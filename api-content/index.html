{"posts":[{"title":"SpringBoot é›†æˆ Mybatis-Plus","content":"1 Mybatis-Plusç®€ä»‹ 1.1 ç®€ä»‹ MyBatis-Plusï¼ˆç®€ç§° MPï¼‰æ˜¯ä¸€ä¸ª MyBatis çš„å¢å¼ºå·¥å…·ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚è¯¥æ¡†æ¶ç”±baomidouï¼ˆè‹ç±³è±†ï¼‰ç»„ç»‡å¼€å‘å¹¶ä¸”å¼€æºçš„ã€‚å®˜ç½‘ï¼šhttps://mp.baomidou.com/ï¼Œç äº‘åœ°å€ï¼šhttps://gitee.com/organizations/baomidou æ„¿æ™¯ æˆ‘ä»¬çš„æ„¿æ™¯æ˜¯æˆä¸º MyBatis æœ€å¥½çš„æ­æ¡£ï¼Œå°±åƒé­‚æ–—ç½— ä¸­çš„ 1Pã€2Pï¼ŒåŸºå‹æ­é…ï¼Œæ•ˆç‡ç¿»å€ã€‚ 1.2 ç‰¹æ€§ æ— ä¾µå…¥ï¼šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œå¼•å…¥å®ƒä¸ä¼šå¯¹ç°æœ‰å·¥ç¨‹äº§ç”Ÿå½±å“ï¼Œå¦‚ä¸èˆ¬é¡ºæ»‘ æŸè€—å°ï¼šå¯åŠ¨å³ä¼šè‡ªåŠ¨æ³¨å…¥åŸºæœ¬ CURDï¼Œæ€§èƒ½åŸºæœ¬æ— æŸè€—ï¼Œç›´æ¥é¢å‘å¯¹è±¡æ“ä½œ å¼ºå¤§çš„ CRUD æ“ä½œï¼šå†…ç½®é€šç”¨ Mapperã€é€šç”¨ Serviceï¼Œä»…ä»…é€šè¿‡å°‘é‡é…ç½®å³å¯å®ç°å•è¡¨å¤§éƒ¨åˆ† CRUD æ“ä½œï¼Œæ›´æœ‰å¼ºå¤§çš„æ¡ä»¶æ„é€ å™¨ï¼Œæ»¡è¶³å„ç±»ä½¿ç”¨éœ€æ±‚ æ”¯æŒ Lambda å½¢å¼è°ƒç”¨ï¼šé€šè¿‡ Lambda è¡¨è¾¾å¼ï¼Œæ–¹ä¾¿çš„ç¼–å†™å„ç±»æŸ¥è¯¢æ¡ä»¶ï¼Œæ— éœ€å†æ‹…å¿ƒå­—æ®µå†™é”™ æ”¯æŒå¤šç§æ•°æ®åº“ï¼šæ”¯æŒ MySQLã€MariaDBã€Oracleã€DB2ã€H2ã€HSQLã€SQLiteã€Postgreã€SQLServer2005ã€SQLServer ç­‰å¤šç§æ•°æ®åº“ æ”¯æŒä¸»é”®è‡ªåŠ¨ç”Ÿæˆï¼šæ”¯æŒå¤šè¾¾ 4 ç§ä¸»é”®ç­–ç•¥ï¼ˆå†…å«åˆ†å¸ƒå¼å”¯ä¸€ ID ç”Ÿæˆå™¨ - Sequenceï¼‰ï¼Œå¯è‡ªç”±é…ç½®ï¼Œå®Œç¾è§£å†³ä¸»é”®é—®é¢˜ æ”¯æŒ XML çƒ­åŠ è½½ï¼šMapper å¯¹åº”çš„ XML æ”¯æŒçƒ­åŠ è½½ï¼Œå¯¹äºç®€å•çš„ CRUD æ“ä½œï¼Œç”šè‡³å¯ä»¥æ—  XML å¯åŠ¨ æ”¯æŒ ActiveRecord æ¨¡å¼ï¼šæ”¯æŒ ActiveRecord å½¢å¼è°ƒç”¨ï¼Œå®ä½“ç±»åªéœ€ç»§æ‰¿ Model ç±»å³å¯è¿›è¡Œå¼ºå¤§çš„ CRUD æ“ä½œ æ”¯æŒè‡ªå®šä¹‰å…¨å±€é€šç”¨æ“ä½œï¼šæ”¯æŒå…¨å±€é€šç”¨æ–¹æ³•æ³¨å…¥ï¼ˆ Write once, use anywhere ï¼‰ æ”¯æŒå…³é”®è¯è‡ªåŠ¨è½¬ä¹‰ï¼šæ”¯æŒæ•°æ®åº“å…³é”®è¯ï¼ˆorderã€key......ï¼‰è‡ªåŠ¨è½¬ä¹‰ï¼Œè¿˜å¯è‡ªå®šä¹‰å…³é”®è¯ å†…ç½®ä»£ç ç”Ÿæˆå™¨ï¼šé‡‡ç”¨ä»£ç æˆ–è€… Maven æ’ä»¶å¯å¿«é€Ÿç”Ÿæˆ Mapper ã€ Model ã€ Service ã€ Controller å±‚ä»£ç ï¼Œæ”¯æŒæ¨¡æ¿å¼•æ“ï¼Œæ›´æœ‰è¶…å¤šè‡ªå®šä¹‰é…ç½®ç­‰æ‚¨æ¥ä½¿ç”¨ å†…ç½®åˆ†é¡µæ’ä»¶ï¼šåŸºäº MyBatis ç‰©ç†åˆ†é¡µï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒå…·ä½“æ“ä½œï¼Œé…ç½®å¥½æ’ä»¶ä¹‹åï¼Œå†™åˆ†é¡µç­‰åŒäºæ™®é€š List æŸ¥è¯¢ å†…ç½®æ€§èƒ½åˆ†ææ’ä»¶ï¼šå¯è¾“å‡º Sql è¯­å¥ä»¥åŠå…¶æ‰§è¡Œæ—¶é—´ï¼Œå»ºè®®å¼€å‘æµ‹è¯•æ—¶å¯ç”¨è¯¥åŠŸèƒ½ï¼Œèƒ½å¿«é€Ÿæªå‡ºæ…¢æŸ¥è¯¢ å†…ç½®å…¨å±€æ‹¦æˆªæ’ä»¶ï¼šæä¾›å…¨è¡¨ delete ã€update æ“ä½œæ™ºèƒ½åˆ†æé˜»æ–­ï¼Œä¹Ÿå¯è‡ªå®šä¹‰æ‹¦æˆªè§„åˆ™ï¼Œé¢„é˜²è¯¯æ“ä½œ å†…ç½® Sql æ³¨å…¥å‰¥ç¦»å™¨ï¼šæ”¯æŒ Sql æ³¨å…¥å‰¥ç¦»ï¼Œæœ‰æ•ˆé¢„é˜² Sql æ³¨å…¥æ”»å‡» 2 å¿«é€Ÿå…¥é—¨ 2.1 åˆ›å»ºæ•°æ®åº“åŠè¡¨ -- åˆ›å»ºæµ‹è¯•è¡¨ CREATE TABLE `sys_user` ( `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID', `user_name` varchar(20) NOT NULL COMMENT 'ç”¨æˆ·å', `name` varchar(30) DEFAULT NULL COMMENT 'å§“å', `age` int(11) DEFAULT NULL COMMENT 'å¹´é¾„', PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8; -- æ’å…¥æµ‹è¯•æ•°æ® INSERT INTO `sys_user` (`id`, `user_name`, `name`, `age`) VALUES ('1', 'zhangsan', 'å¼ ä¸‰', '18'); INSERT INTO `sys_user` (`id`, `user_name`, `name`, `age`) VALUES ('2', 'lisi', 'æå››', '20'); INSERT INTO `sys_user` (`id`, `user_name`, `name`, `age`) VALUES ('3', 'wangwu', 'ç‹äº”', '28'); INSERT INTO `sys_user` (`id`, `user_name`, `name`, `age`) VALUES ('4', 'zhaoliu', 'èµµå…­', '21'); INSERT INTO `sys_user` (`id`, `user_name`, `name`, `age`) VALUES ('5', 'sunqi', 'å­™ä¸ƒ', '24'); ~~~![](http://blog.ludangxin.club/post-images/1597929873595.jpg) ### 2.2 å·¥ç¨‹æ­å»º #### å®Œæ•´çš„é¡¹ç›®ç»“æ„å›¾ç¤º ![](http://blog.ludangxin.club/post-images/1597929500996.jpg) #### 2.2.1 æ·»åŠ æ‰€éœ€ä¾èµ– ~~~xml &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;!--ç®€åŒ–ä»£ç çš„å·¥å…·åŒ…--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!--mybatis-plusçš„springbootæ”¯æŒ--&gt; &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt; &lt;version&gt;3.3.2&lt;/version&gt; &lt;/dependency&gt; &lt;!--mysqlé©±åŠ¨--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.47&lt;/version&gt; &lt;/dependency&gt; 2.2.2 é…ç½® application.yml spring: datasource: # Oracle: oracle.jdbc.OracleDriver # 5.7ä¹‹å‰ç‰ˆæœ¬ä½¿ç”¨ com.mysql.jdbc.Driver driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/mp?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8 username: root password: root type: com.zaxxer.hikari.HikariDataSource hikari: minimum-idle: 5 maximum-pool-size: 5 auto-commit: true idle-timeout: 30000 pool-name: DatebookHikariCP max-lifetime: 1800000 connection-timeout: 30000 connection-test-query: SELECT 1 # Oracle: SELECT 1 FROM DUAL mybatis-plus: # è®¾ç½®Mapperæ¥å£æ‰€å¯¹åº”çš„XMLæ–‡ä»¶ä½ç½®ï¼Œå¦‚æœä½ åœ¨Mapperæ¥å£ä¸­æœ‰è‡ªå®šä¹‰æ–¹æ³•ï¼Œéœ€è¦è¿›è¡Œè¯¥é…ç½® mapper-locations: classpath*:mybatis/*.xml # è®¾ç½®åˆ«ååŒ…æ‰«æè·¯å¾„ï¼Œé€šè¿‡è¯¥å±æ€§å¯ä»¥ç»™åŒ…ä¸­çš„ç±»æ³¨å†Œåˆ«å type-aliases-package: com.ludangxin.mp.pojo configuration: # æ§åˆ¶å°sqlæ‰“å° log-impl: org.apache.ibatis.logging.stdout.StdOutImpl 2.2.3 ç¼–å†™pojo import com.baomidou.mybatisplus.annotation.TableName; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; @Data @NoArgsConstructor @AllArgsConstructor @TableName(&quot;sys_user&quot;) public class User { @TableId(&quot;ID&quot;) private Long id; //é©¼å³°å‘½å,åˆ™æ— éœ€æ³¨è§£ @TableField(&quot;USER_NAME&quot;) private String userName; @TableField(&quot;NAME&quot;) private String name; @TableField(&quot;AGE&quot;) private Integer age; } 2.2.5 ç¼–å†™mapperæ¥å£å’Œé…ç½®æ–‡ä»¶ import com.ludangxin.mp.pojo.User; import com.baomidou.mybatisplus.core.mapper.BaseMapper; public interface UserMapper extends BaseMapper&lt;User&gt; { } åœ¨resourcesç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹mybatisï¼Œä¸“é—¨å­˜æ”¾mapperé…ç½®æ–‡ä»¶ &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt; &lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt; &lt;mapper namespace=&quot;com.ludangxin.mp.mapper.UserMapper&quot;&gt; &lt;/mapper&gt; 2.2.6 ä¿®æ”¹å¯åŠ¨ç±» import org.mybatis.spring.annotation.MapperScan; import org.springframework.boot.SpringApplication; import org.springframework.boot.WebApplicationType; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.boot.builder.SpringApplicationBuilder; //è®¾ç½®mapperæ¥å£çš„æ‰«æåŒ… @MapperScan(&quot;com.ludangxin.mp.mapper&quot;) @SpringBootApplication public class MyApplication { public static void main(String[] args) { SpringApplication.run(MyApplication.class, args); } } 2.2.7 ç¼–å†™æµ‹è¯•ç”¨ä¾‹ import com.ludangxin.mp.mapper.UserMapper; import com.ludangxin.mp.pojo.User; import org.junit.Test; import org.junit.runner.RunWith; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.test.context.junit4.SpringRunner; import java.util.List; @RunWith(SpringRunner.class) @SpringBootTest public class TestMybatisSpringBoot { @Autowired private UserMapper userMapper; @Test public void testSelect() { //æ ¹æ®idæŸ¥è¯¢æ•°æ® User user = userMapper.selectById(2L); System.out.println(user); } } æµ‹è¯•ç»“æœï¼š JDBC Connection [HikariProxyConnection@358849801 wrapping com.mysql.cj.jdbc.ConnectionImpl@4fba8eec] will not be managed by Spring ==&gt; Preparing: SELECT ID,USER_NAME,NAME,AGE FROM sys_user WHERE ID=? ==&gt; Parameters: 2(Long) &lt;== Columns: ID, USER_NAME, NAME, AGE &lt;== Row: 2, lisi, æå››, 20 &lt;== Total: 1 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@39da5e49] User(id=2, userName=lisi, name=æå››, age=20) 3 é€šç”¨CRUD åœ¨å…¥é—¨æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬çš„Mapperæ¥å£ç»§æ‰¿äº†BaseMapperï¼Œç„¶åå°±å¯ä»¥è¿›è¡Œåˆ°å„ç§å„æ ·çš„å•è¡¨æ“ä½œï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†è¯¦ç»†è®²è§£è¿™äº›æ“ä½œã€‚ 3.1 æ’å…¥æ“ä½œ 3.1.1 insertæ–¹æ³• /** * æ’å…¥ä¸€æ¡è®°å½• * @param entity å®ä½“å¯¹è±¡ */ int insert(T entity); 3.1.2 æµ‹è¯•ç”¨ä¾‹ import com.ludangxin.mp.mapper.UserMapper; import com.ludangxin.mp.pojo.User; import org.junit.Test; import org.junit.runner.RunWith; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.test.context.junit4.SpringRunner; import java.util.List; @RunWith(SpringRunner.class) @SpringBootTest public class TestUserMapper { @Autowired private UserMapper userMapper; @Test public void testInsert(){ User user = new User(); user.setAge(301); user.setUserName(&quot;caocao&quot;); user.setName(&quot;æ›¹æ“&quot;); //è¿”å›çš„resultæ˜¯å—å½±å“çš„è¡Œæ•°ï¼Œå¹¶ä¸æ˜¯è‡ªå¢åçš„id int result = userMapper.insert(user); System.out.println(&quot;result = &quot; + result); //è‡ªå¢åçš„idä¼šå›å¡«åˆ°å¯¹è±¡ä¸­ System.out.println(user.getId()); } } æµ‹è¯•ç»“æœï¼š JDBC Connection [HikariProxyConnection@1240320816 wrapping com.mysql.cj.jdbc.ConnectionImpl@59303963] will not be managed by Spring ==&gt; Preparing: INSERT INTO sys_user ( ID, USER_NAME, NAME, AGE ) VALUES ( ?, ?, ?, ? ) ==&gt; Parameters: 1295736901034086401(Long), caocao(String), æ›¹æ“(String), 301(Integer) &lt;== Updates: 1 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@108e9837] result = 1 1295736901034086401 3.1.3 ä¸»é”®ç”Ÿæˆç­–ç•¥ åœ¨åˆšæ‰çš„ä¾‹å­ä¸­ï¼Œæ•°æ®å·²ç»ä¿å­˜åˆ°äº†æ•°æ®åº“ï¼Œä½†æ˜¯idçš„å€¼ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„è‡ªå¢é•¿ï¼Œè€Œæ˜¯MPç”Ÿæˆäº†idçš„å€¼å¹¶å†™å…¥åˆ°äº†æ•°æ®åº“ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡IdTypeç±»è‡ªå·±è®¾ç½®idçš„ç”Ÿæˆç­–ç•¥ã€‚ package com.baomidou.mybatisplus.annotation; import lombok.Getter; /** * ç”ŸæˆIDç±»å‹æšä¸¾ç±» */ @Getter public enum IdType { /** * æ•°æ®åº“IDè‡ªå¢ */ AUTO(0), /** * è¯¥ç±»å‹ä¸ºæœªè®¾ç½®ä¸»é”®ç±»å‹ï¼Œè¿™æ˜¯é»˜è®¤å€¼ */ NONE(1), /** * ç”¨æˆ·è¾“å…¥ID * &lt;p&gt;è¯¥ç±»å‹å¯ä»¥é€šè¿‡è‡ªå·±æ³¨å†Œè‡ªåŠ¨å¡«å……æ’ä»¶è¿›è¡Œå¡«å……&lt;/p&gt; */ INPUT(2), /* ä»¥ä¸‹3ç§ç±»å‹ã€åªæœ‰å½“æ’å…¥å¯¹è±¡IDä¸ºç©ºï¼Œæ‰è‡ªåŠ¨å¡«å……ã€‚ */ /** * å…¨å±€å”¯ä¸€ID (idWorker) */ ID_WORKER(3), /** * å…¨å±€å”¯ä¸€ID (UUID) */ UUID(4), /** * å­—ç¬¦ä¸²å…¨å±€å”¯ä¸€ID (idWorkerçš„å­—ç¬¦ä¸²è¡¨ç¤º) */ ID_WORKER_STR(5); private final int key; IdType(int key) { this.key = key; } } ä¿®æ”¹Userå¯¹è±¡ï¼Œè®¾ç½®idä¸ºè‡ªå¢é•¿ï¼š import com.baomidou.mybatisplus.annotation.IdType; import com.baomidou.mybatisplus.annotation.TableId; import com.baomidou.mybatisplus.annotation.TableName; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; @Data @NoArgsConstructor @AllArgsConstructor @TableName(&quot;sys_user&quot;) public class User { @TableId(type = IdType.AUTO) //æŒ‡å®šidä¸ºè‡ªå¢é•¿ private Long id; ... ... } 3.2 æ›´æ–°æ“ä½œ 3.2.1 updateByIdæ–¹æ³• /** * æ ¹æ®IDä¿®æ”¹ * @param entity å®ä½“å¯¹è±¡ */ int updateById(@Param(Constants.ENTITY) T entity); #### 3.2.2 æµ‹è¯•ç”¨ä¾‹ @Test public void testUpdateById() { User user = new User(); user.setId(5L); //ä¸»é”® user.setAge(21); //æ›´æ–°çš„å­—æ®µ //æ ¹æ®idæ›´æ–°ï¼Œæ›´æ–°ä¸ä¸ºnullçš„å­—æ®µ this.userMapper.updateById(user); } } æµ‹è¯•ç»“æœï¼š JDBC Connection [HikariProxyConnection@864078397 wrapping com.mysql.cj.jdbc.ConnectionImpl@23310248] will not be managed by Spring ==&gt; Preparing: UPDATE sys_user SET AGE=? WHERE id=? ==&gt; Parameters: 21(Integer), 5(Long) &lt;== Updates: 1 3.3 åˆ é™¤æ“ä½œ 3.3.1 deleteById /** * æ ¹æ® ID åˆ é™¤ * @param id ä¸»é”®ID */ int deleteById(Serializable id); 3.3.2 æµ‹è¯•ç”¨ä¾‹ @Test public void testDeleteById() { //æ‰§è¡Œåˆ é™¤æ“ä½œ int result = this.userMapper.deleteById(6L); System.out.println(&quot;result = &quot; + result); } } æµ‹è¯•ç»“æœï¼š JDBC Connection [HikariProxyConnection@103068963 wrapping com.mysql.cj.jdbc.ConnectionImpl@50b46e24] will not be managed by Spring ==&gt; Preparing: DELETE FROM sys_user WHERE id=? ==&gt; Parameters: 5(Long) &lt;== Updates: 1 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@5934ca1e] result = 1 3.3.3 æ‰¹é‡åˆ é™¤ @Test public void testDeleteByIds() { //æ ¹æ®idé›†åˆæ‰¹é‡åˆ é™¤ int result = this.userMapper.deleteBatchIds(Arrays.asList(1L,10L,20L)); System.out.println(&quot;result = &quot; + result); } 3.4 æŸ¥è¯¢æ“ä½œ MPæä¾›äº†å¤šç§æŸ¥è¯¢æ“ä½œï¼ŒåŒ…æ‹¬æ ¹æ®idæŸ¥è¯¢ã€æ‰¹é‡æŸ¥è¯¢ã€æŸ¥è¯¢å•æ¡æ•°æ®ã€æŸ¥è¯¢åˆ—è¡¨ã€åˆ†é¡µæŸ¥è¯¢ç­‰æ“ä½œã€‚ 3.4.1 selectById /** * æ ¹æ®IDæŸ¥è¯¢ * @param id ä¸»é”®ID */ T selectById(Serializable id); 3.4.2 æµ‹è¯•ç”¨ä¾‹ @Test public void testSelectById() { //æ ¹æ®idæŸ¥è¯¢æ•°æ® User user = this.userMapper.selectById(2L); System.out.println(&quot;result = &quot; + user); } } æµ‹è¯•ç»“æœï¼š JDBC Connection [HikariProxyConnection@1317052417 wrapping com.mysql.cj.jdbc.ConnectionImpl@624b523] will not be managed by Spring ==&gt; Preparing: SELECT id,USER_NAME,NAME,AGE FROM sys_user WHERE id=? ==&gt; Parameters: 2(Long) &lt;== Columns: id, USER_NAME, NAME, AGE &lt;== Row: 2, lisi, æå››, 20 &lt;== Total: 1 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@1cbc5693] result = User(id=2, userName=lisi, name=æå››, age=20) 4 æ¡ä»¶æ„é€ å™¨ åœ¨å¢åˆ æ”¹æŸ¥ä¸­ï¼Œæœ€å¤æ‚çš„å°±æ˜¯å¸¦æœ‰å„ç§æ¡ä»¶çš„æ“ä½œã€‚åœ¨MPä¸­ï¼Œä¸“é—¨é’ˆå¯¹sqlæ¡ä»¶è¿›è¡Œäº†å°è£…ï¼Œæä¾›äº†å„ç§Wrapperæ¥å£åŠå…¶å®ç°ç±»ã€‚XxxWrapperç±»æä¾›äº†å„ç§æ–¹æ³•æ¥å°è£…sqlæ¡ä»¶ã€‚ MPæä¾›äº†å„ç§æ–¹æ³•ç”¨æ¥æ”¯æŒå¸¦æœ‰æ¡ä»¶çš„æŸ¥è¯¢æ–¹æ³•ã€ä¿®æ”¹æ–¹æ³•å’Œåˆ é™¤æ–¹æ³•ï¼š /** æ ¹æ® entity æ¡ä»¶ï¼ŒæŸ¥è¯¢ä¸€æ¡è®°å½• @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸ºnullï¼‰ */ T selectOne(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper); /** æ ¹æ® Wrapper æ¡ä»¶ï¼ŒæŸ¥è¯¢æ€»è®°å½•æ•° @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸ºnullï¼‰ */ Integer selectCount(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper); /** æ ¹æ® entity æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½• @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸ºnullï¼‰ */ List&lt;T&gt; selectList(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper); ä¸‹é¢æˆ‘ä»¬ä»¥æŸ¥è¯¢æ–¹æ³•ä¸ºä¾‹å­¦ä¹ æ¡ä»¶æ„é€ å™¨çš„å…·ä½“ç”¨æ³•ã€‚ 4.1 æ¯”è¾ƒæ“ä½œ eq ç­‰äº = ne ä¸ç­‰äº &lt;&gt; gt å¤§äº &gt; ge å¤§äºç­‰äº &gt;= lt å°äº &lt; le å°äºç­‰äº &lt;= between BETWEEN å€¼1 AND å€¼2 notBetween NOT BETWEEN å€¼1 AND å€¼2 in å­—æ®µ IN (value.get(0), value.get(1), ...) notIn å­—æ®µ NOT IN (v0, v1, ...) æµ‹è¯•ç”¨ä¾‹ï¼š @Test public void testEq() { QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;&gt;(); //SELECT id,user_name,name,age FROM sys_user WHERE // AND age &gt;= ? AND name IN (?,?,?) wrapper.ge(&quot;age&quot;, 20) .in(&quot;name&quot;, &quot;æå››&quot;, &quot;ç‹äº”&quot;, &quot;èµµå…­&quot;); List&lt;User&gt; users = this.userMapper.selectList(wrapper); for (User user : users) { System.out.println(user); } } } æµ‹è¯•ç»“æœ: JDBC Connection [HikariProxyConnection@525275084 wrapping com.mysql.cj.jdbc.ConnectionImpl@46c10083] will not be managed by Spring ==&gt; Preparing: SELECT id,USER_NAME,NAME,AGE FROM sys_user WHERE age &gt;= ? AND name IN (?,?,?) ==&gt; Parameters: 20(Integer), æå››(String), ç‹äº”(String), èµµå…­(String) &lt;== Columns: id, USER_NAME, NAME, AGE &lt;== Row: 2, lisi, æå››, 20 &lt;== Row: 3, wangwu, ç‹äº”, 28 &lt;== Row: 4, zhaoliu, èµµå…­, 21 &lt;== Total: 3 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@61149fa5] User(id=2, userName=lisi, name=æå››, age=20) User(id=3, userName=wangwu, name=ç‹äº”, age=28) User(id=4, userName=zhaoliu, name=èµµå…­, age=21) 4.2 æ¨¡ç³ŠæŸ¥è¯¢ like LIKE '%å€¼%' ä¾‹: like(&quot;name&quot;, &quot;ç‹&quot;)---&gt;name like '%ç‹%' notLike NOT LIKE '%å€¼%' ä¾‹: notLike(&quot;name&quot;, &quot;ç‹&quot;)---&gt;name not like '%ç‹%' likeLeft LIKE '%å€¼' ä¾‹: likeLeft(&quot;name&quot;, &quot;ç‹&quot;)---&gt;name like '%ç‹' likeRight LIKE 'å€¼%' ä¾‹: likeRight(&quot;name&quot;, &quot;ç‹&quot;)---&gt;name like 'ç‹%' æµ‹è¯•ç”¨ä¾‹ï¼š @Test public void testLike() { QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;&gt;(); //SELECT id,user_name,name,age FROM sys_user WHERE name LIKE ? //Parameters: %æ›¹%(String) wrapper.like(&quot;name&quot;, &quot;æ›¹&quot;); List&lt;User&gt; users = this.userMapper.selectList(wrapper); for (User user : users) { System.out.println(user); } } } 4.3 æ’åº orderBy æ’åºï¼šORDER BY å­—æ®µ, ... ä¾‹: orderBy(true, true, &quot;id&quot;, &quot;name&quot;)---&gt;order by id ASC,name ASC orderByAsc æ’åºï¼šORDER BY å­—æ®µ, ... ASC ä¾‹: orderByAsc(&quot;id&quot;, &quot;name&quot;)---&gt;order by id ASC,name ASC orderByDesc æ’åºï¼šORDER BY å­—æ®µ, ... DESC ä¾‹: orderByDesc(&quot;id&quot;, &quot;name&quot;)---&gt;order by id DESC,name DESC æµ‹è¯•ç”¨ä¾‹ï¼š @Test public void testOrderByAgeDesc() { QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;&gt;(); //SELECT id,user_name,name,age FROM sys_user ORDER BY age DESC wrapper.orderByDesc(&quot;age&quot;); List&lt;User&gt; users = this.userMapper.selectList(wrapper); for (User user : users) { System.out.println(user); } } } 4.4 é€»è¾‘æŸ¥è¯¢ or æ‹¼æ¥ OR ä¸»åŠ¨è°ƒç”¨orè¡¨ç¤ºç´§æ¥ç€ä¸‹ä¸€ä¸ªæ–¹æ³•ä¸æ˜¯ç”¨andè¿æ¥!(ä¸è°ƒç”¨oråˆ™é»˜è®¤ä¸ºä½¿ç”¨andè¿æ¥) and AND åµŒå¥— ä¾‹: and(i -&gt; i.eq(&quot;name&quot;, &quot;æç™½&quot;).ne(&quot;status&quot;, &quot;æ´»ç€&quot;))---&gt;and (name = 'æç™½' and status &lt;&gt; 'æ´»ç€') æµ‹è¯•ç”¨ä¾‹ï¼š @Test public void testOr() { QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;&gt;(); //SELECT id,user_name,name,age FROM sys_user WHERE //name = ? OR age = ? wrapper.eq(&quot;name&quot;,&quot;æå››&quot;).or().eq(&quot;age&quot;, 24); List&lt;User&gt; users = this.userMapper.selectList(wrapper); for (User user : users) { System.out.println(user); } } } @Test public void testAnd() { QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;&gt;(); //SELECT id,USER_NAME,NAME,AGE FROM sys_user WHERE age = ? AND ( name = ? OR user_Name = ? ) wrapper.eq(&quot;age&quot;, 20) .and(obj -&gt; obj.eq(&quot;name&quot;,&quot;æå››&quot;).or().eq(&quot;user_name&quot;, &quot;ç‹äº”&quot;)); List&lt;User&gt; users = this.userMapper.selectList(wrapper); for (User user : users) { System.out.println(user); } } 4.5 åˆ†é¡µæŸ¥è¯¢ selectPageæ–¹æ³•ï¼š /** * æ ¹æ® entity æ¡ä»¶ï¼ŒæŸ¥è¯¢å…¨éƒ¨è®°å½•ï¼ˆå¹¶ç¿»é¡µï¼‰ * @param page åˆ†é¡µæŸ¥è¯¢æ¡ä»¶ï¼ˆå¯ä»¥ä¸º RowBounds.DEFAULTï¼‰ * @param queryWrapper å®ä½“å¯¹è±¡å°è£…æ“ä½œç±»ï¼ˆå¯ä»¥ä¸º nullï¼‰ */ IPage&lt;T&gt; selectPage(IPage&lt;T&gt; page, @Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper); é…ç½®åˆ†é¡µæ’ä»¶ï¼š import com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor; import org.mybatis.spring.annotation.MapperScan; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class MybatisPlusConfig { /** * åˆ†é¡µæ’ä»¶ */ @Bean public PaginationInterceptor paginationInterceptor() { PaginationInterceptor paginationInterceptor = new PaginationInterceptor(); // è®¾ç½®è¯·æ±‚çš„é¡µé¢å¤§äºæœ€å¤§é¡µåæ“ä½œï¼Œ trueè°ƒå›åˆ°é¦–é¡µï¼Œfalse ç»§ç»­è¯·æ±‚ é»˜è®¤false // paginationInterceptor.setOverflow(false); // è®¾ç½®æœ€å¤§å•é¡µé™åˆ¶æ•°é‡ï¼Œé»˜è®¤ 500 æ¡ï¼Œ-1 ä¸å—é™åˆ¶ // paginationInterceptor.setLimit(500); // å¼€å¯ count çš„ join ä¼˜åŒ–,åªé’ˆå¯¹éƒ¨åˆ† left join paginationInterceptor.setCountSqlParser(new JsqlParserCountOptimize(true)); return paginationInterceptor; } } æµ‹è¯•ç”¨ä¾‹ï¼š @Test public void testSelectPage() { QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;User&gt;(); wrapper.gt(&quot;age&quot;, 20); //å¹´é¾„å¤§äº20å² Page&lt;User&gt; page = new Page&lt;&gt;(1,1); //æ ¹æ®æ¡ä»¶æŸ¥è¯¢æ•°æ® IPage&lt;User&gt; iPage = this.userMapper.selectPage(page, wrapper); System.out.println(&quot;æ•°æ®æ€»æ¡æ•°ï¼š&quot; + iPage.getTotal()); System.out.println(&quot;æ€»é¡µæ•°ï¼š&quot; + iPage.getPages()); List&lt;User&gt; users = iPage.getRecords(); for (User user : users) { System.out.println(&quot;user = &quot; + user); } } } æµ‹è¯•ç»“æœ: JDBC Connection [HikariProxyConnection@1663774813 wrapping com.mysql.cj.jdbc.ConnectionImpl@44598ef7] will not be managed by Spring JsqlParserCountOptimize sql=SELECT id,USER_NAME,NAME,AGE FROM sys_user WHERE age &gt; ? ==&gt; Preparing: SELECT COUNT(1) FROM sys_user WHERE age &gt; ? ==&gt; Parameters: 20(Integer) &lt;== Columns: COUNT(1) &lt;== Row: 3 ==&gt; Preparing: SELECT id,USER_NAME,NAME,AGE FROM sys_user WHERE age &gt; ? LIMIT ?,? ==&gt; Parameters: 20(Integer), 0(Long), 1(Long) &lt;== Columns: id, USER_NAME, NAME, AGE &lt;== Row: 3, wangwu, ç‹äº”, 28 &lt;== Total: 1 Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@11d4d979] æ•°æ®æ€»æ¡æ•°ï¼š3 æ€»é¡µæ•°ï¼š3 user = User(id=3, userName=wangwu, name=ç‹äº”, age=28) 4.6 ä¿®æ”¹å’Œåˆ é™¤ å‰é¢éƒ½æ˜¯ä»¥æŸ¥è¯¢ä¸ºä¾‹è®²è§£æ¡ä»¶æ„é€ å™¨ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œä¿®æ”¹å’Œåˆ é™¤æ“ä½œæ—¶ä¹Ÿå¯ä»¥å¸¦æ¡ä»¶ï¼Œå’ŒæŸ¥è¯¢åŸºæœ¬ä¸€æ ·ï¼Œè¿™é‡Œä¸å†è®²è§£ï¼Œåé¢ç”¨åˆ°æ—¶å†è¯´ã€‚ /** æ ¹æ®wrapperå°è£…çš„æ¡ä»¶è¿›è¡Œæ›´æ–°æ“ä½œ */ int delete(@Param(&quot;ew&quot;) Wrapper&lt;T&gt; wrapper); /** æ ¹æ®wrapperå°è£…çš„æ¡ä»¶è¿›è¡Œåˆ é™¤æ“ä½œ */ int update(@Param(&quot;et&quot;) T entity, @Param(&quot;ew&quot;) Wrapper&lt;T&gt; updateWrapper); 4.7 lambda â€‹ è·å– LambdaWrapper â€‹ åœ¨QueryWrapperä¸­æ˜¯è·å–LambdaQueryWrapper â€‹ åœ¨UpdateWrapperä¸­æ˜¯è·å–LambdaUpdateWrapper â€‹ å¼ºçƒˆä½¿ç”¨lambdaè¡¨è¾¾å¼æ„å»ºwrapperï¼Œæ— éœ€å†æ‹…å¿ƒå­—æ®µå†™é”™ 4.7.1 æµ‹è¯•ç”¨ä¾‹ @Test public void testLambdaSelect(){ LambdaQueryWrapper lambdaQueryWrapper = new LambdaQueryWrapper&lt;User&gt;().eq(User::getUserName,&quot;zhangsan&quot;); //QueryWrapper&lt;User&gt; queryWrapper = new QueryWrapper&lt;&gt;(); //queryWrapper.lambda().eq(User::getName, &quot;zhangsan&quot;); int result = this.userMapper.selectCount(lambdaQueryWrapper); System.out.println(&quot;result = &quot; + result); } 5 Mybatis-Plusçš„Serviceå°è£… Mybatis-Plusä¸ºäº†å¼€å‘æ›´åŠ å¿«æ·ï¼Œå¯¹ä¸šåŠ¡å±‚ä¹Ÿè¿›è¡Œäº†å°è£…ï¼Œç›´æ¥æä¾›äº†ç›¸å…³çš„æ¥å£å’Œå®ç°ç±»ã€‚æˆ‘ä»¬åœ¨è¿›è¡Œä¸šåŠ¡å±‚å¼€å‘æ—¶ï¼Œå¯ä»¥ç»§æ‰¿å®ƒæä¾›çš„æ¥å£å’Œå®ç°ç±»ï¼Œä½¿å¾—ç¼–ç æ›´åŠ é«˜æ•ˆã€‚ com.baomidou.mybatisplus.extension.service.IServiceæ¥å£ è¯¥æ¥å£æ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œé‡Œé¢æä¾›äº†å¾ˆå¤šæ–¹æ³•ï¼ŒåŒ…æ‹¬åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ã€‚ com.baomidou.mybatisplus.extension.service.impl.ServiceImplç±» è¯¥ç±»å®ç°äº†ä¸Šé¢æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•ã€‚ æµ‹è¯•ç”¨ä¾‹ 1ï¼‰è‡ªå®šä¹‰ä¸šåŠ¡å±‚æ¥å£ï¼Œç»§æ‰¿IServiceï¼š public interface UserService extends IService&lt;User&gt; { } 2ï¼‰è‡ªå®šä¹‰ä¸šåŠ¡å±‚å®ç°ç±»ï¼Œç»§æ‰¿ServiceImplï¼š @Service public class UserServiceImpl extends ServiceImpl&lt;UserMapper,User&gt; implements UserService { } 3ï¼‰æµ‹è¯•ç±»ï¼š @RunWith(SpringRunner.class) @SpringBootTest public class TestUserService { @Autowired private UserService userService; @Test public void testInsert() { User user = new User(); user.setAge(301); user.setUserName(&quot;caocao1&quot;); user.setName(&quot;æ›¹æ“1&quot;); userService.save(user); //è·å–è‡ªå¢é•¿åçš„idå€¼, è‡ªå¢é•¿åçš„idå€¼ä¼šå›å¡«åˆ°userå¯¹è±¡ä¸­ System.out.println(&quot;id =&gt; &quot; + user.getId()); } @Test public void testSelectById() { User user = userService.getById(2); System.out.println(user); } @Test public void testUpdateById() { User user = new User(); user.setId(1L); //æ¡ä»¶ï¼Œæ ¹æ®idæ›´æ–° user.setAge(19); //æ›´æ–°çš„å­—æ®µ userService.updateById(user); } @Test public void testDeleteById(){ // æ ¹æ®idåˆ é™¤æ•°æ® userService.removeById(2L); } } 6 oracle ä¸»é”® Sequence åœ¨mysqlä¸­ï¼Œä¸»é”®å¾€å¾€æ˜¯è‡ªå¢é•¿çš„ï¼Œè¿™æ ·ä½¿ç”¨èµ·æ¥æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯Oracleæ•°æ®åº“ï¼Œé‚£ä¹ˆå°±ä¸èƒ½ä½¿ç”¨è‡ªå¢é•¿äº†ï¼Œå°±å¾—ä½¿ç”¨Sequence åºåˆ—ç”Ÿæˆidå€¼äº†ã€‚ 6.1ä¿®æ”¹application.properties mybatis-plus: # è®¾ç½®Mapperæ¥å£æ‰€å¯¹åº”çš„XMLæ–‡ä»¶ä½ç½®ï¼Œå¦‚æœä½ åœ¨Mapperæ¥å£ä¸­æœ‰è‡ªå®šä¹‰æ–¹æ³•ï¼Œéœ€è¦è¿›è¡Œè¯¥é…ç½® mapper-locations: classpath*:mybatis/*.xml # è®¾ç½®åˆ«ååŒ…æ‰«æè·¯å¾„ï¼Œé€šè¿‡è¯¥å±æ€§å¯ä»¥ç»™åŒ…ä¸­çš„ç±»æ³¨å†Œåˆ«å type-aliases-package: com.ludangxin.mp.pojo configuration: log-impl: org.apache.ibatis.logging.stdout.StdOutImpl # id ç”Ÿæˆç­–ç•¥ global-config: db-config: id-type: input 6.2 MybatisPlusConfig å¢åŠ åºåˆ—ç”Ÿæˆå™¨é…ç½® /*** åºåˆ—ç”Ÿæˆå™¨ */ @Bean public OracleKeyGenerator oracleKeyGenerator(){ return new OracleKeyGenerator(); } 7 é€»è¾‘åˆ é™¤ å¼€å‘ç³»ç»Ÿæ—¶ï¼Œæœ‰æ—¶å€™åœ¨å®ç°åŠŸèƒ½æ—¶ï¼Œåˆ é™¤æ“ä½œéœ€è¦å®ç°é€»è¾‘åˆ é™¤ï¼Œæ‰€è°“é€»è¾‘åˆ é™¤å°±æ˜¯å°†æ•°æ®æ ‡è®°ä¸ºåˆ é™¤ï¼Œè€Œå¹¶éçœŸæ­£çš„ç‰©ç†åˆ é™¤ï¼ˆéDELETEæ“ä½œï¼‰ï¼ŒæŸ¥è¯¢æ—¶éœ€è¦æºå¸¦çŠ¶æ€æ¡ä»¶ï¼Œç¡®ä¿è¢«æ ‡è®°çš„æ•°æ®ä¸è¢«æŸ¥è¯¢åˆ°ã€‚è¿™æ ·åšçš„ç›®çš„å°±æ˜¯é¿å…æ•°æ®è¢«çœŸæ­£çš„åˆ é™¤ã€‚ 7.1 å¢åŠ å­—æ®µ ALTER TABLE sys_user ADD COLUMN deleted int(1) NULL DEFAULT 0 COMMENT '1ä»£è¡¨åˆ é™¤ï¼Œ0ä»£è¡¨æœªåˆ é™¤'; 7.2 ä¿®æ”¹pojo @TableLogic private Integer deleted; 7.3 ä¿®æ”¹application.yml mybatis-plus: # è®¾ç½®Mapperæ¥å£æ‰€å¯¹åº”çš„XMLæ–‡ä»¶ä½ç½®ï¼Œå¦‚æœä½ åœ¨Mapperæ¥å£ä¸­æœ‰è‡ªå®šä¹‰æ–¹æ³•ï¼Œéœ€è¦è¿›è¡Œè¯¥é…ç½® mapper-locations: classpath*:mybatis/*.xml # è®¾ç½®åˆ«ååŒ…æ‰«æè·¯å¾„ï¼Œé€šè¿‡è¯¥å±æ€§å¯ä»¥ç»™åŒ…ä¸­çš„ç±»æ³¨å†Œåˆ«å type-aliases-package: com.ludangxin.mp.pojo configuration: # æ§åˆ¶å°sqlæ‰“å° log-impl: org.apache.ibatis.logging.stdout.StdOutImpl global-config: db-config: # é€»è¾‘åˆ é™¤å€¼ä¸º1 logic-delete-value: 1 # é€»è¾‘æœªåˆ é™¤å€¼ä¸º 0 logic-not-delete-value: 0 7.4 æµ‹è¯•ç”¨ä¾‹ @Test public void testDeleteById2() { this.userMapper.deleteById(3L); } 7.5 æµ‹è¯•ç»“æœ JDBC Connection [HikariProxyConnection@2098830440 wrapping com.mysql.cj.jdbc.ConnectionImpl@63411512] will not be managed by Spring ==&gt; Preparing: UPDATE sys_user SET deleted=1 WHERE id=? AND deleted=0 ==&gt; Parameters: 3(Long) &lt;== Updates: 1 8 ä¹è§‚é” ä¸»è¦é€‚ç”¨åœºæ™¯ æ„å›¾ï¼š å½“è¦æ›´æ–°ä¸€æ¡è®°å½•çš„æ—¶å€™ï¼Œå¸Œæœ›è¿™æ¡è®°å½•æ²¡æœ‰è¢«åˆ«äººæ›´æ–° ä¹è§‚é”å®ç°æ–¹å¼ï¼š å–å‡ºè®°å½•æ—¶ï¼Œè·å–å½“å‰version æ›´æ–°æ—¶ï¼Œå¸¦ä¸Šè¿™ä¸ªversion æ‰§è¡Œæ›´æ–°æ—¶ï¼Œ set version = newVersion where version = oldVersion å¦‚æœversionä¸å¯¹ï¼Œå°±æ›´æ–°å¤±è´¥ ä¹è§‚é”é…ç½®éœ€è¦2æ­¥ è®°å¾—ä¸¤æ­¥ 8.1 å¢åŠ å­—æ®µ ALTER TABLE `sys_user` ADD COLUMN `version` int(10) NULL COMMENT 'ä¹è§‚é”' ; 8.2 ä¿®æ”¹pojo @Version private Integer version; 8.3 å¢åŠ ä¹è§‚é”é…ç½® /** * ä¹è§‚é”é…ç½® * @return */ @Bean public OptimisticLockerInterceptor optimisticLockerInterceptor() { return new OptimisticLockerInterceptor(); } 8.4 æµ‹è¯•ç”¨ä¾‹ @Test public void testUpdate(){ User user = new User(); user.setAge(30); user.setId(2L); //è·å–åˆ°versionä¸º1 user.setVersion(1); int result = this.userMapper.updateById(user); System.out.println(&quot;result = &quot; + result); } 8.5 æµ‹è¯•ç»“æœ JDBC Connection [HikariProxyConnection@2032547119 wrapping com.mysql.cj.jdbc.ConnectionImpl@5bc63e20] will not be managed by Spring ==&gt; Preparing: UPDATE sys_user SET AGE=?, version=? WHERE id=? AND version=? AND deleted=0 ==&gt; Parameters: 30(Integer), 2(Integer), 2(Long), 1(Integer) &lt;== Updates: 0 æ³¨: æ“ä½œè®°å½•æ•°ä¸º0è¯´æ˜å·²ç»æœ‰äººupdateäº† 9 è‡ªåŠ¨å¡«å……åŠŸèƒ½ ç¤ºä¾‹å·¥ç¨‹ï¼š ğŸ‘‰ mybatis-plus-sample-auto-fill-metainfo 9.1 æ·»åŠ å­—æ®µ ALTER TABLE `sys_user` ADD COLUMN `create_by` VARCHAR(50) NULL COMMENT 'åˆ›å»ºäºº' ; ALTER TABLE `sys_user` ADD COLUMN `update_by` VARCHAR(50) NULL COMMENT 'ä¿®æ”¹äºº' ; 9.2 ä¿®æ”¹pojo @TableField(fill = FieldFill.INSERT) private String createBy; @TableField(fill = FieldFill.UPDATE) private String updateBy; 9.2.1 FieldFillæä¾›äº†å¤šç§æ¨¡å¼é€‰æ‹© public enum FieldFill { /** * é»˜è®¤ä¸å¤„ç† */ DEFAULT, /** * æ’å…¥å¡«å……å­—æ®µ */ INSERT, /** * æ›´æ–°å¡«å……å­—æ®µ */ UPDATE, /** * æ’å…¥å’Œæ›´æ–°å¡«å……å­—æ®µ */ INSERT_UPDATE } è‡ªå®šä¹‰å®ç°ç±» MyMetaObjectHandler import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler; import lombok.extern.slf4j.Slf4j; import org.apache.ibatis.reflection.MetaObject; import org.springframework.stereotype.Component; @Slf4j @Component public class MyMetaObjectHandler implements MetaObjectHandler { @Override public void insertFill(MetaObject metaObject) { // Object createTime = getFieldValByName(&quot;createTime&quot;, metaObject); // //å­—æ®µä¸ºç©ºï¼Œå¯ä»¥è¿›è¡Œå¡«å…… // if (null == createTime) { // setFieldValByName(&quot;createTime&quot;, LocalDateTime.now(), metaObject); // } log.info(&quot;start insert fill ....&quot;); this.strictInsertFill(metaObject, &quot;createBy&quot;, String.class, this.getUserId()); } @Override public void updateFill (MetaObject metaObject){ log.info(&quot;start update fill ....&quot;); this.strictUpdateFill(metaObject, &quot;updateBy&quot;, String.class, this.getUserId()); } private String getUserId() { return &quot;001&quot;; } } æ³¨æ„äº‹é¡¹ï¼š å¡«å……åŸç†æ˜¯ç›´æ¥ç»™entityçš„å±æ€§è®¾ç½®å€¼!!! æ³¨è§£åˆ™æ˜¯æŒ‡å®šè¯¥å±æ€§åœ¨å¯¹åº”æƒ…å†µä¸‹å¿…æœ‰å€¼,å¦‚æœæ— å€¼åˆ™å…¥åº“ä¼šæ˜¯null MetaObjectHandleræä¾›çš„é»˜è®¤æ–¹æ³•çš„ç­–ç•¥å‡ä¸º:å¦‚æœå±æ€§æœ‰å€¼åˆ™ä¸è¦†ç›–,å¦‚æœå¡«å……å€¼ä¸ºnullåˆ™ä¸å¡«å…… å­—æ®µå¿…é¡»å£°æ˜TableFieldæ³¨è§£,å±æ€§fillé€‰æ‹©å¯¹åº”ç­–ç•¥,è¯¥å£°æ˜å‘ŠçŸ¥Mybatis-Pluséœ€è¦é¢„ç•™æ³¨å…¥SQLå­—æ®µ å¡«å……å¤„ç†å™¨MyMetaObjectHandleråœ¨ Spring Boot ä¸­éœ€è¦å£°æ˜@Componentæˆ–@Beanæ³¨å…¥ è¦æƒ³æ ¹æ®æ³¨è§£FieldFill.xxxå’Œå­—æ®µåä»¥åŠå­—æ®µç±»å‹æ¥åŒºåˆ†å¿…é¡»ä½¿ç”¨çˆ¶ç±»çš„strictInsertFillæˆ–è€…strictUpdateFillæ–¹æ³• ä¸éœ€è¦æ ¹æ®ä»»ä½•æ¥åŒºåˆ†å¯ä»¥ä½¿ç”¨çˆ¶ç±»çš„fillStrategyæ–¹æ³• 9.3 æ‰§è¡Œæ–°å¢æ“ä½œæ—¥å¿— JDBC Connection [HikariProxyConnection@897358809 wrapping com.mysql.cj.jdbc.ConnectionImpl@7aea704c] will not be managed by Spring ==&gt; Preparing: INSERT INTO sys_user ( USER_NAME, NAME, AGE, create_by ) VALUES ( ?, ?, ?, ? ) ==&gt; Parameters: caocao(String), æ›¹æ“(String), 301(Integer), 001(String) &lt;== Updates: 1 10 å¤šæ•°æ®æºé…ç½® ç®€ä»‹ dynamic-datasource-spring-boot-starter æ˜¯ä¸€ä¸ªåŸºäºspringbootçš„å¿«é€Ÿé›†æˆå¤šæ•°æ®æºçš„å¯åŠ¨å™¨ã€‚ å…¶æ”¯æŒ Jdk 1.7+, SpringBoot 1.4.x 1.5.x 2.x.xã€‚ ç¤ºä¾‹é¡¹ç›® å¯å‚è€ƒé¡¹ç›®ä¸‹çš„samplesç›®å½•ã€‚ ç‰¹æ€§ æ”¯æŒ æ•°æ®æºåˆ†ç»„ ï¼Œé€‚ç”¨äºå¤šç§åœºæ™¯ çº¯ç²¹å¤šåº“ è¯»å†™åˆ†ç¦» ä¸€ä¸»å¤šä» æ··åˆæ¨¡å¼ã€‚ æ”¯æŒæ•°æ®åº“æ•æ„Ÿé…ç½®ä¿¡æ¯ åŠ å¯† ENC()ã€‚ æ”¯æŒæ¯ä¸ªæ•°æ®åº“ç‹¬ç«‹åˆå§‹åŒ–è¡¨ç»“æ„schemaå’Œæ•°æ®åº“databaseã€‚ æ”¯æŒ è‡ªå®šä¹‰æ³¨è§£ ï¼Œéœ€ç»§æ‰¿DS(3.2.0+)ã€‚ æä¾›å¯¹Druidï¼ŒMybatis-Plusï¼ŒP6syï¼ŒJndiçš„å¿«é€Ÿé›†æˆã€‚ ç®€åŒ–Druidå’ŒHikariCpé…ç½®ï¼Œæä¾› å…¨å±€å‚æ•°é…ç½® ã€‚é…ç½®ä¸€æ¬¡ï¼Œå…¨å±€é€šç”¨ã€‚ æä¾› è‡ªå®šä¹‰æ•°æ®æºæ¥æº æ–¹æ¡ˆã€‚ æä¾›é¡¹ç›®å¯åŠ¨å åŠ¨æ€å¢åŠ ç§»é™¤æ•°æ®æº æ–¹æ¡ˆã€‚ æä¾›Mybatisç¯å¢ƒä¸‹çš„ çº¯è¯»å†™åˆ†ç¦» æ–¹æ¡ˆã€‚ æä¾›ä½¿ç”¨ spelåŠ¨æ€å‚æ•° è§£ææ•°æ®æºæ–¹æ¡ˆã€‚å†…ç½®spelï¼Œsessionï¼Œheaderï¼Œæ”¯æŒè‡ªå®šä¹‰ã€‚ æ”¯æŒ å¤šå±‚æ•°æ®æºåµŒå¥—åˆ‡æ¢ ã€‚ï¼ˆServiceA &gt;&gt;&gt; ServiceB &gt;&gt;&gt; ServiceCï¼‰ã€‚ æä¾›å¯¹shiroï¼Œsharding-jdbc,quartzç­‰ç¬¬ä¸‰æ–¹åº“é›†æˆçš„æ–¹æ¡ˆ,æ³¨æ„äº‹é¡¹å’Œç¤ºä¾‹ã€‚ æä¾› åŸºäºseataçš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆã€‚ é™„ï¼šä¸æ”¯æŒåŸç”Ÿspringäº‹åŠ¡ã€‚ çº¦å®š æœ¬æ¡†æ¶åªåš åˆ‡æ¢æ•°æ®æº è¿™ä»¶æ ¸å¿ƒçš„äº‹æƒ…ï¼Œå¹¶ä¸é™åˆ¶ä½ çš„å…·ä½“æ“ä½œï¼Œåˆ‡æ¢äº†æ•°æ®æºå¯ä»¥åšä»»ä½•CRUDã€‚ é…ç½®æ–‡ä»¶æ‰€æœ‰ä»¥ä¸‹åˆ’çº¿ _ åˆ†å‰²çš„æ•°æ®æº é¦–éƒ¨ å³ä¸ºç»„çš„åç§°ï¼Œç›¸åŒç»„åç§°çš„æ•°æ®æºä¼šæ”¾åœ¨ä¸€ä¸ªç»„ä¸‹ã€‚ åˆ‡æ¢æ•°æ®æºå¯ä»¥æ˜¯ç»„åï¼Œä¹Ÿå¯ä»¥æ˜¯å…·ä½“æ•°æ®æºåç§°ã€‚ç»„ååˆ™åˆ‡æ¢æ—¶é‡‡ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•åˆ‡æ¢ã€‚ é»˜è®¤çš„æ•°æ®æºåç§°ä¸º master ï¼Œä½ å¯ä»¥é€šè¿‡ spring.datasource.dynamic.primary ä¿®æ”¹ã€‚ æ–¹æ³•ä¸Šçš„æ³¨è§£ä¼˜å…ˆäºç±»ä¸Šæ³¨è§£ã€‚ å¼ºçƒˆå»ºè®®åªåœ¨serviceçš„ç±»å’Œæ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£ï¼Œä¸å»ºè®®åœ¨mapperä¸Šæ·»åŠ æ³¨è§£ã€‚ ä½¿ç”¨æ–¹æ³• å¼•å…¥dynamic-datasource-spring-boot-starterã€‚ &lt;dependency&gt; &lt;groupId&gt;com.baomidou&lt;/groupId&gt; &lt;artifactId&gt;dynamic-datasource-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;${version}&lt;/version&gt; &lt;/dependency&gt; é…ç½®æ•°æ®æºã€‚ spring: datasource: dynamic: primary: master #è®¾ç½®é»˜è®¤çš„æ•°æ®æºæˆ–è€…æ•°æ®æºç»„,é»˜è®¤å€¼å³ä¸ºmaster strict: false #è®¾ç½®ä¸¥æ ¼æ¨¡å¼,é»˜è®¤falseä¸å¯åŠ¨. å¯åŠ¨ååœ¨æœªåŒ¹é…åˆ°æŒ‡å®šæ•°æ®æºæ—¶å€™ä¼šæŠ›å‡ºå¼‚å¸¸,ä¸å¯åŠ¨åˆ™ä½¿ç”¨é»˜è®¤æ•°æ®æº. datasource: master: url: jdbc:mysql://xx.xx.xx.xx:3306/dynamic username: root password: 123456 driver-class-name: com.mysql.jdbc.Driver # 3.2.0å¼€å§‹æ”¯æŒSPIå¯çœç•¥æ­¤é…ç½® slave_1: url: jdbc:mysql://xx.xx.xx.xx:3307/dynamic username: root password: 123456 driver-class-name: com.mysql.jdbc.Driver slave_2: url: ENC(xxxxx) # å†…ç½®åŠ å¯†,ä½¿ç”¨è¯·æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ username: ENC(xxxxx) password: ENC(xxxxx) driver-class-name: com.mysql.jdbc.Driver schema: db/schema.sql # é…ç½®åˆ™ç”Ÿæ•ˆ,è‡ªåŠ¨åˆå§‹åŒ–è¡¨ç»“æ„ data: db/data.sql # é…ç½®åˆ™ç”Ÿæ•ˆ,è‡ªåŠ¨åˆå§‹åŒ–æ•°æ® continue-on-error: true # é»˜è®¤true,åˆå§‹åŒ–å¤±è´¥æ˜¯å¦ç»§ç»­ separator: &quot;;&quot; # sqlé»˜è®¤åˆ†å·åˆ†éš”ç¬¦ #......çœç•¥ #ä»¥ä¸Šä¼šé…ç½®ä¸€ä¸ªé»˜è®¤åº“masterï¼Œä¸€ä¸ªç»„slaveä¸‹æœ‰ä¸¤ä¸ªå­åº“slave_1,slave_2 # å¤šä¸»å¤šä» çº¯ç²¹å¤šåº“ï¼ˆè®°å¾—è®¾ç½®primaryï¼‰ æ··åˆé…ç½® spring: spring: spring: datasource: datasource: datasource: dynamic: dynamic: dynamic: datasource: datasource: datasource: master_1: mysql: master: master_2: oracle: slave_1: slave_1: sqlserver: slave_2: slave_2: postgresql: oracle_1: slave_3: h2: oracle_2: ä½¿ç”¨ @DS åˆ‡æ¢æ•°æ®æºã€‚ @DS å¯ä»¥æ³¨è§£åœ¨æ–¹æ³•ä¸Šå’Œç±»ä¸Šï¼ŒåŒæ—¶å­˜åœ¨æ–¹æ³•æ³¨è§£ä¼˜å…ˆäºç±»ä¸Šæ³¨è§£ã€‚ å¼ºçƒˆå»ºè®®åªæ³¨è§£åœ¨serviceå®ç°ä¸Šã€‚ æ³¨è§£ ç»“æœ æ²¡æœ‰@DS é»˜è®¤æ•°æ®æº @DS(&quot;dsName&quot;) dsNameå¯ä»¥ä¸ºç»„åä¹Ÿå¯ä»¥ä¸ºå…·ä½“æŸä¸ªåº“çš„åç§° @Service @DS(&quot;slave&quot;) public class UserServiceImpl implements UserService { @Autowired private JdbcTemplate jdbcTemplate; public List selectAll() { return jdbcTemplate.queryForList(&quot;select * from user&quot;); } @Override @DS(&quot;slave_1&quot;) public List selectByCondition() { return jdbcTemplate.queryForList(&quot;select * from user where age &gt;10&quot;); } } #èµ¶ç´§é›†æˆä½“éªŒä¸€ä¸‹å§ï¼ å¦‚æœéœ€è¦æ›´å¤šåŠŸèƒ½è¯·ç‚¹å‡»ä¸‹é¢é“¾æ¥æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼ å¸¸è§é—®é¢˜è¯·ç‚¹æˆ‘ åˆ†å¸ƒå¼äº‹åŠ¡ï¼ŒåŠ å¯†,Druidé›†æˆï¼ŒMybatisPlusé›†æˆï¼ŒåŠ¨æ€å¢å‡æ•°æ®æºï¼Œè‡ªå®šä¹‰åˆ‡æ¢è§„åˆ™,çº¯è¯»å†™åˆ†ç¦»æ’ä»¶ç­‰ç­‰æ›´å¤šæ›´ç»†è‡´çš„æ–‡æ¡£åœ¨è¿™é‡Œ ","link":"http://blog.ludangxin.club/post/mybatis-plus/"},{"title":"SpringBoot  é›†æˆ ä»»åŠ¡è°ƒåº¦","content":"ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä»»åŠ¡è°ƒåº¦ å®šæ—¶ä»»åŠ¡çš„åœºæ™¯å¯ä»¥è¯´éå¸¸å¹¿æ³›ï¼Œæ¯”å¦‚æŸäº›è§†é¢‘ç½‘ç«™ï¼Œè´­ä¹°ä¼šå‘˜åï¼Œæ¯å¤©ä¼šç»™ä¼šå‘˜é€æˆé•¿å€¼ï¼Œæ¯æœˆä¼šç»™ä¼šå‘˜é€ä¸€äº›ç”µå½±åˆ¸ï¼›æ¯”å¦‚åœ¨ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„åœºæ™¯ä¸­ï¼Œå¾€å¾€åˆ©ç”¨å®šæ—¶ä»»åŠ¡è°ƒåº¦è¿›è¡Œä¸€äº›æ¯”å¯¹å·¥ä½œï¼›æ¯”å¦‚ä¸€äº›å®šæ—¶éœ€è¦ç”Ÿæˆçš„æŠ¥è¡¨ã€é‚®ä»¶ï¼›æ¯”å¦‚ä¸€äº›éœ€è¦å®šæ—¶æ¸…ç†æ•°æ®çš„ä»»åŠ¡ç­‰ã€‚ @Scheduled springboot scheduling å®˜æ–¹æ•™ç¨‹ å¿«é€Ÿä¸Šæ‰‹ éœ€æ±‚: æ¯ä¸ªäº”ç§’æ‰“å°ä¸€æ¬¡æ—¥å¿— å¼•å…¥æ‰€éœ€ä¾èµ– å› spring-boot-starterä¸­é»˜è®¤å¼•å…¥äº†schedulerä¾èµ–,æ‰€ä»¥ä¸ç”¨é¢å¤–æ·»åŠ  &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- lombok å·¥å…·ç±» --&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; ä¿®æ”¹å¯åŠ¨ç±» import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import org.springframework.scheduling.annotation.EnableScheduling; // å¼€å¯Scheduler @EnableScheduling @SpringBootApplication public class SpringbootApplication { public static void main(String[] args) { SpringApplication.run(SpringbootApplication.class, args); } } åˆ›å»ºæ—¥å¿—æ‰“å°ä»»åŠ¡ import lombok.extern.slf4j.Slf4j; import org.springframework.scheduling.annotation.Scheduled; import org.springframework.stereotype.Component; import java.text.SimpleDateFormat; import java.util.Date; @Slf4j @Component public class PrintTask { private static final SimpleDateFormat DATE_FORMAT = new SimpleDateFormat(&quot;HH:mm:ss&quot;); /** * æ¯éš”5ç§’æ‰“å°ä¸€æ¬¡æ—¥å¿— */ @Scheduled(fixedRate = 5000) public void reportCurrentTime() { log.info(&quot;The time is now {}&quot;, DATE_FORMAT.format(new Date())); } } è¾“å‡ºç»“æœ 2020-06-04 21:33:06.130 INFO 1244 --- [ scheduling-1] com.ldx.springboot.scheduler.PrintTask : The time is now 21:33:06 2020-06-04 21:33:11.131 INFO 1244 --- [ scheduling-1] com.ldx.springboot.scheduler.PrintTask : The time is now 21:33:11 2020-06-04 21:33:16.133 INFO 1244 --- [ scheduling-1] com.ldx.springboot.scheduler.PrintTask : The time is now 21:33:16 2020-06-04 21:33:21.135 INFO 1244 --- [ scheduling-1] com.ldx.springboot.scheduler.PrintTask : The time is now 21:33:21 2020-06-04 21:33:26.137 INFO 1244 --- [ scheduling-1] com.ldx.springboot.scheduler.PrintTask : The time is now 21:33:26 2020-06-04 21:33:31.139 INFO 1244 --- [ scheduling-1] com.ldx.springboot.scheduler.PrintTask : The time is now 21:33:31 2020-06-04 21:33:36.140 INFO 1244 --- [ scheduling-1] com.ldx.springboot.scheduler.PrintTask : The time is now 21:33:36 2020-06-04 21:33:41.142 INFO 1244 --- [ scheduling-1] com.ldx.springboot.scheduler.PrintTask : The time is now 21:33:41 é…ç½®TaskSchedulerçº¿ç¨‹æ±  åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸€ä¸ªç³»ç»Ÿå¯èƒ½ä¼šå®šä¹‰å¤šä¸ªå®šæ—¶ä»»åŠ¡ã€‚é‚£ä¹ˆå¤šä¸ªå®šæ—¶ä»»åŠ¡ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’ç‹¬ç«‹ä¸”å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„ã€‚ é€šè¿‡æŸ¥çœ‹org.springframework.scheduling.config.ScheduledTaskRegistraræºä»£ç ï¼Œå‘ç°springé»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹æ± ã€‚è¿™æ ·å¯¹äºæˆ‘ä»¬çš„å¤šä»»åŠ¡è°ƒåº¦å¯èƒ½ä¼šæ˜¯è‡´å‘½çš„ï¼Œå½“å¤šä¸ªä»»åŠ¡å¹¶å‘ï¼ˆæˆ–éœ€è¦åœ¨åŒä¸€æ—¶é—´ï¼‰æ‰§è¡Œæ—¶ï¼Œä»»åŠ¡è°ƒåº¦å™¨å°±ä¼šå‡ºç°æ—¶é—´æ¼‚ç§»ï¼Œä»»åŠ¡æ‰§è¡Œæ—¶é—´å°†ä¸ç¡®å®šã€‚ æºç  protected void scheduleTasks() { if (this.taskScheduler == null) { this.localExecutor = Executors.newSingleThreadScheduledExecutor(); this.taskScheduler = new ConcurrentTaskScheduler(this.localExecutor); } //çœç•¥... } è‡ªå®šä¹‰çº¿ç¨‹æ±  import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.scheduling.TaskScheduler; import org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler; @Configuration public class ScheduleConfig { @Bean public TaskScheduler taskScheduler() { //org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler ThreadPoolTaskScheduler threadPoolTaskScheduler = new ThreadPoolTaskScheduler(); threadPoolTaskScheduler.setPoolSize(20); return threadPoolTaskScheduler; } } æ³¨è§£å‚æ•°ä»‹ç» å‚æ•° ä½œç”¨ fixedRate è¯¥å±æ€§çš„å«ä¹‰æ˜¯ä¸Šä¸€ä¸ªè°ƒç”¨å¼€å§‹åå†æ¬¡è°ƒç”¨çš„å»¶æ—¶ï¼ˆä¸ç”¨ç­‰å¾…ä¸Šä¸€æ¬¡è°ƒç”¨å®Œæˆï¼‰ï¼Œè¿™æ ·å°±ä¼šå­˜åœ¨é‡å¤æ‰§è¡Œçš„é—®é¢˜ï¼Œæ‰€ä»¥ä¸æ˜¯å»ºè®®ä½¿ç”¨ï¼Œä½†æ•°æ®é‡å¦‚æœä¸å¤§æ—¶åœ¨é…ç½®çš„é—´éš”æ—¶é—´å†…å¯ä»¥æ‰§è¡Œå®Œä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚ fixedDelay è¯¥å±æ€§çš„åŠŸæ•ˆä¸ä¸Šé¢çš„fixedRateåˆ™æ˜¯ç›¸åçš„ï¼Œé…ç½®äº†è¯¥å±æ€§åä¼šç­‰åˆ°æ–¹æ³•æ‰§è¡Œå®Œæˆåå»¶è¿Ÿé…ç½®çš„æ—¶é—´å†æ¬¡æ‰§è¡Œè¯¥æ–¹æ³•. initialDelay è¯¥å±æ€§è·Ÿä¸Šé¢çš„fixedDelayã€fixedRateæœ‰ç€å¯†åˆ‡çš„å…³ç³»ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿè¯¥å±æ€§çš„ä½œç”¨æ˜¯ç¬¬ä¸€æ¬¡æ‰§è¡Œå»¶è¿Ÿæ—¶é—´ï¼Œåªæ˜¯åšå»¶è¿Ÿçš„è®¾å®šï¼Œå¹¶ä¸ä¼šæ§åˆ¶å…¶ä»–é€»è¾‘ï¼Œæ‰€ä»¥è¦é…åˆfixedDelayæˆ–è€…fixedRateæ¥ä½¿ç”¨ cron cronå°±ä¸åšèµ˜è¿°äº†ã€‚ä¼ é€é—¨ zone æŒ‡å®šè§£æcronè¡¨è¾¾å¼çš„æ—¶åŒº ç‰¹ç‚¹ ä¼˜ç‚¹: è¶³å¤Ÿç®€å• , æ˜“ä¸Šæ‰‹ ç¼ºç‚¹: æ— æ³•å®ç°å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ å¦‚æœæœåŠ¡å™¨å®•æœº , é‚£ä¹ˆå†…å­˜ä¸­çš„å®šæ—¶ä»»åŠ¡å°±ä¼šé‡Šæ”¾,æ— æ³•æ”¯æŒmisfire åˆ†å¸ƒå¼éƒ¨ç½²ä¼šå‡ºç°é‡å¤è°ƒç”¨çš„é—®é¢˜ç­‰... Quartz Quartzæ˜¯çº¯Javaå®ç°ï¼Œè€Œä¸”ä½œä¸ºSpringçš„é»˜è®¤è°ƒåº¦æ¡†æ¶ï¼Œç”±äºQuartzçš„å¼ºå¤§çš„è°ƒåº¦åŠŸèƒ½ã€çµæ´»çš„ä½¿ç”¨æ–¹å¼ã€è¿˜å…·æœ‰åˆ†å¸ƒå¼é›†ç¾¤èƒ½åŠ›ï¼Œå¯ä»¥è¯´Quartzå‡ºé©¬ï¼Œå¯ä»¥æå®šä¸€åˆ‡å®šæ—¶ä»»åŠ¡è°ƒåº¦ï¼ Quartz ä¸­ä¸»è¦å¯¹è±¡ Schedulerï¼šè°ƒåº¦ä»»åŠ¡çš„ä¸»è¦API ScheduleBuilderï¼šç”¨äºæ„å»ºSchedulerï¼Œä¾‹å¦‚å…¶ç®€å•å®ç°ç±»SimpleScheduleBuilder Jobï¼šè°ƒåº¦ä»»åŠ¡æ‰§è¡Œçš„æ¥å£ï¼Œä¹Ÿå³å®šæ—¶ä»»åŠ¡æ‰§è¡Œçš„æ–¹æ³• JobDetailï¼šå®šæ—¶ä»»åŠ¡ä½œä¸šçš„å®ä¾‹ JobBuilderï¼šå…³è”å…·ä½“çš„Jobï¼Œç”¨äºæ„å»ºJobDetail Triggerï¼šå®šä¹‰è°ƒåº¦æ‰§è¡Œè®¡åˆ’çš„ç»„ä»¶ï¼Œå³å®šæ—¶æ‰§è¡Œ TriggerBuilderï¼šæ„å»ºTrigger å¿«é€Ÿä¸Šæ‰‹ æ·»åŠ æ‰€éœ€ä¾èµ– &lt;!-- spring boot --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- quartz ä»»åŠ¡è°ƒåº¦ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-quartz&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- mysqlä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.47&lt;/version&gt; &lt;/dependency&gt; &lt;!-- mybatis --&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.1&lt;/version&gt; &lt;/dependency&gt; &lt;!-- lombok å·¥å…·ç±» --&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; é…ç½®application.yml spring: datasource: type: com.zaxxer.hikari.HikariDataSource driver-class-name: com.mysql.jdbc.Driver url: jdbc:mysql://localhost:3306/test?useUnicode=true&amp;zeroDateTimeBehavior=convertToNull&amp;autoReconnect=true&amp;characterEncoding=utf-8 username: root password: root hikari: minimum-idle: 5 idle-timeout: 600000 maximum-pool-size: 10 auto-commit: true pool-name: MyHikariCP max-lifetime: 1800000 connection-timeout: 30000 connection-test-query: SELECT 1 quartz: # ç›¸å…³å±æ€§é…ç½® properties: org: quartz: scheduler: # å®ä¾‹åç§° instanceName: TestScheduler # å®ä¾‹id instanceId: AUTO jobStore: class: org.quartz.impl.jdbcjobstore.JobStoreTX driverDelegateClass: org.quartz.impl.jdbcjobstore.StdJDBCDelegate tablePrefix: QRTZ_ useProperties: false # å¼€å¯é›†ç¾¤ isClustered: true clusterCheckinInterval: 15000 threadPool: class: org.quartz.simpl.SimpleThreadPool threadCount: 20 threadPriority: 8 threadsInheritContextClassLoaderOfInitializingThread: true # åˆå§‹åŒ–åæ˜¯å¦è‡ªåŠ¨å¯åŠ¨è°ƒåº¦ç¨‹åº auto-startup: true # æ•°æ®åº“æ–¹å¼ memory å†…å­˜ ; jdbc æ•°æ®åº“ job-store-type: jdbc # åˆå§‹åŒ–è¡¨ç»“æ„ jdbc: # é¡¹ç›®å¯åŠ¨æ—¶åˆå§‹åŒ–æ•°æ®åº“ never ä»ä¸ ; always æ¯æ¬¡å¯åŠ¨éƒ½åˆå§‹åŒ– initialize-schema: always # æ˜¯å¦è¦†ç›–å·²ç»æŒä¹…åŒ–çš„job overwrite-existing-jobs: true quartzå®˜æ–¹é…ç½®æ–‡æ¡£ åˆ›å»ºJob import lombok.extern.slf4j.Slf4j; import org.quartz.JobExecutionContext; import org.quartz.JobExecutionException; import org.springframework.scheduling.quartz.QuartzJobBean; import java.text.SimpleDateFormat; import java.util.Date; @Slf4j public class LogJob extends QuartzJobBean { private static final SimpleDateFormat DATE_FORMAT = new SimpleDateFormat(&quot;HH:mm:ss&quot;); @Override protected void executeInternal(JobExecutionContext jobExecutionContext) throws JobExecutionException { log.info(&quot;The time is now {}&quot;, DATE_FORMAT.format(new Date())); } } æ³¨å†ŒJobä¿¡æ¯ import org.quartz.*; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; @Configuration public class QuartzConfig { @Bean public JobDetail logJobDetail(){ return JobBuilder.newJob(LogJob.class).storeDurably().build(); } @Bean public Trigger logTrigger(){ SimpleScheduleBuilder scheduleBuilder = SimpleScheduleBuilder.simpleSchedule() //æ¯ä¸€ç§’æ‰§è¡Œä¸€æ¬¡ .withIntervalInSeconds(1) //æ°¸ä¹…é‡å¤ï¼Œä¸€ç›´æ‰§è¡Œä¸‹å» .repeatForever(); return TriggerBuilder.newTrigger() .forJob(logJobDetail()) .withSchedule(scheduleBuilder) .build(); } } å¯åŠ¨é¡¹ç›®,æµ‹è¯• 2020-06-06 17:04:50.904 INFO 9920 --- [eduler_Worker-1] com.ldx.springboot.quartz.LogJob : The time is now 17:04:50 2020-06-06 17:04:50.914 INFO 9920 --- [eduler_Worker-2] com.ldx.springboot.quartz.LogJob : The time is now 17:04:50 2020-06-06 17:04:51.791 INFO 9920 --- [eduler_Worker-3] com.ldx.springboot.quartz.LogJob : The time is now 17:04:51 2020-06-06 17:04:52.791 INFO 9920 --- [eduler_Worker-4] com.ldx.springboot.quartz.LogJob : The time is now 17:04:52 2020-06-06 17:04:53.792 INFO 9920 --- [eduler_Worker-5] com.ldx.springboot.quartz.LogJob : The time is now 17:04:53 2020-06-06 17:04:54.791 INFO 9920 --- [eduler_Worker-6] com.ldx.springboot.quartz.LogJob : The time is now 17:04:54 2020-06-06 17:04:55.791 INFO 9920 --- [eduler_Worker-7] com.ldx.springboot.quartz.LogJob : The time is now 17:04:55 ","link":"http://blog.ludangxin.club/post/springboot-ji-cheng-ren-wu-diao-du/"},{"title":"OAuth2.0","content":"ç®€ä»‹ OAUTHåè®®ä¸ºç”¨æˆ·èµ„æºçš„æˆæƒæä¾›äº†ä¸€ä¸ªå®‰å…¨çš„ã€å¼€æ”¾è€Œåˆç®€æ˜“çš„æ ‡å‡†ã€‚ä¸ä»¥å¾€çš„æˆæƒæ–¹å¼ä¸åŒä¹‹å¤„æ˜¯OAUTHçš„æˆæƒä¸ä¼šä½¿ç¬¬ä¸‰æ–¹è§¦åŠåˆ°ç”¨æˆ·çš„å¸å·ä¿¡æ¯ï¼ˆå¦‚ç”¨æˆ·åä¸å¯†ç ï¼‰ï¼Œå³ç¬¬ä¸‰æ–¹æ— éœ€ä½¿ç”¨ç”¨æˆ·çš„ç”¨æˆ·åä¸å¯†ç å°±å¯ä»¥ç”³è¯·è·å¾—è¯¥ç”¨æˆ·èµ„æºçš„æˆæƒï¼Œå› æ­¤OAUTHæ˜¯å®‰å…¨çš„ã€‚oAuthæ˜¯Open Authorizationçš„ç®€å†™ã€‚ OAuth2.0æ˜¯OAuthåè®®çš„å»¶ç»­ç‰ˆæœ¬ï¼Œä½†ä¸å‘å‰å…¼å®¹OAuth 1.0(å³å®Œå…¨åºŸæ­¢äº†OAuth1.0)ã€‚ OAuth 2.0å…³æ³¨å®¢æˆ·ç«¯å¼€å‘è€…çš„ç®€æ˜“æ€§ã€‚è¦ä¹ˆé€šè¿‡ç»„ç»‡åœ¨èµ„æºæ‹¥æœ‰è€…å’ŒHTTPæœåŠ¡å•†ä¹‹é—´çš„è¢«æ‰¹å‡†çš„äº¤äº’åŠ¨ä½œä»£è¡¨ç”¨æˆ·ï¼Œè¦ä¹ˆå…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨ä»£è¡¨ç”¨æˆ·è·å¾—è®¿é—®çš„æƒé™ã€‚åŒæ—¶ä¸ºWebåº”ç”¨ï¼Œæ¡Œé¢åº”ç”¨å’Œæ‰‹æœºï¼Œå’Œèµ·å±…å®¤è®¾å¤‡æä¾›ä¸“é—¨çš„è®¤è¯æµç¨‹ã€‚ RFCæ–‡æ¡£ è®¤è¯è¿‡ç¨‹ +--------+ +---------------+ | |--(A)- Authorization Request -&gt;| Resource | | | | Owner | | |&lt;-(B)-- Authorization Grant ---| | | | +---------------+ | | | | +---------------+ | |--(C)-- Authorization Grant --&gt;| Authorization | | Client | | Server | | |&lt;-(D)----- Access Token -------| | | | +---------------+ | | | | +---------------+ | |--(E)----- Access Token ------&gt;| Resource | | | | Server | | |&lt;-(F)--- Protected Resource ---| | +--------+ +---------------+ ä¸Šå›¾ä¸­æ‰€æ¶‰åŠåˆ°çš„å¯¹è±¡åˆ†åˆ«ä¸ºï¼š Client ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæˆ‘ä»¬çš„åº”ç”¨å°±æ˜¯ä¸€ä¸ªClient Resource Owner èµ„æºæ‰€æœ‰è€…ï¼Œå³ç”¨æˆ· Authorization Server æˆæƒæœåŠ¡å™¨ï¼Œå³æä¾›ç¬¬ä¸‰æ–¹ç™»å½•æœåŠ¡çš„æœåŠ¡å™¨ï¼Œå¦‚Github Resource Server æ‹¥æœ‰èµ„æºä¿¡æ¯çš„æœåŠ¡å™¨ï¼Œé€šå¸¸å’ŒæˆæƒæœåŠ¡å™¨å±äºåŒä¸€åº”ç”¨ æ ¹æ®ä¸Šå›¾çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“OAuth2çš„åŸºæœ¬æµç¨‹ä¸ºï¼š ç¬¬ä¸‰æ–¹åº”ç”¨è¯·æ±‚ç”¨æˆ·æˆæƒã€‚ ç”¨æˆ·åŒæ„æˆæƒï¼Œå¹¶è¿”å›ä¸€ä¸ªå‡­è¯ï¼ˆcodeï¼‰ ç¬¬ä¸‰æ–¹åº”ç”¨é€šè¿‡ç¬¬äºŒæ­¥çš„å‡­è¯ï¼ˆcodeï¼‰å‘æˆæƒæœåŠ¡å™¨è¯·æ±‚æˆæƒ æˆæƒæœåŠ¡å™¨éªŒè¯å‡­è¯ï¼ˆcodeï¼‰é€šè¿‡åï¼ŒåŒæ„æˆæƒï¼Œå¹¶è¿”å›ä¸€ä¸ªèµ„æºè®¿é—®çš„å‡­è¯ï¼ˆAccess Tokenï¼‰ã€‚ ç¬¬ä¸‰æ–¹åº”ç”¨é€šè¿‡ç¬¬å››æ­¥çš„å‡­è¯ï¼ˆAccess Tokenï¼‰å‘èµ„æºæœåŠ¡å™¨è¯·æ±‚ç›¸å…³èµ„æºã€‚ èµ„æºæœåŠ¡å™¨éªŒè¯å‡­è¯ï¼ˆAccess Tokenï¼‰é€šè¿‡åï¼Œå°†ç¬¬ä¸‰æ–¹åº”ç”¨è¯·æ±‚çš„èµ„æºè¿”å›ã€‚ OAuth2.0çš„å…·ä½“å®ç° çœ‹å®ŒOAuthçš„åŸºæœ¬æµç¨‹åï¼Œå¤§å®¶å®é™…ä¸Šå¯¹åˆ°åº•å¦‚ä½•åšOAuthéªŒè¯è¿˜æ˜¯ä¸å¤ªæ¸…æ¥šï¼ŒåŒæ—¶ï¼Œä¹Ÿä¼šäº§ç”Ÿç–‘é—®ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸¤æ¬¡è·å–å‡­è¯ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨æˆ·æˆæƒæ‹¿åˆ°å‡­è¯åå°±ç›´æ¥è·å–èµ„æºå‘¢ï¼Ÿè¿™å’ŒOAuthçš„å…·ä½“å®ç°æœ‰å…³ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹OAuth2çš„å…·ä½“å®ç°å§ã€‚ ç”¨æˆ·æˆæƒ åœ¨ç”¨æˆ·æˆæƒè¿™ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰ï¼Œæˆ‘ä»¬çš„åº”ç”¨å¯ä»¥é€šè¿‡è¯¥ç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰æ¥å’ŒæˆæƒæœåŠ¡å™¨äº¤æ¢ä¸€ä¸ªèµ„æºè®¿é—®å‡­è¯ï¼ˆAccess Tokenï¼‰ã€‚ è¿™é‡Œæˆ‘ä»¬åªè®¨è®ºç¬¬ä¸‰æ–¹ç™»å½•åŠŸèƒ½çš„å®ç°æƒ…å†µï¼Œç»è¿‡åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰å…·æœ‰ä¸‰ä¸ªç‰¹æ€§ï¼š ç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰éœ€è¦ç”±ç”¨æˆ·æˆæƒï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥è¡Œä¸ºæ˜¯ç”¨æˆ·çš„ä¸»åŠ¨è¡Œä¸ºï¼Œ æ­¤æ—¶ä¸ºäº†ä¿è¯ç”¨æˆ·èº«ä»½æ­£ç¡®ï¼Œå®é™…ä¸Šä¹Ÿéœ€è¦ç”¨æˆ·é€šè¿‡æˆæƒæœåŠ¡å™¨çš„éªŒè¯ï¼ˆç™»å½•æ“ä½œæˆ–è€…å·²ç™»å½•çŠ¶æ€ï¼‰ ç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰éœ€è¦æˆæƒæœåŠ¡å™¨é¢å‘ï¼Œå› ä¸ºæœ€ç»ˆç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰æ˜¯ç”±æˆæƒæœåŠ¡å™¨éªŒè¯çš„ï¼ŒåŒæ—¶ç”¨æˆ·æˆæƒæ“ä½œä¸ºäº†ä¿è¯ç”¨æˆ·èº«ä»½ï¼Œä¹Ÿéœ€è¦åœ¨æˆæƒæœåŠ¡å™¨ä¸Šè¿›è¡Œæ“ä½œï¼Œå› æ­¤ï¼Œç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰æ˜¯ç”±æˆæƒæœåŠ¡å™¨è¿›è¡Œé¢å‘çš„ ç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰éœ€è¦ç”±æˆæƒæœåŠ¡å™¨ä¼ é€’ç»™æˆ‘ä»¬çš„ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œå¾ˆæ˜æ˜¾ï¼Œç”±ç”¨æˆ·åœ¨èµ„æºæœåŠ¡å™¨ä¸Šæ‹¿åˆ°å‡­è¯å†æ‰‹åŠ¨çš„æäº¤è‡³ç¬¬ä¸‰æ–¹åº”ç”¨å¤ªéº»çƒ¦ï¼Œå› æ­¤ï¼Œå½“ç”¨æˆ·ä¸»åŠ¨æˆæƒè¡Œä¸ºå‘ç”Ÿåï¼Œèµ„æºæœåŠ¡å™¨éœ€è¦å°†ç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰å‘é€ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚ æˆ‘ä»¬ä»¥Githubä¸ºä¾‹ï¼Œçœ‹çœ‹ä¸»æµçš„ç¬¬ä¸‰æ–¹ç™»å½•æ˜¯å¦‚ä½•æ»¡è¶³ä¸Šè¿°ä¸‰ä¸ªç‰¹æ€§çš„ã€‚ ç¬¬0æ­¥. å¼•å¯¼ç”¨æˆ·è¿›è¡Œæˆæƒï¼šgithub å½“ç”¨æˆ·å¸Œæœ›ä½¿ç”¨ç¬¬ä¸‰æ–¹ç™»å½•è¿›è¡Œç™»å½•æ—¶ï¼Œç¬¬ä¸‰æ–¹åº”ç”¨ä¼šé€šè¿‡ç±»ä¼¼ä¸‹å›¾&quot;å¿«é€Ÿç™»é™†å›¾æ ‡&quot;çš„æ–¹å¼å°†ç”¨æˆ·å¼•å¯¼è‡³æˆæƒé¡µé¢ï¼Œä¸ºäº†å’ŒOAuthåŸºæœ¬æµç¨‹ä¸€è‡´ï¼Œæˆ‘ä»¬å°†è¿™ä¸€æ­¥å®šä¹‰ä¸ºç¬¬0æ­¥ã€‚ ç¬¬0.5æ­¥. ç”¨æˆ·èº«ä»½éªŒè¯ å½“æˆ‘ä»¬ç‚¹å‡»Githubçš„å›¾æ ‡ï¼Œæˆ‘ä»¬ä¼šè¿›å…¥åˆ°Githubåº”ç”¨ä¸‹é¢ï¼Œæ­¤æ—¶å®é™…ä¸Šè¿›è¡Œäº†ä¸€æ¬¡ç”¨æˆ·èº«ä»½çš„éªŒè¯ï¼Œä¹‹å‰æ²¡æœ‰ç™»å½•Githubçš„ç”¨æˆ·éœ€è¦è¾“å…¥Githubçš„è´¦å·å¯†ç ï¼Œå·²ç™»å½•çš„ç”¨æˆ·Githubä¼šæ ¹æ®Sessionè¿›è¡Œèº«ä»½ç¡®è®¤ã€‚æ­¤æ“ä½œæˆ‘ä»¬ç§°ä¸º0.5æ­¥ã€‚æ¥ä¸‹æ¥æ­£å¼è¿›å…¥OAuth2çš„æµç¨‹ ç¬¬1æ­¥. ç”¨æˆ·æˆæƒ ç”¨æˆ·èº«ä»½ç¡®è®¤åä¼šè¿›å…¥ä¸‹é¢è¿™ä¸ªé¡µé¢ï¼Œè¯¥é¡µé¢ç”±æˆæƒæœåŠ¡å™¨æä¾›ï¼ŒæˆæƒæœåŠ¡å™¨ä¼šå‘Šè¯‰ç”¨æˆ·è¯¥ç¬¬ä¸‰æ–¹åœ¨æˆæƒæœåŠ¡å™¨ä¸­æäº¤çš„ç›¸å…³ä¿¡æ¯ï¼ˆå¦‚æœéœ€è¦å®ç°ç¬¬ä¸‰æ–¹ç™»å½•åŠŸèƒ½ï¼Œç¬¬ä¸‰æ–¹åº”ç”¨éœ€è¦å‘Githubã€å¾®åšç­‰åº”ç”¨ä¸­æäº¤åº”ç”¨çš„ç›¸å…³ä¿¡æ¯ï¼Œä¸åŒæœåŠ¡å¯èƒ½ä¼šéœ€è¦å®¡æ ¸ç­‰ä¸åŒçš„æ­¥éª¤ï¼‰ï¼Œä»¥åŠæˆæƒåç¬¬ä¸‰æ–¹åº”ç”¨èƒ½å¤Ÿè·å–å“ªäº›èµ„æºã€‚åœ¨Githubä¸­ï¼Œæœ€åŸºç¡€çš„è®¤è¯å¯ä»¥è®¿é—®ç”¨æˆ·çš„å…¬å…±ä¿¡æ¯ã€‚å¦‚æœç”¨æˆ·åŒæ„æˆæƒï¼Œéœ€è¦ä¸»åŠ¨çš„ç‚¹å‡»ã€Authorize applicationã€‘æŒ‰é’®ã€‚ ç¬¬2æ­¥. è¿”å›ç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰ å½“ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åŒæ„æˆæƒåï¼ŒæˆæƒæœåŠ¡å™¨å°†ç”Ÿæˆä¸€ä¸ªç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰ï¼Œæ­¤æ—¶æˆæƒæœåŠ¡å™¨å¦‚ä½•å°†ç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰ä¼ é€’ç»™ç¬¬ä¸‰æ–¹åº”ç”¨å‘¢ï¼Ÿ å½“æˆ‘ä»¬å‘æˆæƒæœåŠ¡å™¨æäº¤åº”ç”¨ä¿¡æ¯æ—¶ï¼Œé€šå¸¸éœ€è¦å¡«å†™ä¸€ä¸ªredirect_uriï¼Œå½“æˆ‘ä»¬å¼•å¯¼ç”¨æˆ·è¿›å…¥æˆæƒé¡µé¢æ—¶ï¼Œä¹Ÿä¼šé™„å¸¦ä¸€ä¸ªredirect_uriçš„ä¿¡æ¯ï¼Œå½“æˆæƒæœåŠ¡å™¨éªŒè¯ä¸¤ä¸ªURLä¸€è‡´æ—¶ï¼Œä¼šé€šçŸ¥æµè§ˆå™¨è·³è½¬åˆ°redirect_uriï¼ŒåŒæ—¶ï¼Œåœ¨redirect_uriåé™„åŠ ç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰çš„ç›¸å…³ä¿¡æ¯ï¼Œæ­¤æ—¶ï¼Œæµè§ˆå™¨è¿”å›ç¬¬ä¸‰æ–¹åº”ç”¨åŒæ—¶æºå¸¦ç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰çš„ç›¸å…³ä¿¡æ¯ã€‚æˆæƒåè®¿é—®çš„redirect_uriå¦‚ä¸‹ï¼š https://www.csdn.net/oauth/github/callback?code=9e3efa6cea739f9aaab2&amp;state=XXX è¿™æ ·ï¼Œç¬¬äºŒæ­¥è¿”å›ç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰å°±å®Œæˆäº†ã€‚ æˆæƒæœåŠ¡å™¨æˆæƒ ä»è¿™ä¸€æ­¥å¼€å§‹ï¼ŒOAuth2 çš„æˆæƒå°†æœ‰ä¸¤ä¸ªé‡å¤§å˜åŒ–çš„å‘ç”Ÿï¼š ç”¨æˆ·ä¸»åŠ¨è¡Œä¸ºç»“æŸï¼Œç”¨æˆ·ç†è®ºä¸Šå¯ä»¥ä¸éœ€è¦å†åšä»»ä½•ä¸»åŠ¨çš„æ“ä½œï¼Œä½œä¸ºç¬¬ä¸‰æ–¹åº”ç”¨çš„æˆ‘ä»¬å¯ä»¥åœ¨åå°æ‹¿åˆ°èµ„æºæœåŠ¡å™¨ä¸Šçš„èµ„æºè€Œå¯¹ç”¨æˆ·æ˜¯ä¸å¯è§çš„ï¼Œå½“ç”¨æˆ·çš„æµè§ˆå™¨è·³åˆ°ä¸‹ä¸€ä¸ªé¡µé¢æ—¶ï¼Œæ•´ä¸ªOAuth2çš„æµç¨‹å·²ç»ç»“æŸ æµè§ˆå™¨ç«¯è¡Œä¸ºç»“æŸï¼Œä»OAuth2 çš„åŸºæœ¬æµç¨‹å¯ä»¥çœ‹å‡ºï¼Œæ¥ä¸‹æ¥çš„æµç¨‹å·²ç»ä¸éœ€è¦å’Œç”¨æˆ·è¿›è¡Œäº¤äº’ï¼Œæ¥ä¸‹æ¥çš„è¡Œä¸ºéƒ½åœ¨ç¬¬ä¸‰æ–¹åº”ç”¨ä¸æˆæƒæœåŠ¡å™¨ã€èµ„æºæœåŠ¡å™¨ä¹‹é—´çš„äº¤äº’ã€‚ æˆ‘ä»¬çŸ¥é“æµè§ˆå™¨ç«¯çš„è¡Œä¸ºå®é™…ä¸Šæ˜¯ä¸å®‰å…¨çš„ï¼Œç”šè‡³å®‰å…¨å‡­è¯çš„ä¼ é€’éƒ½æ˜¯é€šè¿‡URLç›´æ¥ä¼ é€’çš„ã€‚ä½†æ˜¯ç”±äºç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰ä¸æ˜¯é‚£ä¹ˆæ•æ„Ÿï¼Œå…¶ä»–æ”»å‡»è€…æ‹¿åˆ°ç”¨æˆ·å‡­è¯ï¼ˆcodeï¼‰åä¾ç„¶æ— æ³•è·å–åˆ°ç›¸åº”çš„ç”¨æˆ·èµ„æºï¼Œæ‰€ä»¥ä¹‹å‰çš„è¡Œä¸ºæ˜¯å…è®¸çš„ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹æœåŠ¡å™¨å¦‚ä½•äº¤äº’æ¥å®‰å…¨çš„è·å¾—æˆæƒæœåŠ¡å™¨æˆæƒã€‚ ç¬¬3æ­¥. è¯·æ±‚æˆæƒæœåŠ¡å™¨æˆæƒ è¦æ‹¿åˆ°æˆæƒæœåŠ¡å™¨çš„æˆæƒï¼Œéœ€è¦ä»¥ä¸‹å‡ ä¸ªä¿¡æ¯ï¼š client_id æ ‡è¯†ç¬¬ä¸‰æ–¹åº”ç”¨çš„idï¼Œç”±æˆæƒæœåŠ¡å™¨ï¼ˆGithubï¼‰åœ¨ç¬¬ä¸‰æ–¹åº”ç”¨æäº¤æ—¶é¢å‘ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ client_secret ç¬¬ä¸‰æ–¹åº”ç”¨å’ŒæˆæƒæœåŠ¡å™¨ä¹‹é—´çš„å®‰å…¨å‡­è¯ï¼Œç”±æˆæƒæœåŠ¡å™¨ï¼ˆGithubï¼‰åœ¨ç¬¬ä¸‰æ–¹åº”ç”¨æäº¤æ—¶é¢å‘ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ code ç¬¬ä¸€æ­¥ä¸­è¿”å›çš„ç”¨æˆ·å‡­è¯redirect_uri ç¬¬ä¸€æ­¥ç”Ÿæˆç”¨æˆ·å‡­è¯åè·³è½¬åˆ°ç¬¬äºŒæ­¥æ—¶çš„åœ°å€ state ç”±ç¬¬ä¸‰æ–¹åº”ç”¨ç»™å‡ºçš„éšæœºç  æˆ‘ä»¬çœ‹åˆ°ï¼Œä¸Šè¿°ä¿¡æ¯è¿˜æ¶‰åŠåˆ°ç¬¬ä¸‰æ–¹åº”ç”¨çš„å®‰å…¨å‡­è¯ï¼ˆclient_secretï¼‰ï¼Œå› æ­¤è¦æ±‚OAuthè¦æ±‚è¯¥è¯·æ±‚å¿…é¡»æ—¶POSTè¯·æ±‚ï¼ŒåŒæ—¶ï¼Œè¿˜å¿…é¡»æ—¶HTTPSæœåŠ¡ï¼Œä»¥æ­¤ä¿è¯è·å–åˆ°çš„éªŒè¯å‡­è¯ï¼ˆAccess Tokenï¼‰çš„å®‰å…¨æ€§ã€‚ ç¬¬4æ­¥. æ‹¿åˆ°éªŒè¯å‡­è¯ï¼ˆAccess Tokenï¼‰ å½“æˆæƒæœåŠ¡å™¨æ‹¿åˆ°ç¬¬3æ­¥ä¸­çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒéªŒè¯é€šè¿‡åï¼Œä¼šå°†Access Tokenè¿”å›ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ã€‚ è®¿é—®èµ„æº ç¬¬5æ­¥. è¯·æ±‚è®¿é—®ç”¨æˆ·èµ„æº æ‹¿åˆ°éªŒè¯å‡­è¯ï¼ˆAccess Tokenï¼‰åï¼Œå‰©ä¸‹çš„äº‹æƒ…å°±å¾ˆç®€å•äº†ï¼Œèµ„æºæœåŠ¡å™¨ä¼šæä¾›ä¸€ç³»åˆ—å…³äºç”¨æˆ·èµ„æºçš„APIï¼Œæ‹¿éªŒè¯å‡­è¯ï¼ˆAccess Tokenï¼‰è®¿é—®ç›¸åº”çš„APIå³å¯ï¼Œä¾‹å¦‚ï¼Œåœ¨GIthubä¸­ï¼Œå¦‚æœä½ æƒ³æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå¯ä»¥è®¿é—®ä»¥ä¸‹APIï¼š GET https://api.github.com/user?access_token=... æ³¨æ„ï¼Œæ­¤æ—¶çš„è®¿é—®ä¸æ˜¯é€šè¿‡æµè§ˆå™¨è¿›è¡Œçš„ï¼Œè€Œæ˜¯æœåŠ¡å™¨ç›´æ¥å‘é€HTTPè¯·æ±‚ï¼Œå› æ­¤å…¶å®‰å…¨æ€§æ˜¯å¯ä»¥ä¿è¯çš„ã€‚ ç¬¬6æ­¥. è¿”å›èµ„æº å¦‚æœéªŒè¯å‡­è¯ï¼ˆAccess Tokenï¼‰æ˜¯æ­£ç¡®çš„ï¼Œæ­¤æ—¶èµ„æºæœåŠ¡å™¨å°±ä¼šè¿”å›èµ„æºä¿¡æ¯ï¼Œæ­¤æ—¶æ•´ä¸ªOAuthæµç¨‹å°±ç»“æŸäº†ã€‚ ç¬¬ä¸‰æ–¹ç™»å½• çœ‹å®ŒOAuth2çš„èµ„æºè®¿é—®æµç¨‹ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸‰æ–¹ç™»å½•æ˜¯å¦‚ä½•åšçš„å‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸¤ç‚¹ï¼š ç”¨æˆ·æˆæƒä¿¡æ¯åœ¨æˆæƒæœåŠ¡å™¨ä¸­æ˜¯æœ‰è®°å½•çš„ï¼Œå½“ç”¨æˆ·ç¬¬ä¸€æ¬¡æˆæƒç»™ç›¸åº”çš„ç¬¬ä¸‰æ–¹åº”ç”¨åï¼Œä¸éœ€è¦è¿›è¡Œå†æ¬¡æˆæƒ æ¯ä¸ªç”¨æˆ·åœ¨èµ„æºæœåŠ¡å™¨ä¸­éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„IDï¼Œç¬¬ä¸‰æ–¹åº”ç”¨å¯ä»¥å°†å…¶å­˜å‚¨èµ·æ¥å¹¶ä¸æœ¬åœ°ç”¨æˆ·ç³»ç»Ÿä¸€ä¸€å¯¹åº”èµ·æ¥ è¿™æ ·ï¼Œå½“ç”¨æˆ·ç¬¬ä¸€æ¬¡æˆæƒå¹¶ä¸”æ³¨å†Œåï¼ˆä¸»åŠ¨æ³¨å†Œæˆ–è€…ç¬¬ä¸‰æ–¹åº”ç”¨ä½¿ç”¨ç”¨æˆ·ä¿¡æ¯é»˜è®¤æ³¨å†Œï¼‰ï¼Œå½“å†æ¬¡ç‚¹å‡»ç¬¬ä¸‰æ–¹ç™»å½•çš„æŒ‰é’®ï¼Œæµè§ˆå™¨è·³è½¬åˆ°æˆæƒæœåŠ¡å™¨ï¼ŒæˆæƒæœåŠ¡å™¨é€šè¿‡Sessionæ‰¾åˆ°ç”¨æˆ·çš„æˆæƒä¿¡æ¯ï¼Œå‘ç°è¯¥ç”¨æˆ·å·²ç»æˆæƒç»™è¯¥ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œå°†ç›´æ¥è·³è½¬åˆ°redirect_uriï¼Œæ­¤æ—¶ç¬¬ä¸‰æ–¹åº”ç”¨é€šè¿‡å”¯ä¸€çš„ç”¨æˆ·IDæ‰¾åˆ°ç›¸åº”çš„æœ¬åœ°ç”¨æˆ·ï¼Œè‡ªåŠ¨å¸®åŠ©å…¶ç™»å½•ã€‚ è¿™æ ·ï¼Œå°±å¯ä»¥è¾¾åˆ°ç›´æ¥ç‚¹å‡»ç¬¬ä¸‰æ–¹ç™»å½•æŒ‰é’®ï¼Œä¸éœ€è¦ä»»ä½•æ“ä½œï¼Œç»è¿‡å‡ æ¬¡è·³è½¬åè‡ªåŠ¨ç™»å½•çš„æ•ˆæœäº†ã€‚å¤§å®¶å¿«å»è¯•è¯•å§ã€‚ å®¢æˆ·ç«¯æˆæƒæ¨¡å¼ å®¢æˆ·ç«¯å¿…é¡»å¾—åˆ°ç”¨æˆ·çš„æˆæƒï¼ˆauthorization grantï¼‰ï¼Œæ‰èƒ½è·å¾—ä»¤ç‰Œï¼ˆaccess tokenï¼‰ã€‚oAuth 2.0 å®šä¹‰äº†å››ç§æˆæƒæ–¹å¼ã€‚ implicitï¼šç®€åŒ–æ¨¡å¼ authorization codeï¼šæˆæƒç æ¨¡å¼ resource owner password credentialsï¼šå¯†ç æ¨¡å¼ client credentialsï¼šå®¢æˆ·ç«¯æ¨¡å¼ æˆæƒç æ¨¡å¼ èµ„æºæ‹¥æœ‰è€…æ‰“å¼€å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è¦æ±‚èµ„æºæ‹¥æœ‰è€…ç»™äºˆæˆæƒï¼Œå®ƒå°†æµè§ˆå™¨è¢«é‡å®šå‘åˆ°æˆæƒæœåŠ¡å™¨ï¼Œé‡å®šå‘æ—¶ä¼š é™„åŠ å®¢æˆ·ç«¯çš„èº«ä»½ä¿¡æ¯ã€‚å¦‚ï¼š/uaa/oauth/authorize? client_id=c1&amp;response_type=code&amp;scope=all&amp;redirect_uri=http://www.baidu.com â€‹ å‚æ•°åˆ—è¡¨å¦‚ä¸‹ï¼š â€‹ client_idï¼šå®¢æˆ·ç«¯å‡†å…¥æ ‡è¯†ã€‚ â€‹ response_typeï¼šæˆæƒç æ¨¡å¼å›ºå®šä¸ºcodeã€‚ â€‹ scopeï¼šå®¢æˆ·ç«¯æƒé™ã€‚ â€‹ redirect_uriï¼šè·³è½¬uriï¼Œå½“æˆæƒç ç”³è¯·æˆåŠŸåä¼šè·³è½¬åˆ°æ­¤åœ°å€ï¼Œå¹¶åœ¨åè¾¹å¸¦ä¸Šcodeå‚æ•°ï¼ˆæˆæƒç ï¼‰ã€‚ æµè§ˆå™¨å‡ºç°å‘æˆæƒæœåŠ¡å™¨æˆæƒé¡µé¢ï¼Œä¹‹åå°†ç”¨æˆ·åŒæ„æˆæƒã€‚ æˆæƒæœåŠ¡å™¨å°†æˆæƒç ï¼ˆAuthorizationCodeï¼‰è½¬ç»æµè§ˆå™¨å‘é€ç»™client(é€šè¿‡redirect_uri)ã€‚ å®¢æˆ·ç«¯æ‹¿ç€æˆæƒç å‘æˆæƒæœåŠ¡å™¨ç´¢è¦è®¿é—®access_tokenï¼Œè¯·æ±‚å¦‚ä¸‹ï¼š/uaa/oauth/token? client_id=c1&amp;client_secret=secret&amp;grant_type=authorization_code&amp;code=5PgfcD&amp;redirect_uri=http://w ww.baidu.com â€‹ å‚æ•°åˆ—è¡¨å¦‚ä¸‹ â€‹ client_idï¼šå®¢æˆ·ç«¯å‡†å…¥æ ‡è¯†ã€‚ â€‹ client_secretï¼šå®¢æˆ·ç«¯ç§˜é’¥ã€‚ â€‹ grant_typeï¼šæˆæƒç±»å‹ï¼Œå¡«å†™authorization_codeï¼Œè¡¨ç¤ºæˆæƒç æ¨¡å¼ â€‹ codeï¼šæˆæƒç ï¼Œå°±æ˜¯åˆšåˆšè·å–çš„æˆæƒç ï¼Œæ³¨æ„ï¼šæˆæƒç åªä½¿ç”¨ä¸€æ¬¡å°±æ— æ•ˆäº†ï¼Œéœ€è¦é‡æ–°ç”³è¯·ã€‚ â€‹ redirect_uriï¼šç”³è¯·æˆæƒç æ—¶çš„è·³è½¬urlï¼Œä¸€å®šå’Œç”³è¯·æˆæƒç æ—¶ç”¨çš„redirect_uriä¸€è‡´ã€‚ æˆæƒæœåŠ¡å™¨è¿”å›ä»¤ç‰Œ**(access_token)** è¿™ç§æ¨¡å¼æ˜¯å››ç§æ¨¡å¼ä¸­æœ€å®‰å…¨çš„ä¸€ç§æ¨¡å¼ã€‚ä¸€èˆ¬ç”¨äºclientæ˜¯WebæœåŠ¡å™¨ç«¯åº”ç”¨æˆ–ç¬¬ä¸‰æ–¹çš„åŸç”ŸAppè°ƒç”¨èµ„æºæœåŠ¡çš„æ—¶å€™ã€‚å› ä¸ºåœ¨è¿™ç§æ¨¡å¼ä¸­access_tokenä¸ä¼šç»è¿‡æµè§ˆå™¨æˆ–ç§»åŠ¨ç«¯çš„Appï¼Œè€Œæ˜¯ç›´æ¥ä»æœåŠ¡ç«¯å»äº¤æ¢ï¼Œè¿™æ ·å°±æœ€å¤§é™åº¦çš„å‡å°äº†ä»¤ç‰Œæ³„æ¼çš„é£é™©ã€‚ ç®€åŒ–æ¨¡å¼ èµ„æºæ‹¥æœ‰è€…æ‰“å¼€å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è¦æ±‚èµ„æºæ‹¥æœ‰è€…ç»™äºˆæˆæƒï¼Œå®ƒå°†æµè§ˆå™¨è¢«é‡å®šå‘åˆ°æˆæƒæœåŠ¡å™¨ï¼Œé‡å®šå‘æ—¶ä¼šé™„åŠ å®¢æˆ·ç«¯çš„èº«ä»½ä¿¡æ¯ã€‚å¦‚ï¼š/uaa/oauth/authorize? client_id=c1&amp;response_type=token&amp;scope=all&amp;redirect_uri=http://www.baidu.com å‚æ•°æè¿°åŒæˆæƒç æ¨¡å¼ ï¼Œæ³¨æ„response_type=tokenï¼Œè¯´æ˜æ˜¯ç®€åŒ–æ¨¡å¼ã€‚ æµè§ˆå™¨å‡ºç°å‘æˆæƒæœåŠ¡å™¨æˆæƒé¡µé¢ï¼Œä¹‹åå°†ç”¨æˆ·åŒæ„æˆæƒã€‚ æˆæƒæœåŠ¡å™¨å°†æˆæƒç å°†ä»¤ç‰Œï¼ˆaccess_tokenï¼‰ä»¥Hashçš„å½¢å¼å­˜æ”¾åœ¨é‡å®šå‘uriçš„fargmentä¸­å‘é€ç»™æµè§ˆå™¨ã€‚ æ³¨ï¼šfragment ä¸»è¦æ˜¯ç”¨æ¥æ ‡è¯† URI æ‰€æ ‡è¯†èµ„æºé‡Œçš„æŸä¸ªèµ„æºï¼Œåœ¨ URI çš„æœ«å°¾é€šè¿‡ ï¼ˆ#ï¼‰ä½œä¸º fragment çš„å¼€å¤´ï¼Œå…¶ä¸­ # ä¸å±äº fragment çš„å€¼ã€‚å¦‚https://domain/index#L18è¿™ä¸ª URI ä¸­ L18 å°±æ˜¯ fragment çš„å€¼ã€‚å¤§å®¶åªéœ€è¦çŸ¥é“jsé€šè¿‡å“åº”æµè§ˆå™¨åœ°å€æ å˜åŒ–çš„æ–¹å¼èƒ½è·å–åˆ°fragment å°±è¡Œäº†ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œç®€åŒ–æ¨¡å¼ç”¨äºæ²¡æœ‰æœåŠ¡å™¨ç«¯çš„ç¬¬ä¸‰æ–¹å•é¡µé¢åº”ç”¨ï¼Œå› ä¸ºæ²¡æœ‰æœåŠ¡å™¨ç«¯å°±æ— æ³•æ¥æ”¶æˆæƒç ã€‚ å¯†ç æ¨¡å¼ èµ„æºæ‹¥æœ‰è€…å°†ç”¨æˆ·åã€å¯†ç å‘é€ç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯æ‹¿ç€èµ„æºæ‹¥æœ‰è€…çš„ç”¨æˆ·åã€å¯†ç å‘æˆæƒæœåŠ¡å™¨è¯·æ±‚ä»¤ç‰Œï¼ˆaccess_tokenï¼‰ï¼Œè¯·æ±‚å¦‚ä¸‹ï¼š /uaa/oauth/token? client_id=c1&amp;client_secret=secret&amp;grant_type=password&amp;username=shangsan&amp;password=123 â€‹ å‚æ•°åˆ—è¡¨å¦‚ä¸‹ï¼š â€‹ client_idï¼šå®¢æˆ·ç«¯å‡†å…¥æ ‡è¯†ã€‚ â€‹ client_secretï¼šå®¢æˆ·ç«¯ç§˜é’¥ã€‚ â€‹ grant_typeï¼šæˆæƒç±»å‹ï¼Œå¡«å†™passwordè¡¨ç¤ºå¯†ç æ¨¡å¼ â€‹ usernameï¼šèµ„æºæ‹¥æœ‰è€…ç”¨æˆ·åã€‚ â€‹ passwordï¼šèµ„æºæ‹¥æœ‰è€…å¯†ç ã€‚ æˆæƒæœåŠ¡å™¨å°†ä»¤ç‰Œï¼ˆaccess_tokenï¼‰å‘é€ç»™client è¿™ç§æ¨¡å¼ååˆ†ç®€å•ï¼Œä½†æ˜¯å´æ„å‘³ç€ç›´æ¥å°†ç”¨æˆ·æ•æ„Ÿä¿¡æ¯æ³„æ¼ç»™äº†clientï¼Œå› æ­¤è¿™å°±è¯´æ˜è¿™ç§æ¨¡å¼åªèƒ½ç”¨äºclientæ˜¯æˆ‘ä»¬è‡ªå·±å¼€å‘çš„æƒ…å†µä¸‹ã€‚å› æ­¤å¯†ç æ¨¡å¼ä¸€èˆ¬ç”¨äºæˆ‘ä»¬è‡ªå·±å¼€å‘çš„ï¼Œç¬¬ä¸€æ–¹åŸç”ŸAppæˆ–ç¬¬ä¸€æ–¹å•é¡µé¢åº”ç”¨ã€‚ å®¢æˆ·ç«¯æ¨¡å¼ å®¢æˆ·ç«¯å‘æˆæƒæœåŠ¡å™¨å‘é€è‡ªå·±çš„èº«ä»½ä¿¡æ¯ï¼Œå¹¶è¯·æ±‚ä»¤ç‰Œï¼ˆaccess_tokenï¼‰ ç¡®è®¤å®¢æˆ·ç«¯èº«ä»½æ— è¯¯åï¼Œå°†ä»¤ç‰Œï¼ˆaccess_tokenï¼‰å‘é€ç»™clientï¼Œè¯·æ±‚å¦‚ä¸‹ï¼š/uaa/oauth/token?client_id=c1&amp;client_secret=secret&amp;grant_type=client_credentials â€‹ å‚æ•°åˆ—è¡¨å¦‚ä¸‹ï¼š â€‹ client_idï¼šå®¢æˆ·ç«¯å‡†å…¥æ ‡è¯†ã€‚ â€‹ client_secretï¼šå®¢æˆ·ç«¯ç§˜é’¥ã€‚ â€‹ grant_typeï¼šæˆæƒç±»å‹ï¼Œå¡«å†™client_credentialsè¡¨ç¤ºå®¢æˆ·ç«¯æ¨¡å¼ è¿™ç§æ¨¡å¼æ˜¯æœ€æ–¹ä¾¿ä½†æœ€ä¸å®‰å…¨çš„æ¨¡å¼ã€‚å› æ­¤è¿™å°±è¦æ±‚æˆ‘ä»¬å¯¹clientå®Œå…¨çš„ä¿¡ä»»ï¼Œè€Œclientæœ¬èº«ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚å› æ­¤è¿™ç§æ¨¡å¼ä¸€èˆ¬ç”¨æ¥æä¾›ç»™æˆ‘ä»¬å®Œå…¨ä¿¡ä»»çš„æœåŠ¡å™¨ç«¯æœåŠ¡ã€‚æ¯”å¦‚ï¼Œåˆä½œæ–¹ç³»ç»Ÿå¯¹æ¥ï¼Œæ‹‰å–ä¸€ç»„ç”¨æˆ·ä¿¡æ¯ã€‚ ","link":"http://blog.ludangxin.club/post/oauth20/"},{"title":"Spring Security è¯¦è§£ åŠ å¿«é€Ÿä¸Šæ‰‹","content":"ä»€ä¹ˆæ˜¯è®¤è¯ ç”¨æˆ·è®¤è¯å°±æ˜¯åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·çš„èº«ä»½æ˜¯å¦åˆæ³•çš„è¿‡ç¨‹ï¼Œç”¨æˆ·å»è®¿é—®ç³»ç»Ÿèµ„æºæ—¶ç³»ç»Ÿè¦æ±‚éªŒè¯ç”¨æˆ·çš„èº«ä»½ä¿¡ æ¯ï¼Œèº«ä»½åˆæ³•æ–¹å¯ç»§ç»­è®¿é—®ï¼Œä¸åˆæ³•åˆ™æ‹’ç»è®¿é—®ã€‚å¸¸è§çš„ç”¨æˆ·èº«ä»½è®¤è¯æ–¹å¼æœ‰ï¼šç”¨æˆ·åå¯†ç ç™»å½•ï¼ŒäºŒç»´ç ç™»å½•ï¼Œæ‰‹æœºçŸ­ä¿¡ç™»å½•ï¼ŒæŒ‡çº¹è®¤è¯ç­‰æ–¹å¼ã€‚ ç³»ç»Ÿä¸ºä»€ä¹ˆè¦è®¤è¯ï¼Ÿ è®¤è¯æ˜¯ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿçš„éšç§æ•°æ®ä¸èµ„æºï¼Œç”¨æˆ·çš„èº«ä»½åˆæ³•æ–¹å¯è®¿é—®è¯¥ç³»ç»Ÿçš„èµ„æºã€‚ ä»€ä¹ˆæ˜¯ä¼šè¯ ç”¨æˆ·è®¤è¯é€šè¿‡åï¼Œä¸ºäº†é¿å…ç”¨æˆ·çš„æ¯æ¬¡æ“ä½œéƒ½è¿›è¡Œè®¤è¯å¯å°†ç”¨æˆ·çš„ä¿¡æ¯ä¿è¯åœ¨ä¼šè¯ä¸­ã€‚ä¼šè¯å°±æ˜¯ç³»ç»Ÿä¸ºäº†ä¿æŒå½“å‰ ç”¨æˆ·çš„ç™»å½•çŠ¶æ€æ‰€æä¾›çš„æœºåˆ¶ï¼Œå¸¸è§çš„æœ‰åŸºäºsessionæ–¹å¼ã€åŸºäºtokenæ–¹å¼ç­‰ã€‚ session ä¼šè¯ ç”¨æˆ·è®¤è¯æˆåŠŸåï¼Œåœ¨æœåŠ¡ç«¯ç”Ÿæˆç”¨æˆ·ç›¸å…³çš„æ•°æ®ä¿å­˜åœ¨session(å½“å‰ä¼šè¯)ä¸­ï¼Œå‘ç»™å®¢æˆ·ç«¯çš„ sesssion_id å­˜æ”¾åˆ° cookie ä¸­ï¼Œè¿™æ ·ç”¨æˆ·å®¢æˆ·ç«¯è¯·æ±‚æ—¶å¸¦ä¸Š session_id å°±å¯ä»¥éªŒè¯æœåŠ¡å™¨ç«¯æ˜¯å¦å­˜åœ¨ session æ•° æ®ï¼Œä»¥æ­¤å®Œæˆç”¨æˆ·çš„åˆæ³•æ ¡éªŒï¼Œå½“ç”¨æˆ·é€€å‡ºç³»ç»Ÿæˆ–sessionè¿‡æœŸé”€æ¯æ—¶,å®¢æˆ·ç«¯çš„session_idä¹Ÿå°±æ— æ•ˆäº†ã€‚ token ä¼šè¯ ç”¨æˆ·è®¤è¯æˆåŠŸåï¼ŒæœåŠ¡ç«¯ç”Ÿæˆä¸€ä¸ªtokenå‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ”¾åˆ° cookie æˆ– localStorageç­‰å­˜å‚¨ä¸­ï¼Œæ¯æ¬¡è¯·æ±‚æ—¶å¸¦ä¸Š tokenï¼ŒæœåŠ¡ç«¯æ”¶åˆ°tokené€šè¿‡éªŒè¯åå³å¯ç¡®è®¤ç”¨æˆ·èº«ä»½ã€‚ åŸºäºsessionçš„è®¤è¯æ–¹å¼ç”±Servletè§„èŒƒå®šåˆ¶ï¼ŒæœåŠ¡ç«¯è¦å­˜å‚¨sessionä¿¡æ¯éœ€è¦å ç”¨å†…å­˜èµ„æºï¼Œå®¢æˆ·ç«¯éœ€è¦æ”¯æŒ cookieï¼›åŸºäºtokençš„æ–¹å¼åˆ™ä¸€èˆ¬ä¸éœ€è¦æœåŠ¡ç«¯å­˜å‚¨tokenï¼Œå¹¶ä¸”ä¸é™åˆ¶å®¢æˆ·ç«¯çš„å­˜å‚¨æ–¹å¼ã€‚å¦‚ä»Šç§»åŠ¨äº’è”ç½‘æ—¶ä»£ æ›´å¤šç±»å‹çš„å®¢æˆ·ç«¯éœ€è¦æ¥å…¥ç³»ç»Ÿï¼Œç³»ç»Ÿå¤šæ˜¯é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„æ¶æ„è¿›è¡Œå®ç°ï¼Œæ‰€ä»¥åŸºäºtokençš„æ–¹å¼æ›´é€‚åˆã€‚ ä»€ä¹ˆæ˜¯æˆæƒ æˆæƒæ˜¯ç”¨æˆ·è®¤è¯é€šè¿‡æ ¹æ®ç”¨æˆ·çš„æƒé™æ¥æ§åˆ¶ç”¨æˆ·è®¿é—®èµ„æºçš„è¿‡ç¨‹ï¼Œæ‹¥æœ‰èµ„æºçš„è®¿é—®æƒé™åˆ™æ­£å¸¸è®¿é—®ï¼Œæ²¡æœ‰æƒé™åˆ™æ‹’ç»è®¿é—®ã€‚ ä¸ºä»€ä¹ˆè¦æˆæƒï¼Ÿ è®¤è¯æ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·èº«ä»½çš„åˆæ³•æ€§ï¼Œæˆæƒåˆ™æ˜¯ä¸ºäº†æ›´ç»†ç²’åº¦çš„å¯¹éšç§æ•°æ®è¿›è¡Œåˆ’åˆ†ï¼Œæˆæƒæ˜¯åœ¨è®¤è¯é€šè¿‡åå‘ç”Ÿçš„ï¼Œæ§åˆ¶ä¸åŒçš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ä¸åŒçš„èµ„æºã€‚ SpringSecurity Spring Securityæ˜¯ä¸€ä¸ªèƒ½å¤Ÿä¸ºåŸºäºSpringçš„ä¼ä¸šåº”ç”¨ç³»ç»Ÿæä¾›å£°æ˜å¼çš„å®‰å…¨è®¿é—®æ§åˆ¶è§£å†³æ–¹æ¡ˆçš„å®‰å…¨æ¡†æ¶ã€‚ç”±äºå®ƒæ˜¯Springç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€å‘˜ï¼Œå› æ­¤å®ƒä¼´éšç€æ•´ä¸ªSpringç”Ÿæ€ç³»ç»Ÿä¸æ–­ä¿®æ­£ã€å‡çº§ï¼Œåœ¨spring booté¡¹ç›®ä¸­åŠ å…¥spring securityæ›´æ˜¯ååˆ†ç®€å•ï¼Œä½¿ç”¨Spring Security å‡å°‘äº†ä¸ºä¼ä¸šç³»ç»Ÿå®‰å…¨æ§åˆ¶ç¼–å†™å¤§é‡é‡å¤ä»£ç çš„å·¥ä½œã€‚ å¿«é€Ÿä¸Šæ‰‹ å¼•å…¥æ‰€éœ€ä¾èµ– &lt;!-- spring security ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- webæ”¯æŒ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; æ·»åŠ spring security é…ç½®ç±» package com.ldx.springboot.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.password.NoOpPasswordEncoder; import org.springframework.security.crypto.password.PasswordEncoder; import org.springframework.security.provisioning.InMemoryUserDetailsManager; /** * springsecurity é…ç½®ç±» * @author ludangxin * @Date 2020-06-01 **/ @Configuration @EnableGlobalMethodSecurity(securedEnabled = true,prePostEnabled = true) public class WebSecurityConfig extends WebSecurityConfigurerAdapter { /** * å®šä¹‰ç”¨æˆ·ä¿¡æ¯æœåŠ¡ï¼ˆæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼‰ */ @Bean @Override public UserDetailsService userDetailsService(){ //åŸºäºå†…å­˜çš„userDetail InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager(); //ç”¨æˆ·zhangsan æ‹¥æœ‰è®¿é—®p1èµ„æºæƒé™ manager.createUser(User.withUsername(&quot;zhangsan&quot;).password(&quot;123&quot;).authorities(&quot;p1&quot;).build()); //ç”¨æˆ·lisi æ‹¥æœ‰è®¿é—®p2èµ„æºæƒé™ manager.createUser(User.withUsername(&quot;lisi&quot;).password(&quot;456&quot;).authorities(&quot;p2&quot;).build()); return manager; } /** * å¯†ç ç¼–ç å™¨ */ @Bean public PasswordEncoder passwordEncoder(){ //æ— åŠ å¯†æœºåˆ¶ return NoOpPasswordEncoder.getInstance(); } /** * å®‰å…¨æ‹¦æˆªæœºåˆ¶ï¼ˆæœ€é‡è¦ï¼‰ */ @Override protected void configure(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(&quot;/r/r1&quot;).hasAuthority(&quot;p1&quot;) .antMatchers(&quot;/r/r2&quot;).hasAuthority(&quot;p2&quot;) //æ‰€æœ‰çš„è¯·æ±‚å¿…é¡»é€šè¿‡è®¤è¯ .anyRequest().authenticated() .and() //å…è®¸è¡¨å•ç™»å½• .formLogin() //è‡ªå®šä¹‰ç™»å½•æˆåŠŸçš„é¡µé¢åœ°å€ .successForwardUrl(&quot;/login-success&quot;); } } ç¼–å†™æµ‹è¯•æ¥å£ import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class TestController { @RequestMapping(value = &quot;/login-success&quot;) public String loginSuccess(){ return &quot; ç™»å½•æˆåŠŸ&quot;; } /** * æµ‹è¯•èµ„æº1 * @return */ @GetMapping(value = &quot;/r/r1&quot;) public String r1(){ return &quot; è®¿é—®èµ„æº1&quot;; } /** * æµ‹è¯•èµ„æº2 * @return */ @GetMapping(value = &quot;/r/r2&quot;) public String r2(){ return &quot; è®¿é—®èµ„æº2&quot;; } } æµ‹è¯• æµ‹è¯•ç™»é™†åŠŸèƒ½,è®¿é—® localhost:8080 è¾“å…¥ è´¦å·:zhangsan å¯†ç : 123ç™»é™†æˆåŠŸ è®¿é—® /r/r1èµ„æº è®¿é—®r/r2èµ„æº, 403æ— æƒé™ å°ç»“ é€šè¿‡å¿«é€Ÿä¸Šæ‰‹ï¼Œå’±ä»¬ä½¿ç”¨Spring Securityå®ç°äº†è®¤è¯å’Œæˆæƒï¼ŒSpring Securityæä¾›äº†åŸºäºè´¦å·å’Œå¯†ç çš„è®¤è¯æ–¹å¼ï¼Œé€šè¿‡å®‰å…¨é…ç½®å³å¯å®ç°è¯·æ±‚æ‹¦æˆªï¼ŒæˆæƒåŠŸèƒ½ï¼ŒSpring Securityèƒ½å®Œæˆçš„ä¸ä»…ä»…æ˜¯è¿™äº›ã€‚ å·¥ä½œåŸç† ç»“æ„æ€»è§ˆ Spring Securityæ‰€è§£å†³çš„é—®é¢˜å°±æ˜¯å®‰å…¨è®¿é—®æ§åˆ¶ï¼Œè€Œå®‰å…¨è®¿é—®æ§åˆ¶åŠŸèƒ½å…¶å®å°±æ˜¯å¯¹æ‰€æœ‰è¿›å…¥ç³»ç»Ÿçš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œæ ¡éªŒæ¯ä¸ªè¯·æ±‚æ˜¯å¦èƒ½å¤Ÿè®¿é—®å®ƒæ‰€æœŸæœ›çš„èµ„æºã€‚ å½“åˆå§‹åŒ–Spring Securityæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªåä¸º SpringSecurityFilterChain çš„Servletè¿‡æ»¤å™¨ï¼Œç±»å‹ä¸º org.springframework.security.web.FilterChainProxyï¼Œå®ƒå®ç°äº†javax.servlet.Filterï¼Œå› æ­¤å¤–éƒ¨çš„è¯·æ±‚ä¼šç»è¿‡æ­¤ç±»ï¼Œä¸‹å›¾æ˜¯Spring Securityè¿‡è™‘å™¨é“¾ç»“æ„å›¾ï¼š FilterChainProxyæ˜¯ä¸€ä¸ªä»£ç†ï¼ŒçœŸæ­£èµ·ä½œç”¨çš„æ˜¯FilterChainProxyä¸­SecurityFilterChainæ‰€åŒ…å«çš„å„ä¸ªFilterï¼ŒåŒæ—¶è¿™äº›Filterä½œä¸ºBeanè¢«Springç®¡ç†ï¼Œå®ƒä»¬æ˜¯Spring Securityæ ¸å¿ƒï¼Œå„æœ‰å„çš„èŒè´£ï¼Œä½†ä»–ä»¬å¹¶ä¸ç›´æ¥å¤„ç†ç”¨æˆ·çš„è®¤è¯ï¼Œä¹Ÿä¸ç›´æ¥å¤„ç†ç”¨æˆ·çš„æˆæƒï¼Œè€Œæ˜¯æŠŠå®ƒä»¬äº¤ç»™äº†è®¤è¯ç®¡ç†ï¼ˆAuthenticationManagerï¼‰å’Œå†³ç­–ç®¡ç†å™¨ï¼ˆAccessDecisionManagerï¼‰è¿›è¡Œå¤„ç†. ä¸‹é¢ä»‹ç»è¿‡æ»¤å™¨é“¾ä¸­ä¸»è¦çš„å‡ ä¸ªè¿‡æ»¤å™¨åŠå…¶ä½œç”¨ï¼š SecurityContextPersistenceFilter : è¿™ä¸ªFilteræ˜¯æ•´ä¸ªæ‹¦æˆªè¿‡ç¨‹çš„å…¥å£å’Œå‡ºå£ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªæ‹¦æˆªå™¨ï¼‰ï¼Œä¼šåœ¨è¯·æ±‚å¼€å§‹æ—¶ä»é…ç½®å¥½çš„ SecurityContextRepository ä¸­è·å– SecurityContextï¼Œç„¶åæŠŠå®ƒè®¾ç½®ç»™SecurityContextHolderã€‚åœ¨è¯·æ±‚å®Œæˆåå°† SecurityContextHolder æŒæœ‰çš„ SecurityContext å†ä¿å­˜åˆ°é…ç½®å¥½çš„ SecurityContextRepositoryï¼ŒåŒæ—¶æ¸…é™¤ securityContextHolder æ‰€æŒæœ‰çš„SecurityContextï¼› UsernamePasswordAuthenticationFilter : ç”¨äºå¤„ç†æ¥è‡ªè¡¨å•æäº¤çš„è®¤è¯ã€‚è¯¥è¡¨å•å¿…é¡»æä¾›å¯¹åº”çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå…¶å†…éƒ¨è¿˜æœ‰ç™»å½•æˆåŠŸæˆ–å¤±è´¥åè¿›è¡Œå¤„ç†çš„ AuthenticationSuccessHandler å’Œ AuthenticationFailureHandlerï¼Œè¿™äº›éƒ½å¯ä»¥æ ¹æ®éœ€æ±‚åšç›¸å…³æ”¹å˜ï¼› FilterSecurityInterceptor : æ˜¯ç”¨äºä¿æŠ¤webèµ„æºçš„ï¼Œä½¿ç”¨AccessDecisionManagerå¯¹å½“å‰ç”¨æˆ·è¿›è¡Œæˆæƒè®¿é—®ï¼› ExceptionTranslationFilter : èƒ½å¤Ÿæ•è·æ¥è‡ª FilterChain æ‰€æœ‰çš„å¼‚å¸¸ï¼Œå¹¶è¿›è¡Œå¤„ç†ã€‚ä½†æ˜¯å®ƒåªä¼šå¤„ç†ä¸¤ç±»å¼‚å¸¸ï¼šAuthenticationException å’Œ AccessDeniedExceptionï¼Œå…¶å®ƒçš„å¼‚å¸¸å®ƒä¼šç»§ç»­æŠ›å‡ºã€‚ è®¤è¯ æµç¨‹ ç”¨æˆ·æäº¤ç”¨æˆ·åã€å¯†ç è¢«SecurityFilterChainä¸­çš„ UsernamePasswordAuthenticationFilter è¿‡æ»¤å™¨è·å–åˆ°ï¼Œå°è£…ä¸ºè¯·æ±‚Authenticationï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯UsernamePasswordAuthenticationTokenè¿™ä¸ªå®ç°ç±»ã€‚ ç„¶åè¿‡æ»¤å™¨å°†Authenticationæäº¤è‡³è®¤è¯ç®¡ç†å™¨ï¼ˆAuthenticationManagerï¼‰è¿›è¡Œè®¤è¯ è®¤è¯æˆåŠŸåï¼Œ AuthenticationManager èº«ä»½ç®¡ç†å™¨è¿”å›ä¸€ä¸ªè¢«å¡«å……æ»¡äº†ä¿¡æ¯çš„ï¼ˆåŒ…æ‹¬ä¸Šé¢æåˆ°çš„æƒé™ä¿¡æ¯ï¼Œèº«ä»½ä¿¡æ¯ï¼Œç»†èŠ‚ä¿¡æ¯ï¼Œä½†å¯†ç é€šå¸¸ä¼šè¢«ç§»é™¤ï¼‰ Authentication å®ä¾‹ã€‚ SecurityContextHolder å®‰å…¨ä¸Šä¸‹æ–‡å®¹å™¨å°†ç¬¬3æ­¥å¡«å……äº†ä¿¡æ¯çš„ Authentication ï¼Œé€šè¿‡SecurityContextHolder.getContext().setAuthentication(â€¦)æ–¹æ³•ï¼Œè®¾ç½®åˆ°å…¶ä¸­ã€‚å¯ä»¥çœ‹å‡ºAuthenticationManageræ¥å£ï¼ˆè®¤è¯ç®¡ç†å™¨ï¼‰æ˜¯è®¤è¯ç›¸å…³çš„æ ¸å¿ƒæ¥å£ï¼Œä¹Ÿæ˜¯å‘èµ·è®¤è¯çš„å‡ºå‘ç‚¹ï¼Œå®ƒ çš„å®ç°ç±»ä¸ºProviderManagerã€‚è€ŒSpring Securityæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼Œå› æ­¤ProviderManagerç»´æŠ¤ç€ä¸€ä¸ª List åˆ—è¡¨ï¼Œå­˜æ”¾å¤šç§è®¤è¯æ–¹å¼ï¼Œæœ€ç»ˆå®é™…çš„è®¤è¯å·¥ä½œæ˜¯ç”± AuthenticationProviderå®Œæˆçš„ã€‚å’±ä»¬çŸ¥é“webè¡¨å•çš„å¯¹åº”çš„AuthenticationProviderå®ç°ç±»ä¸º DaoAuthenticationProviderï¼Œå®ƒçš„å†…éƒ¨åˆç»´æŠ¤ç€ä¸€ä¸ªUserDetailsServiceè´Ÿè´£UserDetailsçš„è·å–ã€‚æœ€ç»ˆAuthenticationProviderå°†UserDetailså¡«å……è‡³Authenticationã€‚ AuthenticationProvider é€šè¿‡å‰é¢çš„Spring Securityè®¤è¯æµç¨‹æˆ‘ä»¬å¾—çŸ¥ï¼Œè®¤è¯ç®¡ç†å™¨ï¼ˆAuthenticationManagerï¼‰å§”æ‰˜AuthenticationProviderå®Œæˆè®¤è¯å·¥ä½œã€‚ AuthenticationProvideræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š public interface AuthenticationProvider { Authentication authenticate(Authentication authentication) throws AuthenticationException; boolean supports(Class&lt;?&gt; var1); } authenticate()æ–¹æ³•å®šä¹‰äº†è®¤è¯çš„å®ç°è¿‡ç¨‹ï¼Œå®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªAuthenticationï¼Œé‡Œé¢åŒ…å«äº†ç™»å½•ç”¨æˆ·æ‰€æäº¤çš„ç”¨æˆ·ã€å¯†ç ç­‰ã€‚è€Œè¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªAuthenticationï¼Œè¿™ä¸ªAuthenticationåˆ™æ˜¯åœ¨è®¤è¯æˆåŠŸåï¼Œå°†ç”¨æˆ·çš„æƒé™åŠå…¶ä»–ä¿¡æ¯é‡æ–°ç»„è£…åç”Ÿæˆã€‚ Spring Securityä¸­ç»´æŠ¤ç€ä¸€ä¸ª List åˆ—è¡¨ï¼Œå­˜æ”¾å¤šç§è®¤è¯æ–¹å¼ï¼Œä¸åŒçš„è®¤è¯æ–¹å¼ä½¿ç”¨ä¸åŒçš„AuthenticationProviderã€‚å¦‚ä½¿ç”¨ç”¨æˆ·åå¯†ç ç™»å½•æ—¶ï¼Œä½¿ç”¨AuthenticationProvider1ï¼ŒçŸ­ä¿¡ç™»å½•æ—¶ä½¿ç”¨AuthenticationProvider2ç­‰ç­‰è¿™æ ·çš„ä¾‹å­å¾ˆå¤šã€‚ æ¯ä¸ªAuthenticationProvideréœ€è¦å®ç°supports()æ–¹æ³•æ¥è¡¨æ˜è‡ªå·±æ”¯æŒçš„è®¤è¯æ–¹å¼ï¼Œå¦‚æˆ‘ä»¬ä½¿ç”¨è¡¨å•æ–¹å¼è®¤è¯ï¼Œåœ¨æäº¤è¯·æ±‚æ—¶Spring Securityä¼šç”ŸæˆUsernamePasswordAuthenticationTokenï¼Œå®ƒæ˜¯ä¸€ä¸ªAuthenticationï¼Œé‡Œé¢å°è£…ç€ç”¨æˆ·æäº¤çš„ç”¨æˆ·åã€å¯†ç ä¿¡æ¯ã€‚è€Œå¯¹åº”çš„ï¼Œå“ªä¸ªAuthenticationProvideræ¥å¤„ç†å®ƒï¼Ÿ æˆ‘ä»¬åœ¨DaoAuthenticationProviderçš„åŸºç±»AbstractUserDetailsAuthenticationProviderå‘ç°ä»¥ä¸‹ä»£ç ï¼š public boolean supports(Class&lt;?&gt; authentication) { return UsernamePasswordAuthenticationToken.class.isAssignableFrom(authentication); } ä¹Ÿå°±æ˜¯è¯´å½“webè¡¨å•æäº¤ç”¨æˆ·åå¯†ç æ—¶ï¼ŒSpring Securityç”±DaoAuthenticationProviderå¤„ç†ã€‚ æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Authentication(è®¤è¯ä¿¡æ¯)çš„ç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬ä¹‹å‰æåˆ°çš„ UsernamePasswordAuthenticationTokenå°±æ˜¯å®ƒçš„å®ç°ä¹‹ä¸€ï¼š public interface Authentication extends Principal, Serializable { Collection&lt;? extends GrantedAuthority&gt; getAuthorities(); Object getCredentials(); Object getDetails(); Object getPrincipal(); boolean isAuthenticated(); void setAuthenticated(boolean var1) throws IllegalArgumentException; } Authenticationæ˜¯spring securityåŒ…ä¸­çš„æ¥å£ï¼Œç›´æ¥ç»§æ‰¿è‡ªPrincipalç±»ï¼Œè€ŒPrincipalæ˜¯ä½äº java.securityåŒ…ä¸­çš„ã€‚å®ƒæ˜¯è¡¨ç¤ºç€ä¸€ä¸ªæŠ½è±¡ä¸»ä½“èº«ä»½ï¼Œä»»ä½•ä¸»ä½“éƒ½æœ‰ä¸€ä¸ªåç§°ï¼Œå› æ­¤åŒ…å«ä¸€ä¸ªgetName()æ–¹æ³•ã€‚ getAuthorities()ï¼Œæƒé™ä¿¡æ¯åˆ—è¡¨ï¼Œé»˜è®¤æ˜¯GrantedAuthorityæ¥å£çš„ä¸€äº›å®ç°ç±»ï¼Œé€šå¸¸æ˜¯ä»£è¡¨æƒé™ä¿¡æ¯çš„ä¸€ç³»åˆ—å­—ç¬¦ä¸²ã€‚ getCredentials()ï¼Œå‡­è¯ä¿¡æ¯ï¼Œç”¨æˆ·è¾“å…¥çš„å¯†ç å­—ç¬¦ä¸²ï¼Œåœ¨è®¤è¯è¿‡åé€šå¸¸ä¼šè¢«ç§»é™¤ï¼Œç”¨äºä¿éšœå®‰å…¨ã€‚ getDetails()ï¼Œç»†èŠ‚ä¿¡æ¯ï¼Œwebåº”ç”¨ä¸­çš„å®ç°æ¥å£é€šå¸¸ä¸º WebAuthenticationDetailsï¼Œå®ƒè®°å½•äº†è®¿é—®è€…çš„ipåœ°å€å’ŒsessionIdçš„å€¼ã€‚ getPrincipal()ï¼Œèº«ä»½ä¿¡æ¯ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿”å›çš„æ˜¯UserDetailsæ¥å£çš„å®ç°ç±»ï¼ŒUserDetailsä»£è¡¨ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œé‚£ä»Authenticationä¸­å–å‡ºæ¥çš„UserDetailså°±æ˜¯å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œå®ƒä¹Ÿæ˜¯æ¡†æ¶ä¸­çš„å¸¸ç”¨æ¥å£ä¹‹ä¸€ã€‚ UserDetailsService è®¤è¯†UserDetailsService ç°åœ¨å’±ä»¬ç°åœ¨çŸ¥é“DaoAuthenticationProviderå¤„ç†äº†webè¡¨å•çš„è®¤è¯é€»è¾‘ï¼Œè®¤è¯æˆåŠŸåæ—¢å¾—åˆ°ä¸€ä¸ª Authentication(UsernamePasswordAuthenticationTokenå®ç°)ï¼Œé‡Œé¢åŒ…å«äº†èº«ä»½ä¿¡æ¯ï¼ˆPrincipalï¼‰ã€‚è¿™ä¸ªèº«ä»½ä¿¡æ¯å°±æ˜¯ä¸€ä¸ª Object ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å®ƒå¯ä»¥è¢«å¼ºè½¬ä¸ºUserDetailså¯¹è±¡ã€‚ DaoAuthenticationProviderä¸­åŒ…å«äº†ä¸€ä¸ªUserDetailsServiceå®ä¾‹ï¼Œå®ƒè´Ÿè´£æ ¹æ®ç”¨æˆ·åæå–ç”¨æˆ·ä¿¡æ¯UserDetails(åŒ…å«å¯†ç )ï¼Œè€ŒåDaoAuthenticationProviderä¼šå»å¯¹æ¯”UserDetailsServiceæå–çš„ç”¨æˆ·å¯†ç ä¸ç”¨æˆ·æäº¤çš„å¯†ç æ˜¯å¦åŒ¹é…ä½œä¸ºè®¤è¯æˆåŠŸçš„å…³é”®ä¾æ®ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å°†è‡ªå®šä¹‰çš„ UserDetailsService å…¬å¼€ä¸ºspring beanæ¥å®šä¹‰è‡ªå®šä¹‰èº«ä»½éªŒè¯ã€‚ public interface UserDetailsService { UserDetails loadUserByUsername(String username) throws UsernameNotFoundException; } å¾ˆå¤šäººæŠŠDaoAuthenticationProviderå’ŒUserDetailsServiceçš„èŒè´£ææ··æ·†ï¼Œå…¶å®UserDetailsServiceåªè´Ÿè´£ä»ç‰¹å®šçš„åœ°æ–¹ï¼ˆé€šå¸¸æ˜¯æ•°æ®åº“ï¼‰åŠ è½½ç”¨æˆ·ä¿¡æ¯ï¼Œä»…æ­¤è€Œå·²ã€‚è€ŒDaoAuthenticationProviderçš„èŒè´£æ›´å¤§ï¼Œå®ƒå®Œæˆå®Œæ•´çš„è®¤è¯æµç¨‹ï¼ŒåŒæ—¶ä¼šæŠŠUserDetailså¡«å……è‡³Authenticationã€‚ä¸Šé¢ä¸€ç›´æåˆ°UserDetailsæ˜¯ç”¨æˆ·ä¿¡æ¯ï¼Œå’±ä»¬çœ‹ä¸€ä¸‹å®ƒçš„çœŸé¢ç›®ï¼š public interface UserDetails extends Serializable { Collection&lt;? extends GrantedAuthority&gt; getAuthorities(); String getPassword(); String getUsername(); boolean isAccountNonExpired(); boolean isAccountNonLocked(); boolean isCredentialsNonExpired(); boolean isEnabled(); } å®ƒå’ŒAuthenticationæ¥å£å¾ˆç±»ä¼¼ï¼Œæ¯”å¦‚å®ƒä»¬éƒ½æ‹¥æœ‰usernameï¼Œauthoritiesã€‚Authenticationçš„getCredentials()ä¸UserDetailsä¸­çš„getPassword()éœ€è¦è¢«åŒºåˆ†å¯¹å¾…ï¼Œå‰è€…æ˜¯ç”¨æˆ·æäº¤çš„å¯†ç å‡­è¯ï¼Œåè€…æ˜¯ç”¨æˆ·å®é™…å­˜å‚¨çš„å¯†ç ï¼Œè®¤è¯å…¶å®å°±æ˜¯å¯¹è¿™ä¸¤è€…çš„æ¯”å¯¹ã€‚Authenticationä¸­çš„getAuthorities()å®é™…æ˜¯ç”±UserDetailsçš„getAuthorities()ä¼ é€’è€Œå½¢æˆçš„ã€‚è¿˜è®°å¾—Authenticationæ¥å£ä¸­çš„getDetails()æ–¹æ³•å—ï¼Ÿå…¶ä¸­çš„UserDetailsç”¨æˆ·è¯¦ç»†ä¿¡æ¯ä¾¿æ˜¯ç»è¿‡äº†AuthenticationProviderè®¤è¯ä¹‹åè¢«å¡«å……çš„ã€‚ é€šè¿‡å®ç°UserDetailsServiceå’ŒUserDetailsï¼Œæˆ‘ä»¬å¯ä»¥å®Œæˆå¯¹ç”¨æˆ·ä¿¡æ¯è·å–æ–¹å¼ä»¥åŠç”¨æˆ·ä¿¡æ¯å­—æ®µçš„æ‰©å±•ã€‚ Spring Securityæä¾›çš„InMemoryUserDetailsManager(å†…å­˜è®¤è¯)ï¼ŒJdbcUserDetailsManager(jdbcè®¤è¯)å°±æ˜¯UserDetailsServiceçš„å®ç°ç±»ï¼Œä¸»è¦åŒºåˆ«æ— éå°±æ˜¯ä»å†…å­˜è¿˜æ˜¯ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·ã€‚ 2. è‡ªå®šä¹‰UserDetailsService @Service public class SpringDataUserDetailsService implements UserDetailsService { @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { //ç™»å½•è´¦å· System.out.println(&quot;username=&quot;+username); //æ ¹æ®è´¦å·å»æ•°æ®åº“æŸ¥è¯¢... //è¿™é‡Œæš‚æ—¶ä½¿ç”¨é™æ€æ•°æ® UserDetails userDetails = User.withUsername(username).password(&quot;123&quot;).authorities(&quot;p1&quot;).build(); return userDetails; } } PasswordEncoder è®¤è¯†PasswordEncoder DaoAuthenticationProviderè®¤è¯å¤„ç†å™¨é€šè¿‡UserDetailsServiceè·å–åˆ°UserDetailsåï¼Œå®ƒæ˜¯å¦‚ä½•ä¸è¯·æ±‚Authenticationä¸­çš„å¯†ç åšå¯¹æ¯”å‘¢ï¼Ÿ åœ¨è¿™é‡ŒSpring Securityä¸ºäº†é€‚åº”å¤šç§å¤šæ ·çš„åŠ å¯†ç±»å‹ï¼Œåˆåšäº†æŠ½è±¡ï¼ŒDaoAuthenticationProvideré€šè¿‡PasswordEncoderæ¥å£çš„matchesæ–¹æ³•è¿›è¡Œå¯†ç çš„å¯¹æ¯”ï¼Œè€Œå…·ä½“çš„å¯†ç å¯¹æ¯”ç»†èŠ‚å–å†³äºå®ç°ï¼š public interface PasswordEncoder { String encode(CharSequence var1); boolean matches(CharSequence var1, String var2); default boolean upgradeEncoding(String encodedPassword) { return false; } } è€ŒSpring Securityæä¾›å¾ˆå¤šå†…ç½®çš„PasswordEncoderï¼Œèƒ½å¤Ÿå¼€ç®±å³ç”¨ï¼Œä½¿ç”¨æŸç§PasswordEncoderåªéœ€è¦è¿›è¡Œå¦‚ä¸‹å£°æ˜å³å¯ï¼Œå¦‚ä¸‹ï¼š @Bean public PasswordEncoder passwordEncoder() { //NoOpPasswordEncoderé‡‡ç”¨å­—ç¬¦ä¸²åŒ¹é…æ–¹æ³•ï¼Œä¸å¯¹å¯†ç è¿›è¡ŒåŠ å¯†æ¯”è¾ƒå¤„ç† return NoOpPasswordEncoder.getInstance(); } å¯†ç æ¯”è¾ƒæµç¨‹å¦‚ä¸‹ ç”¨æˆ·è¾“å…¥å¯†ç ï¼ˆæ˜æ–‡ ï¼‰ DaoAuthenticationProviderè·å–UserDetailsï¼ˆå…¶ä¸­å­˜å‚¨äº†ç”¨æˆ·çš„æ­£ç¡®å¯†ç ï¼‰ DaoAuthenticationProviderä½¿ç”¨PasswordEncoderå¯¹è¾“å…¥çš„å¯†ç å’Œæ­£ç¡®çš„å¯†ç è¿›è¡Œæ ¡éªŒï¼Œå¯†ç ä¸€è‡´åˆ™æ ¡éªŒé€šè¿‡ï¼Œå¦åˆ™æ ¡éªŒå¤±è´¥ã€‚ NoOpPasswordEncoderçš„æ ¡éªŒè§„åˆ™æ‹¿ è¾“å…¥çš„å¯†ç å’ŒUserDetailsä¸­çš„æ­£ç¡®å¯†ç è¿›è¡Œå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œå­—ç¬¦ä¸²å†…å®¹ä¸€è‡´åˆ™æ ¡éªŒé€šè¿‡ï¼Œå¦åˆ™ æ ¡éªŒå¤±è´¥ã€‚ å®é™…é¡¹ç›®ä¸­æ¨èä½¿ç”¨BCryptPasswordEncoder, Pbkdf2PasswordEncoder, SCryptPasswordEncoderç­‰ï¼Œæ„Ÿå…´è¶£çš„å¤§å®¶å¯ä»¥çœ‹çœ‹è¿™äº›PasswordEncoderçš„å…·ä½“å®ç°ã€‚ ä½¿ç”¨BCryptPasswordEncoder é…ç½®BCryptPasswordEncoder åœ¨å®‰å…¨é…ç½®ç±»ä¸­å®šä¹‰ï¼š @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } æµ‹è¯•å‘ç°è®¤è¯å¤±è´¥ï¼Œæç¤ºï¼šEncoded password does not look like BCryptã€‚ åŸå› ï¼š ç”±äºUserDetailsä¸­å­˜å‚¨çš„æ˜¯åŸå§‹å¯†ç ï¼ˆæ¯”å¦‚ï¼š123ï¼‰ï¼Œå®ƒä¸æ˜¯BCryptæ ¼å¼ã€‚è·Ÿè¸ª DaoAuthenticationProviderç¬¬33è¡Œä»£ç æŸ¥çœ‹ userDetailsä¸­çš„å†…å®¹ ï¼Œè·Ÿè¸ªç¬¬38è¡Œä»£ç æŸ¥çœ‹PasswordEncoderçš„ç±»å‹ã€‚ â€‹ 2. æµ‹è¯•BCrypt é€šè¿‡ä¸‹è¾¹çš„ä»£ç æµ‹è¯•BCryptåŠ å¯†åŠæ ¡éªŒçš„æ–¹æ³• ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼š @RunWith(SpringRunner.class) public class TestBCrypt { @Test public void test1(){ //å¯¹åŸå§‹å¯†ç åŠ å¯† String hashpw = BCrypt.hashpw(&quot;123&quot;,BCrypt.gensalt()); System.out.println(hashpw); //æ ¡éªŒåŸå§‹å¯†ç å’ŒBCryptå¯†ç æ˜¯å¦ä¸€è‡´ boolean checkpw = BCrypt.checkpw(&quot;123&quot;, &quot;$2a$10$NlBC84MVb7F95EXYTXwLneXgCca6/GipyWR5NHm8K0203bSQMLpvm&quot;); System.out.println(checkpw); } } æˆæƒ æµç¨‹ é€šè¿‡å¿«é€Ÿä¸Šæ‰‹æˆ‘ä»¬çŸ¥é“ï¼ŒSpring Securityå¯ä»¥é€šè¿‡ http.authorizeRequests() å¯¹webè¯·æ±‚è¿›è¡Œæˆæƒä¿æŠ¤ã€‚Spring Securityä½¿ç”¨æ ‡å‡†Filterå»ºç«‹äº†å¯¹webè¯·æ±‚çš„æ‹¦æˆªï¼Œæœ€ç»ˆå®ç°å¯¹èµ„æºçš„æˆæƒè®¿é—®ã€‚ Spring Securityçš„æˆæƒæµç¨‹å¦‚ä¸‹ï¼š æ‹¦æˆªè¯·æ±‚ï¼Œå·²è®¤è¯ç”¨æˆ·è®¿é—®å—ä¿æŠ¤çš„webèµ„æºå°†è¢«SecurityFilterChainä¸­çš„ FilterSecurityInterceptor çš„å­ç±»æ‹¦æˆªã€‚ è·å–èµ„æºè®¿é—®ç­–ç•¥ï¼ŒFilterSecurityInterceptorä¼šä» SecurityMetadataSource çš„å­ç±» DefaultFilterInvocationSecurityMetadataSource è·å–è¦è®¿é—®å½“å‰èµ„æºæ‰€éœ€è¦çš„æƒé™Collection ã€‚ SecurityMetadataSourceå…¶å®å°±æ˜¯è¯»å–è®¿é—®ç­–ç•¥çš„æŠ½è±¡ï¼Œè€Œè¯»å–çš„å†…å®¹ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬é…ç½®çš„è®¿é—®è§„åˆ™ï¼Œ è¯» å–è®¿é—®ç­–ç•¥å¦‚ï¼š http.authorizeRequests() .antMatchers(&quot;/r/r1&quot;).hasAuthority(&quot;p1&quot;) .antMatchers(&quot;/r/r2&quot;).hasAuthority(&quot;p2&quot;) ... æœ€åï¼ŒFilterSecurityInterceptorä¼šè°ƒç”¨ AccessDecisionManager è¿›è¡Œæˆæƒå†³ç­–ï¼Œè‹¥å†³ç­–é€šè¿‡ï¼Œåˆ™å…è®¸è®¿é—®èµ„æºï¼Œå¦åˆ™å°†ç¦æ­¢è®¿é—®ã€‚ AccessDecisionManagerï¼ˆè®¿é—®å†³ç­–ç®¡ç†å™¨ï¼‰çš„æ ¸å¿ƒæ¥å£å¦‚ä¸‹: public interface AccessDecisionManager { /** * é€šè¿‡ä¼ é€’çš„å‚æ•°æ¥å†³å®šç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®å¯¹åº”å—ä¿æŠ¤èµ„æºçš„æƒé™ */ void decide(Authentication authentication , Object object, Collection&lt;ConfigAttribute&gt; configAttributes ) throws AccessDeniedException, InsufficientAuthenticationException; //ç•¥.. } è¿™é‡Œç€é‡è¯´æ˜ä¸€ä¸‹decideçš„å‚æ•°ï¼š authenticationï¼šè¦è®¿é—®èµ„æºçš„è®¿é—®è€…çš„èº«ä»½ objectï¼šè¦è®¿é—®çš„å—ä¿æŠ¤èµ„æºï¼Œwebè¯·æ±‚å¯¹åº”FilterInvocation confifigAttributesï¼šæ˜¯å—ä¿æŠ¤èµ„æºçš„è®¿é—®ç­–ç•¥ï¼Œé€šè¿‡SecurityMetadataSourceè·å–ã€‚ decideæ¥å£å°±æ˜¯ç”¨æ¥é‰´å®šå½“å‰ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®å¯¹åº”å—ä¿æŠ¤èµ„æºçš„æƒé™ã€‚ æˆæƒå†³ç­– AccessDecisionManageré‡‡ç”¨æŠ•ç¥¨çš„æ–¹å¼æ¥ç¡®å®šæ˜¯å¦èƒ½å¤Ÿè®¿é—®å—ä¿æŠ¤èµ„æºã€‚ AccessDecisionManagerä¸­åŒ…å«çš„ä¸€ç³»åˆ—AccessDecisionVoterå°†ä¼šè¢«ç”¨æ¥å¯¹Authenticationæ˜¯å¦æœ‰æƒè®¿é—®å—ä¿æŠ¤å¯¹è±¡è¿›è¡ŒæŠ•ç¥¨ï¼ŒAccessDecisionManageræ ¹æ®æŠ•ç¥¨ç»“æœï¼Œåšå‡ºæœ€ç»ˆå†³ç­–ã€‚ AccessDecisionVoteræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶ä¸­å®šä¹‰æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼Œå…·ä½“ç»“æ„å¦‚ä¸‹æ‰€ç¤ºã€‚ public interface AccessDecisionVoter&lt;S&gt; { int ACCESS_GRANTED = 1; int ACCESS_ABSTAIN = 0; int ACCESS_DENIED = â€1; boolean supports(ConfigAttribute var1); boolean supports(Class&lt;?&gt; var1); int vote(Authentication var1, S var2, Collection&lt;ConfigAttribute&gt; var3); } vote()æ–¹æ³•çš„è¿”å›ç»“æœä¼šæ˜¯AccessDecisionVoterä¸­å®šä¹‰çš„ä¸‰ä¸ªå¸¸é‡ä¹‹ä¸€ã€‚ACCESS_GRANTEDè¡¨ç¤ºåŒæ„ï¼ŒACCESS_DENIEDè¡¨ç¤ºæ‹’ç»ï¼ŒACCESS_ABSTAINè¡¨ç¤ºå¼ƒæƒã€‚å¦‚æœä¸€ä¸ªAccessDecisionVoterä¸èƒ½åˆ¤å®šå½“å‰Authenticationæ˜¯å¦æ‹¥æœ‰è®¿é—®å¯¹åº”å—ä¿æŠ¤å¯¹è±¡çš„æƒé™ï¼Œåˆ™å…¶vote()æ–¹æ³•çš„è¿”å›å€¼åº”å½“ä¸ºå¼ƒæƒACCESS_ABSTAINã€‚ Spring Securityå†…ç½®äº†ä¸‰ä¸ªåŸºäºæŠ•ç¥¨çš„AccessDecisionManagerå®ç°ç±»å¦‚ä¸‹ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ AffirmativeBasedã€ConsensusBasedå’ŒUnanimousBasedï¼ŒSpring securityé»˜è®¤ä½¿ç”¨çš„æ˜¯AffirmativeBasedã€‚ AffirmativeBasedï¼š åªè¦æœ‰AccessDecisionVoterçš„æŠ•ç¥¨ä¸ºACCESS_GRANTEDåˆ™åŒæ„ç”¨æˆ·è¿›è¡Œè®¿é—®ï¼› å¦‚æœå…¨éƒ¨å¼ƒæƒä¹Ÿè¡¨ç¤ºé€šè¿‡ï¼› å¦‚æœæ²¡æœ‰ä¸€ä¸ªäººæŠ•èµæˆç¥¨ï¼Œä½†æ˜¯æœ‰äººæŠ•åå¯¹ç¥¨ï¼Œåˆ™å°†æŠ›å‡ºAccessDeniedExceptionã€‚ ConsensusBasedï¼š å¦‚æœèµæˆç¥¨å¤šäºåå¯¹ç¥¨åˆ™è¡¨ç¤ºé€šè¿‡ã€‚ åè¿‡æ¥ï¼Œå¦‚æœåå¯¹ç¥¨å¤šäºèµæˆç¥¨åˆ™å°†æŠ›å‡ºAccessDeniedExceptionã€‚ å¦‚æœèµæˆç¥¨ä¸åå¯¹ç¥¨ç›¸åŒä¸”ä¸ç­‰äº0ï¼Œå¹¶ä¸”å±æ€§allowIfEqualGrantedDeniedDecisionsçš„å€¼ä¸ºtrueï¼Œåˆ™è¡¨ç¤ºé€šè¿‡ï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸AccessDeniedExceptionã€‚å‚æ•°allowIfEqualGrantedDeniedDecisionsçš„å€¼é»˜è®¤ä¸ºtrueã€‚ å¦‚æœæ‰€æœ‰çš„AccessDecisionVoteréƒ½å¼ƒæƒäº†ï¼Œåˆ™å°†è§†å‚æ•°allowIfAllAbstainDecisionsçš„å€¼è€Œå®šï¼Œå¦‚æœè¯¥å€¼ä¸ºtrueåˆ™è¡¨ç¤ºé€šè¿‡ï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸AccessDeniedExceptionã€‚å‚æ•°allowIfAllAbstainDecisionsçš„å€¼é»˜è®¤ä¸ºfalseã€‚ UnanimousBased: UnanimousBasedä¸å¦å¤–ä¸¤ç§å®ç°æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå¦å¤–ä¸¤ç§ä¼šä¸€æ¬¡æ€§æŠŠå—ä¿æŠ¤å¯¹è±¡çš„é…ç½®å±æ€§å…¨éƒ¨ä¼ é€’ç»™AccessDecisionVoterè¿›è¡ŒæŠ•ç¥¨ï¼Œè€ŒUnanimousBasedä¼šä¸€æ¬¡åªä¼ é€’ä¸€ä¸ªConfifigAttributeç»™AccessDecisionVoterè¿›è¡ŒæŠ•ç¥¨ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€å¦‚æœæˆ‘ä»¬çš„AccessDecisionVoterçš„é€»è¾‘æ˜¯åªè¦ä¼ é€’è¿›æ¥çš„ ConfifigAttributeä¸­æœ‰ä¸€ä¸ªèƒ½å¤ŸåŒ¹é…åˆ™æŠ•èµæˆç¥¨ï¼Œä½†æ˜¯æ”¾åˆ°UnanimousBasedä¸­å…¶æŠ•ç¥¨ç»“æœå°±ä¸ä¸€å®šæ˜¯èµæˆäº†ã€‚ å¦‚æœå—ä¿æŠ¤å¯¹è±¡é…ç½®çš„æŸä¸€ä¸ªConfifigAttributeè¢«ä»»æ„çš„AccessDecisionVoteråå¯¹äº†ï¼Œåˆ™å°†æŠ›å‡ºAccessDeniedExceptionã€‚ å¦‚æœæ²¡æœ‰åå¯¹ç¥¨ï¼Œä½†æ˜¯æœ‰èµæˆç¥¨ï¼Œåˆ™è¡¨ç¤ºé€šè¿‡ã€‚ å¦‚æœå…¨éƒ¨å¼ƒæƒäº†ï¼Œåˆ™å°†è§†å‚æ•°allowIfAllAbstainDecisionsçš„å€¼è€Œå®šï¼Œtrueåˆ™é€šè¿‡ï¼Œfalseåˆ™æŠ›å‡º AccessDeniedExceptionã€‚ Spring Securityä¹Ÿå†…ç½®ä¸€äº›æŠ•ç¥¨è€…å®ç°ç±»å¦‚RoleVoterã€AuthenticatedVoterå’ŒWebExpressionVoterç­‰ã€‚ è‡ªå®šä¹‰è®¤è¯ åˆ›å»ºæ•°æ®åº“è¡¨ CREATE DATABASE `test` CHARACTER SET 'utf8' COLLATE 'utf8_general_ci'; CREATE TABLE `t_user` ( `id` bigint(20) NOT NULL COMMENT 'ç”¨æˆ·id', `username` varchar(64) NOT NULL, `password` varchar(64) NOT NULL, `fullname` varchar(255) NOT NULL COMMENT 'ç”¨æˆ·å§“å', `mobile` varchar(11) DEFAULT NULL COMMENT 'æ‰‹æœºå·', PRIMARY KEY (`id`) USING BTREE ) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC æ·»åŠ æ‰€éœ€ä¾èµ– &lt;!-- spring security ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- webæ”¯æŒ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- mysqlä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.47&lt;/version&gt; &lt;/dependency&gt; &lt;!-- mybatis --&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt; &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.1&lt;/version&gt; &lt;/dependency&gt; &lt;!-- lombok å·¥å…·--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- å•å…ƒæµ‹è¯• --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; é…ç½®application.yml spring: datasource: type: com.zaxxer.hikari.HikariDataSource driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/test?useUnicode=true&amp;zeroDateTimeBehavior=convertToNull&amp;autoReconnect=true&amp;characterEncoding=utf-8 username: root password: root hikari: minimum-idle: 5 idle-timeout: 600000 maximum-pool-size: 10 auto-commit: true pool-name: MyHikariCP max-lifetime: 1800000 connection-timeout: 30000 connection-test-query: SELECT 1 ä¿®æ”¹springboot å¯åŠ¨ç±» import org.mybatis.spring.annotation.MapperScan; import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; @SpringBootApplication @MapperScan(basePackages = &quot;com.ldx.springboot.dao&quot;) public class SpringbootSpringSecurityApplication { public static void main(String[] args) { SpringApplication.run(SpringbootSpringSecurityApplication.class, args); } } åˆ›å»ºsecurityConfig /** * springsecurity é…ç½®ç±» * @author ludangxin * @Date 2020-06-01 **/ @Configuration @EnableGlobalMethodSecurity(securedEnabled = true,prePostEnabled = true) public class WebSecurityConfig extends WebSecurityConfigurerAdapter { /** * å¯†ç ç¼–ç å™¨ */ @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } /** * å®‰å…¨æ‹¦æˆªæœºåˆ¶ï¼ˆæœ€é‡è¦ï¼‰ */ @Override protected void configure(HttpSecurity http) throws Exception { http. //å±è”½CSRFæ§åˆ¶ï¼Œå³spring securityä¸å†é™åˆ¶CSRF csrf().disable(). authorizeRequests() .antMatchers(&quot;/r/r1&quot;).hasAuthority(&quot;p1&quot;) .antMatchers(&quot;/r/r2&quot;).hasAuthority(&quot;p2&quot;) //æ‰€æœ‰çš„è¯·æ±‚å¿…é¡»é€šè¿‡è®¤è¯ .anyRequest().authenticated() .and() //å…è®¸è¡¨å•ç™»å½• .formLogin() //è‡ªå®šä¹‰ç™»å½•æˆåŠŸçš„é¡µé¢åœ°å€ .successForwardUrl(&quot;/login-success&quot;); } } åˆ›å»ºmodel import lombok.Data; @Data public class UserDto { private String id; private String username; private String password; private String fullname; private String mobile; } åˆ›å»ºcontroller import org.springframework.security.core.Authentication; import org.springframework.security.core.context.SecurityContextHolder; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class LoginController { /** * ç”¨æˆ·ç™»å½•æˆåŠŸ */ @RequestMapping(value = &quot;/login-success&quot;) public String loginSuccess() { String username = getUsername(); return username + &quot; ç™»å½•æˆåŠŸ&quot;; } /** * è·å–å½“å‰ç™»å½•ç”¨æˆ·å */ private String getUsername() { Authentication authentication = SecurityContextHolder.getContext().getAuthentication(); if (!authentication.isAuthenticated()) { return null; } Object principal = authentication.getPrincipal(); String username = null; if (principal instanceof org.springframework.security.core.userdetails.UserDetails) { username = ((org.springframework.security.core.userdetails.UserDetails) principal).getUsername(); } else { username = principal.toString(); } return username; } /** * æµ‹è¯•èµ„æº1 */ @GetMapping(value = &quot;/r/r1&quot;) public String r1() { String username = getUsername(); return username + &quot; è®¿é—®èµ„æº1&quot;; } /** * æµ‹è¯•èµ„æº2 */ @GetMapping(value = &quot;/r/r2&quot;) public String r2() { String username = getUsername(); return username + &quot; è®¿é—®èµ„æº2&quot;; } } åˆ›å»ºuserdetailsService import com.ldx.springboot.dao.UserMapper; import com.ldx.springboot.model.UserDto; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.core.userdetails.UsernameNotFoundException; import org.springframework.stereotype.Service; @Service public class SpringDataUserDetailsService implements UserDetailsService { @Autowired UserMapper userMapper; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { //ç™»å½•è´¦å· System.out.println(&quot;username=&quot; + username); //æ ¹æ®è´¦å·å»æ•°æ®åº“æŸ¥è¯¢... UserDto user = userMapper.getUserByUsername(username); if (user == null) { return null; } //è¿™é‡Œæš‚æ—¶ä½¿ç”¨é™æ€æ•°æ® UserDetails userDetails = User.withUsername(user.getFullname()).password(user.getPassword()).authorities(&quot;p1&quot;).build(); return userDetails; } } åˆ›å»ºmapper import com.ldx.springboot.model.UserDto; import org.apache.ibatis.annotations.Select; public interface UserMapper { @Select(&quot;select id,username,password,fullname from t_user where username = #{username}&quot;) UserDto getUserByUsername(String username); } åˆ›å»ºBCryptå¯†ç æµ‹è¯•ç±» import org.junit.Test; import org.junit.runner.RunWith; import org.springframework.security.crypto.bcrypt.BCrypt; import org.springframework.test.context.junit4.SpringRunner; @RunWith(SpringRunner.class) public class TestBCrypt { @Test public void test1(){ //å¯¹åŸå§‹å¯†ç åŠ å¯† String hashpw = BCrypt.hashpw(&quot;123&quot;,BCrypt.gensalt()); System.out.println(hashpw); //æ ¡éªŒåŸå§‹å¯†ç å’ŒBCryptå¯†ç æ˜¯å¦ä¸€è‡´ boolean checkpw = BCrypt.checkpw(&quot;123&quot;, &quot;$2a$10$NlBC84MVb7F95EXYTXwLneXgCca6/GipyWR5NHm8K0203bSQMLpvm&quot;); System.out.println(checkpw); } } æµ‹è¯•ç»“æœ ä½¿ç”¨BCryptå¯†ç æµ‹è¯•ç±»ç”ŸæˆæŒ‡å®šå¯†ç ä¸”å°†ç”¨æˆ·ä¿¡æ¯å†™å…¥æ•°æ®åº“ç”¨æˆ·è¡¨ å¯åŠ¨é¡¹ç›®è®¿é—®localhost:8080 è¾“å…¥ç”¨æˆ·åå¯†ç è¿›è¡Œæµ‹è¯• æš‚æ—¶ä½¿ç”¨é™æ€æƒé™æ•°æ®,æµ‹è¯•r/r1: æ­£å¸¸,r/r2:æ— æƒé™ ä¼šè¯ ç”¨æˆ·è®¤è¯é€šè¿‡åï¼Œä¸ºäº†é¿å…ç”¨æˆ·çš„æ¯æ¬¡æ“ä½œéƒ½è¿›è¡Œè®¤è¯å¯å°†ç”¨æˆ·çš„ä¿¡æ¯ä¿å­˜åœ¨ä¼šè¯ä¸­ã€‚spring securityæä¾›ä¼šè¯ç®¡ç†ï¼Œè®¤è¯é€šè¿‡åå°†èº«ä»½ä¿¡æ¯æ”¾å…¥SecurityContextHolderä¸Šä¸‹æ–‡ï¼ŒSecurityContextä¸å½“å‰çº¿ç¨‹è¿›è¡Œç»‘å®šï¼Œæ–¹ä¾¿è·å–ç”¨æˆ·èº«ä»½ã€‚ è·å–å½“å‰ç”¨æˆ·å /** * è·å–å½“å‰ç™»å½•ç”¨æˆ·å */ private String getUsername() { Authentication authentication = SecurityContextHolder.getContext().getAuthentication(); if (!authentication.isAuthenticated()) { return null; } Object principal = authentication.getPrincipal(); String username = null; if (principal instanceof org.springframework.security.core.userdetails.UserDetails) { username = ((org.springframework.security.core.userdetails.UserDetails) principal).getUsername(); } else { username = principal.toString(); } return username; } ä¼šè¯æ§åˆ¶ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹é€‰é¡¹å‡†ç¡®æ§åˆ¶ä¼šè¯ä½•æ—¶åˆ›å»ºä»¥åŠSpring Securityå¦‚ä½•ä¸ä¹‹äº¤äº’ï¼š æœºåˆ¶ æè¿° always å¦‚æœæ²¡æœ‰sessionå­˜åœ¨å°±åˆ›å»ºä¸€ä¸ª ifRequired å¦‚æœéœ€è¦å°±åˆ›å»ºä¸€ä¸ªSessionï¼ˆé»˜è®¤ï¼‰ç™»å½•æ—¶ never SpringSecurity å°†ä¸ä¼šåˆ›å»ºSessionï¼Œä½†æ˜¯å¦‚æœåº”ç”¨ä¸­å…¶ä»–åœ°æ–¹åˆ›å»ºäº†Sessionï¼Œé‚£ä¹ˆSpringSecurityå°†ä¼šä½¿ç”¨å®ƒã€‚ stateles SpringSecurityå°†ç»å¯¹ä¸ä¼šåˆ›å»ºSessionï¼Œä¹Ÿä¸ä½¿ç”¨Session é€šè¿‡ä»¥ä¸‹é…ç½®æ–¹å¼å¯¹è¯¥é€‰é¡¹è¿›è¡Œé…ç½®ï¼š @Override protected void configure(HttpSecurity http) throws Exception { http.sessionManagement() .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED) } é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Securityä¼šä¸ºæ¯ä¸ªç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¼šæ–°å»ºä¸€ä¸ªSessionï¼Œå°±æ˜¯ifRequired ã€‚ è‹¥é€‰ç”¨neverï¼Œåˆ™æŒ‡ç¤ºSpring Securityå¯¹ç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¸åˆ›å»ºSessionäº†ï¼Œä½†è‹¥ä½ çš„åº”ç”¨ç¨‹åºåœ¨æŸåœ°æ–¹æ–°å»ºäº†sessionï¼Œé‚£ä¹ˆSpring Securityä¼šç”¨å®ƒçš„ã€‚ è‹¥ä½¿ç”¨statelessï¼Œåˆ™è¯´æ˜Spring Securityå¯¹ç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¸ä¼šåˆ›å»ºSessionäº†ï¼Œä½ çš„åº”ç”¨ç¨‹åºä¹Ÿä¸ä¼šå…è®¸æ–°å»ºsessionã€‚å¹¶ä¸”å®ƒä¼šæš—ç¤ºä¸ä½¿ç”¨cookieï¼Œæ‰€ä»¥æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦é‡æ–°è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¿™ç§æ— çŠ¶æ€æ¶æ„é€‚ç”¨äºREST APIåŠå…¶æ— çŠ¶æ€è®¤è¯æœºåˆ¶ã€‚ ä¼šè¯è¶…æ—¶ å¯ä»¥å†sevletå®¹å™¨ä¸­è®¾ç½®Sessionçš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚ä¸‹è®¾ç½®Sessionæœ‰æ•ˆæœŸä¸º3600sï¼› springbooté…ç½®: server.servlet.session.timeout=3600s sessionè¶…æ—¶ä¹‹åï¼Œå¯ä»¥é€šè¿‡Spring Security è®¾ç½®è·³è½¬çš„è·¯å¾„ã€‚ http.sessionManagement() .expiredUrl(&quot;/loginâ€view?error=EXPIRED_SESSION&quot;) .invalidSessionUrl(&quot;/loginâ€view?error=INVALID_SESSION&quot;); expiredæŒ‡sessionè¿‡æœŸï¼ŒinvalidSessionæŒ‡ä¼ å…¥çš„sessionidæ— æ•ˆã€‚ å®‰å…¨ä¼šè¯cookie æˆ‘ä»¬å¯ä»¥ä½¿ç”¨httpOnlyå’Œsecureæ ‡ç­¾æ¥ä¿æŠ¤æˆ‘ä»¬çš„ä¼šè¯cookieï¼š httpOnlyï¼šå¦‚æœä¸ºtrueï¼Œé‚£ä¹ˆæµè§ˆå™¨è„šæœ¬å°†æ— æ³•è®¿é—®cookie secureï¼šå¦‚æœä¸ºtrueï¼Œåˆ™cookieå°†ä»…é€šè¿‡HTTPSè¿æ¥å‘é€ spring boot é…ç½®æ–‡ä»¶ï¼š server.servlet.session.cookie.httpâ€only=true server.servlet.session.cookie.secure=true é€€å‡º Spring securityé»˜è®¤å®ç°äº†logouté€€å‡ºï¼Œè®¿é—®/logoutå®ç°é€€å‡ºæ“ä½œã€‚ è¿™é‡Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰é€€å‡ºæˆåŠŸçš„é¡µé¢ï¼š åœ¨WebSecurityConfifigçš„protected void confifigure(HttpSecurity http)ä¸­é…ç½®ï¼š .and() .logout() .logoutUrl(&quot;/logout&quot;) .logoutSuccessUrl(&quot;/loginâ€view?logout&quot;); å½“é€€å‡ºæ“ä½œå‡ºå‘æ—¶ï¼Œå°†å‘ç”Ÿï¼š ä½¿HTTP Session æ— æ•ˆ æ¸…é™¤ SecurityContextHolder è·³è½¬åˆ° /login-view?logout ä½†æ˜¯ï¼Œç±»ä¼¼äºé…ç½®ç™»å½•åŠŸèƒ½ï¼Œå’±ä»¬å¯ä»¥è¿›ä¸€æ­¥è‡ªå®šä¹‰é€€å‡ºåŠŸèƒ½ï¼š @Override protected void configure(HttpSecurity http) throws Exception { http .authorizeRequests() //... .and() .logout() (1) .logoutUrl(&quot;/logout&quot;) (2) .logoutSuccessUrl(&quot;/loginâ€view?logout&quot;) (3) .logoutSuccessHandler(logoutSuccessHandler) (4) .addLogoutHandler(logoutHandler) (5) .invalidateHttpSession(true); (6) } ï¼ˆ1ï¼‰æä¾›ç³»ç»Ÿé€€å‡ºæ”¯æŒï¼Œä½¿ç”¨ WebSecurityConfigurerAdapter ä¼šè‡ªåŠ¨è¢«åº”ç”¨ ï¼ˆ2ï¼‰è®¾ç½®è§¦å‘é€€å‡ºæ“ä½œçš„URL (é»˜è®¤æ˜¯ /logout ). ï¼ˆ3ï¼‰é€€å‡ºä¹‹åè·³è½¬çš„URLã€‚é»˜è®¤æ˜¯ /login?logout ã€‚ ï¼ˆ4ï¼‰å®šåˆ¶çš„ LogoutSuccessHandler ï¼Œç”¨äºå®ç°ç”¨æˆ·é€€å‡ºæˆåŠŸæ—¶çš„å¤„ç†ã€‚å¦‚æœæŒ‡å®šäº†è¿™ä¸ªé€‰é¡¹é‚£ä¹ˆlogoutSuccessUrl() çš„è®¾ç½®ä¼šè¢«å¿½ç•¥ã€‚ ï¼ˆ5ï¼‰æ·»åŠ ä¸€ä¸ª LogoutHandler ï¼Œç”¨äºå®ç°ç”¨æˆ·é€€å‡ºæ—¶çš„æ¸…ç†å·¥ä½œ.é»˜è®¤ SecurityContextLogoutHandler ä¼šè¢«æ·»åŠ ä¸ºæœ€åä¸€ä¸ª LogoutHandler ã€‚ ï¼ˆ6ï¼‰æŒ‡å®šæ˜¯å¦åœ¨é€€å‡ºæ—¶è®© HttpSession æ— æ•ˆã€‚ é»˜è®¤è®¾ç½®ä¸º trueã€‚ æ³¨æ„ï¼šå¦‚æœè®©logoutåœ¨GETè¯·æ±‚ä¸‹ç”Ÿæ•ˆï¼Œå¿…é¡»å…³é—­é˜²æ­¢CSRFæ”»å‡»csrf().disable()ã€‚å¦‚æœå¼€å¯äº†CSRFï¼Œå¿…é¡»ä½¿ç”¨postæ–¹å¼è¯·æ±‚/logout logoutHandlerï¼š ä¸€èˆ¬æ¥è¯´ï¼Œ LogoutHandler çš„å®ç°ç±»è¢«ç”¨æ¥æ‰§è¡Œå¿…è¦çš„æ¸…ç†ï¼Œå› è€Œä»–ä»¬ä¸åº”è¯¥æŠ›å‡ºå¼‚å¸¸ã€‚ ä¸‹é¢æ˜¯Spring Securityæä¾›çš„ä¸€äº›å®ç°ï¼š PersistentTokenBasedRememberMeServices åŸºäºæŒä¹…åŒ–tokençš„RememberMeåŠŸèƒ½çš„ç›¸å…³æ¸…ç† TokenBasedRememberMeService åŸºäºtokençš„RememberMeåŠŸèƒ½çš„ç›¸å…³æ¸…ç† CookieClearingLogoutHandler é€€å‡ºæ—¶Cookieçš„ç›¸å…³æ¸…ç† CsrfLogoutHandler è´Ÿè´£åœ¨é€€å‡ºæ—¶ç§»é™¤csrfToken SecurityContextLogoutHandler é€€å‡ºæ—¶SecurityContextçš„ç›¸å…³æ¸…ç† é“¾å¼APIæä¾›äº†è°ƒç”¨ç›¸åº”çš„ LogoutHandler å®ç°çš„å¿«æ·æ–¹å¼ï¼Œæ¯”å¦‚deleteCookies()ã€‚ è‡ªå®šä¹‰æˆæƒ æˆæƒçš„æ–¹å¼åŒ…æ‹¬ webæˆæƒå’Œæ–¹æ³•æˆæƒï¼Œwebæˆæƒæ˜¯é€šè¿‡ urlæ‹¦æˆªè¿›è¡Œæˆæƒï¼Œæ–¹æ³•æˆæƒæ˜¯é€šè¿‡ æ–¹æ³•æ‹¦æˆªè¿›è¡Œæˆæƒã€‚ä»–ä»¬éƒ½ä¼šè°ƒç”¨accessDecisionManagerè¿›è¡Œæˆæƒå†³ç­–ï¼Œè‹¥ä¸ºwebæˆæƒåˆ™æ‹¦æˆªå™¨ä¸ºFilterSecurityInterceptorï¼›è‹¥ä¸ºæ–¹æ³•æˆæƒåˆ™æ‹¦æˆªå™¨ä¸ºMethodSecurityInterceptorã€‚å¦‚æœåŒæ—¶é€šè¿‡webæˆæƒå’Œæ–¹æ³•æˆæƒåˆ™å…ˆæ‰§è¡Œwebæˆæƒï¼Œå†æ‰§è¡Œæ–¹æ³•æˆæƒï¼Œæœ€åå†³ç­–é€šè¿‡ï¼Œåˆ™å…è®¸è®¿é—®èµ„æºï¼Œå¦åˆ™å°†ç¦æ­¢è®¿é—®ã€‚ åˆ›å»ºæ•°æ®åº“è¡¨ # è§’è‰²è¡¨ CREATE TABLE `t_role` ( `id` varchar(32) NOT NULL, `role_name` varchar(255) DEFAULT NULL, `description` varchar(255) DEFAULT NULL, `create_time` datetime DEFAULT NULL, `update_time` datetime DEFAULT NULL, `status` char(1) NOT NULL, PRIMARY KEY (`id`), UNIQUE KEY `unique_role_name` (`role_name`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; insert into `t_role` (`id`,`role_name`,`description`,`create_time`,`update_time`,`status`) values ('1','ç®¡ç†å‘˜',NULL,NULL,NULL,''); # ç”¨æˆ·è§’è‰²å…³ç³»è¡¨ CREATE TABLE `t_user_role` ( `user_id` varchar(32) NOT NULL, `role_id` varchar(32) NOT NULL, `create_time` datetime DEFAULT NULL, `creator` varchar(255) DEFAULT NULL, PRIMARY KEY (`user_id`,`role_id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; insert into `t_user_role` (`user_id`,`role_id`,`create_time`,`creator`) values ('1','1',NULL,NULL); # æƒé™è¡¨ CREATE TABLE `t_permission`( `id` varchar(32) NOT NULL, `code` varchar(32) NOT NULL COMMENT 'æƒé™æ ‡è¯†ç¬¦', `description` varchar(64) DEFAULT NULL COMMENT 'æè¿°', `url` varchar(128) DEFAULT NULL COMMENT 'è¯·æ±‚åœ°å€', PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; insert into `t_permission` (`id`,`code`,`description`,`url`) values ('1','p1','æµ‹è¯•èµ„æº 1','/r/r1'),('2','p3','æµ‹è¯•èµ„æº2','/r/r2'); # è§’è‰²æƒé™å…³ç³»è¡¨ CREATE TABLE `t_role_permission` ( `role_id` varchar(32) NOT NULL, `permission_id` varchar(32) NOT NULL, PRIMARY KEY (`role_id`,`permission_id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8; insert into `t_role_permission` (`role_id`,`permission_id`) values ('1','1'),('1','2'); åˆ›å»ºmodel import lombok.Data; @Data public class PermissionDto { private String id; private String code; private String description; private String url; } ä¿®æ”¹userdatailsService import com.ldx.springboot.dao.PermissionMapper; import com.ldx.springboot.dao.UserMapper; import com.ldx.springboot.model.PermissionDto; import com.ldx.springboot.model.UserDto; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.core.userdetails.UsernameNotFoundException; import org.springframework.stereotype.Service; import java.util.List; import java.util.stream.Collectors; @Service public class SpringDataUserDetailsService implements UserDetailsService { @Autowired UserMapper userMapper; @Autowired PermissionMapper permissionMapper; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { //ç™»å½•è´¦å· System.out.println(&quot;username=&quot; + username); //æ ¹æ®è´¦å·å»æ•°æ®åº“æŸ¥è¯¢... UserDto user = userMapper.getUserByUsername(username); if (user == null) { return null; } //æŸ¥è¯¢ç”¨æˆ·æƒé™ List&lt;PermissionDto&gt; permissions = permissionMapper.findPermissionsByUserId(user.getId()); List&lt;String&gt; permissionCodes = permissions.stream().map(PermissionDto::getCode).collect(Collectors.toList()); String[] permissionCodeArr = permissionCodes.toArray(new String[permissionCodes.size()]); //åˆ›å»ºuserDetails UserDetails userDetails = User.withUsername(user.getFullname()).password(user.getPassword()).authorities(permissionCodeArr).build(); return userDetails; } } åˆ›å»ºmapper import com.ldx.springboot.model.PermissionDto; import org.apache.ibatis.annotations.Select; import java.util.List; public interface PermissionMapper { @Select(&quot;SELECT * FROM t_permission WHERE id &quot; + &quot;IN(SELECT permission_id FROM t_role_permission WHERE role_id &quot; + &quot;IN(SELECT role_id FROM t_user_role WHERE user_id = #{id}))&quot;) List&lt;PermissionDto&gt; findPermissionsByUserId(String id); } æµ‹è¯• å¯åŠ¨é¡¹ç›®è®¿é—®localhost:8080 ç™»é™†ç”¨æˆ· æµ‹è¯•è®¿é—®r/r1,r/r2 èµ„æº webæˆæƒ åœ¨ä¸Šé¢ä¾‹å­ä¸­æˆ‘ä»¬å®Œæˆäº†è®¤è¯æ‹¦æˆªï¼Œå¹¶å¯¹/r/**ä¸‹çš„æŸäº›èµ„æºè¿›è¡Œç®€å•çš„æˆæƒä¿æŠ¤ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è¿›è¡Œçµæ´»çš„æˆæƒæ§åˆ¶è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé€šè¿‡ç»™ http.authorizeRequests() æ·»åŠ å¤šä¸ªå­èŠ‚ç‚¹æ¥å®šåˆ¶éœ€æ±‚åˆ°æˆ‘ä»¬çš„URLï¼Œå¦‚ä¸‹ä»£ç ï¼š @Override protected void configure(HttpSecurity http) throws Exception { http .authorizeRequests() (1) .antMatchers(&quot;/r/r1&quot;) .hasAuthority(&quot;p1&quot;) (2) .antMatchers(&quot;/r/r2&quot;) .hasAuthority(&quot;p2&quot;) (3) .antMatchers(&quot;/r/r3&quot;) .access(&quot;hasAuthority('p1') and hasAuthority('p2')&quot;) (4) .antMatchers(&quot;/r/**&quot;) .authenticated() (5) .anyRequest().permitAll() (6) .and() .formLogin() // ... } ï¼ˆ1ï¼‰ http.authorizeRequests() æ–¹æ³•æœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼Œæ¯ä¸ªmacheræŒ‰ç…§ä»–ä»¬çš„å£°æ˜é¡ºåºæ‰§è¡Œã€‚ ï¼ˆ2ï¼‰æŒ‡å®š&quot;/r/r1&quot;URLï¼Œæ‹¥æœ‰p1æƒé™èƒ½å¤Ÿè®¿é—® ï¼ˆ3ï¼‰æŒ‡å®š&quot;/r/r2&quot;URLï¼Œæ‹¥æœ‰p2æƒé™èƒ½å¤Ÿè®¿é—® ï¼ˆ4ï¼‰æŒ‡å®šäº†&quot;/r/r3&quot;URLï¼ŒåŒæ—¶æ‹¥æœ‰p1å’Œp2æƒé™æ‰èƒ½å¤Ÿè®¿é—® ï¼ˆ5ï¼‰æŒ‡å®šäº†é™¤äº†r1ã€r2ã€r3ä¹‹å¤–&quot;/r/**&quot;èµ„æºï¼ŒåŒæ—¶é€šè¿‡èº«ä»½è®¤è¯å°±èƒ½å¤Ÿè®¿é—®ï¼Œè¿™é‡Œä½¿ç”¨SpELï¼ˆSpring Expression Languageï¼‰è¡¨è¾¾å¼ã€‚ã€‚ ï¼ˆ6ï¼‰å‰©ä½™çš„å°šæœªåŒ¹é…çš„èµ„æºï¼Œä¸åšä¿æŠ¤ã€‚ æ³¨æ„ï¼š è§„åˆ™çš„é¡ºåºæ˜¯é‡è¦çš„,æ›´å…·ä½“çš„è§„åˆ™åº”è¯¥å…ˆå†™.ç°åœ¨ä»¥/ adminå¼€å§‹çš„æ‰€æœ‰å†…å®¹éƒ½éœ€è¦å…·æœ‰ADMINè§’è‰²çš„èº«ä»½éªŒè¯ç”¨ æˆ·,å³ä½¿æ˜¯/ admin / loginè·¯å¾„(å› ä¸º/ admin / loginå·²ç»è¢«/ admin / **è§„åˆ™åŒ¹é…,å› æ­¤ç¬¬äºŒä¸ªè§„åˆ™è¢«å¿½ç•¥). .antMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;) .antMatchers(&quot;/admin/login&quot;).permitAll() å› æ­¤,ç™»å½•é¡µé¢çš„è§„åˆ™åº”è¯¥åœ¨/ admin / **è§„åˆ™ä¹‹å‰.ä¾‹å¦‚. .antMatchers(&quot;/admin/login&quot;).permitAll() .antMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;) ä¿æŠ¤URLå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼š æ–¹æ³• ä½œç”¨ authenticated() ä¿æŠ¤URLï¼Œéœ€è¦ç”¨æˆ·ç™»å½• permitAll() æŒ‡å®šURLæ— éœ€ä¿æŠ¤ï¼Œä¸€èˆ¬åº”ç”¨ä¸é™æ€èµ„æºæ–‡ä»¶ hasRole(String role) é™åˆ¶å•ä¸ªè§’è‰²è®¿é—®ï¼Œè§’è‰²å°†è¢«å¢åŠ  â€œROLE_â€ .æ‰€ä»¥â€ADMINâ€ å°†å’Œ â€œROLE_ADMINâ€è¿›è¡Œæ¯”è¾ƒ. hasAuthority(String authority) é™åˆ¶å•ä¸ªæƒé™è®¿é—® hasAnyRole(Stringâ€¦ roles) å…è®¸å¤šä¸ªè§’è‰²è®¿é—®. hasAnyAuthority(Stringâ€¦ authorities) å…è®¸å¤šä¸ªæƒé™è®¿é—®. access(String attribute) è¯¥æ–¹æ³•ä½¿ç”¨ SpELè¡¨è¾¾å¼, æ‰€ä»¥å¯ä»¥åˆ›å»ºå¤æ‚çš„é™åˆ¶. hasIpAddress(String ipaddressExpression) é™åˆ¶IPåœ°å€æˆ–å­ç½‘ æ–¹æ³•æˆæƒ ç°åœ¨æˆ‘ä»¬å·²ç»æŒæ¡äº†ä½¿ç”¨å¦‚ä½•ä½¿ç”¨ http.authorizeRequests() å¯¹webèµ„æºè¿›è¡Œæˆæƒä¿æŠ¤ï¼Œä»Spring Security2.0ç‰ˆ æœ¬å¼€å§‹ï¼Œå®ƒæ”¯æŒæœåŠ¡å±‚æ–¹æ³•çš„å®‰å…¨æ€§çš„æ”¯æŒã€‚æœ¬èŠ‚å­¦ä¹ @PreAuthorize,@PostAuthorize, @Securedä¸‰ç±»æ³¨è§£ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½• @Configuration å®ä¾‹ä¸Šä½¿ç”¨ @EnableGlobalMethodSecurity æ³¨é‡Šæ¥å¯ç”¨åŸºäºæ³¨è§£çš„å®‰å…¨æ€§ã€‚ä»¥ä¸‹å†…å®¹å°†å¯ç”¨Spring Securityçš„ @Secured æ³¨é‡Šã€‚ @EnableGlobalMethodSecurity(securedEnabled = true) public class MethodSecurityConfig { // ... } ç„¶åå‘æ–¹æ³•ï¼ˆåœ¨ç±»æˆ–æ¥å£ä¸Šï¼‰æ·»åŠ æ³¨è§£å°±ä¼šé™åˆ¶å¯¹è¯¥æ–¹æ³•çš„è®¿é—®ã€‚ Spring Securityçš„åŸç”Ÿæ³¨é‡Šæ”¯æŒä¸ºè¯¥æ–¹æ³•å®šä¹‰äº†ä¸€ç»„å±æ€§ã€‚ è¿™äº›å°†è¢«ä¼ é€’ç»™AccessDecisionManagerä»¥ä¾›å®ƒä½œå‡ºå®é™…çš„å†³å®šï¼š public interface BankService { @Secured(&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;) public Account readAccount(Long id); @Secured(&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;) public Account[] findAccounts(); @Secured(&quot;ROLE_TELLER&quot;) public Account post(Account account, double amount); } ä»¥ä¸Šé…ç½®æ ‡æ˜readAccountã€findAccountsæ–¹æ³•å¯åŒ¿åè®¿é—®ï¼Œåº•å±‚ä½¿ç”¨WebExpressionVoteræŠ•ç¥¨å™¨ï¼Œå¯ä» AffirmativeBasedç¬¬23è¡Œä»£ç è·Ÿè¸ªã€‚ã€‚ postæ–¹æ³•éœ€è¦æœ‰TELLERè§’è‰²æ‰èƒ½è®¿é—®ï¼Œåº•å±‚ä½¿ç”¨RoleVoteræŠ•ç¥¨å™¨ã€‚ ä½¿ç”¨å¦‚ä¸‹ä»£ç å¯å¯ç”¨prePostæ³¨è§£çš„æ”¯æŒ @EnableGlobalMethodSecurity(prePostEnabled = true) public class MethodSecurityConfig { // ... } ç›¸åº”Javaä»£ç å¦‚ä¸‹ï¼š public interface BankService { @PreAuthorize(&quot;isAnonymous()&quot;) public Account readAccount(Long id); @PreAuthorize(&quot;isAnonymous()&quot;) public Account[] findAccounts(); @PreAuthorize(&quot;hasAuthority('p_transfer') and hasAuthority('p_read_account')&quot;) public Account post(Account account, double amount); } ä»¥ä¸Šé…ç½®æ ‡æ˜readAccountã€findAccountsæ–¹æ³•å¯åŒ¿åè®¿é—®ï¼Œpostæ–¹æ³•éœ€è¦åŒæ—¶æ‹¥æœ‰p_transferå’Œp_read_account æƒé™æ‰èƒ½è®¿é—®ï¼Œåº•å±‚ä½¿ç”¨WebExpressionVoteræŠ•ç¥¨å™¨ï¼Œå¯ä»AffirmativeBasedç¬¬23è¡Œä»£ç è·Ÿè¸ªã€‚ ","link":"http://blog.ludangxin.club/post/spring-security-xiang-jie-ji-kuai-su-shang-shou/"},{"title":"åˆè¯† Dubbo","content":"dubboæ˜¯ä»€ä¹ˆ ç®€ä»‹ Apache Dubboæ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„java RPCæ¡†æ¶. å…¶å‰èº«æ˜¯é˜¿é‡Œå·´å·´å…¬å¸å¼€æºçš„ä¸€ä¸ªé«˜æ€§èƒ½,è½»é‡çº§çš„å¼€æºjava RPC æ¡†æ¶,å¯ä»¥å’ŒSpringæ¡†æ¶æ— ç¼é›†æˆ. Dubboæä¾›äº†ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›: é¢å‘æ¥å£çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨, æ™ºèƒ½å®¹é”™å’Œè´Ÿè½½å‡è¡¡,ä»¥åŠæœåŠ¡æ³¨å†Œå’Œå‘ç°. å®˜æ–¹:http://dubbo.apache.org/zh-cn/ æ¶æ„ èŠ‚ç‚¹è§’è‰²è¯´æ˜ èŠ‚ç‚¹ è§’è‰²è¯´æ˜ Provider æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ Consumer è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ Registry æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ Monitor ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ Container æœåŠ¡è¿è¡Œå®¹å™¨ è°ƒç”¨å…³ç³»è¯´æ˜ æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚ æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚ æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚ æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚ æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚ æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚ RPC RPCå…¨ç§°ä¸ºremote procedure call. å³è¿œç¨‹è°ƒç”¨è¿‡ç¨‹ ,è¿‡ç¨‹å…¶å®å°±æ˜¯æ–¹æ³•, æ‰€ä»¥å¯ä»¥æŠŠRPCç†è§£ä¸ºâ€œè¿œç¨‹æ–¹æ³•è°ƒç”¨â€ã€‚ æ¯”å¦‚ä¸¤å°æœåŠ¡å™¨Aå’ŒB, AæœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ªåº”ç”¨, BæœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ªåº”ç”¨, AæœåŠ¡å™¨ä¸Šçš„åº”ç”¨æƒ³è°ƒç”¨BæœåŠ¡å™¨ä¸Šçš„åº”ç”¨æä¾›çš„æ–¹æ³•,ç”±äºä¸¤ä¸ªåº”ç”¨ä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´, ä¸èƒ½ç›´æ¥è°ƒç”¨, æ‰€ä»¥éœ€è¦é€šè¿‡ç½‘ç»œæ¥è¡¨è¾¾è°ƒç”¨çš„è¯­ä¹‰å’Œä¼ è¾¾è°ƒç”¨çš„æ•°æ®. éœ€è¦æ³¨æ„çš„æ˜¯RPCå¹¶ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æŠ€æœ¯, è€Œæ˜¯æŒ‡æ•´ä¸ªç½‘ç»œè¿œç¨‹è°ƒç”¨è¿‡ç¨‹. è€Œä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œæŠ€æœ¯çš„åè®®,åœ¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¸­, è¿œç¨‹è¿‡ç¨‹è°ƒç”¨å³æ˜¯ è¿œç¨‹æ–¹æ³•è°ƒç”¨ æ™ºèƒ½å®¹é”™ ä¸ºäº†é¿å…å•ç‚¹æ•…éšœï¼Œç°åœ¨çš„åº”ç”¨é€šå¸¸è‡³å°‘ä¼šéƒ¨ç½²åœ¨ä¸¤å°æœåŠ¡å™¨ä¸Šã€‚å¯¹äºä¸€äº›è´Ÿè½½æ¯”è¾ƒé«˜çš„æœåŠ¡ï¼Œä¼šéƒ¨ç½²æ›´å¤šçš„æœåŠ¡å™¨ã€‚è¿™æ ·ï¼Œåœ¨åŒä¸€ç¯å¢ƒä¸‹çš„æœåŠ¡æä¾›è€…æ•°é‡ä¼šå¤§äº1ã€‚å¯¹äºæœåŠ¡æ¶ˆè´¹è€…æ¥è¯´ï¼ŒåŒä¸€ç¯å¢ƒä¸‹å‡ºç°äº†å¤šä¸ªæœåŠ¡æä¾›è€…ã€‚è¿™æ—¶ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼ŒæœåŠ¡æ¶ˆè´¹è€…éœ€è¦å†³å®šé€‰æ‹©å“ªä¸ªæœåŠ¡æä¾›è€…è¿›è¡Œè°ƒç”¨ã€‚å¦å¤–æœåŠ¡è°ƒç”¨å¤±è´¥æ—¶çš„å¤„ç†æªæ–½ä¹Ÿæ˜¯éœ€è¦è€ƒè™‘çš„ï¼Œæ˜¯é‡è¯•å‘¢ï¼Œè¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œäº¦æˆ–æ˜¯åªæ‰“å°å¼‚å¸¸ç­‰ã€‚ä¸ºäº†å¤„ç†è¿™äº›é—®é¢˜ï¼ŒDubbo å®šä¹‰äº†é›†ç¾¤æ¥å£ Cluster ä»¥åŠ Cluster Invokerã€‚é›†ç¾¤ Cluster ç”¨é€”æ˜¯å°†å¤šä¸ªæœåŠ¡æä¾›è€…åˆå¹¶ä¸ºä¸€ä¸ª Cluster Invokerï¼Œå¹¶å°†è¿™ä¸ª Invoker æš´éœ²ç»™æœåŠ¡æ¶ˆè´¹è€…ã€‚è¿™æ ·ä¸€æ¥ï¼ŒæœåŠ¡æ¶ˆè´¹è€…åªéœ€é€šè¿‡è¿™ä¸ª Invoker è¿›è¡Œè¿œç¨‹è°ƒç”¨å³å¯ï¼Œè‡³äºå…·ä½“è°ƒç”¨å“ªä¸ªæœåŠ¡æä¾›è€…ï¼Œä»¥åŠè°ƒç”¨å¤±è´¥åå¦‚ä½•å¤„ç†ç­‰é—®é¢˜ï¼Œç°åœ¨éƒ½äº¤ç»™é›†ç¾¤æ¨¡å—å»å¤„ç†ã€‚é›†ç¾¤æ¨¡å—æ˜¯æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…çš„ä¸­é—´å±‚ï¼Œä¸ºæœåŠ¡æ¶ˆè´¹è€…å±è”½äº†æœåŠ¡æä¾›è€…çš„æƒ…å†µï¼Œè¿™æ ·æœåŠ¡æ¶ˆè´¹è€…å°±å¯ä»¥ä¸“å¿ƒå¤„ç†è¿œç¨‹è°ƒç”¨ç›¸å…³äº‹å®œã€‚æ¯”å¦‚å‘è¯·æ±‚ï¼Œæ¥å—æœåŠ¡æä¾›è€…è¿”å›çš„æ•°æ®ç­‰ã€‚è¿™å°±æ˜¯é›†ç¾¤çš„ä½œç”¨ã€‚ Dubbo æä¾›äº†å¤šç§é›†ç¾¤å®ç°ï¼ŒåŒ…å«ä½†ä¸é™äº Failover Clusterã€Failfast Cluster å’Œ Failsafe Cluster ç­‰ã€‚æ¯ç§é›†ç¾¤å®ç°ç±»çš„ç”¨é€”ä¸åŒï¼Œæ¥ä¸‹æ¥ä¼šä¸€ä¸€è¿›è¡Œåˆ†æã€‚ åœ¨å¯¹é›†ç¾¤ç›¸å…³ä»£ç è¿›è¡Œåˆ†æä¹‹å‰ï¼Œè¿™é‡Œæœ‰å¿…è¦å…ˆæ¥ä»‹ç»ä¸€ä¸‹é›†ç¾¤å®¹é”™çš„æ‰€æœ‰ç»„ä»¶ã€‚åŒ…å« Clusterã€Cluster Invokerã€Directoryã€Router å’Œ LoadBalance ç­‰ã€‚ é›†ç¾¤å·¥ä½œè¿‡ç¨‹å¯åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯åœ¨æœåŠ¡æ¶ˆè´¹è€…åˆå§‹åŒ–æœŸé—´ï¼Œé›†ç¾¤ Cluster å®ç°ç±»ä¸ºæœåŠ¡æ¶ˆè´¹è€…åˆ›å»º Cluster Invoker å®ä¾‹ï¼Œå³ä¸Šå›¾ä¸­çš„ merge æ“ä½œã€‚ç¬¬äºŒä¸ªé˜¶æ®µæ˜¯åœ¨æœåŠ¡æ¶ˆè´¹è€…è¿›è¡Œè¿œç¨‹è°ƒç”¨æ—¶ã€‚ä»¥ FailoverClusterInvoker ä¸ºä¾‹ï¼Œè¯¥ç±»å‹ Cluster Invoker é¦–å…ˆä¼šè°ƒç”¨ Directory çš„ list æ–¹æ³•åˆ—ä¸¾ Invoker åˆ—è¡¨ï¼ˆå¯å°† Invoker ç®€å•ç†è§£ä¸ºæœåŠ¡æä¾›è€…ï¼‰ã€‚Directory çš„ç”¨é€”æ˜¯ä¿å­˜ Invokerï¼Œå¯ç®€å•ç±»æ¯”ä¸º Listã€‚å…¶å®ç°ç±» RegistryDirectory æ˜¯ä¸€ä¸ªåŠ¨æ€æœåŠ¡ç›®å½•ï¼Œå¯æ„ŸçŸ¥æ³¨å†Œä¸­å¿ƒé…ç½®çš„å˜åŒ–ï¼Œå®ƒæ‰€æŒæœ‰çš„ Invoker åˆ—è¡¨ä¼šéšç€æ³¨å†Œä¸­å¿ƒå†…å®¹çš„å˜åŒ–è€Œå˜åŒ–ã€‚æ¯æ¬¡å˜åŒ–åï¼ŒRegistryDirectory ä¼šåŠ¨æ€å¢åˆ  Invokerï¼Œå¹¶è°ƒç”¨ Router çš„ route æ–¹æ³•è¿›è¡Œè·¯ç”±ï¼Œè¿‡æ»¤æ‰ä¸ç¬¦åˆè·¯ç”±è§„åˆ™çš„ Invokerã€‚å½“ FailoverClusterInvoker æ‹¿åˆ° Directory è¿”å›çš„ Invoker åˆ—è¡¨åï¼Œå®ƒä¼šé€šè¿‡ LoadBalance ä» Invoker åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ª Invokerã€‚æœ€å FailoverClusterInvoker ä¼šå°†å‚æ•°ä¼ ç»™ LoadBalance é€‰æ‹©å‡ºçš„ Invoker å®ä¾‹çš„ invoke æ–¹æ³•ï¼Œè¿›è¡ŒçœŸæ­£çš„è¿œç¨‹è°ƒç”¨ã€‚ ä»¥ä¸Šå°±æ˜¯é›†ç¾¤å·¥ä½œçš„æ•´ä¸ªæµç¨‹ï¼Œè¿™é‡Œå¹¶æ²¡ä»‹ç»é›†ç¾¤æ˜¯å¦‚ä½•å®¹é”™çš„ã€‚Dubbo ä¸»è¦æä¾›äº†è¿™æ ·å‡ ç§å®¹é”™æ–¹å¼ï¼š Failover Cluster - å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ Failfast Cluster - å¿«é€Ÿå¤±è´¥ Failsafe Cluster - å¤±è´¥å®‰å…¨ Failback Cluster - å¤±è´¥è‡ªåŠ¨æ¢å¤ Forking Cluster - å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡æä¾›è€… Failover Cluster FailoverClusterInvoker åœ¨è°ƒç”¨å¤±è´¥æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ‡æ¢ Invoker è¿›è¡Œé‡è¯•ã€‚é»˜è®¤é…ç½®ä¸‹ï¼ŒDubbo ä¼šä½¿ç”¨è¿™ä¸ªç±»ä½œä¸ºç¼ºçœ Cluster Invoker å¯é€šè¿‡ retries=&quot;2&quot; æ¥è®¾ç½®é‡è¯•æ¬¡æ•°(ä¸å«ç¬¬ä¸€æ¬¡)ã€‚ é‡è¯•æ¬¡æ•°é…ç½®å¦‚ä¸‹ï¼š &lt;dubbo:service retries=&quot;2&quot; /&gt; æˆ– &lt;dubbo:reference retries=&quot;2&quot; /&gt; æˆ– &lt;dubbo:reference&gt; &lt;dubbo:method name=&quot;findFoo&quot; retries=&quot;2&quot; /&gt; &lt;/dubbo:reference&gt; Failfast Cluster FailfastClusterInvoker åªä¼šè¿›è¡Œä¸€æ¬¡è°ƒç”¨ï¼Œå¤±è´¥åç«‹å³æŠ›å‡ºå¼‚å¸¸ã€‚é€‚ç”¨äºéå¹‚ç­‰æ“ä½œï¼Œæ¯”å¦‚æ–°å¢è®°å½•ã€‚ Failsafe Cluster FailsafeClusterInvoker æ˜¯ä¸€ç§å¤±è´¥å®‰å…¨çš„ Cluster Invokerã€‚æ‰€è°“çš„å¤±è´¥å®‰å…¨æ˜¯æŒ‡ï¼Œå½“è°ƒç”¨è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸æ—¶ï¼ŒFailsafeClusterInvoker ä»…ä¼šæ‰“å°å¼‚å¸¸ï¼Œè€Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚é€‚ç”¨äºå†™å…¥å®¡è®¡æ—¥å¿—ç­‰æ“ä½œã€‚ Failback Cluster FailbackClusterInvoker ä¼šåœ¨è°ƒç”¨å¤±è´¥åï¼Œè¿”å›ä¸€ä¸ªç©ºç»“æœç»™æœåŠ¡æ¶ˆè´¹è€…ã€‚å¹¶é€šè¿‡å®šæ—¶ä»»åŠ¡å¯¹å¤±è´¥çš„è°ƒç”¨è¿›è¡Œé‡ä¼ ï¼Œé€‚åˆæ‰§è¡Œæ¶ˆæ¯é€šçŸ¥ç­‰æ“ä½œã€‚ Forking Cluster ForkingClusterInvoker ä¼šåœ¨è¿è¡Œæ—¶é€šè¿‡çº¿ç¨‹æ± åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œå¹¶å‘è°ƒç”¨å¤šä¸ªæœåŠ¡æä¾›è€…ã€‚åªè¦æœ‰ä¸€ä¸ªæœåŠ¡æä¾›è€…æˆåŠŸè¿”å›äº†ç»“æœï¼ŒdoInvoke æ–¹æ³•å°±ä¼šç«‹å³ç»“æŸè¿è¡Œã€‚ForkingClusterInvoker çš„åº”ç”¨åœºæ™¯æ˜¯åœ¨ä¸€äº›å¯¹å®æ—¶æ€§è¦æ±‚æ¯”è¾ƒé«˜è¯»æ“ä½œï¼ˆæ³¨æ„æ˜¯è¯»æ“ä½œï¼Œå¹¶è¡Œå†™æ“ä½œå¯èƒ½ä¸å®‰å…¨ï¼‰ä¸‹ä½¿ç”¨ï¼Œä½†è¿™å°†ä¼šè€—è´¹æ›´å¤šçš„èµ„æºã€‚ æœåŠ¡æ²»ç†å’Œé…ç½®ç®¡ç† æœåŠ¡æ²»ç† æœåŠ¡æ²»ç†ä¸»è¦ä½œç”¨æ˜¯æ”¹å˜è¿è¡Œæ—¶æœåŠ¡çš„è¡Œä¸ºå’Œé€‰å€é€»è¾‘ï¼Œè¾¾åˆ°é™æµï¼Œæƒé‡é…ç½®ç­‰ç›®çš„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ï¼š åº”ç”¨çº§åˆ«çš„æœåŠ¡æ²»ç† åœ¨Dubbo2.6åŠæ›´æ—©ç‰ˆæœ¬ä¸­ï¼Œæ‰€æœ‰çš„æœåŠ¡æ²»ç†è§„åˆ™éƒ½åªé’ˆå¯¹æœåŠ¡ç²’åº¦ï¼Œå¦‚æœè¦æŠŠæŸæ¡è§„åˆ™ä½œç”¨åˆ°åº”ç”¨ç²’åº¦ä¸Šï¼Œéœ€è¦ä¸ºåº”ç”¨ä¸‹çš„æ‰€æœ‰æœåŠ¡é…åˆç›¸åŒçš„è§„åˆ™ï¼Œå˜æ›´ï¼Œåˆ é™¤çš„æ—¶å€™ä¹Ÿéœ€è¦å¯¹åº”çš„æ“ä½œï¼Œè¿™æ ·çš„æ“ä½œå¾ˆä¸å‹å¥½ï¼Œå› æ­¤Dubbo2.7ç‰ˆæœ¬ä¸­å¢åŠ äº†åº”ç”¨ç²’åº¦çš„æœåŠ¡æ²»ç†æ“ä½œï¼Œå¯¹äºæ¡ä»¶è·¯ç”±(åŒ…æ‹¬é»‘ç™½åå•)ï¼ŒåŠ¨æ€é…ç½®(åŒ…æ‹¬æƒé‡ï¼Œè´Ÿè½½å‡è¡¡)éƒ½å¯ä»¥åšåº”ç”¨çº§åˆ«çš„é…ç½®ï¼š ä¸Šå›¾æ˜¯æ¡ä»¶è·¯ç”±çš„é…ç½®ï¼Œå¯ä»¥æŒ‰ç…§åº”ç”¨åï¼ŒæœåŠ¡åä¸¤ä¸ªç»´åº¦æ¥å¡«å†™ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§è¿™ä¸¤ä¸ªç»´åº¦æ¥æŸ¥è¯¢ã€‚ æ ‡ç­¾è·¯ç”± æ ‡ç­¾è·¯ç”±æ˜¯Dubbo2.7å¼•å…¥çš„æ–°åŠŸèƒ½ï¼Œé…ç½®ä»¥åº”ç”¨ä½œä¸ºç»´åº¦ï¼Œç»™ä¸åŒçš„æœåŠ¡å™¨æ‰“ä¸Šä¸åŒåå­—çš„æ ‡ç­¾ï¼Œé…ç½®å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è°ƒç”¨çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡setAttachmentçš„æ–¹å¼ï¼Œæ¥è®¾ç½®ä¸åŒçš„æ ‡ç­¾åç§°ï¼Œæ¯”å¦‚æœ¬ä¾‹ä¸­ï¼ŒsetAttachment(tag1)ï¼Œå®¢æˆ·ç«¯çš„é€‰å€èŒƒå›´å°±åœ¨å¦‚å›¾æ‰€ç¤ºçš„ä¸‰å°æœºå™¨ä¸­ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥å®ç°æµé‡éš”ç¦»ï¼Œç°åº¦å‘å¸ƒç­‰åŠŸèƒ½ã€‚ æ¡ä»¶è·¯ç”± æ¡ä»¶è·¯ç”±æ˜¯Dubboä¸€ç›´ä»¥æ¥å°±æœ‰çš„åŠŸèƒ½ï¼Œç›®å‰å¯ä»¥é…ç½®æœåŠ¡å’Œåº”ç”¨ä¸¤ä¸ªç»´åº¦ï¼Œæ¡ä»¶è·¯ç”±ä¸ºyamlæ ¼å¼ï¼Œå…·ä½“çš„è§„åˆ™ä½“ä»¥åŠå„ç§é€‚ç”¨åœºæ™¯ï¼Œè¯·å‚è€ƒè¿™é‡Œ é»‘ç™½åå• é»‘ç™½åå•æ˜¯æ¡ä»¶è·¯ç”±çš„ä¸€éƒ¨åˆ†ï¼Œè§„åˆ™å­˜å‚¨å’Œæ¡ä»¶è·¯ç”±æ”¾åœ¨ä¸€èµ·ï¼Œä¸ºäº†æ–¹ä¾¿é…ç½®æ‰€ä»¥å•ç‹¬æ‹¿å‡ºæ¥ï¼ŒåŒæ ·å¯ä»¥é€šè¿‡æœåŠ¡å’Œåº”ç”¨ä¸¤ä¸ªç»´åº¦ï¼ŒæŒ‡å®šé»‘åå•å’Œç™½åå•: åŠ¨æ€é…ç½® åŠ¨æ€é…ç½®æ˜¯å’Œè·¯ç”±è§„åˆ™å¹³è¡Œçš„å¦ä¸€ç±»æœåŠ¡æ²»ç†æ²»ç†åŠŸèƒ½ï¼Œä¸»è¦ä½œç”¨æ˜¯åœ¨ä¸é‡å¯æœåŠ¡çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€æ”¹å˜è°ƒç”¨è¡Œä¸ºï¼Œä»Dubbo2.7ç‰ˆæœ¬å¼€å§‹ï¼Œæ”¯æŒæœåŠ¡å’Œåº”ç”¨ä¸¤ä¸ªç»´åº¦çš„é…ç½®ï¼Œé‡‡ç”¨yamlæ ¼å¼ï¼Œç•Œé¢å¦‚ä¸‹ï¼š å…·ä½“çš„è§„åˆ™ä½“è¯´æ˜è¯·å‚è€ƒè¿™é‡Œ æƒé‡è°ƒèŠ‚ æƒé‡è°ƒèŠ‚æ˜¯åŠ¨æ€é…ç½®çš„å­åŠŸèƒ½ï¼Œä¸»è¦ä½œç”¨æ˜¯æ”¹å˜æœåŠ¡ç«¯çš„æƒé‡ï¼Œæ›´å¤§çš„æƒé‡ä¼šæœ‰æ›´å¤§çš„å‡ ç‡è¢«å®¢æˆ·ç«¯é€‰ä¸­ä½œä¸ºæœåŠ¡æä¾›è€…ï¼Œä»è€Œè¾¾åˆ°æµé‡åˆ†é…çš„ç›®çš„ï¼š è´Ÿè½½å‡è¡¡ è´Ÿè½½å‡è¡¡ä¹Ÿæ˜¯åŠ¨æ€é…ç½®çš„å­åŠŸèƒ½ï¼Œä¸»è¦ä½œç”¨æ˜¯è°ƒæ•´å®¢æˆ·ç«¯çš„é€‰å€é€»è¾‘ï¼Œç›®å‰å¯é€‰çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰éšæœºï¼Œè½®è®­å’Œæœ€å°æ´»è·ƒï¼Œå…³äºå„ä¸ªç­–ç•¥çš„è§£é‡Šè¯·å‚è€ƒè¿™é‡Œ é…ç½®ç®¡ç† é…ç½®ç®¡ç†ä¹Ÿæ˜¯é…åˆDubbo2.7æ–°å¢çš„åŠŸèƒ½ï¼Œåœ¨Dubbo2.7ä¸­ï¼Œå¢åŠ äº†å…¨å±€å’Œåº”ç”¨ç»´åº¦çš„é…ç½®ï¼Œåˆ†åˆ«åœ¨å…¨å±€å’Œåº”ç”¨èŒƒå›´å†…ç”Ÿæ•ˆï¼Œå…¶ä¸­åº”ç”¨é…ç½®ä¹Ÿå¯ä»¥æŒ‡å®šè¯¥åº”ç”¨ä¸­çš„æœåŠ¡çº§åˆ«çš„é…ç½®ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°ä¸­æŸ¥çœ‹ï¼Œä¿®æ”¹é…ç½®è§„åˆ™ï¼Œé»˜è®¤å±•ç¤ºå…¨å±€ç»´åº¦çš„é…ç½®ã€‚ å…¨å±€é…ç½®ï¼š å…¨å±€é…ç½®é‡Œå¯ä»¥æŒ‡å®šæ³¨å†Œä¸­å¿ƒï¼Œå…ƒæ•°æ®ä¸­å¿ƒçš„åœ°å€ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„è¶…æ—¶æ—¶é—´ç­‰ï¼Œè¿™äº›é…ç½®åœ¨å…¨å±€å†…ç”Ÿæ•ˆã€‚é™¤äº†é…ç½®å†™å…¥ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥æŸ¥çœ‹ã€‚å¦‚æœä½¿ç”¨zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒå’Œå…ƒæ•°æ®ä¸­å¿ƒï¼Œè¿˜å¯ä»¥çœ‹åˆ°é…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®çš„ç›®å½•ç»“æ„ã€‚ åº”ç”¨ï¼Œ æœåŠ¡é…ç½® åº”ç”¨çº§åˆ«çš„é…ç½®å¯ä»¥ä¸ºåº”ç”¨æˆ–è€…åº”ç”¨å†…çš„æœåŠ¡æŒ‡å®šé…ç½®ï¼Œåœ¨æœåŠ¡ç»´åº¦ä¸Šï¼Œéœ€è¦åŒºåˆ†æä¾›è€…å’Œæ¶ˆè´¹è€…ã€‚dubbo.reference.{serviceName}è¡¨ç¤ºä½œä¸ºè¯¥æœåŠ¡æ¶ˆè´¹è€…çš„é…ç½®ï¼Œdubbo.provider.{servcieName}è¡¨ç¤ºä½œä¸ºè¯¥æœåŠ¡æä¾›è€…çš„é…ç½®ã€‚å…¶ä¸­æ³¨å†Œä¸­å¿ƒå’Œå…ƒæ•°æ®ä¸­å¿ƒçš„åœ°å€ï¼Œåªèƒ½åœ¨å…¨å±€é…ç½®ä¸­æŒ‡å®šï¼Œè¿™ä¹Ÿæ˜¯Dubbo2.7ä¸­æ¨èçš„ä½¿ç”¨æ–¹å¼ã€‚ ä¼˜å…ˆçº§ï¼š æœåŠ¡é…ç½® &gt; åº”ç”¨é…ç½® &gt; å…¨å±€é…ç½® æ—¢ç„¶æœ‰ HTTP è¯·æ±‚ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨ RPC è°ƒç”¨ï¼Ÿ HTTPåè®®ï¼Œä»¥å…¶ä¸­çš„Restfulè§„èŒƒä¸ºä»£è¡¨ï¼Œå…¶ä¼˜åŠ¿å¾ˆå¤§ã€‚å®ƒå¯è¯»æ€§å¥½ï¼Œä¸”å¯ä»¥å¾—åˆ°é˜²ç«å¢™çš„æ”¯æŒã€è·¨è¯­è¨€çš„æ”¯æŒã€‚è€Œä¸”ï¼Œåœ¨å»å¹´çš„æŠ¥å‘Šä¸­ï¼ŒRestfulå¤§æœ‰è¶…è¿‡RPCçš„è¶‹åŠ¿ã€‚ ä½†æ˜¯HTTPä¹Ÿæœ‰å…¶ç¼ºç‚¹ï¼Œè¿™æ˜¯ä¸å…¶ä¼˜ç‚¹ç›¸å¯¹åº”çš„ã€‚é¦–å…ˆæ˜¯æœ‰ç”¨ä¿¡æ¯å æ¯”å°‘ï¼Œæ¯•ç«ŸHTTPå·¥ä½œåœ¨ç¬¬ä¸ƒå±‚ï¼ŒåŒ…å«äº†å¤§é‡çš„HTTPå¤´ç­‰ä¿¡æ¯ã€‚å…¶æ¬¡æ˜¯æ•ˆç‡ä½ï¼Œè¿˜æ˜¯å› ä¸ºç¬¬ä¸ƒå±‚çš„ç¼˜æ•…ã€‚è¿˜æœ‰ï¼Œå…¶å¯è¯»æ€§ä¼¼ä¹æ²¡æœ‰å¿…è¦ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥å¼•å…¥ç½‘å…³å¢åŠ å¯è¯»æ€§ã€‚æ­¤å¤–ï¼Œä½¿ç”¨HTTPåè®®è°ƒç”¨è¿œç¨‹æ–¹æ³•æ¯”è¾ƒå¤æ‚ï¼Œè¦å°è£…å„ç§å‚æ•°åå’Œå‚æ•°å€¼ã€‚ ä½†éœ€è¦å†è¯´ä¸€å¥ï¼Œä¸æ˜¯è¯´RPCå¥½ï¼Œä¹Ÿä¸æ˜¯è¯´HTTPå¥½ï¼Œä¸¤è€…å„æœ‰åƒç§‹ï¼Œè¿˜åœ¨æ¯”æ‹¼ä¸­ã€‚ HTTPå’ŒRPCåŒä¸€çº§åˆ«ï¼Œè¿˜æ˜¯è¢«RPCåŒ…å«ï¼Ÿ Restfulä¹Ÿå±äºRPCä¹ˆï¼Ÿ ä¸Šå›¾æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„å…³ç³»å›¾ï¼Œè¿™æ—¶æˆ‘ä»¬å‘ç°HTTPï¼ˆå›¾ä¸­è“è‰²æ¡†ï¼‰å‡ºç°äº†ä¸¤æ¬¡ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯å’ŒRPCå¹¶åˆ—çš„ï¼Œéƒ½æ˜¯è·¨åº”ç”¨è°ƒç”¨æ–¹æ³•çš„è§£å†³æ–¹æ¡ˆï¼›å¦ä¸€ä¸ªåˆ™æ˜¯è¢«RPCåŒ…å«çš„ï¼Œæ˜¯RPCé€šä¿¡è¿‡ç¨‹çš„å¯é€‰åè®®ä¹‹ä¸€ã€‚ å› æ­¤ï¼Œ**ç¬¬ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯éƒ½å¯¹ã€‚çœ‹æŒ‡çš„æ˜¯å“ªä¸€ä¸ªè“è‰²æ¡†ã€‚**ä»é¢˜ä¸»çš„æé—®çœ‹ï¼Œæ—¢ç„¶é¢˜ä¸»åœ¨çº ç»“è¿™ä¸¤è€…ï¼Œåº”è¯¥æ˜¯æŒ‡ä¸RPCå¹¶åˆ—çš„è“è‰²æ¡†ã€‚ ç¬¬äºŒä¸ªé—®é¢˜æ˜¯åœ¨é—®è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆçº¢è‰²æ¡†ï¼‰æ˜¯ä¸æ˜¯åŒ…å«äº†Restfulï¼ˆé»„è‰²æ¡†ï¼‰ï¼Œè¿™ç§ç†è§£çš„å…³é”®åœ¨äºå¯¹RPCçš„ç†è§£ã€‚ RPCå­—é¢ç†è§£æ˜¯è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œå³åœ¨ä¸€ä¸ªåº”ç”¨ä¸­è°ƒç”¨å¦ä¸€ä¸ªåº”ç”¨çš„æ–¹æ³•ã€‚é‚£Restfulæ˜¯æ»¡è¶³çš„ï¼Œé€šè¿‡å®ƒå¯ä»¥å®ç°åœ¨ä¸€ä¸ªåº”ç”¨ä¸­è°ƒç”¨å¦ä¸€ä¸ªåº”ç”¨çš„æ–¹æ³•ã€‚ ä½†æ˜¯ï¼Œä¸Šè¿°ç†è§£ä½¿å¾—RPCçš„å®šä¹‰è¿‡äºå®½æ³›ã€‚RPCé€šå¸¸ç‰¹æŒ‡åœ¨ä¸€ä¸ªåº”ç”¨ä¸­è°ƒç”¨å¦ä¸€ä¸ªåº”ç”¨çš„æ¥å£è€Œå®ç°çš„è¿œç¨‹è°ƒç”¨ï¼Œå³çº¢è‰²æ¡†æ‰€æŒ‡çš„èŒƒå›´ã€‚è¿™æ ·ï¼ŒRPCæ˜¯ä¸åŒ…å«Restfulçš„ã€‚ å› æ­¤ï¼Œç¬¬äºŒä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯Restfulä¸å±äºRPCï¼Œé™¤éå¯¹RPCæœ‰ç€éå¸¸è§„çš„å®½æ³›ç†è§£ã€‚ RPCçš„è‹±æ–‡å…¨ç§°æ˜¯Remote Procedure Callï¼Œç¿»è¯‘ä¸ºä¸­æ–‡å«â€œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨â€ã€‚å…¶ä¸­ç¨æ˜¾æ™¦æ¶©çš„å…¶å®å°±æ˜¯â€œè¿‡ç¨‹â€ï¼Œè¿‡ç¨‹å…¶å®å°±æ˜¯æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œå¯ä»¥æŠŠRPCç†è§£ä¸ºâ€œè¿œç¨‹æ–¹æ³•è°ƒç”¨â€ã€‚ è¦äº†è§£è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œé‚£å…ˆç†è§£è¿‡ç¨‹è°ƒç”¨ã€‚éå¸¸ç®€å•ï¼Œå¦‚ä¸‹å›¾ï¼Œå°±æ˜¯è°ƒç”¨ä¸€ä¸ªæ–¹æ³•ã€‚è¿™å¤ªå¸¸è§äº†ï¼Œä¸å¤šè§£é‡Šã€‚ è€Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå› ä¸ºæ¯ä¸ªæœåŠ¡çš„è¾¹ç•Œéƒ½å¾ˆå°ï¼Œå¾ˆæœ‰å¯èƒ½è°ƒç”¨åˆ«çš„æœåŠ¡æä¾›çš„æ–¹æ³•ã€‚è¿™å°±å‡ºç°äº†æœåŠ¡Aè°ƒç”¨æœåŠ¡Bä¸­æ–¹æ³•çš„éœ€æ±‚ï¼Œå³è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚ è¦æƒ³è®©æœåŠ¡Aè°ƒç”¨æœåŠ¡Bä¸­çš„æ–¹æ³•ï¼Œæœ€å…ˆæƒ³åˆ°çš„å°±æ˜¯é€šè¿‡HTTPè¯·æ±‚å®ç°ã€‚æ˜¯çš„ï¼Œè¿™æ˜¯å¾ˆå¸¸è§çš„ï¼Œä¾‹å¦‚æœåŠ¡Bæš´éœ²Restfulæ¥å£ï¼Œç„¶åè®©æœåŠ¡Aè°ƒç”¨å®ƒçš„æ¥å£ã€‚åŸºäºRestfulçš„è°ƒç”¨æ–¹å¼å› ä¸ºå¯è¯»æ€§å¥½ï¼ˆæœåŠ¡Bæš´éœ²å‡ºçš„æ˜¯Restfulæ¥å£ï¼Œå¯è¯»æ€§å½“ç„¶å¥½ï¼‰è€Œä¸”HTTPè¯·æ±‚å¯ä»¥é€šè¿‡å„ç§é˜²ç«å¢™ï¼Œå› æ­¤éå¸¸ä¸é”™ã€‚ ç„¶è€Œï¼Œå¦‚å‰é¢æ‰€è¿°ï¼ŒåŸºäºRestfulçš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æœ‰ç€æ˜æ˜¾çš„ç¼ºç‚¹ï¼Œä¸»è¦æ˜¯æ•ˆç‡ä½ã€å°è£…è°ƒç”¨å¤æ‚ã€‚å½“å­˜åœ¨å¤§é‡çš„æœåŠ¡é—´è°ƒç”¨æ—¶ï¼Œè¿™äº›ç¼ºç‚¹å˜å¾—æ›´ä¸ºçªå‡ºã€‚ æœåŠ¡Aè°ƒç”¨æœåŠ¡Bçš„è¿‡ç¨‹æ˜¯åº”ç”¨é—´çš„å†…éƒ¨è¿‡ç¨‹ï¼Œç‰ºç‰²å¯è¯»æ€§æå‡æ•ˆç‡ã€æ˜“ç”¨æ€§æ˜¯å¯å–çš„ã€‚åŸºäºè¿™ç§æ€è·¯ï¼ŒRPCäº§ç”Ÿäº†ã€‚ é€šå¸¸ï¼ŒRPCè¦æ±‚åœ¨è°ƒç”¨æ–¹ä¸­æ”¾ç½®è¢«è°ƒç”¨çš„æ–¹æ³•çš„æ¥å£ã€‚è°ƒç”¨æ–¹åªè¦è°ƒç”¨äº†è¿™äº›æ¥å£ï¼Œå°±ç›¸å½“äºè°ƒç”¨äº†è¢«è°ƒç”¨æ–¹çš„å®é™…æ–¹æ³•ï¼Œååˆ†æ˜“ç”¨ã€‚äºæ˜¯ï¼Œè°ƒç”¨æ–¹å¯ä»¥åƒè°ƒç”¨å†…éƒ¨æ¥å£ä¸€æ ·è°ƒç”¨è¿œç¨‹çš„æ–¹æ³•ï¼Œè€Œä¸ç”¨å°è£…å‚æ•°åå’Œå‚æ•°å€¼ç­‰æ“ä½œã€‚ é‚£è¦æƒ³å®ç°è¿™ä¸ªè¿‡ç¨‹è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿåˆ«æ€¥ï¼Œå’±ä»¬ä¸€æ­¥ä¸€æ­¥æ¥ã€‚ é¦–å…ˆï¼Œè°ƒç”¨æ–¹è°ƒç”¨çš„æ˜¯æ¥å£ï¼Œå¿…é¡»å¾—ä¸ºæ¥å£æ„é€ ä¸€ä¸ªå‡çš„å®ç°ã€‚æ˜¾ç„¶ï¼Œè¦ä½¿ç”¨åŠ¨æ€ä»£ç†ã€‚è¿™æ ·ï¼Œè°ƒç”¨æ–¹çš„è°ƒç”¨å°±è¢«åŠ¨æ€ä»£ç†æ¥æ”¶åˆ°äº†ã€‚ ç¬¬äºŒï¼ŒåŠ¨æ€ä»£ç†æ¥æ”¶åˆ°è°ƒç”¨åï¼Œåº”è¯¥æƒ³åŠæ³•è°ƒç”¨è¿œç¨‹çš„å®é™…å®ç°ã€‚è¿™åŒ…æ‹¬ä¸‹é¢å‡ æ­¥ï¼š è¯†åˆ«å…·ä½“è¦è°ƒç”¨çš„è¿œç¨‹æ–¹æ³•çš„IPã€ç«¯å£ å°†è°ƒç”¨æ–¹æ³•çš„å…¥å‚è¿›è¡Œåºåˆ—åŒ– é€šè¿‡é€šä¿¡å°†è¯·æ±‚å‘é€åˆ°è¿œç¨‹çš„æ–¹æ³•ä¸­ è¿™æ ·ï¼Œè¿œç¨‹çš„æœåŠ¡å°±æ¥æ”¶åˆ°äº†è°ƒç”¨æ–¹çš„è¯·æ±‚ã€‚å®ƒåº”è¯¥ï¼š ååºåˆ—åŒ–å„ä¸ªè°ƒç”¨å‚æ•° å®šä½åˆ°å®é™…è¦è°ƒç”¨çš„æ–¹æ³•ï¼Œç„¶åè¾“å…¥å‚æ•°ï¼Œæ‰§è¡Œæ–¹æ³• æŒ‰ç…§è°ƒç”¨çš„è·¯å¾„è¿”å›è°ƒç”¨çš„ç»“æœ æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤º: è°ƒç”¨æ–¹è°ƒç”¨å†…éƒ¨çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯è¢«RPCæ¡†æ¶å·æ¢æ¢æŸ±ä¸ºè¿œç¨‹çš„ä¸€ä¸ªæ–¹æ³•ã€‚ä¹‹é—´çš„é€šä¿¡æ•°æ®å¯è¯»æ€§ä¸éœ€è¦å¥½ï¼Œåªéœ€è¦RPCæ¡†æ¶èƒ½è¯»æ‡‚å³å¯ï¼Œå› æ­¤æ•ˆç‡å¯ä»¥æ›´é«˜ã€‚é€šå¸¸ä½¿ç”¨UDPæˆ–è€…TCPä½œä¸ºé€šè®¯åè®®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨HTTPã€‚ æ‰€ä»¥ï¼Œä¸è¦è¢«RPCå“åˆ°ï¼Œå®ƒå°±æ˜¯è®©ä¸€ä¸ªåº”ç”¨è°ƒç”¨å¦ä¸€ä¸ªåº”ç”¨ä¸­æ–¹æ³•çš„ä¸€ç§å®ç°æ–¹å¼ã€‚ä¸è°ƒç”¨è¿œç¨‹æ¥å£åŒºåˆ«ä¸å¤§ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ã€‚ å†è¯´ä¸€æ¬¡ï¼Œä¸æ˜¯è¯´RPCå¥½ï¼Œä¹Ÿä¸æ˜¯è¯´HTTPå¥½ï¼Œä¸¤è€…å„æœ‰åƒç§‹ã€‚æœ¬è´¨ä¸Šï¼Œä¸¤è€…æ˜¯å¯è¯»æ€§å’Œæ•ˆç‡ä¹‹é—´çš„æŠ‰æ‹©ï¼Œé€šç”¨æ€§å’Œæ˜“ç”¨æ€§ä¹‹é—´çš„æŠ‰æ‹©ã€‚æœ€ç»ˆè°èƒ½å‘å±•æ›´å¥½ï¼Œå¾ˆéš¾è¯´ã€‚ è¦é—®æˆ‘ç«™è°ï¼Ÿæˆ‘æ ¹æ®ä¸šåŠ¡åœºæ™¯ï¼Œçµæ´»ç«™ä½â€¦â€¦ æ¥æºï¼šçŸ¥ä¹ é“¾æ¥ï¼šhttps://www.zhihu.com/question/41609070/answer/1030913797 ","link":"http://blog.ludangxin.club/post/chu-shi-dubbo/"},{"title":"åˆè¯† Zookeeper","content":"zookeeperæ˜¯ä»€ä¹ˆ zookeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡, æä¾›åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ,åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥å®ç°æ•°æ®ç»Ÿä¸€é…ç½®ç®¡ç†ã€ç»Ÿä¸€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼é”ã€é›†ç¾¤ç®¡ç†ç­‰åŠŸèƒ½. ZooKeeperä¸»è¦æœåŠ¡äºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä½¿ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿå°±æ— æ³•é¿å…å¯¹èŠ‚ç‚¹ç®¡ç†çš„é—®é¢˜(éœ€è¦å®æ—¶æ„ŸçŸ¥èŠ‚ç‚¹çš„çŠ¶æ€ã€å¯¹èŠ‚ç‚¹è¿›è¡Œç»Ÿä¸€ç®¡ç†ç­‰ç­‰)ï¼Œè€Œç”±äºè¿™äº›é—®é¢˜å¤„ç†èµ·æ¥å¯èƒ½ç›¸å¯¹éº»çƒ¦å’Œæé«˜äº†ç³»ç»Ÿçš„å¤æ‚æ€§ï¼ŒZooKeeperä½œä¸ºä¸€ä¸ªèƒ½å¤Ÿé€šç”¨è§£å†³è¿™äº›é—®é¢˜çš„ä¸­é—´ä»¶å°±åº”è¿è€Œç”Ÿäº†ã€‚ zookeeperä¸ºä»€ä¹ˆèƒ½å¹²è¿™ä¹ˆå¤š ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¯ä»¥ç”¨ZooKeeperæ¥åšï¼šç»Ÿä¸€é…ç½®ç®¡ç†ã€ç»Ÿä¸€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼é”ã€é›†ç¾¤ç®¡ç†ã€‚ è¿™é‡Œæˆ‘ä»¬å…ˆä¸ç®¡ç»Ÿä¸€é…ç½®ç®¡ç†ã€ç»Ÿä¸€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼é”ã€é›†ç¾¤ç®¡ç†æ¯ä¸ªå…·ä½“çš„å«ä¹‰(åé¢ä¼šè®²) é‚£ä¸ºä»€ä¹ˆZooKeeperå¯ä»¥å¹²é‚£ä¹ˆå¤šäº‹ï¼Ÿæ¥çœ‹çœ‹ZooKeeperç©¶ç«Ÿæ˜¯ä½•æ–¹ç¥ç‰©ï¼Œåœ¨Wikiä¸­å…¶å®ä¹Ÿæœ‰æåˆ°ï¼š ZooKeeper nodes store their data in a hierarchical name space, much like a file system or a tree data structure è¯‘æ–‡: ZooKeeperèŠ‚ç‚¹å°†å…¶æ•°æ®å­˜å‚¨åœ¨åˆ†å±‚åç§°ç©ºé—´ä¸­ï¼Œè¿™ä¸æ–‡ä»¶ç³»ç»Ÿæˆ–æ ‘æ•°æ®ç»“æ„éå¸¸ç›¸ä¼¼ Zookeeper ä¸€ä¸ªæœ€å¸¸ç”¨çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯ç”¨äºæ‹…ä»»æœåŠ¡ç”Ÿäº§è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…çš„æ³¨å†Œä¸­å¿ƒ ã€‚æœåŠ¡ç”Ÿäº§è€…å°†è‡ªå·±æä¾›çš„æœåŠ¡æ³¨å†Œåˆ°Zookeeperä¸­å¿ƒï¼ŒæœåŠ¡çš„æ¶ˆè´¹è€…åœ¨è¿›è¡ŒæœåŠ¡è°ƒç”¨çš„æ—¶å€™å…ˆåˆ°Zookeeperä¸­æŸ¥æ‰¾æœåŠ¡ï¼Œè·å–åˆ°æœåŠ¡ç”Ÿäº§è€…çš„è¯¦ç»†ä¿¡æ¯ä¹‹åï¼Œå†å»è°ƒç”¨æœåŠ¡ç”Ÿäº§è€…çš„å†…å®¹ä¸æ•°æ®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨ Dubboæ¶æ„ä¸­ Zookeeper å°±æ‹…ä»»äº†æ³¨å†Œä¸­å¿ƒè¿™ä¸€è§’è‰²ã€‚ æ•°æ®ç»“æ„ ZooKeeperçš„æ•°æ®ç»“æ„ï¼Œè·ŸUnixæ–‡ä»¶ç³»ç»Ÿéå¸¸ç±»ä¼¼ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€é¢—æ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹å«åšZNodeã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥é€šè¿‡è·¯å¾„æ¥æ ‡è¯†ï¼Œç»“æ„å›¾å¦‚ä¸‹ï¼š é‚£ZooKeeperè¿™é¢—&quot;æ ‘&quot;æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢ï¼Ÿï¼ŸZooKeeperçš„èŠ‚ç‚¹æˆ‘ä»¬ç§°ä¹‹ä¸ºZnodeï¼ŒZnodeåˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š çŸ­æš‚/ä¸´æ—¶(Ephemeral)ï¼šå½“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ–­å¼€è¿æ¥åï¼Œæ‰€åˆ›å»ºçš„Znode(èŠ‚ç‚¹)ä¼šè‡ªåŠ¨åˆ é™¤ æŒä¹…(Persistent)ï¼šå½“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ–­å¼€è¿æ¥åï¼Œæ‰€åˆ›å»ºçš„Znode(èŠ‚ç‚¹)ä¸ä¼šåˆ é™¤ ZooKeeperå’ŒRedisä¸€æ ·ï¼Œä¹Ÿæ˜¯C/Sç»“æ„(åˆ†æˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯) ç›‘å¬å™¨ åœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»ç®€å•çŸ¥é“äº†ZooKeeperçš„æ•°æ®ç»“æ„äº†ï¼ŒZooKeeperè¿˜é…åˆäº†ç›‘å¬å™¨æ‰èƒ½å¤Ÿåšé‚£ä¹ˆå¤šäº‹çš„ã€‚ å¸¸è§çš„ç›‘å¬åœºæ™¯æœ‰ä»¥ä¸‹ä¸¤é¡¹ï¼š ç›‘å¬ZnodeèŠ‚ç‚¹çš„æ•°æ®å˜åŒ– ç›‘å¬å­èŠ‚ç‚¹çš„å¢å‡å˜åŒ– æ²¡é”™ï¼Œé€šè¿‡ç›‘å¬+ZnodeèŠ‚ç‚¹(æŒä¹…/çŸ­æš‚[ä¸´æ—¶])ï¼ŒZooKeeperå°±å¯ä»¥ç©å‡ºè¿™ä¹ˆå¤šèŠ±æ ·äº†ã€‚ zookeeperå…·ä½“èƒ½å¹²ä»€ä¹ˆ ç»Ÿä¸€é…ç½®ç®¡ç† æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸‰ä¸ªç³»ç»ŸAã€Bã€Cï¼Œä»–ä»¬æœ‰ä¸‰ä»½é…ç½®ï¼Œåˆ†åˆ«æ˜¯ASystem.ymlã€BSystem.ymlã€CSystem.ymlï¼Œç„¶åï¼Œè¿™ä¸‰ä»½é…ç½®åˆéå¸¸ç±»ä¼¼ï¼Œå¾ˆå¤šçš„é…ç½®é¡¹å‡ ä¹éƒ½ä¸€æ ·ã€‚ æ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬è¦æ”¹å˜å…¶ä¸­ä¸€ä»½é…ç½®é¡¹çš„ä¿¡æ¯ï¼Œå¾ˆå¯èƒ½å…¶ä»–ä¸¤ä»½éƒ½è¦æ”¹ã€‚å¹¶ä¸”ï¼Œæ”¹å˜äº†é…ç½®é¡¹çš„ä¿¡æ¯å¾ˆå¯èƒ½å°±è¦é‡å¯ç³»ç»Ÿ äºæ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›æŠŠASystem.ymlã€BSystem.ymlã€CSystem.ymlç›¸åŒçš„é…ç½®é¡¹æŠ½å–å‡ºæ¥æˆä¸€ä»½å…¬ç”¨çš„é…ç½®common.ymlï¼Œå¹¶ä¸”å³ä¾¿common.ymlæ”¹äº†ï¼Œä¹Ÿä¸éœ€è¦ç³»ç»ŸAã€Bã€Cé‡å¯ã€‚ åšæ³•ï¼šæˆ‘ä»¬å¯ä»¥å°†common.ymlè¿™ä»½é…ç½®æ”¾åœ¨ZooKeeperçš„ZnodeèŠ‚ç‚¹ä¸­ï¼Œç³»ç»ŸAã€Bã€Cç›‘å¬ç€è¿™ä¸ªZnodeèŠ‚ç‚¹æœ‰æ— å˜æ›´ï¼Œå¦‚æœå˜æ›´äº†ï¼ŒåŠæ—¶å“åº”ã€‚ ç»Ÿä¸€å‘½åæœåŠ¡ ç»Ÿä¸€å‘½åæœåŠ¡çš„ç†è§£å…¶å®è·ŸåŸŸåä¸€æ ·ï¼Œæ˜¯æˆ‘ä»¬ä¸ºè¿™æŸä¸€éƒ¨åˆ†çš„èµ„æºç»™å®ƒå–ä¸€ä¸ªåå­—ï¼Œåˆ«äººé€šè¿‡è¿™ä¸ªåå­—å°±å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„èµ„æºã€‚ æ¯”å¦‚è¯´ï¼Œç°åœ¨æˆ‘æœ‰ä¸€ä¸ªåŸŸåwww.java3y.comï¼Œä½†æˆ‘è¿™ä¸ªåŸŸåä¸‹æœ‰å¤šå°æœºå™¨ï¼š 192.168.1.1 192.168.1.2 192.168.1.3 192.168.1.4 åˆ«äººè®¿é—®www.java3y.comå³å¯è®¿é—®åˆ°æˆ‘çš„æœºå™¨ï¼Œè€Œä¸æ˜¯é€šè¿‡IPå»è®¿é—®ã€‚ åˆ†å¸ƒå¼é” æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ZooKeeperæ¥å®ç°åˆ†å¸ƒå¼é”ï¼Œé‚£æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿï¼Ÿä¸‹é¢æ¥çœ‹çœ‹ï¼š ç³»ç»ŸAã€Bã€Céƒ½å»è®¿é—®/locksèŠ‚ç‚¹ è®¿é—®çš„æ—¶å€™ä¼šåˆ›å»ºå¸¦é¡ºåºå·çš„ä¸´æ—¶/çŸ­æš‚(EPHEMERAL_SEQUENTIAL)èŠ‚ç‚¹ï¼Œæ¯”å¦‚ï¼Œç³»ç»ŸAåˆ›å»ºäº†id_000000èŠ‚ç‚¹ï¼Œç³»ç»ŸBåˆ›å»ºäº†id_000002èŠ‚ç‚¹ï¼Œç³»ç»ŸCåˆ›å»ºäº†id_000001èŠ‚ç‚¹ã€‚ æ¥ç€ï¼Œæ‹¿åˆ°/locksèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹(id_000000,id_000001,id_000002)ï¼Œåˆ¤æ–­è‡ªå·±åˆ›å»ºçš„æ˜¯ä¸æ˜¯æœ€å°çš„é‚£ä¸ªèŠ‚ç‚¹ å¦‚æœæ˜¯ï¼Œåˆ™æ‹¿åˆ°é”ã€‚ é‡Šæ”¾é”ï¼šæ‰§è¡Œå®Œæ“ä½œåï¼ŒæŠŠåˆ›å»ºçš„èŠ‚ç‚¹ç»™åˆ æ‰ å¦‚æœä¸æ˜¯ï¼Œåˆ™ç›‘å¬æ¯”è‡ªå·±è¦å°1çš„èŠ‚ç‚¹å˜åŒ– ä¸¾ä¸ªä¾‹å­ï¼š ç³»ç»ŸAæ‹¿åˆ°/locksèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œç»è¿‡æ¯”è¾ƒï¼Œå‘ç°è‡ªå·±(id_000000)ï¼Œæ˜¯æ‰€æœ‰å­èŠ‚ç‚¹æœ€å°çš„ã€‚æ‰€ä»¥å¾—åˆ°é” ç³»ç»ŸBæ‹¿åˆ°/locksèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œç»è¿‡æ¯”è¾ƒï¼Œå‘ç°è‡ªå·±(id_000002)ï¼Œä¸æ˜¯æ‰€æœ‰å­èŠ‚ç‚¹æœ€å°çš„ã€‚æ‰€ä»¥ç›‘å¬æ¯”è‡ªå·±å°1çš„èŠ‚ç‚¹id_000001çš„çŠ¶æ€ ç³»ç»ŸCæ‹¿åˆ°/locksèŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œç»è¿‡æ¯”è¾ƒï¼Œå‘ç°è‡ªå·±(id_000001)ï¼Œä¸æ˜¯æ‰€æœ‰å­èŠ‚ç‚¹æœ€å°çš„ã€‚æ‰€ä»¥ç›‘å¬æ¯”è‡ªå·±å°1çš„èŠ‚ç‚¹id_000000çš„çŠ¶æ€ â€¦... ç­‰åˆ°ç³»ç»ŸAæ‰§è¡Œå®Œæ“ä½œä»¥åï¼Œå°†è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹åˆ é™¤(id_000000)ã€‚é€šè¿‡ç›‘å¬ï¼Œç³»ç»ŸCå‘ç°id_000000èŠ‚ç‚¹å·²ç»åˆ é™¤äº†ï¼Œå‘ç°è‡ªå·±å·²ç»æ˜¯æœ€å°çš„èŠ‚ç‚¹äº†ï¼Œäºæ˜¯é¡ºåˆ©æ‹¿åˆ°é” â€¦.ç³»ç»ŸBå¦‚ä¸Š é›†ç¾¤çŠ¶æ€ ç»è¿‡ä¸Šé¢å‡ ä¸ªä¾‹å­ï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶ä¹Ÿå¾ˆå®¹æ˜“æƒ³åˆ°ZooKeeperæ˜¯æ€ä¹ˆ&quot;æ„ŸçŸ¥&quot;èŠ‚ç‚¹çš„åŠ¨æ€æ–°å¢æˆ–è€…åˆ é™¤çš„äº†ã€‚ è¿˜æ˜¯ä»¥æˆ‘ä»¬ä¸‰ä¸ªç³»ç»ŸAã€Bã€Cä¸ºä¾‹ï¼Œåœ¨ZooKeeperä¸­åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹å³å¯ï¼š åªè¦ç³»ç»ŸAæŒ‚äº†ï¼Œé‚£/groupMember/Aè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šåˆ é™¤ï¼Œé€šè¿‡ç›‘å¬groupMemberä¸‹çš„å­èŠ‚ç‚¹ï¼Œç³»ç»ŸBå’ŒCå°±èƒ½å¤Ÿæ„ŸçŸ¥åˆ°ç³»ç»ŸAå·²ç»æŒ‚äº†ã€‚(æ–°å¢ä¹Ÿæ˜¯åŒç†) é™¤äº†èƒ½å¤Ÿæ„ŸçŸ¥èŠ‚ç‚¹çš„ä¸Šä¸‹çº¿å˜åŒ–ï¼ŒZooKeeperè¿˜å¯ä»¥å®ç°åŠ¨æ€é€‰ä¸¾Masterçš„åŠŸèƒ½ã€‚(å¦‚æœé›†ç¾¤æ˜¯ä¸»ä»æ¶æ„æ¨¡å¼ä¸‹) åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚æœæƒ³è¦å®ç°åŠ¨æ€é€‰ä¸¾Masterçš„åŠŸèƒ½ï¼ŒZnodeèŠ‚ç‚¹çš„ç±»å‹æ˜¯å¸¦é¡ºåºå·çš„ä¸´æ—¶èŠ‚ç‚¹(EPHEMERAL_SEQUENTIAL)å°±å¥½äº†ã€‚ Zookeeperä¼šæ¯æ¬¡é€‰ä¸¾æœ€å°ç¼–å·çš„ä½œä¸ºMasterï¼Œå¦‚æœMasteræŒ‚äº†ï¼Œè‡ªç„¶å¯¹åº”çš„ZnodeèŠ‚ç‚¹å°±ä¼šåˆ é™¤ã€‚ç„¶åè®©æ–°çš„æœ€å°ç¼–å·ä½œä¸ºMasterï¼Œè¿™æ ·å°±å¯ä»¥å®ç°åŠ¨æ€é€‰ä¸¾çš„åŠŸèƒ½äº†ã€‚ è½¬è‡ª: Java3y-zookeeper ZAB åè®®&amp;Paxosç®—æ³• paxos ç®—æ³• Paxos ç®—æ³•åº”è¯¥å¯ä»¥è¯´æ˜¯ ZooKeeper çš„çµé­‚äº†ã€‚ä½†æ˜¯ï¼ŒZooKeeper å¹¶æ²¡æœ‰å®Œå…¨é‡‡ç”¨ Paxosç®—æ³• ï¼Œè€Œæ˜¯ä½¿ç”¨ ZAB åè®®ä½œä¸ºå…¶ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„æ ¸å¿ƒç®—æ³•ã€‚å¦å¤–ï¼Œåœ¨ZooKeeperçš„å®˜æ–¹æ–‡æ¡£ä¸­ä¹ŸæŒ‡å‡ºï¼ŒZABåè®®å¹¶ä¸åƒ Paxos ç®—æ³•é‚£æ ·ï¼Œæ˜¯ä¸€ç§é€šç”¨çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹åˆ«ä¸ºZookeeperè®¾è®¡çš„å´©æºƒå¯æ¢å¤çš„åŸå­æ¶ˆæ¯å¹¿æ’­ç®—æ³•ã€‚ ZAB åè®®ä»‹ç» ZABï¼ˆZooKeeper Atomic Broadcast åŸå­å¹¿æ’­ï¼‰ åè®®æ˜¯ä¸ºåˆ†å¸ƒå¼åè°ƒæœåŠ¡ ZooKeeper ä¸“é—¨è®¾è®¡çš„ä¸€ç§æ”¯æŒå´©æºƒæ¢å¤çš„åŸå­å¹¿æ’­åè®®ã€‚ åœ¨ ZooKeeper ä¸­ï¼Œä¸»è¦ä¾èµ– ZAB åè®®æ¥å®ç°åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§ï¼ŒåŸºäºè¯¥åè®®ï¼ŒZooKeeper å®ç°äº†ä¸€ç§ä¸»å¤‡æ¨¡å¼çš„ç³»ç»Ÿæ¶æ„æ¥ä¿æŒé›†ç¾¤ä¸­å„ä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚ ZAB åè®®ä¸¤ç§åŸºæœ¬çš„æ¨¡å¼ï¼šå´©æºƒæ¢å¤å’Œæ¶ˆæ¯å¹¿æ’­ ZABåè®®åŒ…æ‹¬ä¸¤ç§åŸºæœ¬çš„æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ å´©æºƒæ¢å¤å’Œæ¶ˆæ¯å¹¿æ’­ã€‚å½“æ•´ä¸ªæœåŠ¡æ¡†æ¶åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œæˆ–æ˜¯å½“ Leader æœåŠ¡å™¨å‡ºç°ç½‘ç»œä¸­æ–­ã€å´©æºƒé€€å‡ºä¸é‡å¯ç­‰å¼‚å¸¸æƒ…å†µæ—¶ï¼ŒZAB åè®®å°±ä¼šè¿›äººæ¢å¤æ¨¡å¼å¹¶é€‰ä¸¾äº§ç”Ÿæ–°çš„LeaderæœåŠ¡å™¨ã€‚å½“é€‰ä¸¾äº§ç”Ÿäº†æ–°çš„ Leader æœåŠ¡å™¨ï¼ŒåŒæ—¶é›†ç¾¤ä¸­å·²ç»æœ‰è¿‡åŠçš„æœºå™¨ä¸è¯¥LeaderæœåŠ¡å™¨å®Œæˆäº†çŠ¶æ€åŒæ­¥ä¹‹åï¼ŒZABåè®®å°±ä¼šé€€å‡ºæ¢å¤æ¨¡å¼ã€‚å…¶ä¸­ï¼Œæ‰€è°“çš„çŠ¶æ€åŒæ­¥æ˜¯æŒ‡æ•°æ®åŒæ­¥ï¼Œç”¨æ¥ä¿è¯é›†ç¾¤ä¸­å­˜åœ¨è¿‡åŠçš„æœºå™¨èƒ½å¤Ÿå’ŒLeaderæœåŠ¡å™¨çš„æ•°æ®çŠ¶æ€ä¿æŒä¸€è‡´ã€‚ å½“é›†ç¾¤ä¸­å·²ç»æœ‰è¿‡åŠçš„FolloweræœåŠ¡å™¨å®Œæˆäº†å’ŒLeaderæœåŠ¡å™¨çš„çŠ¶æ€åŒæ­¥ï¼Œé‚£ä¹ˆæ•´ä¸ªæœåŠ¡æ¡†æ¶å°±å¯ä»¥è¿›äººæ¶ˆæ¯å¹¿æ’­æ¨¡å¼äº†ã€‚ å½“ä¸€å°åŒæ ·éµå®ˆZABåè®®çš„æœåŠ¡å™¨å¯åŠ¨ååŠ äººåˆ°é›†ç¾¤ä¸­æ—¶ï¼Œå¦‚æœæ­¤æ—¶é›†ç¾¤ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªLeaderæœåŠ¡å™¨åœ¨è´Ÿè´£è¿›è¡Œæ¶ˆæ¯å¹¿æ’­ï¼Œé‚£ä¹ˆæ–°åŠ äººçš„æœåŠ¡å™¨å°±ä¼šè‡ªè§‰åœ°è¿›äººæ•°æ®æ¢å¤æ¨¡å¼ï¼šæ‰¾åˆ°Leaderæ‰€åœ¨çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸å…¶è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œç„¶åä¸€èµ·å‚ä¸åˆ°æ¶ˆæ¯å¹¿æ’­æµç¨‹ä¸­å»ã€‚æ­£å¦‚ä¸Šæ–‡ä»‹ç»ä¸­æ‰€è¯´çš„ï¼ŒZooKeeperè®¾è®¡æˆåªå…è®¸å”¯ä¸€çš„ä¸€ä¸ªLeaderæœåŠ¡å™¨æ¥è¿›è¡Œäº‹åŠ¡è¯·æ±‚çš„å¤„ç†ã€‚LeaderæœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„äº‹åŠ¡è¯·æ±‚åï¼Œä¼šç”Ÿæˆå¯¹åº”çš„äº‹åŠ¡ææ¡ˆå¹¶å‘èµ·ä¸€è½®å¹¿æ’­åè®®ï¼›è€Œå¦‚æœé›†ç¾¤ä¸­çš„å…¶ä»–æœºå™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„äº‹åŠ¡è¯·æ±‚ï¼Œé‚£ä¹ˆè¿™äº›éLeaderæœåŠ¡å™¨ä¼šé¦–å…ˆå°†è¿™ä¸ªäº‹åŠ¡è¯·æ±‚è½¬å‘ç»™LeaderæœåŠ¡å™¨ã€‚ zookeeperç¯å¢ƒæ­å»º å•æœºç¯å¢ƒ ä¸Šä¼ zookeeperåˆ°linuxæœåŠ¡å™¨ è§£å‹ç¼©å‹ç¼©åŒ… tar -zxvf zookeeper-3.5.8.tar è¿›å…¥zookeeper-3.5.8ç›®å½•,åˆ›å»ºdataæ–‡ä»¶å¤¹ä¸”åˆ›å»ºcfgæ–‡ä»¶ mkdir data cd conf # zookeeperé»˜è®¤è¯»å–zoo.cfgçš„é…ç½®æ–‡ä»¶ä¿¡æ¯ cp zoo_sample.cfg zoo.cfg ä¿®æ”¹zoo.cfg dataç›®å½• dataDir=/usr/local/zookeeper-3.5.8/data # zkæœåŠ¡å™¨é»˜è®¤8080ç«¯å£,ä¸ºé˜²æ­¢ç«¯å£å ç”¨,å¢åŠ serverPorté…ç½® admin.serverPort=6666 åˆ°binç›®å½•å¯åŠ¨zookeeper ./zkServer.sh start æŸ¥çœ‹zookeeperçŠ¶æ€ ./zkServer.sh status é›†ç¾¤ç¯å¢ƒ å°†zookeeperåˆ†åˆ«å®‰è£…åˆ°ä¸‰å°æœåŠ¡å™¨ä¸Šå¹¶é…ç½®å¥½åŸºæœ¬ä¿¡æ¯(é‡å¤å•æœºç¯å¢ƒæ­å»ºè¿‡ç¨‹) åœ¨æ¯ä¸ªzookeeperçš„dataç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªmyidæ–‡ä»¶,å†…å®¹åˆ†åˆ«æ˜¯1,2,3 è¿™ä¸ªæ–‡ä»¶å°±æ˜¯è®°å½•æ¯ä¸ªæœåŠ¡å™¨çš„id # 192.168.1.110 æœåŠ¡å™¨ echo 1 &gt; myid # 192.168.1.111 æœåŠ¡å™¨ echo 2 &gt; myid # 192.168.1.112 æœåŠ¡å™¨ echo 3 &gt; myid åœ¨æ¯ä¸€ä¸ªzookeeperçš„zoo.cfgé…ç½®å®¢æˆ·ç«¯è®¿é—®ç«¯å£å’Œé›†ç¾¤æœåŠ¡å™¨ipåˆ—è¡¨ # server.æœåŠ¡å™¨id=æœåŠ¡å™¨ipåœ°å€:æœåŠ¡å™¨ä¹‹é—´é€šä¿¡ç«¯å£:æœåŠ¡å™¨ä¹‹é—´æŠ•ç¥¨é€‰ä¸¾ç«¯å£ server.1=192.168.1.110:2181:3881 server.2=192.168.1.111:2181:3881 server.3=192.168.1.112:2181:3881 å¯åŠ¨é›†ç¾¤ ä¾æ¬¡å¯åŠ¨ä¸‰ä¸ªzkå®ä¾‹,å…¶ä¸­æœ‰ä¸€ä¸ªleaderå’Œä¸¤ä¸ªfollower é€šè¿‡./zkServer.sh statuså‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰zkæ˜¯ leader è¿˜æ˜¯ follower å¯ä»¥é€šè¿‡./zkServer.sh stopå‘½ä»¤åœæ­¢zkæœåŠ¡æ¥æµ‹è¯•zkçš„é€‰ä¸¾æ¨¡å¼ zookeeperåŸºæœ¬ä½¿ç”¨ æ•°æ®ç»“æ„ zookeeperæ•°æ®æ¨¡å‹çš„ç»“æ„ä¸Unixæ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼,æ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘,æ¯ä¸ªèŠ‚ç‚¹ç§°ä½œä¸€ä¸ªZNode,æ¯ä¸ªZNodeéƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†. å¦‚å›¾ç¤º ZNodeèŠ‚ç‚¹ç±»å‹ æŒä¹…åŒ–ç›®å½•èŠ‚ç‚¹(PERSISTENT) å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥å,è¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ æŒä¹…åŒ–é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹(PERSISTENT_SEQUENTIAL) å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥å,è¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨,zookeeperä¼šç»™è¯¥èŠ‚ç‚¹æŒ‰ç…§é¡ºåºç¼–å· ä¸´æ—¶ç›®å½•èŠ‚ç‚¹(EPHEMERAL) å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥å,è¯¥èŠ‚ç‚¹è¢«åˆ é™¤ ä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹(EPHEMERAL_SEQUENTIAL) å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥å,è¯¥èŠ‚ç‚¹è¢«åˆ é™¤,zookeeperä¼šç»™è¯¥èŠ‚ç‚¹æŒ‰ç…§é¡ºåºç¼–å· å‘½ä»¤è¡Œä½¿ç”¨ åœ¨zookeeper binç›®å½•ä¸­è¾“å…¥ ./zkCli.sh è¿›å…¥å®¢æˆ·ç«¯ è¾“å…¥helpæŸ¥çœ‹ç›¸å…³å‘½ä»¤æ“ä½œ,ç»“æœå¦‚ä¸‹ å¸¸ç”¨å‘½ä»¤è®²è§£: èŠ‚ç‚¹ç›®å½•æ“ä½œ ä½¿ç”¨lså‘½ä»¤æ¥æŸ¥çœ‹å½“å‰znodeä¸­é”åŒ…å«çš„å†…å®¹ # ls [-s] [-w] [-R] path [zk: localhost:2181(CONNECTED) 3] ls / [ludangxin, zookeeper] ä½¿ç”¨ls2æŸ¥çœ‹å½“å‰èŠ‚ç‚¹æ•°æ®å¹¶èƒ½çœ‹åˆ°æ›´æ–°æ¬¡æ•°ç­‰æ•°æ® # ls2 path [watch] å®˜æ–¹ä¸æ¨èç›´æ¥ä½¿ç”¨ls2æŸ¥çœ‹, ä½¿ç”¨ ls -s path æ•ˆæœä¸€æ · [zk: localhost:2181(CONNECTED) 4] ls2 / 'ls2' has been deprecated. Please use 'ls [-s] path' instead. [ludangxin, zookeeper] cZxid = 0x0 ctime = Thu Jan 01 00:00:00 UTC 1970 mZxid = 0x0 mtime = Thu Jan 01 00:00:00 UTC 1970 pZxid = 0x2 cversion = 0 dataVersion = 0 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 0 numChildren = 2 ä½¿ç”¨createåˆ›å»ºèŠ‚ç‚¹ -s å«æœ‰åºåˆ— -e ä¸´æ—¶ # create [-s] [-e] [-c] [-t ttl] path [data] [acl] # zkå®¢æˆ·ç«¯ä¸èƒ½é€’å½’åˆ›å»ºç›®å½•,åªèƒ½ä¸€çº§ä¸€çº§åˆ›å»º [zk: localhost:2181(CONNECTED) 6] create /ludangxin/app1 Created /ludangxin/app1 ä½¿ç”¨setè®¾ç½®èŠ‚ç‚¹å€¼ # set [-s] [-v version] path data [zk: localhost:2181(CONNECTED) 8] set /ludangxin/app1 helloworld ä½¿ç”¨getè·å¾—èŠ‚ç‚¹çš„å€¼ # get [-s] [-w] path [zk: localhost:2181(CONNECTED) 9] get /ludangxin/app1 helloworld ä½¿ç”¨statæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ # stat [-w] path [zk: localhost:2181(CONNECTED) 1] stat /ludangxin/app1 cZxid = 0x3 ctime = Sat May 23 13:03:07 UTC 2020 mZxid = 0x4 mtime = Sat May 23 13:05:56 UTC 2020 pZxid = 0x3 cversion = 0 dataVersion = 1 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 10 numChildren = 0 ä½¿ç”¨deleteåˆ é™¤èŠ‚ç‚¹ # delete [-v version] path # deleteä¸èƒ½é€’å½’åˆ é™¤ç›®å½•,åªèƒ½ä¸€çº§ä¸€çº§åˆ é™¤ [zk: localhost:2181(CONNECTED) 3] delete /ludangxin/app1 ä½¿ç”¨rmræˆ–deleteallé€’å½’åˆ é™¤èŠ‚ç‚¹ # rmr path å®˜æ–¹ä¸æ¨èä½¿ç”¨rmr æ¨èä½¿ç”¨deleteall [zk: localhost:2181(CONNECTED) 4] create /ludangxin/app1 Created /ludangxin/app1 [zk: localhost:2181(CONNECTED) 5] create /ludangxin/app1/test1 Created /ludangxin/app1/test1 [zk: localhost:2181(CONNECTED) 7] rmr /ludangxin The command 'rmr' has been deprecated. Please use 'deleteall' instead. [zk: localhost:2181(CONNECTED) 8] ls /ludangxin Node does not exist: /ludangxin [zk: localhost:2181(CONNECTED) 9] ls / [zookeeper] ç›‘å¬æ“ä½œ ç›‘å¬åªèƒ½ç›‘å¬ä¸€æ¬¡,è§¦å‘åå°±é”€æ¯äº† ä½¿ç”¨lsåˆ›å»ºç›‘å¬ # ls -w path å½“ç›‘å¬çš„èŠ‚ç‚¹åŒ…æ‹¬ä»–çš„å­èŠ‚ç‚¹å‘ç›®å½•å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰è§¦å‘ç›‘å¬ # ä¾‹:å½“å‰ç›‘å¬ /a/b å¦‚æœåˆ é™¤bèŠ‚ç‚¹,æˆ–è€…åˆ›å»º /a/b/c çš„æ—¶å€™ä¼šè§¦å‘ç›‘å¬ä¸”åªèƒ½è§¦å‘ä¸€æ¬¡ [zk: localhost:2181(CONNECTED) 15] ls -w /ludangxin/app1 [] [zk: localhost:2181(CONNECTED) 16] set /ludangxin/app1 helloworld [zk: localhost:2181(CONNECTED) 17] create /ludangxin/app1/testwatch Created /ludangxin/app1/testwatch WATCHER:: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/ludangxin/app1 ä½¿ç”¨getåˆ›å»ºç›‘å¬(åªèƒ½å½“å‰èŠ‚ç‚¹ç›‘å¬èŠ‚ç‚¹å€¼çš„å˜åŒ–) # get -w path get -w /ludangxin/app1 ä½¿ç”¨statåˆ›å»ºç›‘å¬(å½“ å½“å‰èŠ‚ç‚¹çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è§¦å‘) # stat -w path stat -w /ludangxin/app1 zookeeper apiä½¿ç”¨ å¼•å…¥ä¾èµ– æ³¨: å¼•å…¥ä¾èµ–çš„ç‰ˆæœ¬æœ€å¥½å’Œå®‰è£…çš„zkæœåŠ¡çš„ç‰ˆæœ¬ä¸€è‡´ &lt;!-- zookeeper --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt; &lt;artifactId&gt;zookeeper&lt;/artifactId&gt; &lt;version&gt;3.5.8&lt;/version&gt; &lt;/dependency&gt; &lt;!-- lombok --&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; åˆ›å»ºæµ‹è¯•ç±» import lombok.extern.slf4j.Slf4j; import org.apache.zookeeper.*; import org.apache.zookeeper.data.Stat; import org.junit.jupiter.api.Test; import java.io.IOException; import java.util.List; @Slf4j public class ZkApiTest { public static final String URL = &quot;192.168.128.130:2181&quot;; public static final int SESSION_TIME_OUT = 20000; @Test public void test() throws IOException, KeeperException, InterruptedException { //1. åˆ›å»ºzookeeperè¿æ¥ ZooKeeper zooKeeper = new ZooKeeper(URL,SESSION_TIME_OUT, watch -&gt; log.info(&quot;è§¦å‘äº†&quot;+ watch.getType() +&quot;äº‹ä»¶&quot;) ); //2. åˆ›å»ºçˆ¶èŠ‚ç‚¹ //Ids.OPEN_ACL_UNSAFE æ— æƒé™ CreateMode.PERSISTENT æŒä¹…åŒ–èŠ‚ç‚¹ String testParentPath = zooKeeper.create(&quot;/testPath1&quot;, &quot;testParentValue&quot;.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT); log.info(&quot;testParentPath===&quot;+testParentPath); //3. åˆ›å»ºå­èŠ‚ç‚¹ String testChildPath = zooKeeper.create(testParentPath+&quot;/child1&quot;, &quot;testChildValue&quot;.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT); log.info(&quot;testChildPath===&quot;+testChildPath); //4. è·å–èŠ‚ç‚¹ä¸­çš„å€¼(çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹) byte[] parentData = zooKeeper.getData(testParentPath, false, null); byte[] childData = zooKeeper.getData(testChildPath, false, null); List&lt;String&gt; childrenNodes = zooKeeper.getChildren(testParentPath, false); log.info(&quot;parentData===&quot;+new String(parentData)); log.info(&quot;childData===&quot;+new String(childData)); for (String childrenNode : childrenNodes) { log.info(&quot;childrenNode===&quot;+childrenNode); } //5. ä¿®æ”¹èŠ‚ç‚¹çš„å€¼ //version èŠ‚ç‚¹ç‰ˆæœ¬ -1 åŒ¹é…ä»»ä½•ç‰ˆæœ¬ zooKeeper.setData(testParentPath, &quot;testValueUpdate&quot;.getBytes(), -1); byte[] parentNewData = zooKeeper.getData(testParentPath, false, null); log.info(&quot;parentNewData===&quot;+new String(parentNewData)); //6. åˆ¤æ–­æŸä¸ªèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨ Stat exists = zooKeeper.exists(testChildPath, false); log.info(exists.toString()); //7. åˆ é™¤èŠ‚ç‚¹ zooKeeper.delete(testChildPath,-1); } } è¾“å‡ºç»“æœ 23:37:36.574 [main-EventThread] INFO com.ldx.springboot.ZkApiTest - è§¦å‘äº†Noneäº‹ä»¶ 23:37:36.581 [main] INFO com.ldx.springboot.ZkApiTest - testParentPath===/testPath1 23:37:36.585 [main] INFO com.ldx.springboot.ZkApiTest - testChildPath===/testPath1/child1 23:37:36.595 [main] INFO com.ldx.springboot.ZkApiTest - parentData===testParentValue 23:37:36.595 [main] INFO com.ldx.springboot.ZkApiTest - childData===testChildValue 23:37:36.595 [main] INFO com.ldx.springboot.ZkApiTest - childrenNode===child1 23:37:36.603 [main] INFO com.ldx.springboot.ZkApiTest - parentNewData===testValueUpdate 23:37:36.606 [main] INFO com.ldx.springboot.ZkApiTest - 111,111,1590248257090,1590248257090,0,0,0,0,14,0,111 ","link":"http://blog.ludangxin.club/post/chu-shi-zookeeper/"},{"title":"æµ…è°ˆ åˆ†å¸ƒå¼ é›†ç¾¤ å¾®æœåŠ¡","content":"æ¦‚å¿µ é›†ç¾¤æ˜¯ä¸ªç‰©ç†å½¢æ€ï¼Œåˆ†å¸ƒå¼æ˜¯ç³»ç»Ÿéƒ¨ç½²æ–¹å¼ï¼Œå¾®æœåŠ¡æ˜¯æ¶æ„è®¾è®¡æ–¹å¼ã€‚ é›†ç¾¤æ˜¯å•¥? å•æœºå¤„ç†åˆ°è¾¾ç“¶é¢ˆçš„æ—¶å€™ï¼Œä½ å°±æŠŠå•æœºå¤åˆ¶å‡ ä»½ï¼Œè¿™æ ·å°±æ„æˆäº†ä¸€ä¸ªâ€œé›†ç¾¤â€ã€‚é›†ç¾¤ä¸­æ¯å°æœåŠ¡å™¨å°±å«åšè¿™ä¸ªé›†ç¾¤çš„ä¸€ä¸ªâ€œèŠ‚ç‚¹â€ï¼Œæ‰€æœ‰èŠ‚ç‚¹æ„æˆäº†ä¸€ä¸ªé›†ç¾¤ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æä¾›ç›¸åŒçš„æœåŠ¡ï¼Œé‚£ä¹ˆè¿™æ ·ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›å°±ç›¸å½“äºæå‡äº†å¥½å‡ å€ï¼ˆæœ‰å‡ ä¸ªèŠ‚ç‚¹å°±ç›¸å½“äºæå‡äº†è¿™ä¹ˆå¤šå€ï¼‰ã€‚ä»å•æœºç»“æ„åˆ°é›†ç¾¤ç»“æ„ï¼Œä½ çš„ä»£ç åŸºæœ¬æ— éœ€è¦ä½œä»»ä½•ä¿®æ”¹ã€‚ä½ è¦åšçš„ä»…ä»…æ˜¯å¤šéƒ¨ç½²å‡ å°æœåŠ¡å™¨ï¼Œæ¯å°æœåŠ¡å™¨ä¸Šè¿è¡Œç›¸åŒçš„ä»£ç å°±è¡Œäº†ã€‚ åˆ†å¸ƒå¼æ˜¯å•¥ï¼Ÿ åˆ†å¸ƒå¼æœåŠ¡é¡¾åæ€ä¹‰æœåŠ¡æ˜¯åˆ†æ•£éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šçš„ï¼Œä¸€ä¸ªæœåŠ¡å¯èƒ½è´Ÿè´£å‡ ä¸ªåŠŸèƒ½ï¼Œæ˜¯ä¸€ç§é¢å‘SOAæ¶æ„çš„ï¼ŒæœåŠ¡ä¹‹é—´ä¹Ÿæ˜¯é€šè¿‡rpcæ¥äº¤äº’æˆ–è€…æ˜¯webserviceæ¥äº¤äº’çš„ã€‚é€»è¾‘æ¶æ„è®¾è®¡å®Œåå°±è¯¥åšç‰©ç†æ¶æ„è®¾è®¡ï¼Œç³»ç»Ÿåº”ç”¨éƒ¨ç½²åœ¨è¶…è¿‡ä¸€å°æœåŠ¡å™¨æˆ–è™šæ‹Ÿæœºä¸Šï¼Œä¸”å„åˆ†å¼€éƒ¨ç½²çš„éƒ¨åˆ†å½¼æ­¤é€šè¿‡å„ç§é€šè®¯åè®®äº¤äº’ä¿¡æ¯ï¼Œå°±å¯ç®—ä½œåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹çš„å¾®æœåŠ¡è‚¯å®šæ˜¯åˆ†å¸ƒå¼éƒ¨ç½²çš„ï¼Œåˆ†å¸ƒå¼éƒ¨ç½²çš„åº”ç”¨ä¸ä¸€å®šæ˜¯å¾®æœåŠ¡æ¶æ„çš„ï¼Œæ¯”å¦‚é›†ç¾¤éƒ¨ç½²ï¼Œå®ƒæ˜¯æŠŠç›¸åŒåº”ç”¨å¤åˆ¶åˆ°ä¸åŒæœåŠ¡å™¨ä¸Šï¼Œä½†æ˜¯é€»è¾‘åŠŸèƒ½ä¸Šè¿˜æ˜¯å•ä½“åº”ç”¨ã€‚ å¾®æœåŠ¡åˆæ˜¯å•¥? ç®€å•æ¥è¯´å¾®æœåŠ¡å°±æ˜¯å¾ˆå°çš„æœåŠ¡ï¼Œå°åˆ°ä¸€ä¸ªæœåŠ¡åªå¯¹åº”ä¸€ä¸ªå•ä¸€çš„åŠŸèƒ½ï¼Œåªåšä¸€ä»¶äº‹ã€‚ è¿™ä¸ªæœåŠ¡å¯ä»¥å•ç‹¬éƒ¨ç½²è¿è¡Œï¼ŒæœåŠ¡ä¹‹é—´å¯ä»¥é€šè¿‡RPCæ¥ç›¸äº’äº¤äº’ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½æ˜¯ç”±ç‹¬ç«‹çš„å°å›¢é˜Ÿå¼€å‘ï¼Œæµ‹è¯•ï¼Œéƒ¨ç½²ï¼Œä¸Šçº¿ï¼Œè´Ÿè´£å®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚ å¾®æœåŠ¡æ¶æ„åˆåˆæ˜¯å•¥ï¼Ÿ åœ¨åšæ¶æ„è®¾è®¡çš„æ—¶å€™ï¼Œå…ˆåšé€»è¾‘æ¶æ„ï¼Œå†åšç‰©ç†æ¶æ„ï¼Œå½“ä½ æ‹¿åˆ°éœ€æ±‚åï¼Œä¼°ç®—è¿‡æœ€å¤§ç”¨æˆ·é‡å’Œå¹¶å‘é‡åï¼Œè®¡ç®—å•ä¸ªåº”ç”¨æœåŠ¡å™¨èƒ½å¦æ»¡è¶³éœ€æ±‚ã€‚ å¦‚æœç”¨æˆ·é‡åªæœ‰å‡ ç™¾äººçš„å°åº”ç”¨ï¼Œå•ä½“åº”ç”¨å°±èƒ½æå®šï¼Œå³æ‰€æœ‰åº”ç”¨éƒ¨ç½²åœ¨ä¸€ä¸ªåº”ç”¨æœåŠ¡å™¨é‡Œï¼Œå¦‚æœæ˜¯å¾ˆå¤§ç”¨æˆ·é‡ï¼Œä¸”æŸäº›åŠŸèƒ½ä¼šè¢«é¢‘ç¹è®¿é—®ï¼Œæˆ–è€…æŸäº›åŠŸèƒ½è®¡ç®—é‡å¾ˆå¤§ï¼Œå»ºè®®å°†åº”ç”¨æ‹†è§£ä¸ºå¤šä¸ªå­ç³»ç»Ÿï¼Œå„è‡ªè´Ÿè´£å„è‡ªåŠŸèƒ½ï¼Œè¿™å°±æ˜¯å¾®æœåŠ¡æ¶æ„ã€‚ åŒºåˆ« åˆ†å¸ƒå¼æ˜¯æŒ‡å°†ä¸åŒçš„ä¸šåŠ¡åˆ†å¸ƒåœ¨ä¸åŒçš„åœ°æ–¹ã€‚ é›†ç¾¤æŒ‡çš„æ˜¯å°†å‡ å°æœåŠ¡å™¨é›†ä¸­åœ¨ä¸€èµ·ï¼Œå®ç°åŒä¸€ä¸šåŠ¡ã€‚ ç®€å•è¯´ï¼Œåˆ†å¸ƒå¼æ˜¯ä»¥ç¼©çŸ­å•ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æ¥æå‡æ•ˆç‡çš„ï¼Œè€Œé›†ç¾¤åˆ™æ˜¯é€šè¿‡æé«˜å•ä½æ—¶é—´å†…æ‰§è¡Œçš„ä»»åŠ¡æ•°æ¥æå‡æ•ˆç‡ã€‚ å¾®æœåŠ¡ä¸åˆ†å¸ƒå¼çš„ç»†å¾®å·®åˆ«æ˜¯ï¼Œå¾®æœåŠ¡çš„åº”ç”¨ä¸ä¸€å®šæ˜¯åˆ†æ•£åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œä»–ä¹Ÿå¯ä»¥æ˜¯åŒä¸€ä¸ªæœåŠ¡å™¨ã€‚å¾®æœåŠ¡ç›¸æ¯”åˆ†å¸ƒå¼æœåŠ¡æ¥è¯´ï¼Œå®ƒçš„ç²’åº¦æ›´å°ï¼ŒæœåŠ¡ä¹‹é—´è€¦åˆåº¦æ›´ä½ï¼Œç”±äºæ¯ä¸ªå¾®æœåŠ¡éƒ½ç”±ç‹¬ç«‹çš„å°å›¢é˜Ÿè´Ÿè´£ï¼Œå› æ­¤å®ƒæ•æ·æ€§æ›´é«˜ï¼Œåˆ†å¸ƒå¼æœåŠ¡æœ€åéƒ½ä¼šå‘å¾®æœåŠ¡æ¶æ„æ¼”åŒ–ï¼Œè¿™æ˜¯ä¸€ç§è¶‹åŠ¿ï¼Œ ä¸è¿‡æœåŠ¡å¾®æœåŠ¡åŒ–åå¸¦æ¥çš„æŒ‘æˆ˜ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œä¾‹å¦‚æœåŠ¡ç²’åº¦å°ï¼Œæ•°é‡å¤§ï¼ŒåæœŸè¿ç»´å°†ä¼šå¾ˆéš¾ å›¾ç¤º: æ¶æ„çš„æ¼”å˜è¿‡ç¨‹ ä¸‹é¢æˆ‘ä»¬æ¥ç®€å•æ¨¡æ‹Ÿä¸€ä¸ªæ¶æ„æ¼”å˜è¿‡ç¨‹ã€‚ æˆ‘ä»¬ä»¥ javaweb ä¸ºä¾‹ï¼Œæ¥æ­å»ºä¸€ä¸ªç®€å•çš„ç”µå•†ç³»ç»Ÿï¼Œä»è¿™ä¸ªç³»ç»Ÿä¸­æ¥çœ‹ç³»ç»Ÿçš„æ¼”å˜è¿‡ç¨‹ã€‚è¦æ³¨æ„çš„æ˜¯æ¥ä¸‹æ¥çš„æ¼”ç¤ºæ¨¡å‹ï¼Œ å…³æ³¨çš„æ˜¯æ•°æ®é‡ã€è®¿é—®é‡æå‡ï¼Œç½‘ç«™ç»“æ„çš„å˜åŒ–ï¼Œ è€Œä¸å…³æ³¨å…·ä½“ä¸šåŠ¡çš„åŠŸèƒ½ç‚¹ã€‚å…¶æ¬¡ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸ºäº†è®©å¤§å®¶èƒ½æ›´å¥½çš„äº†è§£ç½‘ç«™æ¼”è¿›è¿‡ç¨‹ä¸­çš„ä¸€äº›é—®é¢˜å’Œåº”å¯¹ç­–ç•¥ã€‚ å‡å¦‚æˆ‘ä»¬ç³»ç»Ÿå…·å¤‡ä»¥ä¸‹åŠŸèƒ½: ç”¨æˆ·æ¨¡å—:ç”¨æˆ·æ³¨å†Œå’Œç®¡ç†ã€‚ å•†å“æ¨¡å—:å•†å“å±•ç¤ºå’Œç®¡ç†ã€‚ äº¤æ˜“æ¨¡å—:åˆ›å»ºäº¤æ˜“åŠæ”¯ä»˜ç»“ç®—ã€‚ é˜¶æ®µä¸€ï¼šå•åº”ç”¨æ¶æ„ è¿™ä¸ªé˜¶æ®µæ˜¯ç½‘ç«™çš„åˆæœŸï¼Œä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯äº’è”ç½‘å‘å±•çš„æ—©æœŸï¼Œç³»ç»Ÿæ¶æ„å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚æˆ‘ä»¬ç»å¸¸ä¼šåœ¨å•å°æœåŠ¡å™¨ä¸Šè¿è¡Œæˆ‘ä»¬æ‰€æœ‰çš„ç¨‹åºå’Œè½¯ä»¶ã€‚ æŠŠæ‰€æœ‰è½¯ä»¶å’Œåº”ç”¨éƒ½éƒ¨ç½²åœ¨ä¸€å°æœºå™¨ä¸Šï¼Œè¿™æ ·å°±å®Œæˆä¸€ä¸ªç®€å•ç³»ç»Ÿçš„æ­å»ºï¼Œè¿™ä¸ªé˜¶æ®µçš„è®²ç©¶çš„æ˜¯æ•ˆç‡ã€‚æ•ˆç‡å†³å®šç”Ÿæ­»ã€‚ é˜¶æ®µäºŒï¼šåº”ç”¨æœåŠ¡å™¨å’Œæ•°æ®åº“æœåŠ¡å™¨åˆ†ç¦» éšç€ç½‘ç«™çš„ä¸Šçº¿ï¼Œè®¿é—®é‡é€æ­¥ä¸Šå‡ï¼ŒæœåŠ¡å™¨çš„è´Ÿè½½æ…¢æ…¢æé«˜ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨æœåŠ¡å™¨è¿˜æ²¡æœ‰è¶…è½½çš„æ—¶å€™å°±åšå¥½è§„åˆ’ã€æå‡ç½‘ç«™çš„è´Ÿè½½èƒ½åŠ›ã€‚å‡è‹¥æ­¤æ—¶å·²ç»æ²¡åŠæ³•åœ¨ä»£ç å±‚é¢ç»§ç»­ä¼˜åŒ–æé«˜ï¼Œé‚£ä¹ˆåœ¨å•å°æœºå™¨çš„æ€§èƒ½é‡åˆ°ç“¶é¢ˆçš„æ—¶å€™ï¼Œå¢åŠ æœºå™¨æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•å¥½ç”¨çš„æ–¹å¼ï¼ŒæŠ•å…¥äº§å‡ºæ¯”ç›¸å½“é«˜ã€‚è¿™ä¸ªé˜¶æ®µå¢åŠ æœºå™¨çš„ä¸»è¦ç›®çš„æ˜¯å°† web æœåŠ¡å™¨å’Œ æ•°æ®åº“æœåŠ¡å™¨æ‹†åˆ†å¼€æ¥ï¼Œè¿™æ ·åšçš„è¯ä¸ä»…æé«˜äº†å•æœºçš„è´Ÿè½½èƒ½åŠ›ï¼Œä¹Ÿæé«˜äº†æ•´ä¸ªç³»ç»Ÿçš„å®¹ç¾èƒ½åŠ›ã€‚ è¿™ä¸ªé˜¶æ®µçš„ç³»ç»Ÿæ¶æ„å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåº”ç”¨æœåŠ¡å™¨å’Œæ•°æ®åº“æœåŠ¡å™¨å®Œå…¨éš”ç¦»å¼€æ¥ï¼Œç›¸äº’äº’ä¸å½±å“ï¼Œå¤§å¤§å‡å°‘äº†ç½‘ç«™å®•æœºçš„é£é™©ï¼Œæ­¤é˜¶æ®µæˆ‘ä»¬å·²ç»å¼€å§‹å…³æ³¨åˆ°åº”ç”¨æœåŠ¡å™¨çš„ç®¡ç†äº†ã€‚ é˜¶æ®µä¸‰ï¼šåº”ç”¨æœåŠ¡å™¨é›†ç¾¤ è¿™ä¸ªé˜¶æ®µï¼Œéšç€è®¿é—®é‡çš„ç»§ç»­ä¸æ–­å¢åŠ ï¼Œå•å°åº”ç”¨æœåŠ¡å™¨å·²ç»æ— æ³•æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚ å‡è®¾æˆ‘çš„æ•°æ®åº“æœåŠ¡å™¨è¿˜æ²¡æœ‰é‡åˆ°æ€§èƒ½é—®é¢˜ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡å¢åŠ åº”ç”¨æœåŠ¡å™¨çš„æ–¹å¼æ¥å°†åº”ç”¨æœåŠ¡å™¨é›†ç¾¤åŒ–ï¼Œè¿™æ ·å°±å¯ä»¥å°†ç”¨æˆ·è¯·æ±‚åˆ†æµåˆ°å„ä¸ªæœåŠ¡å™¨ä¸­ï¼Œä»è€Œè¾¾åˆ°ç»§ç»­æå‡ç³»ç»Ÿè´Ÿè½½èƒ½åŠ›çš„ç›®çš„ã€‚æ­¤æ—¶å„ä¸ªåº”ç”¨æœåŠ¡å™¨ä¹‹é—´æ²¡æœ‰ç›´æ¥çš„äº¤äº’ï¼Œä»–ä»¬éƒ½æ˜¯ä¾èµ–æ•°æ®åº“å„è‡ªå¯¹å¤–æä¾›æœåŠ¡ã€‚ ç³»ç»Ÿæ¶æ„å‘å±•åˆ°è¿™ä¸ªé˜¶æ®µï¼Œå„ç§é—®é¢˜ä¹Ÿä¼šæ¥è¸µè€Œè‡³ï¼š ç”¨æˆ·è¯·æ±‚äº¤ç”±è°æ¥è½¬å‘åˆ°å…·ä½“çš„åº”ç”¨æœåŠ¡å™¨ä¸Š(è°æ¥è´Ÿè´£è´Ÿè½½å‡è¡¡) ç”¨æˆ·å¦‚æœæ¯æ¬¡è®¿é—®åˆ°çš„æœåŠ¡å™¨ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå¦‚ä½•ç»´æŠ¤sessionï¼Œè¾¾åˆ°sessionå…±äº«çš„ç›®çš„ã€‚ é‚£ä¹ˆæ­¤æ—¶ï¼Œç³»ç»Ÿæ¶æ„åˆä¼šå˜æˆå¦‚ä¸‹æ–¹å¼ï¼š è´Ÿè½½å‡è¡¡åˆå¯ä»¥åˆ†ä¸ºè½¯è´Ÿè½½å’Œç¡¬è´Ÿè½½ã€‚è½¯è´Ÿè½½æˆ‘ä»¬å¯ä»¥é€‰æ‹©Nginxã€Apacheç­‰ï¼Œç¡¬è´Ÿè½½æˆ‘ä»¬å¯ä»¥é€‰æ‹©F5ç­‰ã€‚è€Œsessionå…±äº«é—®é¢˜æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®tomcatçš„sessionå…±äº«è§£å†³ã€‚ é˜¶æ®µå››ï¼šæ•°æ®åº“å‹åŠ›å˜å¤§ï¼Œæ•°æ®åº“è¯»å†™åˆ†ç¦» æ¶æ„æ¼”å˜åˆ°ä¸Šé¢çš„é˜¶æ®µï¼Œå¹¶ä¸æ˜¯ç»ˆç‚¹ã€‚é€šè¿‡ä¸Šé¢çš„è®¾è®¡ï¼Œåº”ç”¨å±‚çš„æ€§èƒ½è¢«æˆ‘ä»¬æ‹‰ä¸Šæ¥äº†ï¼Œ ä½†æ•°æ®åº“çš„è´Ÿè½½ä¹Ÿåœ¨é€æ¸å¢å¤§ï¼Œé‚£å¦‚ä½•å»æé«˜æ•°æ®åº“å±‚é¢çš„æ€§èƒ½å‘¢ï¼Ÿæœ‰äº†å‰é¢çš„è®¾è®¡æ€è·¯ä»¥åï¼Œæˆ‘ä»¬è‡ªç„¶ä¹Ÿä¼šæƒ³åˆ°é€šè¿‡å¢åŠ æœåŠ¡å™¨æ¥æé«˜æ€§èƒ½ã€‚ä½†å‡å¦‚æˆ‘ä»¬å•çº¯çš„æŠŠæ•°æ®åº“ä¸€åˆ†ä¸ºäºŒï¼Œç„¶åå¯¹äºæ•°æ®åº“çš„è¯·æ±‚ï¼Œåˆ†åˆ«è´Ÿè½½åˆ°ä¸¤å°æ•°æ®åº“æœåŠ¡å™¨ä¸Šï¼Œé‚£å¿…å®šä¼šé€ æˆæ•°æ®åº“æ•°æ®ä¸ç»Ÿä¸€çš„é—®é¢˜ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å…ˆè€ƒè™‘å°†æ•°æ®åº“è¯»å†™åˆ†ç¦»ã€‚ è¿™ä¸ªæ¶æ„è®¾è®¡çš„å˜åŒ–ä¼šå¸¦æ¥å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š ä¸»ä»æ•°æ®åº“ä¹‹é—´çš„æ•°æ®éœ€è¦åŒæ­¥(å¯ä»¥ä½¿ç”¨ mysql è‡ªå¸¦çš„ master-slave æ–¹å¼å®ç°ä¸»ä»å¤åˆ¶ ) åº”ç”¨ä¸­éœ€è¦æ ¹æ®ä¸šåŠ¡è¿›è¡Œå¯¹åº”æ•°æ®æºçš„é€‰æ‹©( é‡‡ç”¨ç¬¬ä¸‰æ–¹æ•°æ®åº“ä¸­é—´ä»¶ï¼Œä¾‹å¦‚ mycat ) é˜¶æ®µäº”ï¼šä½¿ç”¨æœç´¢å¼•æ“ç¼“è§£è¯»åº“çš„å‹åŠ› æˆ‘ä»¬éƒ½çŸ¥é“æ•°æ®åº“å¸¸å¸¸å¯¹æ¨¡ç³ŠæŸ¥æ‰¾æ•ˆç‡ä¸æ˜¯å¾ˆé«˜ï¼Œåƒç”µå•†ç±»çš„ç½‘ç«™ï¼Œæœç´¢æ˜¯éå¸¸æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œå³ä½¿æ˜¯åšäº†è¯»å†™åˆ†ç¦»ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿä¸èƒ½å¾—åˆ°æœ‰æ•ˆè§£å†³ã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦å¼•å…¥æœç´¢å¼•æ“äº†ï¼Œä½¿ç”¨æœç´¢å¼•æ“èƒ½å¤Ÿå¤§å¤§æå‡æˆ‘ä»¬ç³»ç»Ÿçš„æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†åŒæ—¶ä¹Ÿä¼šå¸¦æ¥ä¸€ äº›é™„åŠ çš„é—®é¢˜ï¼Œæ¯”å¦‚ç»´æŠ¤ç´¢å¼•çš„æ„å»ºã€æ•°æ®åŒæ­¥åˆ°æœç´¢å¼•æ“ç­‰ã€‚ é˜¶æ®µå…­ï¼šå¼•å…¥ç¼“å­˜æœºåˆ¶ç¼“è§£æ•°æ®åº“çš„å‹åŠ› ç„¶åï¼Œéšç€è®¿é—®é‡çš„æŒç»­ä¸æ–­å¢åŠ ï¼Œé€æ¸ä¼šå‡ºç°è®¸å¤šç”¨æˆ·è®¿é—®åŒä¸€å†…å®¹çš„æƒ…å†µï¼Œé‚£ä¹ˆå¯¹äºè¿™äº›çƒ­ç‚¹æ•°æ®ï¼Œæ²¡å¿…è¦æ¯æ¬¡éƒ½ä»æ•°æ®åº“é‡è¯»å–ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ°ç¼“å­˜æŠ€æœ¯ï¼Œæ¯”å¦‚ redisã€memcache æ¥ä½œä¸ºæˆ‘ä»¬åº”ç”¨å±‚çš„ç¼“å­˜ã€‚å¦å¤–åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå¦‚æˆ‘ä»¬å¯¹ç”¨æˆ·çš„æŸäº› IP çš„è®¿é—®é¢‘ç‡åšé™åˆ¶ï¼Œ é‚£è¿™ä¸ªæ”¾å†…å­˜ä¸­å°±åˆä¸åˆé€‚ï¼Œæ”¾æ•°æ®åº“åˆå¤ªéº»çƒ¦äº†ï¼Œé‚£è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨ Nosql çš„æ–¹å¼æ¯”å¦‚ mongDB æ¥ä»£æ›¿ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ã€‚ é˜¶æ®µä¸ƒï¼šæ•°æ®åº“çš„æ°´å¹³/å‚ç›´æ‹†åˆ† æˆ‘ä»¬çš„ç½‘ç«™æ¼”è¿›çš„å˜åŒ–è¿‡ç¨‹ï¼Œäº¤æ˜“ã€å•†å“ã€ç”¨æˆ·çš„æ•°æ®éƒ½è¿˜åœ¨åŒä¸€ ä¸ªæ•°æ®åº“ä¸­ï¼Œå°½ç®¡é‡‡å–äº†å¢åŠ ç¼“å­˜ï¼Œè¯»å†™åˆ†ç¦»çš„æ–¹å¼ï¼Œä½†æ˜¯éšç€æ•° æ®åº“çš„å‹åŠ›æŒç»­å¢åŠ ï¼Œæ•°æ®åº“çš„ç“¶é¢ˆä»ç„¶æ˜¯ä¸ªæœ€å¤§çš„é—®é¢˜ã€‚å› æ­¤æˆ‘ ä»¬å¯ä»¥è€ƒè™‘å¯¹æ•°æ®çš„å‚ç›´æ‹†åˆ†å’Œæ°´å¹³æ‹†åˆ†ã€‚ å‚ç›´æ‹†åˆ†:æŠŠæ•°æ®åº“ä¸­ä¸åŒä¸šåŠ¡æ•°æ®æ‹†åˆ†åˆ°ä¸åŒçš„æ•°æ®åº“ã€‚ æ°´å¹³æ‹†åˆ†:æŠŠåŒä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®æ‹†åˆ†åˆ°ä¸¤ä¸ªç”šè‡³æ›´å¤šçš„æ•°æ®åº“ä¸­ï¼Œæ°´å¹³æ‹†åˆ†çš„åŸå› æ˜¯æŸäº›ä¸šåŠ¡æ•°æ®é‡å·²ç»è¾¾åˆ°äº†å•ä¸ªæ•°æ®åº“çš„ç“¶é¢ˆï¼Œè¿™æ—¶å¯ä»¥é‡‡å–å°†è¡¨æ‹†åˆ†åˆ°å¤šä¸ªæ•°æ®åº“ä¸­ã€‚ é˜¶æ®µå…«ï¼šåº”ç”¨çš„æ‹†åˆ† éšç€ä¸šåŠ¡çš„å‘å±•ï¼Œä¸šåŠ¡é‡è¶Šæ¥è¶Šå¤§ï¼Œåº”ç”¨çš„å‹åŠ›è¶Šæ¥è¶Šå¤§ã€‚å·¥ç¨‹è§„æ¨¡ä¹Ÿè¶Šæ¥è¶Šåºå¤§ã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥è€ƒè™‘å°†åº”ç”¨æ‹†åˆ†ï¼ŒæŒ‰ç…§é¢†åŸŸæ¨¡å‹å°†æˆ‘ä»¬çš„ç”¨æˆ·ã€å•†å“ã€äº¤æ˜“æ‹†åˆ†æˆå¤šä¸ªå­ç³»ç»Ÿã€‚ è¿™æ ·æ‹†åˆ†ä»¥åï¼Œå¯èƒ½ä¼šæœ‰ä¸€äº›ç›¸åŒçš„ä»£ç ï¼Œæ¯”å¦‚ç”¨æˆ·æ“ä½œï¼Œåœ¨å•†å“å’Œäº¤æ˜“éƒ½éœ€è¦æŸ¥è¯¢ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æ¯ä¸ªç³»ç»Ÿéƒ½ä¼šæœ‰ç”¨æˆ·æŸ¥è¯¢è®¿é—®ç›¸å…³æ“ä½œã€‚è¿™äº›ç›¸åŒçš„æ“ä½œä¸€å®šæ˜¯è¦æŠ½è±¡å‡ºæ¥ï¼Œå¦åˆ™å°±æ˜¯ä¸€ä¸ªå‘ã€‚æ‰€ä»¥é€šè¿‡èµ°æœåŠ¡åŒ–è·¯çº¿çš„æ–¹å¼æ¥è§£å†³ã€‚ é‚£ä¹ˆæœåŠ¡æ‹†åˆ†ä»¥åï¼Œå„ä¸ªæœåŠ¡ä¹‹é—´å¦‚ä½•è¿›è¡Œè¿œç¨‹é€šä¿¡å‘¢? é€šè¿‡ RPC æŠ€æœ¯ï¼Œæ¯”è¾ƒå…¸å‹çš„æœ‰:dubboã€webserviceã€hessianã€httpã€RMI ç­‰ç­‰ã€‚å‰æœŸé€šè¿‡è¿™äº›æŠ€æœ¯èƒ½å¤Ÿå¾ˆå¥½çš„è§£å†³å„ä¸ªæœåŠ¡ä¹‹é—´é€šä¿¡é—®é¢˜ï¼Œä½†æ˜¯ï¼Œ äº’è”ç½‘çš„å‘å±•æ˜¯æŒç»­çš„ï¼Œæ‰€ä»¥æ¶æ„çš„æ¼”å˜å’Œä¼˜åŒ–ä¹Ÿè¿˜åœ¨æŒç»­ã€‚ è½¬è‡ª:é¢†æ‚Ÿ.æµ·æ´‹-åˆ†å¸ƒå¼æ¶æ„çš„æ€»ç»“ CAPç†è®ºæ¦‚è¿° ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰å’Œåˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰è¿™ä¸‰é¡¹ä¸­çš„ä¸¤é¡¹ã€‚ CAPçš„å®šä¹‰ Consistency ä¸€è‡´æ€§ ä¸€è‡´æ€§æŒ‡â€œall nodes see the same data at the same timeâ€ï¼Œå³æ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çš„æ•°æ®å®Œå…¨ä¸€è‡´ã€‚ ä¸€è‡´æ€§æ˜¯å› ä¸ºå¤šä¸ªæ•°æ®æ‹·è´ä¸‹å¹¶å‘è¯»å†™æ‰æœ‰çš„é—®é¢˜ï¼Œå› æ­¤ç†è§£æ—¶ä¸€å®šè¦æ³¨æ„ç»“åˆè€ƒè™‘å¤šä¸ªæ•°æ®æ‹·è´ä¸‹å¹¶å‘è¯»å†™çš„åœºæ™¯ã€‚ å¯¹äºä¸€è‡´æ€§ï¼Œå¯ä»¥åˆ†ä¸ºä»å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸¤ä¸ªä¸åŒçš„è§†è§’ã€‚ å®¢æˆ·ç«¯ ä»å®¢æˆ·ç«¯æ¥çœ‹ï¼Œä¸€è‡´æ€§ä¸»è¦æŒ‡çš„æ˜¯å¤šå¹¶å‘è®¿é—®æ—¶æ›´æ–°è¿‡çš„æ•°æ®å¦‚ä½•è·å–çš„é—®é¢˜ã€‚ æœåŠ¡ç«¯ ä»æœåŠ¡ç«¯æ¥çœ‹ï¼Œåˆ™æ˜¯æ›´æ–°å¦‚ä½•åˆ†å¸ƒåˆ°æ•´ä¸ªç³»ç»Ÿï¼Œä»¥ä¿è¯æ•°æ®æœ€ç»ˆä¸€è‡´ã€‚ å¯¹äºä¸€è‡´æ€§ï¼Œå¯ä»¥åˆ†ä¸ºå¼º/å¼±/æœ€ç»ˆä¸€è‡´æ€§ä¸‰ç±» ä»å®¢æˆ·ç«¯è§’åº¦ï¼Œå¤šè¿›ç¨‹å¹¶å‘è®¿é—®æ—¶ï¼Œæ›´æ–°è¿‡çš„æ•°æ®åœ¨ä¸åŒè¿›ç¨‹å¦‚ä½•è·å–çš„ä¸åŒç­–ç•¥ï¼Œå†³å®šäº†ä¸åŒçš„ä¸€è‡´æ€§ã€‚ å¼ºä¸€è‡´æ€§ å¯¹äºå…³ç³»å‹æ•°æ®åº“ï¼Œè¦æ±‚æ›´æ–°è¿‡çš„æ•°æ®èƒ½è¢«åç»­çš„è®¿é—®éƒ½èƒ½çœ‹åˆ°ï¼Œè¿™æ˜¯å¼ºä¸€è‡´æ€§ã€‚ å¼±ä¸€è‡´æ€§ å¦‚æœèƒ½å®¹å¿åç»­çš„éƒ¨åˆ†æˆ–è€…å…¨éƒ¨è®¿é—®ä¸åˆ°ï¼Œåˆ™æ˜¯å¼±ä¸€è‡´æ€§ã€‚ æœ€ç»ˆä¸€è‡´æ€§ å¦‚æœç»è¿‡ä¸€æ®µæ—¶é—´åè¦æ±‚èƒ½è®¿é—®åˆ°æ›´æ–°åçš„æ•°æ®ï¼Œåˆ™æ˜¯æœ€ç»ˆä¸€è‡´æ€§ã€‚ Availability å¯ç”¨æ€§ å¯ç”¨æ€§æŒ‡â€œReads and writes always succeedâ€ï¼Œå³æœåŠ¡åœ¨æ­£å¸¸å“åº”æ—¶é—´å†…ä¸€ç›´å¯ç”¨ã€‚ å¥½çš„å¯ç”¨æ€§ä¸»è¦æ˜¯æŒ‡ç³»ç»Ÿèƒ½å¤Ÿå¾ˆå¥½çš„ä¸ºç”¨æˆ·æœåŠ¡ï¼Œä¸å‡ºç°ç”¨æˆ·æ“ä½œå¤±è´¥æˆ–è€…è®¿é—®è¶…æ—¶ç­‰ç”¨æˆ·ä½“éªŒä¸å¥½çš„æƒ…å†µã€‚å¯ç”¨æ€§é€šå¸¸æƒ…å†µä¸‹å¯ç”¨æ€§å’Œåˆ†å¸ƒå¼æ•°æ®å†—ä½™ï¼Œè´Ÿè½½å‡è¡¡ç­‰æœ‰ç€å¾ˆå¤§çš„å…³è”ã€‚ Partition Toleranceåˆ†åŒºå®¹é”™æ€§ åˆ†åŒºå®¹é”™æ€§æŒ‡â€œthe system continues to operate despite arbitrary message loss or failure of part of the systemâ€ï¼Œå³åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°æŸèŠ‚ç‚¹æˆ–ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§æˆ–å¯ç”¨æ€§çš„æœåŠ¡ã€‚ CAPçš„è¯æ˜ ä¸Šå›¾æ˜¯æˆ‘ä»¬è¯æ˜CAPçš„åŸºæœ¬åœºæ™¯ï¼Œç½‘ç»œä¸­æœ‰ä¸¤ä¸ªèŠ‚ç‚¹N1å’ŒN2ï¼Œå¯ä»¥ç®€å•çš„ç†è§£N1å’ŒN2åˆ†åˆ«æ˜¯ä¸¤å°è®¡ç®—æœºï¼Œä»–ä»¬ä¹‹é—´ç½‘ç»œå¯ä»¥è¿é€šï¼ŒN1ä¸­æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºAï¼Œå’Œä¸€ä¸ªæ•°æ®åº“Vï¼ŒN2ä¹Ÿæœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºB2å’Œä¸€ä¸ªæ•°æ®åº“Vã€‚ç°åœ¨ï¼ŒAå’ŒBæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸¤ä¸ªéƒ¨åˆ†ï¼ŒVæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ•°æ®å­˜å‚¨çš„ä¸¤ä¸ªå­æ•°æ®åº“ã€‚ åœ¨æ»¡è¶³ä¸€è‡´æ€§çš„æ—¶å€™ï¼ŒN1å’ŒN2ä¸­çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼ŒV0=V0ã€‚åœ¨æ»¡è¶³å¯ç”¨æ€§çš„æ—¶å€™ï¼Œç”¨æˆ·ä¸ç®¡æ˜¯è¯·æ±‚N1æˆ–è€…N2ï¼Œéƒ½ä¼šå¾—åˆ°ç«‹å³å“åº”ã€‚åœ¨æ»¡è¶³åˆ†åŒºå®¹é”™æ€§çš„æƒ…å†µä¸‹ï¼ŒN1å’ŒN2æœ‰ä»»ä½•ä¸€æ–¹å®•æœºï¼Œæˆ–è€…ç½‘ç»œä¸é€šçš„æ—¶å€™ï¼Œéƒ½ä¸ä¼šå½±å“N1å’ŒN2å½¼æ­¤ä¹‹é—´çš„æ­£å¸¸è¿ä½œã€‚ ä¸Šå›¾æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæ­£å¸¸è¿è½¬çš„æµç¨‹ï¼Œç”¨æˆ·å‘N1æœºå™¨è¯·æ±‚æ•°æ®æ›´æ–°ï¼Œç¨‹åºAæ›´æ–°æ•°æ®åº“Voä¸ºV1ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå°†æ•°æ®è¿›è¡ŒåŒæ­¥æ“ä½œMï¼Œå°†V1åŒæ­¥çš„N2ä¸­V0ï¼Œä½¿å¾—N2ä¸­çš„æ•°æ®V0ä¹Ÿæ›´æ–°ä¸ºV1ï¼ŒN2ä¸­çš„æ•°æ®å†å“åº”N2çš„è¯·æ±‚ã€‚ è¿™é‡Œï¼Œå¯ä»¥å®šä¹‰N1å’ŒN2çš„æ•°æ®åº“Vä¹‹é—´çš„æ•°æ®æ˜¯å¦ä¸€æ ·ä¸ºä¸€è‡´æ€§ï¼›å¤–éƒ¨å¯¹N1å’ŒN2çš„è¯·æ±‚å“åº”ä¸ºå¯ç”¨æ€§ï¼›N1å’ŒN2ä¹‹é—´çš„ç½‘ç»œç¯å¢ƒä¸ºåˆ†åŒºå®¹é”™æ€§ã€‚ è¿™æ˜¯æ­£å¸¸è¿ä½œçš„åœºæ™¯ï¼Œä¹Ÿæ˜¯ç†æƒ³çš„åœºæ™¯ï¼Œç„¶è€Œç°å®æ˜¯æ®‹é…·çš„ï¼Œå½“é”™è¯¯å‘ç”Ÿçš„æ—¶å€™ï¼Œä¸€è‡´æ€§å’Œå¯ç”¨æ€§è¿˜æœ‰åˆ†åŒºå®¹é”™æ€§ï¼Œæ˜¯å¦èƒ½åŒæ—¶æ»¡è¶³ï¼Œè¿˜æ˜¯è¯´è¦è¿›è¡Œå–èˆå‘¢ï¼Ÿ ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå®ƒå’Œå•æœºç³»ç»Ÿçš„æœ€å¤§åŒºåˆ«ï¼Œå°±åœ¨äºç½‘ç»œï¼Œç°åœ¨å‡è®¾ä¸€ç§æç«¯æƒ…å†µï¼ŒN1å’ŒN2ä¹‹é—´çš„ç½‘ç»œæ–­å¼€äº†ï¼Œæˆ‘ä»¬è¦æ”¯æŒè¿™ç§ç½‘ç»œå¼‚å¸¸ï¼Œç›¸å½“äºè¦æ»¡è¶³åˆ†åŒºå®¹é”™æ€§ï¼Œèƒ½ä¸èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§å’Œå“åº”æ€§å‘¢ï¼Ÿè¿˜æ˜¯è¯´è¦å¯¹ä»–ä»¬è¿›è¡Œå–èˆã€‚ å‡è®¾åœ¨N1å’ŒN2ä¹‹é—´ç½‘ç»œæ–­å¼€çš„æ—¶å€™ï¼Œæœ‰ç”¨æˆ·å‘N1å‘é€æ•°æ®æ›´æ–°è¯·æ±‚ï¼Œé‚£N1ä¸­çš„æ•°æ®V0å°†è¢«æ›´æ–°ä¸ºV1ï¼Œç”±äºç½‘ç»œæ˜¯æ–­å¼€çš„ï¼Œæ‰€ä»¥åˆ†å¸ƒå¼ç³»ç»ŸåŒæ­¥æ“ä½œMï¼Œæ‰€ä»¥N2ä¸­çš„æ•°æ®ä¾æ—§æ˜¯V0ï¼›è¿™ä¸ªæ—¶å€™ï¼Œæœ‰ç”¨æˆ·å‘N2å‘é€æ•°æ®è¯»å–è¯·æ±‚ï¼Œç”±äºæ•°æ®è¿˜æ²¡æœ‰è¿›è¡ŒåŒæ­¥ï¼Œåº”ç”¨ç¨‹åºæ²¡åŠæ³•ç«‹å³ç»™ç”¨æˆ·è¿”å›æœ€æ–°çš„æ•°æ®V1ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿ æœ‰äºŒç§é€‰æ‹©ï¼Œç¬¬ä¸€ï¼Œç‰ºç‰²æ•°æ®ä¸€è‡´æ€§ï¼Œå“åº”æ—§çš„æ•°æ®V0ç»™ç”¨æˆ·ï¼›ç¬¬äºŒï¼Œç‰ºç‰²å¯ç”¨æ€§ï¼Œé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°ç½‘ç»œè¿æ¥æ¢å¤ï¼Œæ•°æ®æ›´æ–°æ“ä½œMå®Œæˆä¹‹åï¼Œå†ç»™ç”¨æˆ·å“åº”æœ€æ–°çš„æ•°æ®V1ã€‚ è¿™ä¸ªè¿‡ç¨‹ï¼Œè¯æ˜äº†è¦æ»¡è¶³åˆ†åŒºå®¹é”™æ€§çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåªèƒ½åœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ä¸¤è€…ä¸­ï¼Œé€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚ CAPæƒè¡¡ é€šè¿‡CAPç†è®ºï¼Œæˆ‘ä»¬çŸ¥é“æ— æ³•åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªç‰¹æ€§ï¼Œé‚£è¦èˆå¼ƒå“ªä¸ªå‘¢ï¼Ÿ CA without Pï¼šå¦‚æœä¸è¦æ±‚Pï¼ˆä¸å…è®¸åˆ†åŒºï¼‰ï¼Œåˆ™Cï¼ˆå¼ºä¸€è‡´æ€§ï¼‰å’ŒAï¼ˆå¯ç”¨æ€§ï¼‰æ˜¯å¯ä»¥ä¿è¯çš„ã€‚ä½†å…¶å®åˆ†åŒºä¸æ˜¯ä½ æƒ³ä¸æƒ³çš„é—®é¢˜ï¼Œè€Œæ˜¯å§‹ç»ˆä¼šå­˜åœ¨ï¼Œå› æ­¤CAçš„ç³»ç»Ÿæ›´å¤šçš„æ˜¯å…è®¸åˆ†åŒºåå„å­ç³»ç»Ÿä¾ç„¶ä¿æŒCAã€‚ CP without Aï¼šå¦‚æœä¸è¦æ±‚Aï¼ˆå¯ç”¨ï¼‰ï¼Œç›¸å½“äºæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦åœ¨Serverä¹‹é—´å¼ºä¸€è‡´ï¼Œè€ŒPï¼ˆåˆ†åŒºï¼‰ä¼šå¯¼è‡´åŒæ­¥æ—¶é—´æ— é™å»¶é•¿ï¼Œå¦‚æ­¤CPä¹Ÿæ˜¯å¯ä»¥ä¿è¯çš„ã€‚å¾ˆå¤šä¼ ç»Ÿçš„æ•°æ®åº“åˆ†å¸ƒå¼äº‹åŠ¡éƒ½å±äºè¿™ç§æ¨¡å¼ã€‚ AP wihtout Cï¼šè¦é«˜å¯ç”¨å¹¶å…è®¸åˆ†åŒºï¼Œåˆ™éœ€æ”¾å¼ƒä¸€è‡´æ€§ã€‚ä¸€æ—¦åˆ†åŒºå‘ç”Ÿï¼ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½ä¼šå¤±å»è”ç³»ï¼Œä¸ºäº†é«˜å¯ç”¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªèƒ½ç”¨æœ¬åœ°æ•°æ®æä¾›æœåŠ¡ï¼Œè€Œè¿™æ ·ä¼šå¯¼è‡´å…¨å±€æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚ç°åœ¨ä¼—å¤šçš„NoSQLéƒ½å±äºæ­¤ç±»ã€‚ å¯¹äºå¤šæ•°å¤§å‹äº’è”ç½‘åº”ç”¨çš„åœºæ™¯ï¼Œä¸»æœºä¼—å¤šã€éƒ¨ç½²åˆ†æ•£ï¼Œè€Œä¸”ç°åœ¨çš„é›†ç¾¤è§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œæ‰€ä»¥èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œæ•…éšœæ˜¯å¸¸æ€ï¼Œè€Œä¸”è¦ä¿è¯æœåŠ¡å¯ç”¨æ€§è¾¾åˆ°Nä¸ª9ï¼Œå³ä¿è¯På’ŒAï¼Œèˆå¼ƒCï¼ˆé€€è€Œæ±‚å…¶æ¬¡ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼‰ã€‚è™½ç„¶æŸäº›åœ°æ–¹ä¼šå½±å“å®¢æˆ·ä½“éªŒï¼Œä½†æ²¡è¾¾åˆ°é€ æˆç”¨æˆ·æµç¨‹çš„ä¸¥é‡ç¨‹åº¦ã€‚ å¯¹äºæ¶‰åŠåˆ°é’±è´¢è¿™æ ·ä¸èƒ½æœ‰ä¸€ä¸è®©æ­¥çš„åœºæ™¯ï¼ŒCå¿…é¡»ä¿è¯ã€‚ç½‘ç»œå‘ç”Ÿæ•…éšœå®å¯åœæ­¢æœåŠ¡ï¼Œè¿™æ˜¯ä¿è¯CAï¼Œèˆå¼ƒPã€‚è²Œä¼¼è¿™å‡ å¹´å›½å†…é“¶è¡Œä¸šå‘ç”Ÿäº†ä¸ä¸‹10èµ·äº‹æ•…ï¼Œä½†å½±å“é¢ä¸å¤§ï¼ŒæŠ¥é“ä¹Ÿä¸å¤šï¼Œå¹¿å¤§ç¾¤ä¼—çŸ¥é“çš„å°‘ã€‚è¿˜æœ‰ä¸€ç§æ˜¯ä¿è¯CPï¼Œèˆå¼ƒAã€‚ä¾‹å¦‚ç½‘ç»œæ•…éšœäº‹åªè¯»ä¸å†™ã€‚ å­°ä¼˜å­°ç•¥ï¼Œæ²¡æœ‰å®šè®ºï¼Œåªèƒ½æ ¹æ®åœºæ™¯å®šå¤ºï¼Œé€‚åˆçš„æ‰æ˜¯æœ€å¥½çš„ã€‚ ","link":"http://blog.ludangxin.club/post/fen-bu-shi-ji-qun-wei-fu-wu/"},{"title":"SpringBoot é›†æˆ è¡¨å•éªŒè¯ å’Œ å¼‚å¸¸ç»Ÿä¸€å¤„ç†","content":"è¡¨å•éªŒè¯æ³¨è§£æ¸…å• æ³¨è§£ è¯´æ˜ @Null é™åˆ¶åªèƒ½ä¸ºnull @NotNull é™åˆ¶å¿…é¡»ä¸ä¸ºnull @AssertFalse é™åˆ¶å¿…é¡»ä¸ºfalse @AssertTrue é™åˆ¶å¿…é¡»ä¸ºtrue @DecimalMax(value) é™åˆ¶å¿…é¡»ä¸ºä¸€ä¸ªä¸å¤§äºæŒ‡å®šå€¼çš„æ•°å­— @DecimalMin(value) é™åˆ¶å¿…é¡»ä¸ºä¸€ä¸ªä¸å°äºæŒ‡å®šå€¼çš„æ•°å­— @Digits(integer,fraction) é™åˆ¶å¿…é¡»ä¸ºä¸€ä¸ªå°æ•°ï¼Œä¸”æ•´æ•°éƒ¨åˆ†çš„ä½æ•°ä¸èƒ½è¶…è¿‡integerï¼Œå°æ•°éƒ¨åˆ†çš„ä½æ•°ä¸èƒ½è¶…è¿‡fraction @Future é™åˆ¶å¿…é¡»æ˜¯ä¸€ä¸ªå°†æ¥çš„æ—¥æœŸ @Max(value) é™åˆ¶å¿…é¡»ä¸ºä¸€ä¸ªä¸å¤§äºæŒ‡å®šå€¼çš„æ•°å­— @Min(value) é™åˆ¶å¿…é¡»ä¸ºä¸€ä¸ªä¸å°äºæŒ‡å®šå€¼çš„æ•°å­— @Past é™åˆ¶å¿…é¡»æ˜¯ä¸€ä¸ªè¿‡å»çš„æ—¥æœŸ @Pattern(value) é™åˆ¶å¿…é¡»ç¬¦åˆæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ @Size(max,min) é™åˆ¶å­—ç¬¦é•¿åº¦å¿…é¡»åœ¨minåˆ°maxä¹‹é—´ @Past éªŒè¯æ³¨è§£çš„å…ƒç´ å€¼ï¼ˆæ—¥æœŸç±»å‹ï¼‰æ¯”å½“å‰æ—¶é—´æ—© @NotEmpty éªŒè¯æ³¨è§£çš„å…ƒç´ å€¼ä¸ä¸ºnullä¸”ä¸ä¸ºç©ºï¼ˆå­—ç¬¦ä¸²é•¿åº¦ä¸ä¸º0ã€é›†åˆå¤§å°ä¸ä¸º0ï¼‰ @NotBlank éªŒè¯æ³¨è§£çš„å…ƒç´ å€¼ä¸ä¸ºç©ºï¼ˆä¸ä¸ºnullã€å»é™¤é¦–ä½ç©ºæ ¼åé•¿åº¦ä¸º0ï¼‰ï¼Œä¸åŒäº@NotEmptyï¼Œ@NotBlank @Email éªŒè¯æ³¨è§£çš„å…ƒç´ å€¼æ˜¯Emailï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å’ŒflagæŒ‡å®šè‡ªå®šä¹‰çš„emailæ ¼å¼ é¡¹ç›®ç»“æ„å›¾ç¤º å¼•å…¥æ‰€éœ€ä¾èµ– &lt;!-- SpringBoot Webå®¹å™¨ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- è¡¨å•éªŒè¯ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-validation&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- lombok --&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; åˆ›å»ºValidatoré…ç½®ç±» import lombok.extern.slf4j.Slf4j; import org.hibernate.validator.HibernateValidator; import org.springframework.boot.autoconfigure.EnableAutoConfiguration; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.validation.beanvalidation.MethodValidationPostProcessor; import javax.validation.Validation; import javax.validation.Validator; import javax.validation.ValidatorFactory; /** * é…ç½® Hibernate å‚æ•°æ ¡éªŒ * @author ludangxin */ @Slf4j @Configuration @EnableAutoConfiguration public class ValidatorConfig { @Bean public MethodValidationPostProcessor methodValidationPostProcessor() { MethodValidationPostProcessor postProcessor = new MethodValidationPostProcessor(); //å¿«é€Ÿæ ¡éªŒï¼Œåªè¦æœ‰é”™é©¬ä¸Šè¿”å› postProcessor.setValidator(validator()); return postProcessor; } @Bean public Validator validator(){ ValidatorFactory validatorFactory = Validation.byProvider( HibernateValidator.class ) .configure() .addProperty( &quot;hibernate.validator.fail_fast&quot;, &quot;true&quot; ) .buildValidatorFactory(); Validator validator = validatorFactory.getValidator(); return validator; } } åˆ›å»ºå®ä½“ç±» è¿™é‡Œç€é‡è®²ä¸€ä¸‹æ³¨è§£ä¸­groupsæ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„? å› ä¸ºä¸€ä¸ªå®ä½“ä¸å¯èƒ½åªå¹²ä¸€ç§æ“ä½œ,ä¸€ä¸ªå®ä½“å¿…ç„¶å­˜åœ¨å¢åˆ æ”¹æŸ¥æ“ä½œ,é‚£ä¹ˆé—®é¢˜å°±æ¥äº† å¦‚æœæˆ‘è¦æ ¹æ®idè¿›è¡Œæ›´æ–°æ“ä½œ,é‚£ä¹ˆidè‚¯å®šä¸èƒ½ä¸ºç©º è¿™æ—¶å€™æˆ‘è¿˜è¦è¿›è¡Œæ–°å¢æ“ä½œ,å› ä¸ºidæ˜¯æ–°å¢æ•°æ®åº“æ“ä½œæ‰äº§ç”Ÿçš„,æ¥å—æ•°æ®çš„æ—¶å€™æˆ‘è‚¯å®šæ˜¯æ²¡æœ‰idçš„ æ‰€ä»¥å°±äº§ç”ŸçŸ›ç›¾äº† é‚£ä¹ˆgroupsè¿™ä¸ªå‚æ•°å°±èµ·ä½œç”¨äº†,å®ƒå¯ä»¥è¡¨ç¤ºæˆ‘è¿™ä¸ªæ³¨è§£å±äºå“ªä¸ªç»„,è¿™æ ·å°±è§£å†³è¿™ä¸ªå°´å°¬çš„é—®é¢˜äº†. æ³¨: å½“åœ¨controllerä¸­æ ¡éªŒè¡¨å•æ•°æ®æ—¶,å¦‚æœä½¿ç”¨äº†groups,é‚£ä¹ˆæ²¡æœ‰åœ¨è¿™ä¸ªåˆ†ç»„ä¸‹çš„å±æ€§æ˜¯ä¸ä¼šæ ¡éªŒçš„ import lombok.*; import javax.validation.constraints.*; import java.io.Serializable; /** * ç”¨æˆ·ä¿¡æ¯ç®¡ç† * @Author: ludangxin * @Date: 2020/5/20 16:09 */ @Data @Builder @AllArgsConstructor @NoArgsConstructor public class SysUser implements Serializable { private static final long serialVersionUID = 1L; /** * ä¸»é”® */ @NotNull(message = &quot;idä¸èƒ½ä¸ºç©º&quot;,groups = {ValidationInterface.update.class}) private Long id; /** * ç”¨æˆ·å */ @NotEmpty(message = &quot;ç”¨æˆ·åç§°ä¸èƒ½ä¸ºç©º&quot; , groups = {ValidationInterface.update.class,ValidationInterface.add.class}) private String username; /** * å¯†ç  */ @Size(min = 6, max = 16, message = &quot;å¯†ç é•¿åº¦å¿…é¡»åœ¨6-16ä¹‹é—´&quot; , groups = {ValidationInterface.update.class,ValidationInterface.add.class}) private String password; /** * é‚®ç®±åœ°å€ */ @Email(message = &quot;é‚®ç®±åœ°å€ä¸åˆæ³•&quot; , groups = {ValidationInterface.update.class,ValidationInterface.add.class , ValidationInterface.select.class}) @NotEmpty(message = &quot;é‚®ç®±ä¸èƒ½ä¸ºç©º&quot;,groups = ValidationInterface.add.class) private String email; /** * ç”µè¯ */ @Size(min = 11, max = 11, message = &quot;æ‰‹æœºå·ä¸åˆæ³•&quot; , groups = {ValidationInterface.update.class, ValidationInterface.add.class , ValidationInterface.select.class}) @NotEmpty(message = &quot;æ‰‹æœºå·ä¸èƒ½ä¸ºç©º&quot;,groups = {ValidationInterface.add.class}) private String phone; } åˆ›å»ºè¡¨å•éªŒè¯çš„é€šç”¨åˆ†ç»„æ¥å£ å¦‚æœè¿˜æœ‰å…¶å®ƒç‰¹æ®Šçš„åˆ†ç»„è¦æ±‚ ç›´æ¥åœ¨BOä¸­åˆ›å»ºinterfaceå³å¯ ä¾‹:å¦‚æœè¿˜æœ‰ä¸ªéœ€è¦éªŒè¯username å’Œ password(åªæœ‰è¿™ä¸¤ä¸ªå‚æ•°) çš„ selectæ“ä½œ ç›´æ¥åœ¨SysUserä¸­åˆ›å»ºUsernamePasswordValidView çš„æ¥å£å³å¯ /** * ç”¨äºè¡¨å•éªŒè¯çš„é€šç”¨åˆ†ç»„æ¥å£ * @Author: ludangxin * @Date: 2020/5/20 17:07 */ public interface ValidationInterface { /** * æ–°å¢åˆ†ç»„ */ interface add{} /** * åˆ é™¤åˆ†ç»„ */ interface delete{} /** * æŸ¥è¯¢åˆ†ç»„ */ interface select{} /** * æ›´æ–°åˆ†ç»„ */ interface update{} } åˆ›å»ºä¸šåŠ¡å¼‚å¸¸ç±» /** * ä¸šåŠ¡å¼‚å¸¸ * @author ludangxin */ public class BusinessException extends RuntimeException{ private static final long serialVersionUID = 1L; protected final String message; public BusinessException(String message) { this.message = message; } public BusinessException(String message, Throwable e) { super(message, e); this.message = message; } @Override public String getMessage() { return message; } } åˆ›å»ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨ import com.ldx.springboot.util.AjaxResult; import lombok.extern.slf4j.Slf4j; import org.springframework.validation.BindException; import org.springframework.web.HttpRequestMethodNotSupportedException; import org.springframework.web.bind.annotation.ExceptionHandler; import org.springframework.web.bind.annotation.RestControllerAdvice; import javax.servlet.http.HttpServletRequest; import javax.validation.ConstraintViolation; import javax.validation.ConstraintViolationException; import javax.validation.ValidationException; import java.util.Set; /** * å…¨å±€å¼‚å¸¸å¤„ç†å™¨ * */ @RestControllerAdvice @Slf4j public class GlobalExceptionHandler { /** * å‚æ•°ç»‘å®šå¼‚å¸¸ç±» ç”¨äºè¡¨å•éªŒè¯æ—¶æŠ›å‡ºçš„å¼‚å¸¸å¤„ç† */ @ExceptionHandler(BindException.class) public AjaxResult validatedBindException(BindException e){ log.error(e.getMessage(), e); String message = &quot;[&quot; + e.getAllErrors().get(0).getDefaultMessage() + &quot;]&quot;; return AjaxResult.error(message); } /** * å‚æ•°ç»‘å®šå¼‚å¸¸ç±» ç”¨äºJsonæ•°æ®ç»‘å®šéªŒè¯æ—¶æŠ›å‡ºçš„å¼‚å¸¸å¤„ç† */ @ExceptionHandler(MethodArgumentNotValidException.class) public AjaxResult methodArgumentNotValidException(MethodArgumentNotValidException e){ log.error(e.getMessage(), e); String message = &quot;[&quot; + e.getBindingResult().getAllErrors().get(0).getDefaultMessage() + &quot;]&quot;; return AjaxResult.error(message); } /** * å‚æ•°ç»‘å®šå¼‚å¸¸ç±» ç”¨äºæ–¹æ³•å½¢å‚ä¸­å‚æ•°æ ¡éªŒæ—¶æŠ›å‡ºçš„å¼‚å¸¸å¤„ç† * @param e * @return */ @ExceptionHandler(ConstraintViolationException.class) public AjaxResult handle(ValidationException e) { log.error(e.getMessage(), e); String errorInfo = &quot;&quot;; if(e instanceof ConstraintViolationException){ ConstraintViolationException exs = (ConstraintViolationException) e; Set&lt;ConstraintViolation&lt;?&gt;&gt; violations = exs.getConstraintViolations(); for (ConstraintViolation&lt;?&gt; item : violations) { errorInfo = errorInfo + &quot;[&quot; + item.getMessage() + &quot;]&quot;; } } return AjaxResult.error(errorInfo); } /** * è¯·æ±‚æ–¹å¼ä¸æ”¯æŒ */ @ExceptionHandler({ HttpRequestMethodNotSupportedException.class }) public AjaxResult handleException(HttpRequestMethodNotSupportedException e){ log.error(e.getMessage(), e); return AjaxResult.error(&quot;ä¸æ”¯æŒ' &quot; + e.getMethod() + &quot;'è¯·æ±‚&quot;); } /** * æ‹¦æˆªæœªçŸ¥çš„è¿è¡Œæ—¶å¼‚å¸¸ */ @ExceptionHandler(RuntimeException.class) public AjaxResult notFount(RuntimeException e) { log.error(&quot;è¿è¡Œæ—¶å¼‚å¸¸:&quot;, e); return AjaxResult.error(&quot;è¿è¡Œæ—¶å¼‚å¸¸:&quot; + e.getMessage()); } /** * ç³»ç»Ÿå¼‚å¸¸ */ @ExceptionHandler(Exception.class) public AjaxResult handleException(Exception e) { log.error(e.getMessage(), e); return AjaxResult.error(&quot;æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜&quot;); } /** * ä¸šåŠ¡å¼‚å¸¸ */ @ExceptionHandler(BusinessException.class) public AjaxResult businessException(HttpServletRequest request, BusinessException e) { log.error(e.getMessage()); return AjaxResult.error(e.getMessage()); } } åˆ›å»ºcontroller ç±»ä¸Šçš„ @Validated ä¸»è¦æ˜¯ä¸ºäº†ä½¿æ–¹æ³•å½¢å‚ä¸­çš„éªŒè¯ç”Ÿæ•ˆ. å¦‚æœåªæ˜¯ç”¨å®ä½“ç±»ä¸Šçš„å‚æ•°ç»‘å®šæ ¡éªŒ,é‚£ä¹ˆå°±ä¸ç”¨åœ¨ç±»ä¸Šæ ‡æ³¨è¯¥æ³¨è§£ import com.ldx.springboot.exception.BusinessException; import com.ldx.springboot.model.SysUser; import com.ldx.springboot.model.ValidationInterface; import com.ldx.springboot.util.AjaxResult; import org.springframework.validation.annotation.Validated; import org.springframework.web.bind.annotation.*; import javax.validation.constraints.Email; import javax.validation.constraints.NotEmpty; @RequestMapping(&quot;sysuser&quot;) @RestController @Validated public class SysUserController { /** * æ ¹æ®æ‰‹æœºå·å’Œé‚®ç®±æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ * @param sysUser ç”¨æˆ·ä¿¡æ¯ * @return */ @GetMapping(&quot;selectByPhoneOrEmail&quot;) public AjaxResult selectByPhoneOrEmail(@Validated(value = ValidationInterface.select.class) SysUser sysUser){ return AjaxResult.success(&quot;æŸ¥è¯¢æˆåŠŸ&quot;); } /** * æ ¹æ®æ‰‹æœºå·å’Œé‚®ç®±æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ * @param phone æ‰‹æœºå· * @param email é‚®ç®± * @return */ @GetMapping(&quot;selectByPhoneOrEmail2&quot;) public AjaxResult selectByPhoneOrEmail2(@NotEmpty(message = &quot;æ‰‹æœºå·ä¸èƒ½ä¸ºç©º&quot;) String phone ,@NotEmpty(message = &quot;é‚®ç®±ä¸èƒ½ä¸ºç©º&quot;)@Email(message = &quot;é‚®ç®±ä¿¡æ¯ä¸åˆæ³•&quot;) String email){ return AjaxResult.success(&quot;æŸ¥è¯¢æˆåŠŸ&quot;); } /** * æ–°å¢ç”¨æˆ·ä¿¡æ¯ * @param sysUser ç”¨æˆ·ä¿¡æ¯ * @return */ @PostMapping(&quot;add&quot;) public AjaxResult add(@Validated(value = ValidationInterface.add.class) SysUser sysUser){ return AjaxResult.success(&quot;æ–°å¢æˆåŠŸ&quot;); } /** * æ–°å¢ç”¨æˆ·ä¿¡æ¯ * @param sysUser ç”¨æˆ·ä¿¡æ¯ * @return */ @PostMapping(&quot;add1&quot;) public AjaxResult add1(@Validated(value = ValidationInterface.add.class) @RequestBody SysUser sysUser){ return AjaxResult.success(&quot;æ–°å¢æˆåŠŸ&quot;); } /** * æ›´å…·Idæ›´æ–°ç”¨æˆ·ä¿¡æ¯ * @param sysUser ç”¨æˆ·ä¿¡æ¯ * @return */ @PutMapping(&quot;updateById&quot;) public AjaxResult updateById(@Validated(value = ValidationInterface.update.class) SysUser sysUser){ return AjaxResult.success(&quot;æ›´æ–°æˆåŠŸ&quot;); } /** * æ ¹æ®Idåˆ é™¤ç”¨æˆ·ä¿¡æ¯ * @param id * @return */ @DeleteMapping(&quot;deleteById/{id}&quot;) public AjaxResult deleteById( @PathVariable Long id){ return AjaxResult.success(&quot;åˆ é™¤æˆåŠŸ&quot;); } /** * æµ‹è¯•ä¸šåŠ¡å¼‚å¸¸ * @return */ @GetMapping(&quot;testException&quot;) public AjaxResult testException(String name){ if(!&quot;å¼ ä¸‰&quot;.equals(name)){ throw new BusinessException(&quot;åªæœ‰å¼ ä¸‰æ‰å¯ä»¥è®¿é—®&quot;); } return AjaxResult.success(); } } åˆ›å»ºæ“ä½œæ¶ˆæ¯æé†’ç±» import lombok.Data; import lombok.NoArgsConstructor; /** * æ“ä½œæ¶ˆæ¯æé†’ */ @Data @NoArgsConstructor public class AjaxResult { /** * çŠ¶æ€ç±»å‹ */ public enum Type{ /** æˆåŠŸ */ SUCCESS(200), /** è­¦å‘Š */ WARN(301), /** é”™è¯¯ */ ERROR(500), /*tokenå¤±æ•ˆ*/ UNAUTHORIZED(401) ; private final int value; Type(int value){ this.value = value; } public int value(){ return this.value; } } /** çŠ¶æ€ç  */ private int code; /** è¿”å›å†…å®¹ */ private String msg; /** æ•°æ®å¯¹è±¡ */ private Object data; /** * åˆå§‹åŒ–ä¸€ä¸ªæ–°åˆ›å»ºçš„ AjaxResult å¯¹è±¡ * * @param type çŠ¶æ€ç±»å‹ * @param msg è¿”å›å†…å®¹ */ public AjaxResult(Type type, String msg) { this.code = type.value; this.msg = msg; } /** * åˆå§‹åŒ–ä¸€ä¸ªæ–°åˆ›å»ºçš„ AjaxResult å¯¹è±¡ * * @param type çŠ¶æ€ç±»å‹ * @param msg è¿”å›å†…å®¹ * @param data æ•°æ®å¯¹è±¡ */ public AjaxResult(Type type, String msg, Object data) { this.code = type.value; this.msg = msg; if (data != null) { this.data = data; } } /** * è¿”å›æˆåŠŸæ¶ˆæ¯ * * @return æˆåŠŸæ¶ˆæ¯ */ public static AjaxResult success() { return AjaxResult.success(&quot;æ“ä½œæˆåŠŸ&quot;); } /** * è¿”å›æˆåŠŸæ•°æ® * * @return æˆåŠŸæ¶ˆæ¯ */ public static AjaxResult success(Object data) { return AjaxResult.success(&quot;æ“ä½œæˆåŠŸ&quot;, data); } /** * è¿”å›æˆåŠŸæ¶ˆæ¯ * * @param msg è¿”å›å†…å®¹ * @return æˆåŠŸæ¶ˆæ¯ */ public static AjaxResult success(String msg) { return AjaxResult.success(msg, null); } /** * è¿”å›æˆåŠŸæ¶ˆæ¯ * * @param msg è¿”å›å†…å®¹ * @param data æ•°æ®å¯¹è±¡ * @return æˆåŠŸæ¶ˆæ¯ */ public static AjaxResult success(String msg, Object data) { return new AjaxResult(Type.SUCCESS, msg, data); } /** * è¿”å›è­¦å‘Šæ¶ˆæ¯ * * @param msg è¿”å›å†…å®¹ * @return è­¦å‘Šæ¶ˆæ¯ */ public static AjaxResult warn(String msg) { return AjaxResult.warn(msg, null); } /** * è¿”å›è­¦å‘Šæ¶ˆæ¯ * * @param msg è¿”å›å†…å®¹ * @param data æ•°æ®å¯¹è±¡ * @return è­¦å‘Šæ¶ˆæ¯ */ public static AjaxResult warn(String msg, Object data) { return new AjaxResult(Type.WARN, msg, data); } /** * è¿”å›é”™è¯¯æ¶ˆæ¯ * * @return */ public static AjaxResult error() { return AjaxResult.error(&quot;æ“ä½œå¤±è´¥&quot;); } /** * è¿”å›é”™è¯¯æ¶ˆæ¯ * * @param msg è¿”å›å†…å®¹ * @return è­¦å‘Šæ¶ˆæ¯ */ public static AjaxResult error(String msg) { return AjaxResult.error(msg, null); } /** * è¿”å›é”™è¯¯æ¶ˆæ¯ * * @param msg è¿”å›å†…å®¹ * @param data æ•°æ®å¯¹è±¡ * @return è­¦å‘Šæ¶ˆæ¯ */ public static AjaxResult error(String msg, Object data) { return new AjaxResult(Type.ERROR, msg, data); } /** * è¿”å›é”™è¯¯æ¶ˆæ¯ * * @param msg è¿”å›å†…å®¹ * @return è­¦å‘Šæ¶ˆæ¯ */ public static AjaxResult unauthorized(String msg) { return AjaxResult.unauthorized(msg, null); } /** * è¿”å›é”™è¯¯æ¶ˆæ¯ * * @param msg è¿”å›å†…å®¹ * @param data æ•°æ®å¯¹è±¡ * @return è­¦å‘Šæ¶ˆæ¯ */ public static AjaxResult unauthorized(String msg, Object data) { return new AjaxResult(Type.UNAUTHORIZED, msg, data); } } æ•ˆæœæ¼”ç¤º è®¿é—®selectByPhoneOrEmailæ¥å£ è®¿é—®selectByPhoneOrEmail2æ¥å£ è®¿é—®addæ¥å£ è®¿é—®testExceptionæ¥å£æµ‹è¯•ä¸šåŠ¡å¼‚å¸¸æç¤º ","link":"http://blog.ludangxin.club/post/springboot-ji-cheng-biao-dan-yan-zheng-he-yi-chang-tong-yi-chu-li/"},{"title":"Nginx","content":"nginxç®€ä»‹ nginxæ¦‚è¿° Nginx (&quot;engine x&quot;) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç†æœåŠ¡å™¨,ç‰¹ç‚¹æ˜¯å æœ‰å†…å­˜å°‘ï¼Œå¹¶å‘èƒ½ åŠ›å¼ºï¼Œäº‹å®ä¸Š nginx çš„å¹¶å‘èƒ½åŠ›ç¡®å®åœ¨åŒç±»å‹çš„ç½‘é¡µæœåŠ¡å™¨ä¸­è¡¨ç°è¾ƒå¥½ï¼Œä¸­å›½å¤§é™†ä½¿ç”¨ nginx ç½‘ç«™ç”¨æˆ·æœ‰ï¼šç™¾åº¦ã€äº¬ä¸œã€æ–°æµªã€ç½‘æ˜“ã€è…¾è®¯ã€æ·˜å®ç­‰ nginxä½œä¸ºwebæœåŠ¡å™¨ Nginx å¯ä»¥ä½œä¸ºé™æ€é¡µé¢çš„ web æœåŠ¡å™¨ï¼ŒåŒæ—¶è¿˜æ”¯æŒ CGI åè®®çš„åŠ¨æ€è¯­è¨€ï¼Œæ¯”å¦‚ perlã€php ç­‰ã€‚ä½†æ˜¯ä¸æ”¯æŒ javaã€‚Java ç¨‹åºåªèƒ½é€šè¿‡ä¸ tomcat é…åˆå®Œæˆã€‚Nginx ä¸“ä¸ºæ€§èƒ½ä¼˜åŒ–è€Œå¼€å‘ï¼Œ æ€§èƒ½æ˜¯å…¶æœ€é‡è¦çš„è€ƒé‡,å®ç°ä¸Šéå¸¸æ³¨é‡æ•ˆç‡ ï¼Œèƒ½ç»å—é«˜è´Ÿè½½çš„è€ƒéªŒ,æœ‰æŠ¥å‘Šè¡¨æ˜èƒ½æ”¯æŒé«˜ è¾¾ 50,000 ä¸ªå¹¶å‘è¿æ¥æ•°ã€‚ https://lnmp.org/nginx.html æ­£å‘ä»£ç† Nginx ä¸ä»…å¯ä»¥åšåå‘ä»£ç†ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚è¿˜èƒ½ç”¨ä½œæ­£å‘ä»£ç†æ¥è¿›è¡Œä¸Šç½‘ç­‰åŠŸèƒ½ã€‚ æ­£å‘ä»£ç†ï¼šå¦‚æœæŠŠå±€åŸŸç½‘å¤–çš„ Internet æƒ³è±¡æˆä¸€ä¸ªå·¨å¤§çš„èµ„æºåº“ï¼Œåˆ™å±€åŸŸç½‘ä¸­çš„å®¢æˆ·ç«¯è¦è®¿ é—® Internetï¼Œåˆ™éœ€è¦é€šè¿‡ä»£ç†æœåŠ¡å™¨æ¥è®¿é—®ï¼Œè¿™ç§ä»£ç†æœåŠ¡å°±ç§°ä¸ºæ­£å‘ä»£ç†ã€‚ åå‘ä»£ç† åå‘ä»£ç†ï¼Œå…¶å®å®¢æˆ·ç«¯å¯¹ä»£ç†æ˜¯æ— æ„ŸçŸ¥çš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯ä¸éœ€è¦ä»»ä½•é…ç½®å°±å¯ä»¥è®¿é—®ï¼Œæˆ‘ä»¬åª éœ€è¦å°†è¯·æ±‚å‘é€åˆ°åå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”±åå‘ä»£ç†æœåŠ¡å™¨å»é€‰æ‹©ç›®æ ‡æœåŠ¡å™¨è·å–æ•°æ®åï¼Œåœ¨è¿” å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶åå‘ä»£ç†æœåŠ¡å™¨å’Œç›®æ ‡æœåŠ¡å™¨å¯¹å¤–å°±æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæš´éœ²çš„æ˜¯ä»£ç†æœåŠ¡å™¨ åœ°å€ï¼Œéšè—äº†çœŸå®æœåŠ¡å™¨ IP åœ°å€ã€‚ è´Ÿè½½å‡è¡¡ å®¢æˆ·ç«¯å‘é€å¤šä¸ªè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚ï¼Œæœ‰ä¸€äº›å¯èƒ½è¦ä¸æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼ŒæœåŠ¡å™¨å¤„ç†å®Œæ¯•åï¼Œå†å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ è¿™ç§æ¶æ„æ¨¡å¼å¯¹äºæ—©æœŸçš„ç³»ç»Ÿç›¸å¯¹å•ä¸€ï¼Œå¹¶å‘è¯·æ±‚ç›¸å¯¹è¾ƒå°‘çš„æƒ…å†µä¸‹æ˜¯æ¯”è¾ƒé€‚åˆçš„ï¼Œæˆæœ¬ä¹Ÿä½ã€‚ä½†æ˜¯éšç€ä¿¡æ¯æ•°é‡çš„ä¸æ–­å¢é•¿ï¼Œè®¿é—®é‡å’Œæ•°æ®é‡çš„é£é€Ÿå¢é•¿ï¼Œä»¥åŠç³»ç»Ÿä¸šåŠ¡çš„å¤æ‚åº¦å¢åŠ ï¼Œè¿™ç§æ¶æ„ä¼šé€ æˆæœåŠ¡å™¨ç›¸åº”å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¥ç›Šç¼“æ…¢ï¼Œå¹¶å‘é‡ç‰¹åˆ«å¤§çš„æ—¶å€™ï¼Œè¿˜å®¹æ˜“é€ æˆæœåŠ¡å™¨ç›´æ¥å´©æºƒã€‚å¾ˆæ˜æ˜¾è¿™æ˜¯ç”±äºæœåŠ¡å™¨æ€§èƒ½çš„ç“¶é¢ˆé€ æˆçš„é—®é¢˜ï¼Œé‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ç§æƒ…å†µå‘¢ï¼Ÿ æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å¯èƒ½æ˜¯å‡çº§æœåŠ¡å™¨çš„é…ç½®ï¼Œæ¯”å¦‚æé«˜ CPU æ‰§è¡Œé¢‘ç‡ï¼ŒåŠ å¤§å†…å­˜ç­‰æé«˜æœºå™¨çš„ç‰©ç†æ€§èƒ½æ¥è§£å†³æ­¤é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“æ‘©å°”å®šå¾‹çš„æ—¥ç›Šå¤±æ•ˆï¼Œç¡¬ä»¶çš„æ€§èƒ½æå‡å·²ç»ä¸èƒ½æ»¡è¶³æ—¥ç›Šæå‡çš„éœ€æ±‚äº†ã€‚æœ€æ˜æ˜¾çš„ä¸€ä¸ªä¾‹å­ï¼Œå¤©çŒ«åŒåä¸€å½“å¤©ï¼ŒæŸä¸ªçƒ­é”€å•†å“çš„ç¬æ—¶è®¿é—®é‡æ˜¯æå…¶åºå¤§çš„ï¼Œé‚£ä¹ˆç±»ä¼¼ä¸Šé¢çš„ç³»ç»Ÿæ¶æ„ï¼Œå°†æœºå™¨éƒ½å¢åŠ åˆ°ç°æœ‰çš„é¡¶çº§ç‰©ç†é…ç½®ï¼Œéƒ½æ˜¯ä¸èƒ½å¤Ÿæ»¡è¶³éœ€æ±‚çš„ã€‚é‚£ä¹ˆæ€ä¹ˆå‘¢ï¼Ÿ ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å»æ‰äº†å¢åŠ æœåŠ¡å™¨ç‰©ç†é…ç½®æ¥è§£å†³é—®é¢˜çš„åŠæ³•ï¼Œä¹Ÿå°±æ˜¯è¯´çºµå‘è§£å†³é—®é¢˜çš„åŠæ³•è¡Œä¸é€šäº†ï¼Œé‚£ä¹ˆæ¨ªå‘å¢åŠ æœåŠ¡å™¨çš„æ•°é‡å‘¢ï¼Ÿè¿™æ—¶å€™é›†ç¾¤çš„æ¦‚å¿µäº§ç”Ÿäº†ï¼Œå•ä¸ªæœåŠ¡å™¨è§£å†³ä¸äº†ï¼Œæˆ‘ä»¬å¢åŠ æœåŠ¡å™¨çš„æ•°é‡ï¼Œç„¶åå°†è¯·æ±‚åˆ†å‘åˆ°å„ä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°†åŸå…ˆè¯·æ±‚é›†ä¸­åˆ°å•ä¸ªæœåŠ¡å™¨ä¸Šçš„æƒ…å†µæ”¹ä¸ºå°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œå°†è´Ÿè½½åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„è´Ÿè½½å‡è¡¡ åŠ¨é™åˆ†ç¦» ä¸ºäº†åŠ å¿«ç½‘ç«™çš„è§£æé€Ÿåº¦ï¼Œå¯ä»¥æŠŠåŠ¨æ€é¡µé¢å’Œé™æ€é¡µé¢ç”±ä¸åŒçš„æœåŠ¡å™¨æ¥è§£æï¼ŒåŠ å¿«è§£æé€Ÿåº¦ã€‚é™ä½åŸæ¥å•ä¸ªæœåŠ¡å™¨çš„å‹åŠ›ã€‚ nginx å®‰è£… ç´ æä»‹ç» PCRE PCREåº“æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚å¦‚æœæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶nginx.confä¸­ä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘Nginxæ—¶å°±å¿…é¡»æŠŠPCREåº“ç¼–è¯‘è¿›Nginxï¼Œå› ä¸ºNginxçš„HTTPæ¨¡å—éœ€è¦é å®ƒæ¥è§£ææ­£åˆ™è¡¨è¾¾å¼ã€‚å¦å¤–ï¼Œpcre-develæ˜¯ä½¿ç”¨PCREåšäºŒæ¬¡å¼€å‘æ—¶æ‰€éœ€è¦çš„å¼€å‘åº“ï¼ŒåŒ…æ‹¬å¤´æ–‡ä»¶ç­‰ï¼Œè¿™ä¹Ÿæ˜¯ç¼–è¯‘Nginxæ‰€å¿…é¡»ä½¿ç”¨çš„. zlib zlibåº“ç”¨äºå¯¹HTTPåŒ…çš„å†…å®¹åšgzipæ ¼å¼çš„å‹ç¼©ï¼Œå¦‚æœæˆ‘ä»¬åœ¨nginx.confä¸­é…ç½®äº†gzip onï¼Œå¹¶æŒ‡å®šå¯¹äºæŸäº›ç±»å‹ï¼ˆcontent-typeï¼‰çš„HTTPå“åº”ä½¿ç”¨gzipæ¥è¿›è¡Œå‹ç¼©ä»¥å‡å°‘ç½‘ç»œä¼ è¾“é‡ï¼Œåˆ™åœ¨ç¼–è¯‘æ—¶å°±å¿…é¡»æŠŠzlibç¼–è¯‘è¿›Nginxã€‚zlib-develæ˜¯äºŒæ¬¡å¼€å‘æ‰€éœ€è¦çš„åº“. openSSL å¦‚æœæœåŠ¡å™¨ä¸åªæ˜¯è¦æ”¯æŒHTTPï¼Œè¿˜éœ€è¦åœ¨æ›´å®‰å…¨çš„SSLåè®®ä¸Šä¼ è¾“HTTPï¼Œé‚£ä¹ˆéœ€è¦æ‹¥æœ‰OpenSSLã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨MD5ã€SHA1ç­‰æ•£åˆ—å‡½æ•°ï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦å®‰è£…å®ƒã€‚ nginxå®‰è£…åŒ… å¼€å§‹å®‰è£… å®‰è£…pcre cd /usr/local/ : åˆ°å®‰è£…ç›®å½•ä¸‹ wget https://sourceforge.net/projects/pcre/files/pcre/8.44/pcre-8.44.tar.gz:ä¸‹è½½pcre tar -zxvf pcre-8.44.tar.gz: è§£å‹ cd pcre-8.44:åˆ‡æ¢åˆ°æ–‡ä»¶å¤¹ä¸‹ ./configure:æ‰§è¡Œé…ç½®æ–‡ä»¶ make &amp;&amp; make install:ç¼–è¯‘å®‰è£…pcre ç‰¹åˆ«æ³¨æ„:make å‘½ä»¤æ‰§è¡Œä¸äº†çš„åŒå­¦ ./configureå æœ€åä¸€è¡Œä¼šå‡ºç° configure: error: You need a C++ compiler for C++ support. å®‰è£…ä¸€ä¸‹è¿™ä¸ªå³å¯ï¼šyum install -y gcc gcc-c++ ï¼ˆå®‰è£…å®Œæ¯•ååœ¨æ‰§è¡Œ ./configure åœ¨æ‰§è¡Œmake å°±OKäº† æˆ‘å°±æ˜¯è¿™æ ·ï¼‰ å®‰è£…opensslå’Œzlib yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel:ä¸€é”®å®‰è£… å®‰è£…nginx cd /usr/local/ : åˆ°å®‰è£…ç›®å½•ä¸‹å¹¶ä¸”æŠŠtaræ–‡ä»¶æ”¾åˆ°è¯¥ç›®å½•ä¸­ tar -zxvf nginx-1.16.1.tar.gz : è§£å‹æ–‡ä»¶ cd nginx-1.16.1: åˆ‡æ¢åˆ°æ–‡ä»¶ç›®å½•ä¸‹ ./configure: æ‰§è¡Œå®‰è£…é…ç½®æ–‡ä»¶ make &amp;&amp; make install: ç¼–è¯‘å®‰è£… cd /usr/local/nginx/sbin/: è¿›å»nginxå¯æ‰§è¡Œæ–‡ä»¶ç›®å½•ä¸­ ./nginx:å¯åŠ¨nginxæœåŠ¡ è®¿é—®ç³»ç»Ÿ80ç«¯å£æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¯åŠ¨ ç‰¹åˆ«æ³¨æ„: åœ¨ windows ç³»ç»Ÿä¸­è®¿é—®linux ä¸­ nginxï¼Œé»˜è®¤ä¸èƒ½è®¿é—®çš„ï¼Œå› ä¸ºé˜²ç«å¢™é—®é¢˜ æŸ¥çœ‹å¼€æ”¾çš„ç«¯å£å· firewall-cmd --list-all è®¾ç½®å¼€æ”¾çš„ç«¯å£å· firewall-cmd --add-service=http â€“permanent firewall-cmd --add-port=80/tcp --permanent é‡å¯é˜²ç«å¢™ firewall-cmd â€“reload nginx å¸¸ç”¨å‘½ä»¤å’Œé…ç½®æ–‡ä»¶ å¸¸ç”¨å‘½ä»¤ cd /usr/local/nginx/sbin: è¿›å…¥nginxç›®å½•ä¸­ ./nginx -v:æŸ¥çœ‹nginxç‰ˆæœ¬å· ./nginx: å¯åŠ¨nginx ./nginx -s stop: åœæ­¢nginx ./nginx -s reload:é‡æ–°åŠ è½½nginx(ä¸æ˜¯é‡å¯) é…ç½®æ–‡ä»¶ cd /usr/local/nginx/conf/nginx.conf : é…ç½®æ–‡ä»¶çš„ç›®å½• é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ å…¨å±€å— worker_processes; * ä»é…ç½®æ–‡ä»¶å¼€å§‹åˆ° events å—ä¹‹é—´çš„å†…å®¹ï¼Œä¸»è¦ä¼šè®¾ç½®ä¸€äº›å½±å“ nginx æœåŠ¡å™¨æ•´ä½“è¿è¡Œçš„é…ç½®æŒ‡ä»¤ï¼Œä¸»è¦åŒ…æ‹¬é…ç½®è¿è¡Œ Nginx æœåŠ¡å™¨çš„ç”¨æˆ·ï¼ˆç»„ï¼‰ã€å…è®¸ç”Ÿæˆçš„ worker process æ•°ï¼Œè¿›ç¨‹ PID å­˜æ”¾è·¯å¾„ã€æ—¥å¿—å­˜æ”¾è·¯å¾„å’Œç±»å‹ä»¥åŠé…ç½®æ–‡ä»¶çš„å¼•å…¥ç­‰ã€‚æ¯”å¦‚ä¸Šé¢ç¬¬ä¸€è¡Œé…ç½®çš„ `worker_processes 1;` è¿™æ˜¯ Nginx æœåŠ¡å™¨å¹¶å‘å¤„ç†æœåŠ¡çš„å…³é”®é…ç½®ï¼Œworker_processes å€¼è¶Šå¤§ï¼Œå¯ä»¥æ”¯æŒçš„å¹¶å‘å¤„ç†é‡ä¹Ÿè¶Šå¤šï¼Œä½†æ˜¯ä¼šå—åˆ°ç¡¬ä»¶ã€è½¯ä»¶ç­‰è®¾å¤‡çš„åˆ¶çº¦. * eventså— * ``````json events { worker_connections 1024; } `````` * events å—æ¶‰åŠçš„æŒ‡ä»¤ä¸»è¦å½±å“ Nginx æœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ï¼Œå¸¸ç”¨çš„è®¾ç½®åŒ…æ‹¬æ˜¯å¦å¼€å¯å¯¹å¤š work process ä¸‹çš„ç½‘ç»œè¿æ¥è¿›è¡Œåºåˆ—åŒ–ï¼Œæ˜¯å¦å…è®¸åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé€‰å–å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹æ¥å¤„ç†è¿æ¥è¯·æ±‚ï¼Œæ¯ä¸ª word process å¯ä»¥åŒæ—¶æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ç­‰ã€‚ ä¸Šè¿°ä¾‹å­å°±è¡¨ç¤ºæ¯ä¸ª work process æ”¯æŒçš„æœ€å¤§è¿æ¥æ•°ä¸º 1024. è¿™éƒ¨åˆ†çš„é…ç½®å¯¹ Nginx çš„æ€§èƒ½å½±å“è¾ƒå¤§ï¼Œåœ¨å®é™…ä¸­åº”è¯¥çµæ´»é…ç½®ã€‚ * httpå— * ``````json http { include mime.types; default_type application/octet-stream; #log_format main '$remote_addr - $remote_user [$time_local] &quot;$request&quot; ' # '$status $body_bytes_sent &quot;$http_referer&quot; ' # '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;'; #access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; server { listen 80; server_name localhost; `````` * è¿™ç®—æ˜¯ Nginx æœåŠ¡å™¨é…ç½®ä¸­æœ€é¢‘ç¹çš„éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜å’Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®éƒ½åœ¨è¿™é‡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šhttp å—ä¹Ÿå¯ä»¥åŒ…æ‹¬ **http å…¨å±€å—**ã€**server å—** * httpå…¨å±€å— * http å…¨å±€å—é…ç½®çš„æŒ‡ä»¤åŒ…æ‹¬æ–‡ä»¶å¼•å…¥ã€MIME-TYPE å®šä¹‰ã€æ—¥å¿—è‡ªå®šä¹‰ã€è¿æ¥è¶…æ—¶æ—¶é—´ã€å•é“¾æ¥è¯·æ±‚æ•°ä¸Šé™ç­‰ã€‚ * serverå— * è¿™å—å’Œè™šæ‹Ÿä¸»æœºæœ‰å¯†åˆ‡å…³ç³»ï¼Œè™šæ‹Ÿä¸»æœºä»ç”¨æˆ·è§’åº¦çœ‹ï¼Œå’Œä¸€å°ç‹¬ç«‹çš„ç¡¬ä»¶ä¸»æœºæ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œè¯¥æŠ€æœ¯çš„äº§ç”Ÿæ˜¯ä¸ºäº†èŠ‚çœäº’è”ç½‘æœåŠ¡å™¨ç¡¬ä»¶æˆæœ¬ã€‚æ¯ä¸ª http å—å¯ä»¥åŒ…æ‹¬å¤šä¸ªserver å—ï¼Œè€Œæ¯ä¸ª server å—å°±ç›¸å½“äºä¸€ä¸ªè™šæ‹Ÿä¸»æœºã€‚è€Œæ¯ä¸ª server å—ä¹Ÿåˆ†ä¸ºå…¨å±€server å—ï¼Œä»¥åŠå¯ä»¥åŒæ—¶åŒ…å«å¤šä¸ª locaton å—ã€‚ * å…¨å±€serverå— * æœ€å¸¸è§çš„é…ç½®æ˜¯æœ¬è™šæ‹Ÿæœºä¸»æœºçš„ç›‘å¬é…ç½®å’Œæœ¬è™šæ‹Ÿä¸»æœºçš„åç§°æˆ– IP é…ç½®ã€‚ * locationå— * ä¸€ä¸ª server å—å¯ä»¥é…ç½®å¤šä¸ª location å—ã€‚ è¿™å—çš„ä¸»è¦ä½œç”¨æ˜¯åŸºäº Nginx æœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¯·æ±‚å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ server_name/uri-stringï¼‰ï¼Œå¯¹è™šæ‹Ÿ ä¸»æœºåç§°ï¼ˆä¹Ÿå¯ä»¥æ˜¯ IP åˆ«åï¼‰ä¹‹å¤–çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ å‰é¢çš„ /uri-stringï¼‰è¿›è¡ŒåŒ¹é…ï¼Œå¯¹ç‰¹å®šçš„è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚åœ°å€å®šå‘ã€æ•°æ®ç¼“å­˜å’Œåº”ç­”æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œè¿˜æœ‰è®¸å¤šç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ä¹Ÿåœ¨è¿™é‡Œè¿›è¡Œã€‚ location æŒ‡ä»¤è¯´æ˜ è¯¥æŒ‡ä»¤ç”¨äºåŒ¹é…URL è¯­æ³•å¦‚ä¸‹ location [ = | ~ | ~* | ^~] uri { } = : ç”¨äºä¸å«æ­£åˆ™è¡¨è¾¾å¼çš„ uri å‰ï¼Œè¦æ±‚è¯·æ±‚å­—ç¬¦ä¸²ä¸ uri ä¸¥æ ¼åŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œå°±åœæ­¢ç»§ç»­å‘ä¸‹æœç´¢å¹¶ç«‹å³å¤„ç†è¯¥è¯·æ±‚ ~ : ç”¨äºè¡¨ç¤º uri åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”åŒºåˆ†å¤§å°å†™ ~* : ç”¨äºè¡¨ç¤º uri åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”ä¸åŒºåˆ†å¤§å°å†™ ^~ : ç”¨äºä¸å«æ­£åˆ™è¡¨è¾¾å¼çš„ uri å‰ï¼Œè¦æ±‚ Nginx æœåŠ¡å™¨æ‰¾åˆ°æ ‡è¯† uri å’Œè¯·æ±‚å­—ç¬¦ä¸²åŒ¹é…åº¦æœ€é«˜çš„ location åï¼Œç«‹å³ä½¿ç”¨æ­¤ location å¤„ç†è¯·æ±‚ï¼Œè€Œä¸å†ä½¿ç”¨ location å—ä¸­çš„æ­£åˆ™ uri å’Œè¯·æ±‚å­—ç¬¦ä¸²åšåŒ¹é… *æ³¨æ„ : ** å¦‚æœ uri åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™å¿…é¡»è¦æœ‰ ~ æˆ–è€… ~ æ ‡è¯† nginxé…ç½®å®ä¾‹-åå‘ä»£ç† åå‘ä»£ç†å®ä¾‹ä¸€ å®ç°æ•ˆæœ:ä½¿ç”¨nginxåå‘ä»£ç†,è®¿é—®www.123.comç›´æ¥è·³è½¬åˆ°127.0.0.1:8080 å®ç°è¿‡ç¨‹: å¯åŠ¨ä¸€ä¸ªtomcat,æµè§ˆå™¨åœ°å€æ è¾“å…¥127.0.0.1:8080,å¯åŠ¨è®¿é—®æ­£å¸¸å ä¿®æ”¹æœ¬åœ°hostC:\\Windows\\System32\\drivers\\etc\\hostsæ–‡ä»¶,å°†www.123.comæ˜ å°„åˆ°127.0.0.1 é…ç½®å®Œæˆä¹‹åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥é€šè¿‡ www.123.com:8080 è®¿é—®åˆ°ç¬¬ä¸€æ­¥å‡ºç°çš„ Tomcat åˆå§‹ç•Œé¢ã€‚é‚£ä¹ˆå¦‚ä½•åªéœ€è¦è¾“å…¥ www.123.com ä¾¿å¯ä»¥è·³è½¬åˆ° Tomcat åˆå§‹ç•Œé¢å‘¢ï¼Ÿä¾¿ç”¨åˆ° nginxçš„åå‘ä»£ç†ã€‚ åœ¨ nginx.conf é…ç½®æ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹é…ç½® server { listen 80; server_name www.123.com; location / { proxy_pass http://127.0.0.1:8080; index index.html index.htm index.jsp; } } å¦‚ä¸Šé…ç½®ï¼Œæˆ‘ä»¬ç›‘å¬ 80 ç«¯å£ï¼Œè®¿é—®åŸŸåä¸º www.123.comï¼Œä¸åŠ ç«¯å£å·æ—¶é»˜è®¤ä¸º 80 ç«¯å£ï¼Œæ•… è®¿é—®è¯¥åŸŸåæ—¶ä¼šè·³è½¬åˆ° 127.0.0.1:8080 è·¯å¾„ä¸Šã€‚åœ¨æµè§ˆå™¨ç«¯è¾“å…¥ www.123.com ä¼šçœ‹åˆ°tomcat index.jsp é¡µé¢ï¼š åå‘ä»£ç†å®ä¾‹äºŒ å®ç°æ•ˆæœï¼šä½¿ç”¨ nginx åå‘ä»£ç†ï¼Œæ ¹æ®è®¿é—®çš„è·¯å¾„è·³è½¬åˆ°ä¸åŒç«¯å£çš„æœåŠ¡ä¸­nginx ç›‘å¬ç«¯å£ä¸º 9001ï¼Œ è®¿é—® http://127.0.0.1:9001/edu/ ç›´æ¥è·³è½¬åˆ° 127.0.0.1:8081 è®¿é—® http://127.0.0.1:9001/vod/ ç›´æ¥è·³è½¬åˆ° 127.0.0.1:8082 å®ç°è¿‡ç¨‹ å‡†å¤‡ä¸¤ä¸ª tomcatï¼Œä¸€ä¸ª 8001 ç«¯å£ï¼Œä¸€ä¸ª 8002 ç«¯å£ï¼Œå¹¶å‡†å¤‡å¥½æµ‹è¯•çš„é¡µé¢ ä¿®æ”¹ nginx çš„é…ç½®æ–‡ä»¶ ,åœ¨ http å—ä¸­æ·»åŠ  server{} server { listen 9001; server_name localhost; location ~ /edu/ { proxy_pass http://localhost:8001; } location ~ /vod/ { proxy_pass http://localhost:8002; } } è®¿é—®æµ‹è¯• nginx é…ç½®å®ä¾‹-è´Ÿè½½å‡è¡¡ å®ç°æ•ˆæœ: æµè§ˆå™¨åœ°å€æ è¾“å…¥åœ°å€ http://192.168.17.129/edu/a.htmlï¼Œè´Ÿè½½å‡è¡¡æ•ˆæœ,å¹³å‡8080å’Œ 8081 ç«¯å£ä¸­ å®ç°è¿‡ç¨‹ å‡†å¤‡ä¸¤ä¸ªåŒæ—¶å¯åŠ¨çš„tomcat,ä¸€å°8080,ä¸€å°8081 åœ¨ä¸¤å° tomcaté‡Œé¢ webappsç›®å½•ä¸­ï¼Œåˆ›å»ºåç§° edu æ–‡ä»¶å¤¹ï¼Œåœ¨ edu æ–‡ä»¶å¤¹ä¸­åˆ›å»ºé¡µé¢ a.htmlï¼Œç”¨äºæµ‹è¯• åœ¨nginxçš„é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè´Ÿè½½å‡è¡¡çš„é…ç½® upstream myserver { server 192.168.17.129:8080; server 192.168.17.129:8081; } server { listen 80; server_name 192.168.17.129; location /{ proxy_pass http://myserver; root html; index index.html index.htm; } } åœ°å€æ ä¸­è®¿é—®æµ‹è¯•http://192.168.17.129/edu/a.html nginxè´Ÿè½½å‡è¡¡ åˆ†é…ç­–ç•¥ è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨ down æ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚ weight weight ä»£è¡¨æƒ,é‡é»˜è®¤ä¸º 1,æƒé‡è¶Šé«˜è¢«åˆ†é…çš„å®¢æˆ·ç«¯è¶Šå¤š æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweight å’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ä¾‹å¦‚: upstream server_pool{ server 192.168.5.21 weight=5; server 192.168.5.22 weight=10; } ip_hash æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—® ip çš„ hash ç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³ session çš„é—®é¢˜ã€‚ ä¾‹å¦‚ï¼š upstream server_pool{ ip_hash; server 192.168.5.21:80; server 192.168.5.22:80; } fair (ç¬¬ä¸‰æ–¹) æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ upstream server_pool{ server 192.168.5.21:80; server 192.168.5.22:80; fair; } nginx é…ç½®å®ä¾‹-åŠ¨é™åˆ†ç¦» Nginx åŠ¨é™åˆ†ç¦»ç®€å•æ¥è¯´å°±æ˜¯æŠŠåŠ¨æ€è·Ÿé™æ€è¯·æ±‚åˆ†å¼€ï¼Œä¸èƒ½ç†è§£æˆåªæ˜¯å•çº¯çš„æŠŠåŠ¨æ€é¡µé¢å’Œé™æ€é¡µé¢ç‰©ç†åˆ†ç¦»ã€‚ä¸¥æ ¼æ„ä¹‰ä¸Šè¯´åº”è¯¥æ˜¯åŠ¨æ€è¯·æ±‚è·Ÿé™æ€è¯·æ±‚åˆ†å¼€ï¼Œå¯ä»¥ç†è§£æˆä½¿ç”¨ Nginxå¤„ç†é™æ€é¡µé¢ï¼ŒTomcat å¤„ç†åŠ¨æ€é¡µé¢ã€‚åŠ¨é™åˆ†ç¦»ä»ç›®å‰å®ç°è§’åº¦æ¥è®²å¤§è‡´åˆ†ä¸ºä¸¤ç§ï¼Œ â€‹ ä¸€ç§æ˜¯çº¯ç²¹æŠŠé™æ€æ–‡ä»¶ç‹¬ç«‹æˆå•ç‹¬çš„åŸŸåï¼Œæ”¾åœ¨ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸Šï¼Œä¹Ÿæ˜¯ç›®å‰ä¸»æµæ¨å´‡çš„æ–¹æ¡ˆï¼› â€‹ å¦å¤–ä¸€ç§æ–¹æ³•å°±æ˜¯åŠ¨æ€è·Ÿé™æ€æ–‡ä»¶æ··åˆåœ¨ä¸€èµ·å‘å¸ƒï¼Œé€šè¿‡ nginx æ¥åˆ†å¼€ã€‚é€šè¿‡ location æŒ‡å®šä¸åŒçš„åç¼€åå®ç°ä¸åŒçš„è¯·æ±‚è½¬å‘ã€‚é€šè¿‡ expires å‚æ•°è®¾ç½®ï¼Œå¯ä»¥ä½¿æµè§ˆå™¨ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼Œå‡å°‘ä¸æœåŠ¡å™¨ä¹‹å‰çš„è¯·æ±‚å’Œæµé‡ã€‚å…·ä½“ Expires å®šä¹‰ï¼šæ˜¯ç»™ä¸€ä¸ªèµ„æºè®¾å®šä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯è¯´æ— éœ€å»æœåŠ¡ç«¯éªŒè¯ï¼Œç›´æ¥é€šè¿‡æµè§ˆå™¨è‡ªèº«ç¡®è®¤æ˜¯å¦è¿‡æœŸå³å¯ï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿé¢å¤–çš„æµé‡ã€‚æ­¤ç§æ–¹æ³•éå¸¸é€‚åˆä¸ç»å¸¸å˜åŠ¨çš„èµ„æºã€‚ï¼ˆå¦‚æœç»å¸¸æ›´æ–°çš„æ–‡ä»¶ï¼Œä¸å»ºè®®ä½¿ç”¨Expires æ¥ç¼“å­˜ï¼‰ï¼Œæˆ‘è¿™é‡Œè®¾ç½® 3dï¼Œè¡¨ç¤ºåœ¨è¿™ 3 å¤©ä¹‹å†…è®¿é—®è¿™ä¸ª URLï¼Œå‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œæ¯”å¯¹æœåŠ¡å™¨è¯¥æ–‡ä»¶æœ€åæ›´æ–°æ—¶é—´æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸ä¼šä»æœåŠ¡å™¨æŠ“å–ï¼Œè¿”å›çŠ¶æ€ç 304ï¼Œå¦‚æœæœ‰ä¿®æ”¹ï¼Œåˆ™ç›´æ¥ä»æœåŠ¡å™¨é‡æ–°ä¸‹è½½ï¼Œè¿”å›çŠ¶æ€ç  200ã€‚ å®ç°è¿‡ç¨‹ ç°åœ¨ç³»ç»Ÿä¸­å‡†å¤‡é™æ€èµ„æº,ç”¨äºè®¿é—® åœ¨linux è·Ÿç›®å½•ä¸­åˆ›å»ºimageå’Œwwwæ–‡ä»¶å¤¹,å¹¶ç»™æ–‡ä»¶å¤¹ä¸‹æ”¾å…¥é™æ€èµ„æº å…·ä½“é…ç½® server { listen 80; server_name 192.168.17.129; location /www/ { root /data/; index index.html index.htm; } location /image/ { root /data/; autoindex on; } } æµè§ˆå™¨ä¸­è¾“å…¥åœ°å€http://192.168.17.129/image/01.jpg,http://192.168.17.129/www/a.html ç‰¹åˆ«æ³¨æ„: å› ä¸ºé…ç½®æ–‡ä»¶ä¸­é…ç½®äº† autoindex on;æ‰€ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—®http://192.168.17.129/image/ç»“æœå¦‚ä¸‹: nginx å¤„ç†è·¨åŸŸè¯·æ±‚ å½“å‡ºç°403è·¨åŸŸé”™è¯¯çš„æ—¶å€™ No 'Access-Control-Allow-Origin' header is present on the requested resourceï¼Œéœ€è¦ç»™NginxæœåŠ¡å™¨é…ç½®å“åº”çš„headerå‚æ•°ï¼š è§£å†³æ–¹æ¡ˆ location / { add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS'; add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization'; if ($request_method = 'OPTIONS') { return 204; } } è§£é‡Š 1. Access-Control-Allow-Origin æœåŠ¡å™¨é»˜è®¤æ˜¯ä¸è¢«å…è®¸è·¨åŸŸçš„ã€‚ç»™NginxæœåŠ¡å™¨é…ç½®`Access-Control-Allow-Origin *`åï¼Œè¡¨ç¤ºæœåŠ¡å™¨å¯ä»¥æ¥å—æ‰€æœ‰çš„è¯·æ±‚æºï¼ˆOriginï¼‰,å³æ¥å—æ‰€æœ‰è·¨åŸŸçš„è¯·æ±‚ã€‚ 2. Access-Control-Allow-Headers æ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š Request header field Content-Type is not allowed by Access-Control-Allow-Headers in preflight response. è¿™ä¸ªé”™è¯¯è¡¨ç¤ºå½“å‰è¯·æ±‚Content-Typeçš„å€¼ä¸è¢«æ”¯æŒã€‚å…¶å®æ˜¯æˆ‘ä»¬å‘èµ·äº†&quot;application/json&quot;çš„ç±»å‹è¯·æ±‚å¯¼è‡´çš„ã€‚è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªæ¦‚å¿µï¼šé¢„æ£€è¯·æ±‚ï¼ˆpreflight requestï¼‰,è¯·çœ‹ä¸‹é¢&quot;é¢„æ£€è¯·æ±‚&quot;çš„ä»‹ç»ã€‚ 3. Access-Control-Allow-Methods æ˜¯ä¸ºäº†é˜²æ­¢å‡ºç°ä»¥ä¸‹é”™è¯¯ï¼š Content-Type is not allowed by Access-Control-Allow-Headers in preflight response. 4.ç»™OPTIONS æ·»åŠ  204çš„è¿”å›ï¼Œæ˜¯ä¸ºäº†å¤„ç†åœ¨å‘é€POSTè¯·æ±‚æ—¶Nginxä¾ç„¶æ‹’ç»è®¿é—®çš„é”™è¯¯ å‘é€&quot;é¢„æ£€è¯·æ±‚&quot;æ—¶ï¼Œéœ€è¦ç”¨åˆ°æ–¹æ³• OPTIONS ,æ‰€ä»¥æœåŠ¡å™¨éœ€è¦å…è®¸è¯¥æ–¹æ³•ã€‚ é¢„æ£€è¯·æ±‚ï¼ˆpreflight requestï¼‰ å…¶å®ä¸Šé¢çš„é…ç½®æ¶‰åŠåˆ°äº†ä¸€ä¸ªW3Cæ ‡å‡†ï¼šCROS,å…¨ç§°æ˜¯è·¨åŸŸèµ„æºå…±äº« (Cross-origin resource sharing)ï¼Œå®ƒçš„æå‡ºå°±æ˜¯ä¸ºäº†è§£å†³è·¨åŸŸè¯·æ±‚çš„ã€‚ è·¨åŸŸèµ„æºå…±äº«(CORS)æ ‡å‡†æ–°å¢äº†ä¸€ç»„ HTTP é¦–éƒ¨å­—æ®µï¼Œå…è®¸æœåŠ¡å™¨å£°æ˜å“ªäº›æºç«™æœ‰æƒé™è®¿é—®å“ªäº›èµ„æºã€‚å¦å¤–ï¼Œè§„èŒƒè¦æ±‚ï¼Œå¯¹é‚£äº›å¯èƒ½å¯¹æœåŠ¡å™¨æ•°æ®äº§ç”Ÿå‰¯ä½œç”¨çš„HTTP è¯·æ±‚æ–¹æ³•ï¼ˆç‰¹åˆ«æ˜¯ GET ä»¥å¤–çš„ HTTP è¯·æ±‚ï¼Œæˆ–è€…æ­é…æŸäº› MIME ç±»å‹çš„ POST è¯·æ±‚ï¼‰ï¼Œæµè§ˆå™¨å¿…é¡»é¦–å…ˆä½¿ç”¨ OPTIONS æ–¹æ³•å‘èµ·ä¸€ä¸ªé¢„æ£€è¯·æ±‚ï¼ˆpreflight requestï¼‰ï¼Œä»è€Œè·çŸ¥æœåŠ¡ç«¯æ˜¯å¦å…è®¸è¯¥è·¨åŸŸè¯·æ±‚ã€‚æœåŠ¡å™¨ç¡®è®¤å…è®¸ä¹‹åï¼Œæ‰å‘èµ·å®é™…çš„ HTTP è¯·æ±‚ã€‚åœ¨é¢„æ£€è¯·æ±‚çš„è¿”å›ä¸­ï¼ŒæœåŠ¡å™¨ç«¯ä¹Ÿå¯ä»¥é€šçŸ¥å®¢æˆ·ç«¯ï¼Œæ˜¯å¦éœ€è¦æºå¸¦èº«ä»½å‡­è¯ï¼ˆåŒ…æ‹¬ Cookies å’Œ HTTP è®¤è¯ç›¸å…³æ•°æ®ï¼‰ã€‚ é‚£ä¹ˆ, å…è®¸è·¨åŸŸ, ä¸å°±æ˜¯æœåŠ¡ç«¯(ä¾‹å¦‚Nginxæˆ–è€…åç«¯ä»£ç )è®¾ç½®Access-Control-Allow-Origin: *å°±å¯ä»¥äº†å—? æ™®é€šçš„è¯·æ±‚ç¡®å®æ˜¯è¿™æ ·å­çš„, é™¤æ­¤ä¹‹å¤–, è¿˜ä¸€ç§å«è¯·æ±‚å«Preflighted Requestï¼ˆå¸¦é¢„æ£€çš„è·¨åŸŸè¯·æ±‚ï¼‰ Preflighted Requeståœ¨å‘é€çœŸæ­£çš„è¯·æ±‚å‰, ä¼šå…ˆå‘é€ä¸€ä¸ªæ–¹æ³•ä¸ºOPTIONSçš„é¢„è¯·æ±‚(Preflighted Request), ç”¨äºè¯•æ¢æœåŠ¡ç«¯æ˜¯å¦èƒ½æ¥å—çœŸæ­£çš„è¯·æ±‚. å¦‚æœoptionsè·å¾—çš„å›åº”æ˜¯æ‹’ç»æ€§è´¨çš„ï¼Œæ¯”å¦‚404\\403\\500ç­‰httpçŠ¶æ€ï¼Œå°±ä¼šåœæ­¢postã€getç­‰è¯·æ±‚çš„å‘å‡ºã€‚ é‚£ä¹ˆ, ä»€ä¹ˆæƒ…å†µä¸‹è¯·æ±‚ä¼šå˜æˆPreflighted Requestå‘¢? ç¿»çœ‹äº†MDNçš„æ–‡æ¡£å‘ç°å¦‚ä¸‹ï¼š(æ–‡æ¡£åœ°å€ï¼šhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#The_HTTP_request_headers) è¯·æ±‚æ–¹æ³•ä¸æ˜¯GET/HEAD/POST POSTè¯·æ±‚çš„Content-Typeå¹¶éapplication/x-www-form-urlencoded, multipart/form-data, æˆ–text/plain è¯·æ±‚è®¾ç½®äº†è‡ªå®šä¹‰çš„headerå­—æ®µ ä¸¾ä¸ªä¾‹å­, å¦‚æœPOSTè¯·æ±‚è¦ä¼ è¾“çš„æ•°æ®ä¸º XMLæ–‡æ¡£, Content-Typeä¸ºapplication/xmlæˆ–text/xml, åˆ™å‘é€è¿™ä¸ªè¯·æ±‚å‰ä¼šå‘é€ä¸€ä¸ªé¢„è¯·æ±‚ï¼Œæˆ–è€…è‡ªå®šä¹‰çš„headerå­—æ®µä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ã€‚ æœ‰äº†ä¸Šé¢çš„çŸ¥è¯†ç‚¹, å†å»çœ‹é¡¹ç›®ä¸­ajaxè°ƒç”¨ å¯ä»¥çœ‹å‡º, è·¨åŸŸè¯·æ±‚ä¸­è®¾ç½®äº†è‡ªå®šä¹‰çš„headerå­—æ®µ, æ‰€ä»¥è¯¥è¯·æ±‚æ˜¯preflighted request, åˆ™è¯·æ±‚å‰ä¸€å®šä¼šå‘é€ä¸€ä¸ªOPTIONSä½œä¸ºé¢„è¯·æ±‚. æ‰€ä»¥è¯´, åœ¨é¡¹ç›®ä¸­ajaxå¯¹åå°APIçš„è°ƒç”¨, OPTIONSè¯·æ±‚æ˜¯æ²¡åŠæ³•å»æ‰çš„, é™¤éåå°æ¥å£ä¸å†éœ€è¦åœ¨è¯·æ±‚headerä¸­è®¾ç½®openIdä½†æ˜¯ç”±äºè¯¥é¡¹ç›®ä¸­ç”¨æˆ·ä¿¡æ¯æ˜¯é‡‡ç”¨çš„JWTçš„æ–¹å¼ï¼Œæ‰€ä»¥åªå¥½ä½œç½¢ã€‚ ä½†æ˜¯ç”±äºè¯¥é¡¹ç›®åœ¨åå°ä¸­è‡ªå®šä¹‰äº†è¯·æ±‚é¢‘ç‡é™åˆ¶çš„æ‹¦æˆªå™¨ï¼Œä¾‹å¦‚é™åˆ¶åŒä¸€ä¸ªå®¢æˆ·ç«¯ä¸€ç§’å†…å¯¹æŸä¸€ä¸ªæ¥å£åªèƒ½è®¿é—®1æ¬¡ã€‚å¦‚æœè¶…è¿‡é™åˆ¶ï¼Œåˆ™ç¬¬äºŒæ¬¡ä¼šè¿”å›çŠ¶æ€ç 500ï¼Œä¸äºˆå¤„ç†ã€‚å¦‚æœæ¯æ¬¡è¯·æ±‚å‰éƒ½å¸¦ç€ä¸€æ¬¡OPTIONSè¯·æ±‚ï¼Œåˆ™è¯¥æ‹¦æˆªå™¨æ— æ³•æ­£å¸¸å®ç°åŠŸèƒ½ï¼Œåæ­£ä¼šå¯¼è‡´å¤§æ‰¹æ¥å£è°ƒç”¨å¤±è´¥çš„æƒ…å†µã€‚ é‰´äºä¸Šè¿°åˆ†æï¼Œæ—¢ç„¶å‰ç«¯å‘èµ·è¯·æ±‚æ—¶OPTIONSè¯·æ±‚æ²¡æœ‰åŠæ³•å»é™¤ï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥è€ƒè™‘ä»åå°æ‹¦æˆªå™¨è¿›è¡Œæ”¹é€ ã€‚ æ”¹é€ åçš„ä»£ç å¦‚ä¸‹ï¼š å¦‚æœæ‹¦æˆªåˆ°çš„è¯·æ±‚ä¸æ˜¯é¡¹ç›®ä¸­å¸¸è§„çš„GETæˆ–è€…POSTè¯·æ±‚ï¼Œåˆ™è¯¥æ‹¦æˆªå™¨ç›´æ¥æ”¾è¡Œã€‚è‡³æ­¤ï¼Œé—®é¢˜å®Œç¾è§£å†³ã€‚ nginx åŸç† master-workers çš„æœºåˆ¶çš„å¥½å¤„ é¦–å…ˆï¼Œå¯¹äºæ¯ä¸ª worker è¿›ç¨‹æ¥è¯´ï¼Œç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸éœ€è¦åŠ é”ï¼Œæ‰€ä»¥çœæ‰äº†é”å¸¦æ¥çš„å¼€é”€ï¼Œ åŒæ—¶åœ¨ç¼–ç¨‹ä»¥åŠé—®é¢˜æŸ¥æ‰¾æ—¶ï¼Œä¹Ÿä¼šæ–¹ä¾¿å¾ˆå¤šã€‚å…¶æ¬¡ï¼Œé‡‡ç”¨ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå¯ä»¥è®©äº’ç›¸ä¹‹é—´ä¸ä¼š å½±å“ï¼Œä¸€ä¸ªè¿›ç¨‹é€€å‡ºåï¼Œå…¶å®ƒè¿›ç¨‹è¿˜åœ¨å·¥ä½œï¼ŒæœåŠ¡ä¸ä¼šä¸­æ–­ï¼Œmaster è¿›ç¨‹åˆ™å¾ˆå¿«å¯åŠ¨æ–°çš„ worker è¿›ç¨‹ã€‚å½“ç„¶ï¼Œworker è¿›ç¨‹çš„å¼‚å¸¸é€€å‡ºï¼Œè‚¯å®šæ˜¯ç¨‹åºæœ‰ bug äº†ï¼Œå¼‚å¸¸é€€å‡ºï¼Œä¼šå¯¼è‡´å½“ å‰ worker ä¸Šçš„æ‰€æœ‰è¯·æ±‚å¤±è´¥ï¼Œä¸è¿‡ä¸ä¼šå½±å“åˆ°æ‰€æœ‰è¯·æ±‚ï¼Œæ‰€ä»¥é™ä½äº†é£é™©ã€‚ éœ€è¦è®¾ç½®å¤šå°‘ä¸ªworker Nginx åŒ redis ç±»ä¼¼éƒ½é‡‡ç”¨äº† io å¤šè·¯å¤ç”¨æœºåˆ¶ï¼Œæ¯ä¸ª worker éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä½†æ¯ä¸ªè¿›ç¨‹é‡Œåªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œé€šè¿‡å¼‚æ­¥éé˜»å¡çš„æ–¹å¼æ¥å¤„ç†è¯·æ±‚ï¼Œ å³ä½¿æ˜¯åƒä¸Šä¸‡ä¸ªè¯·æ±‚ä¹Ÿä¸åœ¨è¯ä¸‹ã€‚æ¯ä¸ª worker çš„çº¿ç¨‹å¯ä»¥æŠŠä¸€ä¸ª cpu çš„æ€§èƒ½å‘æŒ¥åˆ°æè‡´ã€‚æ‰€ä»¥ worker æ•°å’ŒæœåŠ¡å™¨çš„cpuæ•°ç›¸ç­‰æ˜¯æœ€ä¸ºé€‚å®œçš„ã€‚è®¾å°‘äº†ä¼šæµªè´¹ cpuï¼Œè®¾å¤šäº†ä¼šé€ æˆ cpu é¢‘ç¹åˆ‡æ¢ä¸Šä¸‹æ–‡å¸¦æ¥çš„æŸè€—ã€‚ è®¾ç½® worker æ•°é‡ worker_processes 4 #work ç»‘å®š cpu(4 work ç»‘å®š 4cpu)ã€‚ worker_cpu_affinity 0001 0010 0100 1000 #work ç»‘å®š cpu (4 work ç»‘å®š 8cpu ä¸­çš„ 4 ä¸ª) ã€‚ worker_cpu_affinity 0000001 00000010 00000100 00001000 è¿æ¥æ•° worker_connection è¿™ä¸ªå€¼æ˜¯è¡¨ç¤ºæ¯ä¸ª worker è¿›ç¨‹æ‰€èƒ½å»ºç«‹è¿æ¥çš„æœ€å¤§å€¼ï¼Œæ‰€ä»¥ï¼Œä¸€ä¸ª nginx èƒ½å»ºç«‹çš„æœ€å¤§è¿æ¥æ•°ï¼Œåº”è¯¥æ˜¯ worker_connections * worker_processes å½“ç„¶ï¼Œè¿™é‡Œè¯´çš„æ˜¯æœ€å¤§è¿æ¥æ•°ï¼Œå¯¹äºHTTP è¯· æ±‚ æœ¬ åœ° èµ„ æº æ¥ è¯´ ï¼Œ èƒ½ å¤Ÿ æ”¯ æŒ çš„ æœ€ å¤§ å¹¶ å‘ æ•° é‡ æ˜¯ worker_connections * worker_processes å¦‚æœæ˜¯æ”¯æŒ http1.1 çš„æµè§ˆå™¨æ¯æ¬¡è®¿é—®è¦å ä¸¤ä¸ªè¿æ¥ï¼Œæ‰€ä»¥æ™®é€šçš„é™æ€è®¿é—®æœ€å¤§å¹¶å‘æ•°æ˜¯ï¼š worker_connections * worker_processes /2 è€Œå¦‚æœæ˜¯ HTTP ä½œ ä¸ºåå‘ä»£ç†æ¥è¯´ï¼Œæœ€å¤§å¹¶å‘æ•°é‡åº”è¯¥æ˜¯ worker_connections * worker_processes/4 å› ä¸ºä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œæ¯ä¸ªå¹¶å‘ä¼šå»ºç«‹ä¸å®¢æˆ·ç«¯çš„è¿æ¥å’Œä¸åç«¯æœåŠ¡çš„è¿æ¥ï¼Œä¼šå ç”¨ä¸¤ä¸ªè¿æ¥ã€‚ ","link":"http://blog.ludangxin.club/post/nginx/"},{"title":"SpringBoot  é›†æˆredis","content":"ç®€ä»‹ Redis æ˜¯å®Œå…¨å¼€æºå…è´¹çš„ï¼Œéµå®ˆBSDåè®®ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„key-valueéå…³ç³»æ€§æ•°æ®åº“(NoSql)ã€‚ Redis ä¸å…¶ä»– key - value ç¼“å­˜äº§å“æœ‰ä»¥ä¸‹ä¸‰ä¸ªç‰¹ç‚¹ï¼š Redisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨ã€‚ Redisä¸ä»…ä»…æ”¯æŒç®€å•çš„key-valueç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾›listï¼Œsetï¼Œzsetï¼Œhashç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ã€‚ Redisæ”¯æŒæ•°æ®çš„å¤‡ä»½ï¼Œå³master-slaveæ¨¡å¼çš„æ•°æ®å¤‡ä»½ã€‚ æ•°æ®ç»“æ„ä»‹ç» Rediså¯ä»¥å­˜å‚¨é”®ä¸5ç§ä¸åŒæ•°æ®ç»“æ„ç±»å‹ä¹‹é—´çš„æ˜ å°„ï¼Œè¿™5ç§æ•°æ®ç»“æ„ç±»å‹åˆ†åˆ«ä¸ºStringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€Listï¼ˆåˆ—è¡¨ï¼‰ã€Setï¼ˆé›†åˆï¼‰ã€Hashï¼ˆæ•£åˆ—ï¼‰å’Œ Zsetï¼ˆæœ‰åºé›†åˆï¼‰ã€‚ ç»“æ„ç±»å‹ ç»“æ„å­˜å‚¨çš„å€¼ è¯»å†™èƒ½åŠ› String å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–è€…æµ®ç‚¹æ•° å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–è€…å­—ç¬¦ä¸²çš„å…¶ä¸­ä¸€éƒ¨åˆ†æ‰§è¡Œæ“ä½œï¼›å¯¹è±¡å’Œæµ®ç‚¹æ•°æ‰§è¡Œè‡ªå¢(increment)æˆ–è€…è‡ªå‡(decrement) List ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†ä¸€ä¸ªå­—ç¬¦ä¸² ä»é“¾è¡¨çš„ä¸¤ç«¯æ¨å…¥æˆ–è€…å¼¹å‡ºå…ƒç´ ï¼›æ ¹æ®åç§»é‡å¯¹é“¾è¡¨è¿›è¡Œä¿®å‰ª(trim)ï¼›è¯»å–å•ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ï¼›æ ¹æ®å€¼æ¥æŸ¥æ‰¾æˆ–è€…ç§»é™¤å…ƒç´  Set åŒ…å«å­—ç¬¦ä¸²çš„æ— åºæ”¶é›†å™¨(unorderedcollection)ï¼Œå¹¶ä¸”è¢«åŒ…å«çš„æ¯ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€å„ä¸ç›¸åŒ æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªå…ƒç´ ï¼›æ£€æŸ¥ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºæŸä¸ªé›†åˆä¸­ï¼›è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼›ä»é›†åˆé‡Œå–å¼„éšæœºè·å–å…ƒç´  Hash åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨ æ·»åŠ ã€è·å–ã€ç§»é™¤å•ä¸ªé”®å€¼å¯¹ï¼›è·å–æ‰€æœ‰é”®å€¼å¯¹ Zset å­—ç¬¦ä¸²æˆå‘˜(member)ä¸æµ®ç‚¹æ•°åˆ†å€¼(score)ä¹‹é—´çš„æœ‰åºæ˜ å°„ï¼Œå…ƒç´ çš„æ’åˆ—é¡ºåºç”±åˆ†å€¼çš„å¤§å°å†³å®š æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªå…ƒç´ ï¼›æ ¹æ®åˆ†å€¼èŒƒå›´(range)æˆ–è€…æˆå‘˜æ¥è·å–å…ƒç´  redis ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿« å®Œå…¨åŸºäºå†…å­˜ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼Œéå¸¸å¿«é€Ÿã€‚æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œç±»ä¼¼äºHashMapï¼ŒHashMapçš„ä¼˜åŠ¿å°±æ˜¯æŸ¥æ‰¾å’Œæ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼› æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•ï¼ŒRedisä¸­çš„æ•°æ®ç»“æ„æ˜¯ä¸“é—¨è¿›è¡Œè®¾è®¡çš„ï¼› é‡‡ç”¨å•è¿›ç¨‹å•çº¿ç¨‹(è¿™ä¹Ÿè§£é‡Šä¸ºä»€ä¹ˆrediså¯ä»¥å¤„ç†é«˜å¹¶å‘é—®é¢˜)ï¼Œé¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰æ¡ä»¶ï¼Œä¹Ÿä¸å­˜åœ¨å¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹å¯¼è‡´çš„åˆ‡æ¢è€Œæ¶ˆè€— CPUï¼Œä¸ç”¨å»è€ƒè™‘å„ç§é”çš„é—®é¢˜ï¼Œä¸å­˜åœ¨åŠ é”é‡Šæ”¾é”æ“ä½œï¼Œæ²¡æœ‰å› ä¸ºå¯èƒ½å‡ºç°æ­»é”è€Œå¯¼è‡´çš„æ€§èƒ½æ¶ˆè€—ï¼› ä½¿ç”¨å¤šè·¯I/Oå¤ç”¨æ¨¡å‹(æœ€åæœ‰ä»‹ç»)ï¼› ä½¿ç”¨åº•å±‚æ¨¡å‹ä¸åŒï¼Œå®ƒä»¬ä¹‹é—´åº•å±‚å®ç°æ–¹å¼ä»¥åŠä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡çš„åº”ç”¨åè®®ä¸ä¸€æ ·ï¼ŒRedisç›´æ¥è‡ªå·±æ„å»ºäº†VM æœºåˆ¶ ï¼Œå› ä¸ºä¸€èˆ¬çš„ç³»ç»Ÿè°ƒç”¨ç³»ç»Ÿå‡½æ•°çš„è¯ï¼Œä¼šæµªè´¹ä¸€å®šçš„æ—¶é—´å»ç§»åŠ¨å’Œè¯·æ±‚ï¼› æ³¨è§£ä»‹ç» @Cacheable @Cacheable(value=&quot;myCache&quot;)ï¼Œè¿™ä¸ªæ³¨é‡Šçš„æ„æ€æ˜¯ï¼Œå½“è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šä»ä¸€ä¸ªåå«myCache çš„ç¼“å­˜ä¸­æŸ¥è¯¢ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ‰§è¡Œå®é™…çš„æ–¹æ³•ï¼ˆå³æŸ¥è¯¢æ•°æ®åº“ï¼‰ï¼Œå¹¶å°†æ‰§è¡Œçš„ç»“æœå­˜å…¥ç¼“å­˜ä¸­ï¼Œå¦åˆ™è¿”å›ç¼“å­˜ä¸­çš„å¯¹è±¡ã€‚ @CachePut @CachePut çš„ä½œç”¨ ä¸»è¦é’ˆå¯¹æ–¹æ³•é…ç½®ï¼Œèƒ½å¤Ÿæ ¹æ®æ–¹æ³•çš„è¯·æ±‚å‚æ•°å¯¹å…¶ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå’Œ @Cacheable ä¸åŒçš„æ˜¯ï¼Œå®ƒæ¯æ¬¡éƒ½ä¼šè§¦å‘çœŸå®æ–¹æ³•çš„è°ƒç”¨. @CacheEvict @CachEvict çš„ä½œç”¨ ä¸»è¦é’ˆå¯¹æ–¹æ³•é…ç½®ï¼Œèƒ½å¤Ÿæ ¹æ®ä¸€å®šçš„æ¡ä»¶å¯¹ç¼“å­˜è¿›è¡Œæ¸…ç©º @CacheConfig @Cacheable()é‡Œé¢éƒ½æœ‰ä¸€ä¸ªvalueï¼â€œxxxâ€çš„å±æ€§ï¼Œè¿™æ˜¾ç„¶å¦‚æœæ–¹æ³•å¤šäº†ï¼Œå†™èµ·æ¥ä¹Ÿæ˜¯æŒºç´¯çš„ï¼Œå¦‚æœå¯ä»¥ä¸€æ¬¡æ€§å£°æ˜å®Œ é‚£å°±çœäº‹äº†ï¼Œ æ‰€ä»¥ï¼Œæœ‰äº†@CacheConfigè¿™ä¸ªé…ç½®ï¼Œ@CacheConfig is a class-level annotation that allows to share the cache namesï¼Œå¦‚æœä½ åœ¨ä½ çš„æ–¹æ³•å†™åˆ«çš„åå­—ï¼Œé‚£ä¹ˆä¾ç„¶ä»¥æ–¹æ³•çš„åå­—ä¸ºå‡†ã€‚ @Caching @Cachingå¯ä»¥ä½¿æ³¨è§£ç»„åˆä½¿ç”¨,æ¯”å¦‚æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯,æŸ¥è¯¢å®Œçš„ç»“æœä¸º{key = id,value = userInfo},ä½†æˆ‘ä»¬ç°åœ¨ä¸ºäº†æ–¹é,æƒ³ç”¨ç”¨æˆ·çš„æ‰‹æœºå·,é‚®ç®±ç­‰ç¼“å­˜å¯¹åº”ç”¨æˆ·çš„ä¿¡æ¯,è¿™æ—¶å€™æˆ‘ä»¬å°±è¦ä½¿ç”¨@Cachingã€‚ä¾‹: @Caching(put = { @CachePut(value = &quot;user&quot;, key = &quot;#user.id&quot;), @CachePut(value = &quot;user&quot;, key = &quot;#user.username&quot;), @CachePut(value = &quot;user&quot;, key = &quot;#user.email&quot;) }) public User getUserInfo(User user){ ... return user; } é¡¹ç›®ç»“æ„å›¾ç¤º å¼•å…¥æ‰€éœ€ä¾èµ– &lt;!-- redis --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- lettuce pool --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- aop æœ¬é¡¹ç›®ä¸­ä¸ºäº†æ–¹ä¾¿è®°å½•æ—¥å¿— --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- SpringBoot Webå®¹å™¨ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- lombok å·¥å…·ç±»--&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;!-- å•å…ƒæµ‹è¯•ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; é…ç½®application.yml spring: # redis é…ç½® redis: # åœ°å€ host: localhost # ç«¯å£ï¼Œé»˜è®¤ä¸º6379 port: 6379 # å¯†ç  password: # è¿æ¥è¶…æ—¶æ—¶é—´ timeout: 10s lettuce: pool: # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ min-idle: 0 # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ max-idle: 8 # è¿æ¥æ± çš„æœ€å¤§æ•°æ®åº“è¿æ¥æ•° max-active: 8 # #è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ max-wait: -1ms æ·»åŠ é¡¹ç›®é…ç½®ä¿¡æ¯ åˆ›å»ºredisé…ç½®ç±» import org.springframework.cache.annotation.EnableCaching; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.data.redis.connection.RedisConnectionFactory; import org.springframework.data.redis.core.RedisTemplate; import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer; import org.springframework.data.redis.serializer.StringRedisSerializer; import com.fasterxml.jackson.annotation.JsonAutoDetect; import com.fasterxml.jackson.annotation.PropertyAccessor; import com.fasterxml.jackson.databind.ObjectMapper; /** * redisé…ç½®ç±» * @author ludangxin */ @Configuration @EnableCaching public class RedisConfig { @Bean @SuppressWarnings(&quot;all&quot;) public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) { RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;String, Object&gt;(); template.setConnectionFactory(factory); Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class); ObjectMapper om = new ObjectMapper(); om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); jackson2JsonRedisSerializer.setObjectMapper(om); StringRedisSerializer stringRedisSerializer = new StringRedisSerializer(); // keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼ template.setKeySerializer(stringRedisSerializer); // hashçš„keyä¹Ÿé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼ template.setHashKeySerializer(stringRedisSerializer); // valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson template.setValueSerializer(jackson2JsonRedisSerializer); // hashçš„valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson template.setHashValueSerializer(jackson2JsonRedisSerializer); template.afterPropertiesSet(); return template; } } åˆ›å»ºredis util /** * spring redis å·¥å…·ç±» * * @author ludangxin **/ @SuppressWarnings(value = { &quot;unchecked&quot;, &quot;rawtypes&quot; }) @Component public class RedisUtil { @Autowired public RedisTemplate redisTemplate; /** * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰ * * @param key ç¼“å­˜çš„é”®å€¼ * @param value ç¼“å­˜çš„å€¼ * @return ç¼“å­˜çš„å¯¹è±¡ */ public &lt;T&gt; ValueOperations&lt;String, T&gt; setCacheObject(String key, T value) { ValueOperations&lt;String, T&gt; operation = redisTemplate.opsForValue(); operation.set(key, value); return operation; } /** * ç¼“å­˜åŸºæœ¬çš„å¯¹è±¡ï¼ŒIntegerã€Stringã€å®ä½“ç±»ç­‰ * * @param key ç¼“å­˜çš„é”®å€¼ * @param value ç¼“å­˜çš„å€¼ * @param timeout æ—¶é—´ * @param timeUnit æ—¶é—´é¢—ç²’åº¦ * @return ç¼“å­˜çš„å¯¹è±¡ */ public &lt;T&gt; ValueOperations&lt;String, T&gt; setCacheObject(String key, T value, Integer timeout, TimeUnit timeUnit) { ValueOperations&lt;String, T&gt; operation = redisTemplate.opsForValue(); operation.set(key, value, timeout, timeUnit); return operation; } /** * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡ã€‚ * * @param key ç¼“å­˜é”®å€¼ * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ® */ public &lt;T&gt; T getCacheObject(String key) { ValueOperations&lt;String, T&gt; operation = redisTemplate.opsForValue(); return operation.get(key); } /** * åˆ é™¤å•ä¸ªå¯¹è±¡ * * @param key */ public void deleteObject(String key) { redisTemplate.delete(key); } /** * åˆ é™¤é›†åˆå¯¹è±¡ * * @param collection */ public void deleteObject(Collection collection) { redisTemplate.delete(collection); } /** * ç¼“å­˜Listæ•°æ® * * @param key ç¼“å­˜çš„é”®å€¼ * @param dataList å¾…ç¼“å­˜çš„Listæ•°æ® * @return ç¼“å­˜çš„å¯¹è±¡ */ public &lt;T&gt; ListOperations&lt;String, T&gt; setCacheList(String key, List&lt;T&gt; dataList) { ListOperations listOperation = redisTemplate.opsForList(); if (null != dataList) { int size = dataList.size(); for (int i = 0; i &lt; size; i++) { listOperation.leftPush(key, dataList.get(i)); } } return listOperation; } /** * è·å¾—ç¼“å­˜çš„listå¯¹è±¡ * * @param key ç¼“å­˜çš„é”®å€¼ * @return ç¼“å­˜é”®å€¼å¯¹åº”çš„æ•°æ® */ public &lt;T&gt; List&lt;T&gt; getCacheList(String key) { List&lt;T&gt; dataList = new ArrayList&lt;T&gt;(); ListOperations&lt;String, T&gt; listOperation = redisTemplate.opsForList(); Long size = listOperation.size(key); for (int i = 0; i &lt; size; i++) { dataList.add(listOperation.index(key, i)); } return dataList; } /** * ç¼“å­˜Set * * @param key ç¼“å­˜é”®å€¼ * @param dataSet ç¼“å­˜çš„æ•°æ® * @return ç¼“å­˜æ•°æ®çš„å¯¹è±¡ */ public &lt;T&gt; BoundSetOperations&lt;String, T&gt; setCacheSet(String key, Set&lt;T&gt; dataSet) { BoundSetOperations&lt;String, T&gt; setOperation = redisTemplate.boundSetOps(key); Iterator&lt;T&gt; it = dataSet.iterator(); while (it.hasNext()) { setOperation.add(it.next()); } return setOperation; } /** * è·å¾—ç¼“å­˜çš„set * * @param key * @return */ public &lt;T&gt; Set&lt;T&gt; getCacheSet(String key) { Set&lt;T&gt; dataSet = new HashSet&lt;T&gt;(); BoundSetOperations&lt;String, T&gt; operation = redisTemplate.boundSetOps(key); dataSet = operation.members(); return dataSet; } /** * ç¼“å­˜Map * * @param key * @param dataMap * @return */ public &lt;T&gt; HashOperations&lt;String, String, T&gt; setCacheMap(String key, Map&lt;String, T&gt; dataMap) { HashOperations hashOperations = redisTemplate.opsForHash(); if (null != dataMap) { for (Map.Entry&lt;String, T&gt; entry : dataMap.entrySet()) { hashOperations.put(key, entry.getKey(), entry.getValue()); } } return hashOperations; } /** * è·å¾—ç¼“å­˜çš„Map * * @param key * @return */ public &lt;T&gt; Map&lt;String, T&gt; getCacheMap(String key) { Map&lt;String, T&gt; map = redisTemplate.opsForHash().entries(key); return map; } /** * è·å¾—ç¼“å­˜çš„åŸºæœ¬å¯¹è±¡åˆ—è¡¨ * * @param pattern å­—ç¬¦ä¸²å‰ç¼€ * @return å¯¹è±¡åˆ—è¡¨ */ public Collection&lt;String&gt; keys(String pattern) { return redisTemplate.keys(pattern); } } åˆ›å»º aop log åˆ‡é¢ æ–¹ä¾¿è®°å½•æ—¥å¿— import lombok.extern.slf4j.Slf4j; import org.aspectj.lang.JoinPoint; import org.aspectj.lang.annotation.After; import org.aspectj.lang.annotation.Aspect; import org.aspectj.lang.annotation.Pointcut; import org.springframework.stereotype.Component; /** * è®¾ç½®æ—¥å¿—åˆ‡é¢ * @author ludangxin */ @Slf4j @Aspect @Component public class LogAspect { @Pointcut(&quot;execution(public * com.ldx.springboot.service.impl.UserServiceImpl.*(..))&quot;)//åˆ‡å…¥ç‚¹æè¿° public void userServiceLog(){}//ç­¾åï¼Œå¯ä»¥ç†è§£æˆè¿™ä¸ªåˆ‡å…¥ç‚¹çš„ä¸€ä¸ªåç§° @After(&quot;userServiceLog()&quot;) //åœ¨åˆ‡å…¥ç‚¹çš„æ–¹æ³•runä¹‹å‰è¦å¹²çš„ public void logBeforeController(JoinPoint joinPoint) { //ä¸‹é¢è¿™ä¸ªgetSignature().getDeclaringTypeName()æ˜¯è·å–åŒ…+ç±»åçš„ ç„¶ååé¢çš„joinPoint.getSignature.getName()è·å–äº†æ–¹æ³•å log.info(&quot;################æ‰§è¡Œæ–¹æ³• : &quot; + joinPoint.getSignature().getDeclaringTypeName() + &quot;.&quot; + joinPoint.getSignature().getName()); } } åˆ›å»ºç¼“å­˜å¸¸é‡ä¿¡æ¯ public class CacheConstant { /** ç”¨æˆ·ä¿¡æ¯cache */ public static final String USER_CACHE_NAME = &quot;user_cache&quot;; /** ç”¨æˆ·cache key å‰ç¼€ */ public static final String USER_CACHE_KEY_PREFIX = &quot;user_&quot;; } åˆ›å»ºå®ä½“ç±» import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; import java.io.Serializable; @Data @AllArgsConstructor @NoArgsConstructor public class User implements Serializable { private static final long serialVersionUID = 1L; private int id; private String name; private String sex; private int age; private double height; } åˆ›å»ºservice package com.ldx.springboot.service; import com.ldx.springboot.model.User; import java.util.List; /** * ç”¨æˆ·ç®¡ç† * @author ludangxin */ public interface UserService { /** * æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ * @return */ List&lt;User&gt; selectAll(); /** * æ ¹æ®åç§°æ¨¡ç³ŠæŸ¥è¯¢ * @param name * @return */ List&lt;User&gt; selectByNameLike(String name); /** * æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ * @param id * @return */ User getById(int id); /** * æ–°å¢ç”¨æˆ·ä¿¡æ¯ * @param user * @return */ List&lt;User&gt; add(User user); /** * æ›´æ–°ç”¨æˆ·ä¿¡æ¯ * @param user * @return */ List&lt;User&gt; updateById(User user); /** * æ ¹æ®idåˆ é™¤ç”¨æˆ·ä¿¡æ¯ * @return */ List&lt;User&gt; deleteById(int id); /** * åˆ é™¤å…¨éƒ¨ç”¨æˆ·ä¿¡æ¯ * @return */ void deleteAll(); } åˆ›å»ºå®ç°ç±» package com.ldx.springboot.service.impl; import com.ldx.springboot.constant.CacheConstant; import com.ldx.springboot.model.User; import com.ldx.springboot.service.UserService; import lombok.extern.slf4j.Slf4j; import org.springframework.cache.annotation.*; import org.springframework.stereotype.Service; import java.util.ArrayList; import java.util.Iterator; import java.util.List; import java.util.stream.Collectors; /** * ç”¨æˆ·ç®¡ç†å®ç°ç±» * @author ludangxin */ @Slf4j @CacheConfig(cacheNames = CacheConstant.USER_CACHE_NAME) @Service(value = &quot;userService&quot;) public class UserServiceImpl implements UserService { //æ•°æ®æº static List&lt;User&gt; users = new ArrayList&lt;&gt;(); static{ User user1 = new User(1,&quot;å¼ ä¸‰&quot;,&quot;ç”·&quot;,18,178.5); User user2 = new User(2,&quot;æå››&quot;,&quot;ç”·&quot;,16,172.3); User user3 = new User(3,&quot;ç‹äº”&quot;,&quot;ç”·&quot;,22,180); User user4 = new User(4,&quot;ç‹éº»å­&quot;,&quot;ç”·&quot;,33,185); User user5 = new User(5,&quot;å°çº¢&quot;,&quot;å¥³&quot;,18,160); User user6 = new User(6,&quot;å°ç»¿&quot;,&quot;å¥³&quot;,17,160); User user7 = new User(7,&quot;å°è“&quot;,&quot;å¥³&quot;,19,160); users.add(user1); users.add(user2); users.add(user3); users.add(user4); users.add(user5); users.add(user6); users.add(user7); } @Cacheable(key = &quot;'&quot;+CacheConstant.USER_CACHE_KEY_PREFIX+&quot;all'&quot;) @Override public List&lt;User&gt; selectAll() { return users; } @Cacheable(key = &quot;'&quot;+CacheConstant.USER_CACHE_KEY_PREFIX+&quot;'+#name&quot;) @Override public List&lt;User&gt; selectByNameLike(String name) { List&lt;User&gt; listUser = users.stream().filter(obj -&gt; obj.getName().contains(name)).collect(Collectors.toList()); return listUser; } @Cacheable(key = &quot;'&quot;+CacheConstant.USER_CACHE_KEY_PREFIX+&quot;'+#id&quot;) @Override public User getById(int id) { User user = users.stream().filter(obj -&gt; obj.getId() == id).findFirst().get(); return user; } @CachePut(key = &quot;'&quot;+CacheConstant.USER_CACHE_KEY_PREFIX+&quot;all'&quot;) @Override public List&lt;User&gt; add(User user) { users.add(user); return users; } @Caching(put = {@CachePut(key = &quot;'&quot;+CacheConstant.USER_CACHE_KEY_PREFIX+&quot;all'&quot;)}, evict = {@CacheEvict(key = &quot;'&quot;+CacheConstant.USER_CACHE_KEY_PREFIX+&quot;'+#user.id&quot;)} ) @Override public List&lt;User&gt; updateById(User user) { for (int i = 0; i &lt; users.size(); i++) { if(users.get(i).getId() == user.getId()){ users.set(i,user); } } return users; } @Caching(put = {@CachePut(key = &quot;'&quot;+CacheConstant.USER_CACHE_KEY_PREFIX+&quot;all'&quot;)}, evict = {@CacheEvict(key= &quot;'&quot;+CacheConstant.USER_CACHE_KEY_PREFIX+&quot;'+#id&quot;)} ) @Override public List&lt;User&gt; deleteById(int id) { Iterator&lt;User&gt; iterator = users.iterator(); while(iterator.hasNext()) { User user = iterator.next(); if(user.getId() == id){ iterator.remove(); } } return users; } @CacheEvict(allEntries = true) @Override public void deleteAll() { users = new ArrayList&lt;&gt;(); } } åˆ›å»ºæµ‹è¯•ç±» import com.ldx.springboot.model.User; import lombok.extern.slf4j.Slf4j; import org.junit.jupiter.api.Test; import org.junit.runner.RunWith; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.test.context.junit4.SpringRunner; import javax.annotation.Resource; import java.util.List; @Slf4j @RunWith(SpringRunner.class) @SpringBootTest class UserServiceTest { @Resource(name = &quot;userService&quot;) UserService userService; @Test void selectAll() { List&lt;User&gt; users = userService.selectAll(); users.forEach(System.out::println); } @Test void selectByNameLike() { String keywork = &quot;å°&quot;; List&lt;User&gt; users = userService.selectByNameLike(keywork); users.forEach(System.out::println); } @Test void getById() { int id = 3; User user = userService.getById(id); log.info(user.toString()); } @Test void add() { User user = new User(6,&quot;å°ç²‰&quot;,&quot;å¥³&quot;,16,155); userService.add(user); selectAll(); } @Test void updateById() { User user = new User(3,&quot;å°ç²‰&quot;,&quot;å¥³&quot;,16,155); userService.updateById(user); selectAll(); } @Test void deleteById() { userService.deleteById(5); } @Test void deleteAll() { userService.deleteAll(); } } redis å®‰è£… å®‰è£…gcc ç”±äº redis æ˜¯ç”¨ C è¯­è¨€å¼€å‘ï¼Œå®‰è£…ä¹‹å‰å¿…å…ˆç¡®è®¤æ˜¯å¦å®‰è£… gcc ç¯å¢ƒï¼ˆgcc -vï¼‰ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£… yum install -y gcc ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ… wget http://download.redis.io/releases/redis-5.0.3.tar.gz tar -zxvf redis-5.0.3.tar.gz æ‰§è¡Œç¼–è¯‘ cd redis-5.0.3 make å®‰è£…å¹¶æŒ‡å®šå®‰è£…ç›®å½• make install PREFIX=/usr/local/redis å¯åŠ¨æœåŠ¡ å‰å°å¯åŠ¨ cd /usr/local/redis/bin/ ./redis-server åå°å¯åŠ¨ ä»redisçš„æºç ç›®å½•ä¸­å¤åˆ¶redis.confåˆ°redisçš„å®‰è£…ç›®å½• cp /usr/local/redis-5.0.3/redis.conf /usr/local/redis/bin/ ä¿®æ”¹redis.conf æ–‡ä»¶ï¼ŒæŠŠ daemonize no æ”¹ä¸º daemonize yes vi redis.conf ################################# GENERAL ##################################### # By default Redis does not run as a daemon. Use 'yes' if you need it. # Note that Redis will write a pid file in /var/run/redis.pid when daemonized. daemonize yes åå°å¯åŠ¨ ./redis-server redis.conf # æŸ¥çœ‹redisè¿›ç¨‹çŠ¶æ€ ps -ef | grep redis è®¾ç½®å¼€æœºå¯åŠ¨ æ·»åŠ å¼€æœºå¯åŠ¨æœåŠ¡ vi /etc/systemd/system/redis.service æ·»åŠ ä»¥ä¸‹å†…å®¹ [Unit] Description=redis-server After=network.target [Service] Type=forking ExecStart=/usr/local/redis/bin/redis-server /usr/local/redis/bin/redis.conf PrivateTmp=true [Install] WantedBy=multi-user.target æ³¨æ„ : ExecStarté…ç½®æˆè‡ªå·±çš„è·¯å¾„ è®¾ç½®å¼€æœºå¯åŠ¨ systemctl daemon-reload systemctl start redis.service systemctl enable redis.service åˆ›å»ºrediså‘½ä»¤è½¯é“¾æ¥ ln -s /usr/local/redis/bin/redis-cli /usr/bin/redis æµ‹è¯• ç›´æ¥è¾“å…¥redis [root@iZ2ze ~]# redis 127.0.0.1:6379&gt; æœåŠ¡æ“ä½œå‘½ä»¤ systemctl start redis.service #å¯åŠ¨redisæœåŠ¡ systemctl stop redis.service #åœæ­¢redisæœåŠ¡ systemctl restart redis.service #é‡æ–°å¯åŠ¨æœåŠ¡ systemctl status redis.service #æŸ¥çœ‹æœåŠ¡å½“å‰çŠ¶æ€ systemctl enable redis.service #è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ systemctl disable redis.service #åœæ­¢å¼€æœºè‡ªå¯åŠ¨ ç¼“å­˜é›ªå´© ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨æˆ‘ä»¬è®¾ç½®ç¼“å­˜æ—¶é‡‡ç”¨äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´ç¼“å­˜åœ¨æŸä¸€æ—¶åˆ»åŒæ—¶å¤±æ•ˆï¼Œè¯·æ±‚å…¨éƒ¨è½¬å‘åˆ°DBï¼ŒDBç¬æ—¶å‹åŠ›è¿‡é‡é›ªå´©ã€‚ è§£å†³æ–¹æ¡ˆ ç¼“å­˜å¤±æ•ˆæ—¶çš„é›ªå´©æ•ˆåº”å¯¹åº•å±‚ç³»ç»Ÿçš„å†²å‡»éå¸¸å¯æ€•ã€‚å¤§å¤šæ•°ç³»ç»Ÿè®¾è®¡è€…è€ƒè™‘ç”¨åŠ é”æˆ–è€…é˜Ÿåˆ—çš„æ–¹å¼ä¿è¯ç¼“å­˜çš„å•çº¿ ç¨‹ï¼ˆè¿›ç¨‹ï¼‰å†™ï¼Œä»è€Œé¿å…å¤±æ•ˆæ—¶å¤§é‡çš„å¹¶å‘è¯·æ±‚è½åˆ°åº•å±‚å­˜å‚¨ç³»ç»Ÿä¸Šã€‚è¿™é‡Œåˆ†äº«ä¸€ä¸ªç®€å•æ–¹æ¡ˆå°±æ—¶è®²ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚1-5åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼šé™ä½ï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚ æˆ–è€…è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸï¼Œæœ‰æ›´æ–°æ“ä½œå°±æ›´æ–°ç¼“å­˜å°±å¥½äº†ï¼ˆæ¯”å¦‚è¿ç»´æ›´æ–°äº†é¦–é¡µå•†å“ï¼Œé‚£ä½ åˆ·ä¸‹ç¼“å­˜å°±å®Œäº‹äº†ï¼Œä¸è¦è®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰ï¼Œç”µå•†é¦–é¡µçš„æ•°æ®ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªæ“ä½œï¼Œä¿é™©ã€‚ ç¼“å­˜å‡»ç©¿ å¯¹äºä¸€äº›è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyï¼Œå¦‚æœè¿™äº›keyå¯èƒ½ä¼šåœ¨æŸäº›æ—¶é—´ç‚¹è¢«è¶…é«˜å¹¶å‘åœ°è®¿é—®ï¼Œæ˜¯ä¸€ç§éå¸¸â€œçƒ­ç‚¹â€çš„æ•°æ®ã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šç¼“å­˜è¢«â€œå‡»ç©¿â€çš„é—®é¢˜ï¼Œè¿™ä¸ªå’Œç¼“å­˜é›ªå´©çš„åŒºåˆ«åœ¨äºè¿™é‡Œé’ˆå¯¹æŸä¸€keyç¼“å­˜ï¼Œå‰è€…åˆ™æ˜¯å¾ˆå¤škeyã€‚ ç¼“å­˜åœ¨æŸä¸ªæ—¶é—´ç‚¹è¿‡æœŸçš„æ—¶å€™ï¼Œæ°å¥½åœ¨è¿™ä¸ªæ—¶é—´ç‚¹å¯¹è¿™ä¸ªKeyæœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚ è§£å†³æ–¹æ¡ˆ è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸è¿œä¸è¿‡æœŸæˆ–ä½¿ç”¨äº’æ–¥é”(mutex key) ä¸šç•Œæ¯”è¾ƒå¸¸ç”¨çš„åšæ³•ï¼Œæ˜¯ä½¿ç”¨mutexã€‚ç®€å•åœ°æ¥è¯´ï¼Œå°±æ˜¯åœ¨ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ï¼ˆåˆ¤æ–­æ‹¿å‡ºæ¥çš„å€¼ä¸ºç©ºï¼‰ï¼Œä¸æ˜¯ç«‹å³å»load dbï¼Œè€Œæ˜¯å…ˆä½¿ç”¨ç¼“å­˜å·¥å…·çš„æŸäº›å¸¦æˆåŠŸæ“ä½œè¿”å›å€¼çš„æ“ä½œï¼ˆæ¯”å¦‚Redisçš„SETNXæˆ–è€…Memcacheçš„ADDï¼‰å»setä¸€ä¸ªmutex keyï¼Œå½“æ“ä½œè¿”å›æˆåŠŸæ—¶ï¼Œå†è¿›è¡Œload dbçš„æ“ä½œå¹¶å›è®¾ç¼“å­˜ï¼›å¦åˆ™ï¼Œå°±é‡è¯•æ•´ä¸ªgetç¼“å­˜çš„æ–¹æ³•ã€‚ SETNXï¼Œæ˜¯ã€ŒSET if Not eXistsã€çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯åªæœ‰ä¸å­˜åœ¨çš„æ—¶å€™æ‰è®¾ç½®ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥å®ç°é”çš„æ•ˆæœã€‚ ç¼“å­˜ç©¿é€ ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶è¢«åŠ¨å†™çš„ï¼Œå¹¶ä¸”å‡ºäºå®¹é”™è€ƒè™‘ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚åœ¨æµé‡å¤§æ—¶ï¼Œå¯èƒ½DBå°±æŒ‚æ‰äº†ï¼Œè¦æ˜¯æœ‰äººåˆ©ç”¨ä¸å­˜åœ¨çš„keyé¢‘ç¹æ”»å‡»æˆ‘ä»¬çš„åº”ç”¨ï¼Œè¿™å°±æ˜¯æ¼æ´ã€‚ è§£å†³æ–¹æ¡ˆ å¸ƒéš†è¿‡æ»¤å¯¹æ‰€æœ‰çš„å¯èƒ½æŸ¥è¯¢çš„å‚æ•°ä»¥hashå½¢å¼å­˜å‚¨,åœ¨æ§åˆ¶å™¨å±‚å…ˆè¿›è¡Œæ ¡éªŒ,ä¸ç¬¦åˆåˆ™ä¸¢å¼ƒ,ä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚bloomfilterå°±ç±»ä¼¼äºä¸€ä¸ªhash setï¼Œç”¨äºå¿«é€Ÿåˆ¤æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨äºé›†åˆä¸­ï¼Œå…¶å…¸å‹çš„åº”ç”¨åœºæ™¯å°±æ˜¯å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªkeyæ˜¯å¦å­˜åœ¨äºæŸå®¹å™¨ï¼Œä¸å­˜åœ¨å°±ç›´æ¥è¿”å›ã€‚ä¸¾ä¾‹:å°†çœŸå®æ­£ç¡®Idåœ¨æ·»åŠ å®Œæˆä¹‹åä¾¿åŠ å…¥åˆ°è¿‡æ»¤å™¨å½“ä¸­ï¼Œæ¯æ¬¡å†è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œå…ˆç¡®è®¤è¦æŸ¥è¯¢çš„Idæ˜¯å¦åœ¨è¿‡æ»¤å™¨ä¸­ï¼Œå¦‚æœä¸åœ¨ï¼Œåˆ™è¯´æ˜Idä¸ºéæ³•Idã€‚ ç¼“å­˜ç©ºå¯¹è±¡å½“ä»æ•°æ®åº“æŸ¥è¯¢ä¸åˆ°å€¼ï¼Œå°±æŠŠå‚æ•°å’Œæ§åˆ¶ç¼“å­˜èµ·æ¥ï¼Œè®¾ç½®ä¸€ä¸ªç®€çŸ­çš„è¿‡æœŸæ—¶é—´(å› ä¸ºç¼“å­˜æ˜¯éœ€è¦å†…å­˜çš„ï¼Œå¦‚æœæœ‰è¿‡å¤šç©ºå€¼keyï¼Œå ç”¨å†…å­˜å¤š),åœ¨è¯¥æ—¶é—´æ®µå¦‚æœæœ‰æºå¸¦æ­¤å‚æ•°å†æ¬¡è¯·æ±‚ï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›ã€‚å¯èƒ½å¯¼è‡´è¯¥æ®µæ—¶é—´ç¼“å­˜å±‚å’Œæ•°æ®åº“æ•°æ®ä¸ä¸€è‡´ï¼Œå¯¹äºéœ€è¦ä¿æŒä¸€è‡´æ€§çš„ä¸šåŠ¡æœ‰å½±å“ã€‚ ä»€ä¹ˆæ˜¯å¤šè·¯I/Oå¤ç”¨æ¨¡å‹? é€šä¿—æ˜“æ‡‚çš„ä¾‹å­: å‡è®¾ä½ æ˜¯ä¸€ä¸ªè€å¸ˆï¼Œè®©30ä¸ªå­¦ç”Ÿè§£ç­”ä¸€é“é¢˜ç›®ï¼Œç„¶åæ£€æŸ¥å­¦ç”Ÿåšçš„æ˜¯å¦æ­£ç¡®ï¼Œä½ æœ‰ä¸‹é¢å‡ ä¸ªé€‰æ‹©ï¼š ç¬¬ä¸€ç§é€‰æ‹©ï¼šæŒ‰é¡ºåºé€ä¸ªæ£€æŸ¥ï¼Œå…ˆæ£€æŸ¥Aï¼Œç„¶åæ˜¯Bï¼Œä¹‹åæ˜¯Cã€Dã€‚ã€‚ã€‚è¿™ä¸­é—´å¦‚æœæœ‰ä¸€ä¸ªå­¦ç”Ÿå¡ä¸»ï¼Œå…¨ç­éƒ½ä¼šè¢«è€½è¯¯ã€‚è¿™ç§æ¨¡å¼å°±å¥½æ¯”ï¼Œä½ ç”¨å¾ªç¯æŒ¨ä¸ªå¤„ç†socketï¼Œæ ¹æœ¬ä¸å…·æœ‰å¹¶å‘èƒ½åŠ›ã€‚ ç¬¬äºŒç§é€‰æ‹©ï¼šä½ åˆ›å»º30ä¸ªåˆ†èº«ï¼Œæ¯ä¸ªåˆ†èº«æ£€æŸ¥ä¸€ä¸ªå­¦ç”Ÿçš„ç­”æ¡ˆæ˜¯å¦æ­£ç¡®ã€‚ è¿™ç§ç±»ä¼¼äºä¸ºæ¯ä¸€ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹å¤„ç†è¿æ¥ã€‚ ç¬¬ä¸‰ç§é€‰æ‹©ï¼Œä½ ç«™åœ¨è®²å°ä¸Šç­‰ï¼Œè°è§£ç­”å®Œè°ä¸¾æ‰‹ã€‚è¿™æ—¶Cã€Dä¸¾æ‰‹ï¼Œè¡¨ç¤ºä»–ä»¬è§£ç­”é—®é¢˜å®Œæ¯•ï¼Œä½ ä¸‹å»ä¾æ¬¡æ£€æŸ¥Cã€Dçš„ç­”æ¡ˆï¼Œç„¶åç»§ç»­å›åˆ°è®²å°ä¸Šç­‰ã€‚æ­¤æ—¶Eã€Aåˆä¸¾æ‰‹ï¼Œç„¶åå»å¤„ç†Eå’ŒAã€‚ã€‚ã€‚ è¿™ç§å°±æ˜¯IOå¤ç”¨æ¨¡å‹ï¼ŒLinuxä¸‹çš„selectã€pollå’Œepollå°±æ˜¯å¹²è¿™ä¸ªçš„ã€‚å°†ç”¨æˆ·socketå¯¹åº”çš„fdæ³¨å†Œè¿›epollï¼Œç„¶åepollå¸®ä½ ç›‘å¬å“ªäº›socketä¸Šæœ‰æ¶ˆæ¯åˆ°è¾¾ï¼Œè¿™æ ·å°±é¿å…äº†å¤§é‡çš„æ— ç”¨æ“ä½œã€‚æ­¤æ—¶çš„socketåº”è¯¥é‡‡ç”¨éé˜»å¡æ¨¡å¼ã€‚è¿™æ ·ï¼Œæ•´ä¸ªè¿‡ç¨‹åªåœ¨è°ƒç”¨selectã€pollã€epollè¿™äº›è°ƒç”¨çš„æ—¶å€™æ‰ä¼šé˜»å¡ï¼Œæ”¶å‘å®¢æˆ·æ¶ˆæ¯æ˜¯ä¸ä¼šé˜»å¡çš„ï¼Œæ•´ä¸ªè¿›ç¨‹æˆ–è€…çº¿ç¨‹å°±è¢«å……åˆ†åˆ©ç”¨èµ·æ¥ï¼Œè¿™å°±æ˜¯äº‹ä»¶é©±åŠ¨ï¼Œæ‰€è°“çš„reactoræ¨¡å¼ã€‚ è½¬è‡ªæŸ´å°çŒ« å†æ¬¡åŠ æ·±ç†è§£ é¦–å…ˆï¼Œè¦ä»ä½ å¸¸ç”¨çš„IOæ“ä½œè°ˆèµ·ï¼Œæ¯”å¦‚readå’Œwriteï¼Œé€šå¸¸IOæ“ä½œéƒ½æ˜¯é˜»å¡I/Oçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä½ è°ƒç”¨readæ—¶ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®æ”¶åˆ°ï¼Œé‚£ä¹ˆçº¿ç¨‹æˆ–è€…è¿›ç¨‹å°±ä¼šè¢«æŒ‚èµ·ï¼Œç›´åˆ°æ”¶åˆ°æ•°æ®ã€‚ è¿™æ ·ï¼Œå½“æœåŠ¡å™¨éœ€è¦å¤„ç†1000ä¸ªè¿æ¥çš„çš„æ—¶å€™ï¼Œè€Œä¸”åªæœ‰å¾ˆå°‘è¿æ¥å¿™ç¢Œçš„ï¼Œé‚£ä¹ˆä¼šéœ€è¦1000ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹æ¥å¤„ç†1000ä¸ªè¿æ¥ï¼Œè€Œ1000ä¸ªçº¿ç¨‹å¤§éƒ¨åˆ†æ˜¯è¢«é˜»å¡èµ·æ¥çš„ã€‚ç”±äºCPUçš„æ ¸æ•°æˆ–è¶…çº¿ç¨‹æ•°ä¸€èˆ¬éƒ½ä¸å¤§ï¼Œæ¯”å¦‚4,8,16,32,64,128ï¼Œæ¯”å¦‚4ä¸ªæ ¸è¦è·‘1000ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆæ¯ä¸ªçº¿ç¨‹çš„æ—¶é—´æ§½éå¸¸çŸ­ï¼Œè€Œçº¿ç¨‹åˆ‡æ¢éå¸¸é¢‘ç¹ã€‚ è¿™æ ·æ˜¯æœ‰é—®é¢˜çš„ï¼š çº¿ç¨‹æ˜¯æœ‰å†…å­˜å¼€é”€çš„ï¼Œ1ä¸ªçº¿ç¨‹å¯èƒ½éœ€è¦512Kï¼ˆæˆ–2Mï¼‰å­˜æ”¾æ ˆï¼Œé‚£ä¹ˆ1000ä¸ªçº¿ç¨‹å°±è¦512Mï¼ˆæˆ–2Gï¼‰å†… å­˜ã€‚ çº¿ç¨‹çš„åˆ‡æ¢ï¼Œæˆ–è€…è¯´ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯æœ‰CPUå¼€é”€çš„ï¼Œå½“å¤§é‡æ—¶é—´èŠ±åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶å€™ï¼Œåˆ†é…ç»™çœŸæ­£çš„æ“ä½œçš„CPUå°±è¦å°‘å¾ˆå¤šã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±è¦å¼•å…¥éé˜»å¡I/Oçš„æ¦‚å¿µï¼Œéé˜»å¡IOå¾ˆç®€å•ï¼Œé€šè¿‡fcntlï¼ˆPOSIXï¼‰æˆ–ioctlï¼ˆUnixï¼‰è®¾ä¸ºéé˜»å¡æ¨¡å¼ï¼Œè¿™æ—¶ï¼Œå½“ä½ è°ƒç”¨readæ—¶ï¼Œå¦‚æœæœ‰æ•°æ®æ”¶åˆ°ï¼Œå°±è¿”å›æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®æ”¶åˆ°ï¼Œå°±ç«‹åˆ»è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œå¦‚EWOULDBLOCKã€‚è¿™æ ·æ˜¯ä¸ä¼šé˜»å¡çº¿ç¨‹äº†ï¼Œä½†æ˜¯ä½ è¿˜æ˜¯è¦ä¸æ–­çš„è½®è¯¢æ¥è¯»å–æˆ–å†™å…¥ã€‚ äºæ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥IOå¤šè·¯å¤ç”¨çš„æ¦‚å¿µã€‚å¤šè·¯å¤ç”¨æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ£€æŸ¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆSocketï¼‰çš„å°±ç»ªçŠ¶æ€ï¼Œæ¯”å¦‚è°ƒç”¨selectå’Œpollå‡½æ•°ï¼Œä¼ å…¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼Œåˆ™è¿”å›ï¼Œå¦åˆ™é˜»å¡ç›´åˆ°è¶…æ—¶ã€‚å¾—åˆ°å°±ç»ªçŠ¶æ€åè¿›è¡ŒçœŸæ­£çš„æ“ä½œå¯ä»¥åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å¯åŠ¨çº¿ç¨‹æ‰§è¡Œï¼ˆæ¯”å¦‚ä½¿ç”¨çº¿ç¨‹æ± ï¼‰ã€‚ è¿™æ ·åœ¨å¤„ç†1000ä¸ªè¿æ¥æ—¶ï¼Œåªéœ€è¦1ä¸ªçº¿ç¨‹ç›‘æ§å°±ç»ªçŠ¶æ€ï¼Œå¯¹å°±ç»ªçš„æ¯ä¸ªè¿æ¥å¼€ä¸€ä¸ªçº¿ç¨‹å¤„ç†å°±å¯ä»¥äº†ï¼Œè¿™æ ·éœ€è¦çš„çº¿ç¨‹æ•°å¤§å¤§å‡å°‘ï¼Œå‡å°‘äº†å†…å­˜å¼€é”€å’Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„CPUå¼€é”€ã€‚ è½¬è‡ªç”¨å¿ƒé˜ ","link":"http://blog.ludangxin.club/post/springboot-ji-cheng-redis/"},{"title":"Docker","content":"ä¸ºä»€ä¹ˆéœ€è¦ docker æ¦‚è¿° ä½œä¸ºä¸€ç§æ–°å…´çš„è™šæ‹ŸåŒ–æ–¹å¼ï¼ŒDocker è·Ÿä¼ ç»Ÿçš„è™šæ‹ŸåŒ–æ–¹å¼ç›¸æ¯”å…·æœ‰ä¼—å¤šçš„ä¼˜åŠ¿ã€‚ æ›´é«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº ç”±äºå®¹å™¨ä¸éœ€è¦è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿä»¥åŠè¿è¡Œå®Œæ•´æ“ä½œç³»ç»Ÿç­‰é¢å¤–å¼€é”€ï¼ŒDocker å¯¹ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡æ›´é«˜ã€‚æ— è®ºæ˜¯åº”ç”¨æ‰§è¡Œé€Ÿåº¦ã€å†…å­˜æŸè€—æˆ–è€…æ–‡ä»¶å­˜å‚¨é€Ÿåº¦ï¼Œéƒ½è¦æ¯”ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ›´é«˜æ•ˆã€‚å› æ­¤ï¼Œç›¸æ¯”è™šæ‹ŸæœºæŠ€æœ¯ï¼Œä¸€ä¸ªç›¸åŒé…ç½®çš„ä¸»æœºï¼Œå¾€å¾€å¯ä»¥è¿è¡Œæ›´å¤šæ•°é‡çš„åº”ç”¨ã€‚ æ›´å¿«é€Ÿçš„å¯åŠ¨æ—¶é—´ ä¼ ç»Ÿçš„è™šæ‹ŸæœºæŠ€æœ¯å¯åŠ¨åº”ç”¨æœåŠ¡å¾€å¾€éœ€è¦æ•°åˆ†é’Ÿï¼Œè€Œ Docker å®¹å™¨åº”ç”¨ï¼Œç”±äºç›´æ¥è¿è¡Œäºå®¿ä¸»å†…æ ¸ï¼Œæ— éœ€å¯åŠ¨å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œå› æ­¤å¯ä»¥åšåˆ°ç§’çº§ã€ç”šè‡³æ¯«ç§’çº§çš„å¯åŠ¨æ—¶é—´ã€‚å¤§å¤§çš„èŠ‚çº¦äº†å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²çš„æ—¶é—´ã€‚ ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ å¼€å‘è¿‡ç¨‹ä¸­ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ç¯å¢ƒä¸€è‡´æ€§é—®é¢˜ã€‚ç”±äºå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒä¸ä¸€è‡´ï¼Œå¯¼è‡´æœ‰äº› bug å¹¶æœªåœ¨å¼€å‘è¿‡ç¨‹ä¸­è¢«å‘ç°ã€‚è€Œ Docker çš„é•œåƒæä¾›äº†é™¤å†…æ ¸å¤–å®Œæ•´çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œç¡®ä¿äº†åº”ç”¨è¿è¡Œç¯å¢ƒä¸€è‡´æ€§ï¼Œä»è€Œä¸ä¼šå†å‡ºç° ã€Œè¿™æ®µä»£ç åœ¨æˆ‘æœºå™¨ä¸Šæ²¡é—®é¢˜å•Šã€ è¿™ç±»é—®é¢˜ã€‚ æŒç»­äº¤ä»˜å’Œéƒ¨ç½² å¯¹å¼€å‘å’Œè¿ç»´(DevOps)äººå‘˜æ¥è¯´ï¼Œæœ€å¸Œæœ›çš„å°±æ˜¯ä¸€æ¬¡åˆ›å»ºæˆ–é…ç½®ï¼Œå¯ä»¥åœ¨ä»»æ„åœ°æ–¹æ­£å¸¸è¿è¡Œã€‚ ä½¿ç”¨ Docker å¯ä»¥é€šè¿‡å®šåˆ¶åº”ç”¨é•œåƒæ¥å®ç°æŒç»­é›†æˆã€æŒç»­äº¤ä»˜ã€éƒ¨ç½²ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ Dockerfile æ¥è¿›è¡Œé•œåƒæ„å»ºï¼Œå¹¶ç»“åˆæŒç»­é›†æˆ(Continuous Integration)ç³»ç»Ÿè¿›è¡Œé›†æˆæµ‹è¯•ï¼Œè€Œè¿ç»´äººå‘˜åˆ™å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¿«é€Ÿéƒ¨ç½²è¯¥é•œåƒï¼Œç”šè‡³ç»“åˆ æŒç»­éƒ¨ç½²(Continuous Delivery/Deployment) ç³»ç»Ÿè¿›è¡Œè‡ªåŠ¨éƒ¨ç½²ã€‚ è€Œä¸”ä½¿ç”¨ Dockerfile ä½¿é•œåƒæ„å»ºé€æ˜åŒ–ï¼Œä¸ä»…ä»…å¼€å‘å›¢é˜Ÿå¯ä»¥ç†è§£åº”ç”¨è¿è¡Œç¯å¢ƒï¼Œä¹Ÿæ–¹ä¾¿è¿ç»´å›¢é˜Ÿç†è§£åº”ç”¨è¿è¡Œæ‰€éœ€æ¡ä»¶ï¼Œå¸®åŠ©æ›´å¥½çš„ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²è¯¥é•œåƒã€‚ æ›´è½»æ¾çš„è¿ç§» ç”±äº Docker ç¡®ä¿äº†æ‰§è¡Œç¯å¢ƒçš„ä¸€è‡´æ€§ï¼Œä½¿å¾—åº”ç”¨çš„è¿ç§»æ›´åŠ å®¹æ˜“ã€‚Docker å¯ä»¥åœ¨å¾ˆå¤šå¹³å°ä¸Šè¿è¡Œï¼Œæ— è®ºæ˜¯ç‰©ç†æœºã€è™šæ‹Ÿæœºã€å…¬æœ‰äº‘ã€ç§æœ‰äº‘ï¼Œç”šè‡³æ˜¯ç¬”è®°æœ¬ï¼Œå…¶è¿è¡Œç»“æœæ˜¯ä¸€è‡´çš„ã€‚å› æ­¤ç”¨æˆ·å¯ä»¥å¾ˆè½»æ˜“çš„å°†åœ¨ä¸€ä¸ªå¹³å°ä¸Šè¿è¡Œçš„åº”ç”¨ï¼Œè¿ç§»åˆ°å¦ä¸€ä¸ªå¹³å°ä¸Šï¼Œè€Œä¸ç”¨æ‹…å¿ƒè¿è¡Œç¯å¢ƒçš„å˜åŒ–å¯¼è‡´åº”ç”¨æ— æ³•æ­£å¸¸è¿è¡Œçš„æƒ…å†µã€‚ æ›´è½»æ¾çš„ç»´æŠ¤å’Œæ‰©å±• Docker ä½¿ç”¨çš„åˆ†å±‚å­˜å‚¨ä»¥åŠé•œåƒçš„æŠ€æœ¯ï¼Œä½¿å¾—åº”ç”¨é‡å¤éƒ¨åˆ†çš„å¤ç”¨æ›´ä¸ºå®¹æ˜“ï¼Œä¹Ÿä½¿å¾—åº”ç”¨çš„ç»´æŠ¤æ›´æ–°æ›´åŠ ç®€å•ï¼ŒåŸºäºåŸºç¡€é•œåƒè¿›ä¸€æ­¥æ‰©å±•é•œåƒä¹Ÿå˜å¾—éå¸¸ç®€å•ã€‚æ­¤å¤–ï¼ŒDocker å›¢é˜ŸåŒå„ä¸ªå¼€æºé¡¹ç›®å›¢é˜Ÿä¸€èµ·ç»´æŠ¤äº†ä¸€å¤§æ‰¹é«˜è´¨é‡çš„å®˜æ–¹é•œåƒï¼Œæ—¢å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œåˆå¯ä»¥ä½œä¸ºåŸºç¡€è¿›ä¸€æ­¥å®šåˆ¶ï¼Œå¤§å¤§çš„é™ä½äº†åº”ç”¨æœåŠ¡çš„é•œåƒåˆ¶ä½œæˆæœ¬ã€‚ å¯¹æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ€»ç»“ ç‰¹æ€§ å®¹å™¨ è™šæ‹Ÿæœº å¯åŠ¨ ç§’çº§ åˆ†é’Ÿçº§ ç¡¬ç›˜ä½¿ç”¨ ä¸€èˆ¬ä¸º MB ä¸€èˆ¬ä¸º GB æ€§èƒ½ æ¥è¿‘åŸç”Ÿ å¼±äº ç³»ç»Ÿæ”¯æŒé‡ å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨ ä¸€èˆ¬å‡ åä¸ª å®‰è£…docker Ubuntu apt-get remove docker docker-engine docker.io containerd runc : å¸è½½æ—§ç‰ˆæœ¬docker apt-get update: æ›´æ–°æ•°æ®æº apt-get -y install apt-transport-https ca-certificates curl software-properties-common: å®‰è£…æ‰€éœ€ä¾èµ– curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -:å®‰è£…GPGè¯ä¹¦(é˜²æ­¢ä¸‹è½½æ—¶è¢«äººç¯¡æ”¹) add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot; : æ–°å¢æ•°æ®æºlsb_release -csä¸ºç³»ç»Ÿå˜é‡,å³å½“å‰ç³»ç»Ÿçš„codeName apt-get update &amp;&amp; apt-get install -y docker-ce: æ›´æ–°å¹¶å®‰è£…docker CE docker version:éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ å…¶å®ƒå®‰è£…æ–¹æ³• å®‰è£…å‘½ä»¤ sudo apt install docker.io è§£å†³æ™®é€šç”¨æˆ·ä¸èƒ½ç›´æ¥ä½¿ç”¨ docker å‘½ä»¤ docker ps Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.39/containers/json: dial unix /var/run/docker.sock: connect: permission denied # åˆ›å»º docker ç”¨æˆ·ç»„ sudo groupadd docker # æ·»åŠ å½“å‰ç”¨æˆ·åˆ° docker ç»„ sudo usermod -aG docker $USER # é‡å¯ docker sudo systemctl restart docker newgrp - docker # é‡å¯ç³»ç»Ÿ sudo reboo é…ç½®dockeré•œåƒåŠ é€Ÿå™¨ é˜¿é‡Œäº‘åŠ é€Ÿå™¨(æ¨è) é˜¿é‡Œäº‘dockeré•œåƒæœåŠ¡ é…ç½®åŠ é€Ÿå™¨ ä¸€é…ç½®é˜¿é‡Œäº‘åŠ é€Ÿå™¨ä¸ºä¾‹,é¦–å…ˆç™»é™†é˜¿é‡Œäº‘,æœç´¢ å®¹å™¨é•œåƒæœåŠ¡ æ‰¾åˆ°ä¸“å±åŠ é€Ÿå™¨ é€šè¿‡ä¿®æ”¹daemoné…ç½®æ–‡ä»¶etc/docker/daemon.jsonæ¥ä½¿ç”¨åŠ é€Ÿå™¨ sudo mkdir -p /etc/docker sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF' { &quot;registry-mirrors&quot;: [&quot;https://rwlvh3oh.mirror.aliyuncs.com&quot;] } EOF # é‡å¯docker sudo systemctl daemon-reload sudo systemctl restart docker éªŒè¯é…ç½®æ˜¯å¦æˆåŠŸ docker info # è¾“å‡ºå†…å®¹å¦‚ä¸‹ æŸ¥çœ‹ Registry Mirrors Client: Debug Mode: false Server: Containers: 0 Running: 0 Paused: 0 Stopped: 0 Images: 0 Server Version: 19.03.8 Storage Driver: overlay2 Backing Filesystem: &lt;unknown&gt; Supports d_type: true Native Overlay Diff: true Logging Driver: json-file Cgroup Driver: cgroupfs Plugins: Volume: local Network: bridge host ipvlan macvlan null overlay Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog Swarm: inactive Runtimes: runc Default Runtime: runc Init Binary: docker-init containerd version: 7ad184331fa3e55e52b890ea95e65ba581ae3429 runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd init version: fec3683 Security Options: apparmor seccomp Profile: default Kernel Version: 4.15.0-91-generic Operating System: Ubuntu 18.04.4 LTS OSType: linux Architecture: x86_64 CPUs: 2 Total Memory: 1.924GiB Name: ubuntu ID: ZGXE:UIHK:ZE57:G66R:37US:RT7C:CPHN:IS7Y:AAIG:POEL:UOHA:DBQ3 Docker Root Dir: /var/lib/docker Debug Mode: false Registry: https://index.docker.io/v1/ Labels: Experimental: false Insecure Registries: 127.0.0.0/8 Registry Mirrors: https://rwlvh3oh.mirror.aliyuncs.com/ Live Restore Enabled: false docker æ¦‚è¿° Docker å¼•æ“ Docker å¼•æ“æ˜¯ä¸€ä¸ªåŒ…å«ä»¥ä¸‹ä¸»è¦ç»„ä»¶çš„å®¢æˆ·ç«¯æœåŠ¡å™¨åº”ç”¨ç¨‹åºã€‚ ä¸€ç§æœåŠ¡å™¨ï¼Œå®ƒæ˜¯ä¸€ç§ç§°ä¸ºå®ˆæŠ¤è¿›ç¨‹å¹¶ä¸”é•¿æ—¶é—´è¿è¡Œçš„ç¨‹åºã€‚ REST API ç”¨äºæŒ‡å®šç¨‹åºå¯ä»¥ç”¨æ¥ä¸å®ˆæŠ¤è¿›ç¨‹é€šä¿¡çš„æ¥å£ï¼Œå¹¶æŒ‡ç¤ºå®ƒåšä»€ä¹ˆã€‚ ä¸€ä¸ªæœ‰å‘½ä»¤è¡Œç•Œé¢ (CLI) å·¥å…·çš„å®¢æˆ·ç«¯ã€‚ Docker æ¶æ„ Docker ä½¿ç”¨å®¢æˆ·ç«¯ - æœåŠ¡å™¨ (C/S) æ¶æ„æ¨¡å¼ï¼Œä½¿ç”¨è¿œç¨‹ API æ¥ç®¡ç†å’Œåˆ›å»º Docker å®¹å™¨ã€‚ Docker å®¹å™¨é€šè¿‡ Docker é•œåƒæ¥åˆ›å»ºã€‚ å®¹å™¨ä¸é•œåƒçš„å…³ç³»ç±»ä¼¼äºé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„å¯¹è±¡ä¸ç±»ã€‚ Docker é¢å‘å¯¹è±¡ å®¹å™¨ å¯¹è±¡ é•œåƒ ç±» æ ‡é¢˜ è¯´æ˜ é•œåƒ(Images) Docker é•œåƒæ˜¯ç”¨äºåˆ›å»º Docker å®¹å™¨çš„æ¨¡æ¿ã€‚ å®¹å™¨(Container) å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ã€‚ å®¢æˆ·ç«¯(Client) Docker å®¢æˆ·ç«¯é€šè¿‡å‘½ä»¤è¡Œæˆ–è€…å…¶ä»–å·¥å…·ä½¿ç”¨ Docker API https://docs.docker.com/reference/api/docker_remote_api ä¸ Docker çš„å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ã€‚ ä¸»æœº(Host) ä¸€ä¸ªç‰©ç†æˆ–è€…è™šæ‹Ÿçš„æœºå™¨ç”¨äºæ‰§è¡Œ Docker å®ˆæŠ¤è¿›ç¨‹å’Œå®¹å™¨ã€‚ ä»“åº“(Registry) Docker ä»“åº“ç”¨æ¥ä¿å­˜é•œåƒï¼Œå¯ä»¥ç†è§£ä¸ºä»£ç æ§åˆ¶ä¸­çš„ä»£ç ä»“åº“ã€‚Docker Hubhttps://hub.docker.comæä¾›äº†åºå¤§çš„é•œåƒé›†åˆä¾›ä½¿ç”¨ã€‚ Docker Machine Docker Machineæ˜¯ä¸€ä¸ªç®€åŒ–Dockerå®‰è£…çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå³å¯åœ¨ç›¸åº”çš„å¹³å°ä¸Šå®‰è£…Dockerï¼Œæ¯”å¦‚VirtualBoxã€ Digital Oceanã€Microsoft Azureã€‚ æ“ä½œé•œåƒ è·å–é•œåƒ ä¹‹å‰æåˆ°è¿‡ï¼ŒDocker Hubä¸Šæœ‰å¤§é‡çš„é«˜è´¨é‡çš„é•œåƒå¯ä»¥ç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬å°±è¯´ä¸€ä¸‹æ€ä¹ˆè·å–è¿™äº›é•œåƒã€‚ ä» Docker é•œåƒä»“åº“è·å–é•œåƒçš„å‘½ä»¤æ˜¯ docker pullã€‚å…¶å‘½ä»¤æ ¼å¼ä¸ºï¼š docker pull [é€‰é¡¹] [Docker Registry åœ°å€[:ç«¯å£å·]/]ä»“åº“å[:æ ‡ç­¾] å…·ä½“çš„é€‰é¡¹å¯ä»¥é€šè¿‡ docker pull --help å‘½ä»¤çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬è¯´ä¸€ä¸‹é•œåƒåç§°çš„æ ¼å¼ã€‚ é•œåƒä»“åº“åœ°å€ï¼š åœ°å€çš„æ ¼å¼ä¸€èˆ¬æ˜¯ &lt;åŸŸå/IP&gt;[:ç«¯å£å·]ã€‚é»˜è®¤åœ°å€æ˜¯ Docker Hubã€‚ ä»“åº“åï¼š å¦‚ä¹‹å‰æ‰€è¯´ï¼Œè¿™é‡Œçš„ä»“åº“åæ˜¯ä¸¤æ®µå¼åç§°ï¼Œå³ &lt;ç”¨æˆ·å&gt;/&lt;è½¯ä»¶å&gt;ã€‚å¯¹äº Docker Hubï¼Œå¦‚æœä¸ç»™å‡ºç”¨æˆ·åï¼Œåˆ™é»˜è®¤ä¸º libraryï¼Œä¹Ÿå°±æ˜¯å®˜æ–¹é•œåƒã€‚ docker pull nginx # è¾“å‡ºå¦‚ä¸‹ Using default tag: latest latest: Pulling from library/nginx fc7181108d40: Pull complete c4277fc40ec2: Pull complete 780053e98559: Pull complete Digest: sha256:bdbf36b7f1f77ffe7bd2a32e59235dff6ecf131e3b6b5b96061c652f30685f3a Status: Downloaded newer image for nginx:latest åˆ—å‡ºé•œåƒ è¦æƒ³åˆ—å‡ºå·²ç»ä¸‹è½½ä¸‹æ¥çš„é•œåƒï¼Œå¯ä»¥ä½¿ç”¨ docker image ls å‘½ä»¤ã€‚ docker image ls # è¾“å‡ºå¦‚ä¸‹ REPOSITORY TAG IMAGE ID CREATED SIZE redis latest 5f515359c7f8 5 days ago 183 MB nginx latest 05a60462f8ba 5 days ago 181 MB mongo 3.2 fe9198c04d62 5 days ago 342 MB &lt;none&gt; &lt;none&gt; 00285df0df87 5 days ago 342 MB ubuntu 16.04 f753707788c5 4 weeks ago 127 MB ubuntu latest f753707788c5 4 weeks ago 127 MB ubuntu 14.04 1e0c3dd64ccd 4 weeks ago 188 MB åˆ—è¡¨åŒ…å«äº† ä»“åº“åã€æ ‡ç­¾ã€é•œåƒ IDã€åˆ›å»ºæ—¶é—´ ä»¥åŠ æ‰€å ç”¨çš„ç©ºé—´ã€‚ å…¶ä¸­ä»“åº“åã€æ ‡ç­¾åœ¨ä¹‹å‰çš„åŸºç¡€æ¦‚å¿µç« èŠ‚å·²ç»ä»‹ç»è¿‡äº†ã€‚é•œåƒ ID åˆ™æ˜¯é•œåƒçš„å”¯ä¸€æ ‡è¯†ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥å¯¹åº”å¤šä¸ªæ ‡ç­¾ã€‚å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° ubuntu:16.04 å’Œ ubuntu:latest æ‹¥æœ‰ç›¸åŒçš„ IDï¼Œå› ä¸ºå®ƒä»¬å¯¹åº”çš„æ˜¯åŒä¸€ä¸ªé•œåƒã€‚ é•œåƒä½“ç§¯ å¦‚æœä»”ç»†è§‚å¯Ÿï¼Œä¼šæ³¨æ„åˆ°ï¼Œè¿™é‡Œæ ‡è¯†çš„æ‰€å ç”¨ç©ºé—´å’Œåœ¨ Docker Hub ä¸Šçœ‹åˆ°çš„é•œåƒå¤§å°ä¸åŒã€‚æ¯”å¦‚ï¼Œubuntu:16.04 é•œåƒå¤§å°ï¼Œåœ¨è¿™é‡Œæ˜¯ 127 MBï¼Œä½†æ˜¯åœ¨ Docker Hub æ˜¾ç¤ºçš„å´æ˜¯ 50 MBã€‚è¿™æ˜¯å› ä¸º Docker Hub ä¸­æ˜¾ç¤ºçš„ä½“ç§¯æ˜¯å‹ç¼©åçš„ä½“ç§¯ã€‚åœ¨é•œåƒä¸‹è½½å’Œä¸Šä¼ è¿‡ç¨‹ä¸­é•œåƒæ˜¯ä¿æŒç€å‹ç¼©çŠ¶æ€çš„ï¼Œå› æ­¤ Docker Hub æ‰€æ˜¾ç¤ºçš„å¤§å°æ˜¯ç½‘ç»œä¼ è¾“ä¸­æ›´å…³å¿ƒçš„æµé‡å¤§å°ã€‚è€Œ docker image ls æ˜¾ç¤ºçš„æ˜¯é•œåƒä¸‹è½½åˆ°æœ¬åœ°åï¼Œå±•å¼€çš„å¤§å°ï¼Œå‡†ç¡®è¯´ï¼Œæ˜¯å±•å¼€åçš„å„å±‚æ‰€å ç©ºé—´çš„æ€»å’Œï¼Œå› ä¸ºé•œåƒåˆ°æœ¬åœ°åï¼ŒæŸ¥çœ‹ç©ºé—´çš„æ—¶å€™ï¼Œæ›´å…³å¿ƒçš„æ˜¯æœ¬åœ°ç£ç›˜ç©ºé—´å ç”¨çš„å¤§å°ã€‚ å¦å¤–ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯ï¼Œdocker image ls åˆ—è¡¨ä¸­çš„é•œåƒä½“ç§¯æ€»å’Œå¹¶éæ˜¯æ‰€æœ‰é•œåƒå®é™…ç¡¬ç›˜æ¶ˆè€—ã€‚ç”±äº Docker é•œåƒæ˜¯å¤šå±‚å­˜å‚¨ç»“æ„ï¼Œå¹¶ä¸”å¯ä»¥ç»§æ‰¿ã€å¤ç”¨ï¼Œå› æ­¤ä¸åŒé•œåƒå¯èƒ½ä¼šå› ä¸ºä½¿ç”¨ç›¸åŒçš„åŸºç¡€é•œåƒï¼Œä»è€Œæ‹¥æœ‰å…±åŒçš„å±‚ã€‚ç”±äº Docker ä½¿ç”¨ Union FSï¼Œç›¸åŒçš„å±‚åªéœ€è¦ä¿å­˜ä¸€ä»½å³å¯ï¼Œå› æ­¤å®é™…é•œåƒç¡¬ç›˜å ç”¨ç©ºé—´å¾ˆå¯èƒ½è¦æ¯”è¿™ä¸ªåˆ—è¡¨é•œåƒå¤§å°çš„æ€»å’Œè¦å°çš„å¤šã€‚ ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥ä¾¿æ·çš„æŸ¥çœ‹é•œåƒã€å®¹å™¨ã€æ•°æ®å·æ‰€å ç”¨çš„ç©ºé—´ã€‚ docker system df # è¾“å‡ºå¦‚ä¸‹ TYPE TOTAL ACTIVE SIZE RECLAIMABLE Images 24 0 1.992GB 1.992GB (100%) Containers 1 0 62.82MB 62.82MB (100%) Local Volumes 9 0 652.2MB 652.2MB (100%) Build Cache 0B 0B è™šæ‚¬é•œåƒ ä¸Šé¢çš„é•œåƒåˆ—è¡¨ä¸­ï¼Œè¿˜å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç‰¹æ®Šçš„é•œåƒï¼Œè¿™ä¸ªé•œåƒæ—¢æ²¡æœ‰ä»“åº“åï¼Œä¹Ÿæ²¡æœ‰æ ‡ç­¾ï¼Œå‡ä¸º &lt;none&gt; &lt;none&gt; &lt;none&gt; 00285df0df87 5 days ago 342 MB è¿™ä¸ªé•œåƒåŸæœ¬æ˜¯æœ‰é•œåƒåå’Œæ ‡ç­¾çš„ï¼ŒåŸæ¥ä¸º mongo:3.2ï¼Œéšç€å®˜æ–¹é•œåƒç»´æŠ¤ï¼Œå‘å¸ƒäº†æ–°ç‰ˆæœ¬åï¼Œé‡æ–° docker pull mongo:3.2 æ—¶ï¼Œmongo:3.2 è¿™ä¸ªé•œåƒåè¢«è½¬ç§»åˆ°äº†æ–°ä¸‹è½½çš„é•œåƒèº«ä¸Šï¼Œè€Œæ—§çš„é•œåƒä¸Šçš„è¿™ä¸ªåç§°åˆ™è¢«å–æ¶ˆï¼Œä»è€Œæˆä¸ºäº† &lt;none&gt;ã€‚é™¤äº† docker pull å¯èƒ½å¯¼è‡´è¿™ç§æƒ…å†µï¼Œdocker build ä¹ŸåŒæ ·å¯ä»¥å¯¼è‡´è¿™ç§ç°è±¡ã€‚ç”±äºæ–°æ—§é•œåƒåŒåï¼Œæ—§é•œåƒåç§°è¢«å–æ¶ˆï¼Œä»è€Œå‡ºç°ä»“åº“åã€æ ‡ç­¾å‡ä¸º &lt;none&gt; çš„é•œåƒã€‚è¿™ç±»æ— æ ‡ç­¾é•œåƒä¹Ÿè¢«ç§°ä¸º è™šæ‚¬é•œåƒ(dangling image) ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ä¸“é—¨æ˜¾ç¤ºè¿™ç±»é•œåƒï¼š docker image ls -f dangling=true # è¾“å‡ºå¦‚ä¸‹ REPOSITORY TAG IMAGE ID CREATED SIZE &lt;none&gt; &lt;none&gt; 00285df0df87 5 days ago 342 MB ä¸€èˆ¬æ¥è¯´ï¼Œè™šæ‚¬é•œåƒå·²ç»å¤±å»äº†å­˜åœ¨çš„ä»·å€¼ï¼Œæ˜¯å¯ä»¥éšæ„åˆ é™¤çš„ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ é™¤ã€‚ docker image prune ä¸­é—´å±‚é•œåƒ ä¸ºäº†åŠ é€Ÿé•œåƒæ„å»ºã€é‡å¤åˆ©ç”¨èµ„æºï¼ŒDocker ä¼šåˆ©ç”¨ ä¸­é—´å±‚é•œåƒã€‚æ‰€ä»¥åœ¨ä½¿ç”¨ä¸€æ®µæ—¶é—´åï¼Œå¯èƒ½ä¼šçœ‹åˆ°ä¸€äº›ä¾èµ–çš„ä¸­é—´å±‚é•œåƒã€‚é»˜è®¤çš„ docker image ls åˆ—è¡¨ä¸­åªä¼šæ˜¾ç¤ºé¡¶å±‚é•œåƒï¼Œå¦‚æœå¸Œæœ›æ˜¾ç¤ºåŒ…æ‹¬ä¸­é—´å±‚é•œåƒåœ¨å†…çš„æ‰€æœ‰é•œåƒçš„è¯ï¼Œéœ€è¦åŠ  -a å‚æ•°ã€‚ docker image ls -a è¿™æ ·ä¼šçœ‹åˆ°å¾ˆå¤šæ— æ ‡ç­¾çš„é•œåƒï¼Œä¸ä¹‹å‰çš„è™šæ‚¬é•œåƒä¸åŒï¼Œè¿™äº›æ— æ ‡ç­¾çš„é•œåƒå¾ˆå¤šéƒ½æ˜¯ä¸­é—´å±‚é•œåƒï¼Œæ˜¯å…¶å®ƒé•œåƒæ‰€ä¾èµ–çš„é•œåƒã€‚è¿™äº›æ— æ ‡ç­¾é•œåƒä¸åº”è¯¥åˆ é™¤ï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¸Šå±‚é•œåƒå› ä¸ºä¾èµ–ä¸¢å¤±è€Œå‡ºé”™ã€‚å®é™…ä¸Šï¼Œè¿™äº›é•œåƒä¹Ÿæ²¡å¿…è¦åˆ é™¤ï¼Œå› ä¸ºä¹‹å‰è¯´è¿‡ï¼Œç›¸åŒçš„å±‚åªä¼šå­˜ä¸€éï¼Œè€Œè¿™äº›é•œåƒæ˜¯åˆ«çš„é•œåƒçš„ä¾èµ–ï¼Œå› æ­¤å¹¶ä¸ä¼šå› ä¸ºå®ƒä»¬è¢«åˆ—å‡ºæ¥è€Œå¤šå­˜äº†ä¸€ä»½ï¼Œæ— è®ºå¦‚ä½•ä½ ä¹Ÿä¼šéœ€è¦å®ƒä»¬ã€‚åªè¦åˆ é™¤é‚£äº›ä¾èµ–å®ƒä»¬çš„é•œåƒåï¼Œè¿™äº›ä¾èµ–çš„ä¸­é—´å±‚é•œåƒä¹Ÿä¼šè¢«è¿å¸¦åˆ é™¤ã€‚ åˆ é™¤é•œåƒ å¦‚æœè¦åˆ é™¤æœ¬åœ°çš„é•œåƒï¼Œå¯ä»¥ä½¿ç”¨ docker image rm å‘½ä»¤ï¼Œå…¶æ ¼å¼ä¸ºï¼š docker image rm [é€‰é¡¹] &lt;é•œåƒ1&gt; [&lt;é•œåƒ2&gt; ...] ç”¨ IDã€é•œåƒåã€æ‘˜è¦åˆ é™¤é•œåƒ å…¶ä¸­ï¼Œ&lt;é•œåƒ&gt; å¯ä»¥æ˜¯ é•œåƒçŸ­ IDã€é•œåƒé•¿ IDã€é•œåƒå æˆ–è€… é•œåƒæ‘˜è¦ã€‚ æ¯”å¦‚æˆ‘ä»¬æœ‰è¿™ä¹ˆä¸€äº›é•œåƒï¼š docker image ls # è¾“å‡ºå¦‚ä¸‹ REPOSITORY TAG IMAGE ID CREATED SIZE centos latest 0584b3d2cf6d 3 weeks ago 196.5 MB redis alpine 501ad78535f0 3 weeks ago 21.03 MB docker latest cf693ec9b5c7 3 weeks ago 105.1 MB nginx latest e43d811ce2f4 5 weeks ago 181.5 MB æˆ‘ä»¬å¯ä»¥ç”¨é•œåƒçš„å®Œæ•´ IDï¼Œä¹Ÿç§°ä¸º é•¿ IDï¼Œæ¥åˆ é™¤é•œåƒã€‚ä½¿ç”¨è„šæœ¬çš„æ—¶å€™å¯èƒ½ä¼šç”¨é•¿ IDï¼Œä½†æ˜¯äººå·¥è¾“å…¥å°±å¤ªç´¯äº†ï¼Œæ‰€ä»¥æ›´å¤šçš„æ—¶å€™æ˜¯ç”¨ çŸ­ ID æ¥åˆ é™¤é•œåƒã€‚docker image ls é»˜è®¤åˆ—å‡ºçš„å°±å·²ç»æ˜¯çŸ­ ID äº†ï¼Œä¸€èˆ¬å–å‰ 3 ä¸ªå­—ç¬¦ä»¥ä¸Šï¼Œåªè¦è¶³å¤ŸåŒºåˆ†äºåˆ«çš„é•œåƒå°±å¯ä»¥äº†ã€‚ æ¯”å¦‚è¿™é‡Œï¼Œå¦‚æœæˆ‘ä»¬è¦åˆ é™¤ redis:alpine é•œåƒï¼Œå¯ä»¥æ‰§è¡Œï¼š docker image rm 501 # è¾“å‡ºå¦‚ä¸‹ Untagged: redis:alpine Untagged:redis@sha256:f1ed3708f538b537eb9c2a7dd50dc90a706f7debd7e1196c9264edeea521a86dDeleted:sha256:501ad78535f015d88872e13fa87a828425117e3d28075d0c117932b05bf189b7 Deleted:sha256:96167737e29ca8e9d74982ef2a0dda76ed7b430da55e321c071f0dbff8c2899b Deleted:sha256:32770d1dcf835f192cafd6b9263b7b597a1778a403a109e2cc2ee866f74adf23 Deleted:sha256:127227698ad74a5846ff5153475e03439d96d4b1c7f2a449c7a826ef74a2d2fa Deleted:sha256:1333ecc582459bac54e1437335c0816bc17634e131ea0cc48daa27d32c75eab3 Deleted: sha256:4fc455b921edf9c4aea207c51ab39b10b06540c8b4825ba57b3feed1668fa7c7 æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨é•œåƒåï¼Œä¹Ÿå°±æ˜¯ &lt;ä»“åº“å&gt;:&lt;æ ‡ç­¾&gt;ï¼Œæ¥åˆ é™¤é•œåƒã€‚ docker image rm centos # è¾“å‡ºå¦‚ä¸‹ Untagged: centos:latest Untagged:centos@sha256:b2f9d1c0ff5f87a4743104d099a3d561002ac500db1b9bfa02a783a46e0d366c Deleted:sha256:0584b3d2cf6d235ee310cf14b54667d889887b838d3f3d3033acd70fc3c48b8a Deleted: sha256:97ca462ad9eeae25941546209454496e1d66749d53dfa2ee32bf1faabd239d38 å½“ç„¶ï¼Œæ›´ç²¾ç¡®çš„æ˜¯ä½¿ç”¨ é•œåƒæ‘˜è¦ åˆ é™¤é•œåƒã€‚ docker image ls --digests # è¾“å‡ºå¦‚ä¸‹ REPOSITORY TAG DIGEST IMAGE ID CREATED SIZE node slim sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228 6e0c4c8e3913 3 weeks ago 214 MB docker image rm node@sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228 # è¾“å‡ºå¦‚ä¸‹ Untagged: node@sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228 ç”¨ docker image ls å‘½ä»¤æ¥é…åˆ åƒå…¶å®ƒå¯ä»¥æ‰¿æ¥å¤šä¸ªå®ä½“çš„å‘½ä»¤ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨ docker image ls -q æ¥é…åˆä½¿ç”¨ docker image rmï¼Œè¿™æ ·å¯ä»¥æˆæ‰¹çš„åˆ é™¤å¸Œæœ›åˆ é™¤çš„é•œåƒã€‚æˆ‘ä»¬åœ¨â€œé•œåƒåˆ—è¡¨â€ç« èŠ‚ä»‹ç»è¿‡å¾ˆå¤šè¿‡æ»¤é•œåƒåˆ—è¡¨çš„æ–¹å¼éƒ½å¯ä»¥æ‹¿è¿‡æ¥ä½¿ç”¨ã€‚ æ¯”å¦‚ï¼Œæˆ‘ä»¬éœ€è¦åˆ é™¤æ‰€æœ‰ä»“åº“åä¸º redis çš„é•œåƒï¼š docker image rm $(docker image ls -q redis) æˆ–è€…åˆ é™¤æ‰€æœ‰åœ¨ mongo:3.2 ä¹‹å‰çš„é•œåƒï¼š docker image rm $(docker image ls -q -f before=mongo:3.2) å……åˆ†åˆ©ç”¨ä½ çš„æƒ³è±¡åŠ›å’Œ Linux å‘½ä»¤è¡Œçš„å¼ºå¤§ï¼Œä½ å¯ä»¥å®Œæˆå¾ˆå¤šéå¸¸èµçš„åŠŸèƒ½ã€‚ æ‰©å±•é˜…è¯» åˆ—å‡ºéƒ¨åˆ†é•œåƒ ä¸åŠ ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹ï¼Œdocker image ls ä¼šåˆ—å‡ºæ‰€æœ‰é¡¶çº§é•œåƒï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬åªå¸Œæœ›åˆ—å‡ºéƒ¨åˆ†é•œåƒã€‚docker image ls æœ‰å¥½å‡ ä¸ªå‚æ•°å¯ä»¥å¸®åŠ©åšåˆ°è¿™ä¸ªäº‹æƒ…ã€‚ æ ¹æ®ä»“åº“ååˆ—å‡ºé•œåƒ docker image ls ubuntu # è¾“å‡ºå¦‚ä¸‹ REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu 16.04 f753707788c5 4 weeks ago 127 MB ubuntu latest f753707788c5 4 weeks ago 127 MB ubuntu 14.04 1e0c3dd64ccd 4 weeks ago 188 MB åˆ—å‡ºç‰¹å®šçš„æŸä¸ªé•œåƒï¼Œä¹Ÿå°±æ˜¯è¯´æŒ‡å®šä»“åº“åå’Œæ ‡ç­¾ docker image ls ubuntu:16.04 # è¾“å‡ºå¦‚ä¸‹ REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu 16.04 f753707788c5 4 weeks ago 127 MB é™¤æ­¤ä»¥å¤–ï¼Œdocker image ls è¿˜æ”¯æŒå¼ºå¤§çš„è¿‡æ»¤å™¨å‚æ•° --filterï¼Œæˆ–è€…ç®€å†™ -fã€‚ä¹‹å‰æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä½¿ç”¨è¿‡æ»¤å™¨æ¥åˆ—å‡ºè™šæ‚¬é•œåƒçš„ç”¨æ³•ï¼Œå®ƒè¿˜æœ‰æ›´å¤šçš„ç”¨æ³•ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›çœ‹åˆ°åœ¨ mongo:3.2 ä¹‹åå»ºç«‹çš„é•œåƒï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š docker image ls -f since=mongo:3.2 # è¾“å‡ºå¦‚ä¸‹ REPOSITORY TAG IMAGE ID CREATED SIZE redis latest 5f515359c7f8 5 days ago 183 MB nginx latest 05a60462f8ba 5 days ago 181 MB æƒ³æŸ¥çœ‹æŸä¸ªä½ç½®ä¹‹å‰çš„é•œåƒä¹Ÿå¯ä»¥ï¼Œåªéœ€è¦æŠŠ since æ¢æˆ before å³å¯ã€‚ æ­¤å¤–ï¼Œå¦‚æœé•œåƒæ„å»ºæ—¶ï¼Œå®šä¹‰äº† LABELï¼Œè¿˜å¯ä»¥é€šè¿‡ LABEL æ¥è¿‡æ»¤ã€‚ docker image ls -f label=com.example.version=0.1 ä»¥ç‰¹å®šæ ¼å¼æ˜¾ç¤º é»˜è®¤æƒ…å†µä¸‹ï¼Œdocker image ls ä¼šè¾“å‡ºä¸€ä¸ªå®Œæ•´çš„è¡¨æ ¼ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶éæ‰€æœ‰æ—¶å€™éƒ½ä¼šéœ€è¦è¿™äº›å†…å®¹ã€‚æ¯”å¦‚ï¼Œåˆšæ‰åˆ é™¤è™šæ‚¬é•œåƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ docker image ls æŠŠæ‰€æœ‰çš„è™šæ‚¬é•œåƒçš„ ID åˆ—å‡ºæ¥ï¼Œç„¶åæ‰å¯ä»¥äº¤ç»™ docker image rm å‘½ä»¤ä½œä¸ºå‚æ•°æ¥åˆ é™¤æŒ‡å®šçš„è¿™äº›é•œåƒï¼Œè¿™ä¸ªæ—¶å€™å°±ç”¨åˆ°äº† -q å‚æ•°ã€‚ docker image ls -q # è¾“å‡ºå¦‚ä¸‹ 5f515359c7f8 05a60462f8ba fe9198c04d62 00285df0df87 f753707788c5 f753707788c5 1e0c3dd64ccd --filter é…åˆ -q äº§ç”Ÿå‡ºæŒ‡å®šèŒƒå›´çš„ ID åˆ—è¡¨ï¼Œç„¶åé€ç»™å¦ä¸€ä¸ª docker å‘½ä»¤ä½œä¸ºå‚æ•°ï¼Œä»è€Œé’ˆå¯¹è¿™ç»„å®ä½“æˆæ‰¹çš„è¿›è¡ŒæŸç§æ“ä½œçš„åšæ³•åœ¨ Docker å‘½ä»¤è¡Œä½¿ç”¨è¿‡ç¨‹ä¸­éå¸¸å¸¸è§ï¼Œä¸ä»…ä»…æ˜¯é•œåƒï¼Œå°†æ¥æˆ‘ä»¬ä¼šåœ¨å„ä¸ªå‘½ä»¤ä¸­çœ‹åˆ°è¿™ç±»æ­é…ä»¥å®Œæˆå¾ˆå¼ºå¤§çš„åŠŸèƒ½ã€‚å› æ­¤æ¯æ¬¡åœ¨æ–‡æ¡£çœ‹åˆ°è¿‡æ»¤å™¨åï¼Œå¯ä»¥å¤šæ³¨æ„ä¸€ä¸‹å®ƒä»¬çš„ç”¨æ³•ã€‚ å¦å¤–ä¸€äº›æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½åªæ˜¯å¯¹è¡¨æ ¼çš„ç»“æ„ä¸æ»¡æ„ï¼Œå¸Œæœ›è‡ªå·±ç»„ç»‡åˆ—ï¼›æˆ–è€…ä¸å¸Œæœ›æœ‰æ ‡é¢˜ï¼Œè¿™æ ·æ–¹ä¾¿å…¶å®ƒç¨‹åºè§£æç»“æœç­‰ï¼Œè¿™å°±ç”¨åˆ°äº† Go çš„æ¨¡æ¿è¯­æ³•ã€‚ æ¯”å¦‚ï¼Œä¸‹é¢çš„å‘½ä»¤ä¼šç›´æ¥åˆ—å‡ºé•œåƒç»“æœï¼Œå¹¶ä¸”åªåŒ…å«é•œåƒ ID å’Œä»“åº“åï¼š docker image ls --format &quot;{{.ID}}: {{.Repository}}&quot; # è¾“å‡ºå¦‚ä¸‹ 5f515359c7f8: redis 05a60462f8ba: nginx fe9198c04d62: mongo 00285df0df87: &lt;none&gt; f753707788c5: ubuntu f753707788c5: ubuntu 1e0c3dd64ccd: ubuntu æˆ–è€…æ‰“ç®—ä»¥è¡¨æ ¼ç­‰è·æ˜¾ç¤ºï¼Œå¹¶ä¸”æœ‰æ ‡é¢˜è¡Œï¼Œå’Œé»˜è®¤ä¸€æ ·ï¼Œä¸è¿‡è‡ªå·±å®šä¹‰åˆ—ï¼š docker image ls --format &quot;table {{.ID}}\\t{{.Repository}}\\t{{.Tag}}&quot; # è¾“å‡ºå¦‚ä¸‹ IMAGE ID REPOSITORY TAG 5f515359c7f8 redis latest 05a60462f8ba nginx latest fe9198c04d62 mongo 3.2 00285df0df87 &lt;none&gt; &lt;none&gt; f753707788c5 ubuntu 16.04 f753707788c5 ubuntu latest 1e0c3dd64ccd ubuntu 14.04 æ“ä½œå®¹å™¨ å¯åŠ¨å®¹å™¨ æ‰€éœ€è¦çš„å‘½ä»¤ä¸»è¦ä¸º docker runã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„å‘½ä»¤è¾“å‡ºä¸€ä¸ª â€œHello Worldâ€ï¼Œä¹‹åç»ˆæ­¢å®¹å™¨ã€‚ docker run ubuntu:16.04 /bin/echo 'Hello world' Hello world docker run -p 8080:8080 --name myTomcat -d tomcat # å¯åŠ¨ä¸€ä¸ªtomcat(é•œåƒåå­—) å®¿ä¸»æœºç«¯å£ä¸º8080 å®¹å™¨ç«¯å£8080 èµ·åä¸ºmyTomcat 8dd9addeee5960d6818a3744d897a3b2200815f954f0dc0e6f63e647bc1574ea å½“åˆ©ç”¨ docker run æ¥åˆ›å»ºå®¹å™¨æ—¶ï¼ŒDocker åœ¨åå°è¿è¡Œçš„æ ‡å‡†æ“ä½œåŒ…æ‹¬ï¼š æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é•œåƒï¼Œä¸å­˜åœ¨å°±ä»å…¬æœ‰ä»“åº“ä¸‹è½½ åˆ©ç”¨é•œåƒåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨ åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå±‚å¤–é¢æŒ‚è½½ä¸€å±‚å¯è¯»å†™å±‚ ä»å®¿ä¸»ä¸»æœºé…ç½®çš„ç½‘æ¡¥æ¥å£ä¸­æ¡¥æ¥ä¸€ä¸ªè™šæ‹Ÿæ¥å£åˆ°å®¹å™¨ä¸­å» ä»åœ°å€æ± é…ç½®ä¸€ä¸ª ip åœ°å€ç»™å®¹å™¨ æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åº æ‰§è¡Œå®Œæ¯•åå®¹å™¨è¢«ç»ˆæ­¢ ç»ˆæ­¢å®¹å™¨ å¯ä»¥ä½¿ç”¨ docker container stop [container ID or NAMES] æ¥ç»ˆæ­¢ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ã€‚æ­¤å¤–ï¼Œå½“ Docker å®¹å™¨ä¸­æŒ‡å®šçš„åº”ç”¨ç»ˆç»“æ—¶ï¼Œå®¹å™¨ä¹Ÿè‡ªåŠ¨ç»ˆæ­¢ã€‚ ä¾‹å¦‚å¯¹äºåªå¯åŠ¨äº†ä¸€ä¸ªç»ˆç«¯çš„å®¹å™¨ï¼Œç”¨æˆ·é€šè¿‡ exit å‘½ä»¤æˆ– ctrl + d æ¥é€€å‡ºç»ˆç«¯æ—¶ï¼Œæ‰€åˆ›å»ºçš„å®¹å™¨ç«‹åˆ»ç»ˆæ­¢ã€‚ç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨å¯ä»¥ç”¨ docker container ls -a å‘½ä»¤çœ‹åˆ°ã€‚ä¾‹å¦‚ docker container ls -a # è¾“å‡ºå¦‚ä¸‹ CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES ba267838cc1b ubuntu:14.04 &quot;/bin/bash&quot; 30 minutes ago Exited (0) About a minute ago trusting_newton 98e5efa7d997 training/webapp:latest &quot;python app.py&quot; About an hour ago Exited (0) 34 minutes ago backstabbing_pike å¯åŠ¨å·²ç»ˆæ­¢å®¹å™¨ å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡ docker container start å‘½ä»¤æ¥é‡æ–°å¯åŠ¨ã€‚æ­¤å¤–ï¼Œdocker container restart å‘½ä»¤ä¼šå°†ä¸€ä¸ªè¿è¡Œæ€çš„å®¹å™¨ç»ˆæ­¢ï¼Œç„¶åå†é‡æ–°å¯åŠ¨å®ƒã€‚ docker container start [container ID or NAMES] å®ˆæŠ¤æ€è¿è¡Œ æ›´å¤šçš„æ—¶å€™ï¼Œéœ€è¦è®© Docker åœ¨åå°è¿è¡Œè€Œä¸æ˜¯ç›´æ¥æŠŠæ‰§è¡Œå‘½ä»¤çš„ç»“æœè¾“å‡ºåœ¨å½“å‰å®¿ä¸»æœºä¸‹ã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ  -d å‚æ•°æ¥å®ç°ã€‚å¦‚æœä¸ä½¿ç”¨ -d å‚æ•°è¿è¡Œå®¹å™¨ã€‚ docker run ubuntu:16.04 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot; # è¾“å‡ºå¦‚ä¸‹ hello world hello world hello world hello world å®¹å™¨ä¼šæŠŠè¾“å‡ºçš„ç»“æœ (STDOUT) æ‰“å°åˆ°å®¿ä¸»æœºä¸Šé¢ï¼Œå¦‚æœä½¿ç”¨äº† -d å‚æ•°è¿è¡Œå®¹å™¨ã€‚ docker run -d ubuntu:17.10 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot; # è¾“å‡ºå¦‚ä¸‹ 77b2dc01fe0f3f1265df143181e7b9af5e05279a884f4776ee75350ea9d8017a æ­¤æ—¶å®¹å™¨ä¼šåœ¨åå°è¿è¡Œå¹¶ä¸ä¼šæŠŠè¾“å‡ºçš„ç»“æœ (STDOUT) æ‰“å°åˆ°å®¿ä¸»æœºä¸Šé¢(è¾“å‡ºç»“æœå¯ä»¥ç”¨ docker logs æŸ¥çœ‹)ã€‚ æ³¨æ„ï¼š å®¹å™¨æ˜¯å¦ä¼šé•¿ä¹…è¿è¡Œï¼Œæ˜¯å’Œ docker run æŒ‡å®šçš„å‘½ä»¤æœ‰å…³ï¼Œå’Œ -d å‚æ•°æ— å…³ã€‚ å®¹å™¨æ—¥å¿— è¦è·å–å®¹å™¨çš„è¾“å‡ºä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ docker container logs å‘½ä»¤ã€‚ docker container logs [container ID or NAMES] # è¾“å‡ºå¦‚ä¸‹ hello world hello world hello world è¿›å…¥å®¹å™¨ åœ¨ä½¿ç”¨ -d å‚æ•°æ—¶ï¼Œå®¹å™¨å¯åŠ¨åä¼šè¿›å…¥åå°ã€‚æŸäº›æ—¶å€™éœ€è¦è¿›å…¥å®¹å™¨è¿›è¡Œæ“ä½œï¼Œdocker exec å‘½ä»¤èƒ½è®©æˆ‘ä»¬ä»¥äº¤äº’çš„æ–¹å¼è¿›å…¥å®¹å™¨ã€‚ docker exec åè¾¹å¯ä»¥è·Ÿå¤šä¸ªå‚æ•°ï¼Œè¿™é‡Œä¸»è¦è¯´æ˜ -i -t å‚æ•°ã€‚åªç”¨ -i å‚æ•°æ—¶ï¼Œç”±äºæ²¡æœ‰åˆ†é…ä¼ªç»ˆç«¯ï¼Œç•Œé¢æ²¡æœ‰æˆ‘ä»¬ç†Ÿæ‚‰çš„ Linux å‘½ä»¤æç¤ºç¬¦ï¼Œä½†å‘½ä»¤æ‰§è¡Œç»“æœä»ç„¶å¯ä»¥è¿”å›ã€‚å½“ -i -t å‚æ•°ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œåˆ™å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç†Ÿæ‚‰çš„ Linux å‘½ä»¤æç¤ºç¬¦ã€‚ docker exec -it 69d1 bash root@69d137adef7a:/# å¦‚æœä»è¿™ä¸ª stdin ä¸­ exitï¼Œä¸ä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢ã€‚æ›´å¤šå‚æ•°è¯´æ˜è¯·ä½¿ç”¨ docker exec --help æŸ¥çœ‹ã€‚ åˆ é™¤å®¹å™¨ å¯ä»¥ä½¿ç”¨ docker container rm æ¥åˆ é™¤ä¸€ä¸ªå¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚ä¾‹å¦‚ docker container rm trusting_newton trusting_newton å¦‚æœè¦åˆ é™¤ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ï¼Œå¯ä»¥æ·»åŠ  -f å‚æ•°ã€‚Docker ä¼šå‘é€ SIGKILL ä¿¡å·ç»™å®¹å™¨ã€‚ docker rm -f unruffled_jang:unruffled_jangä¸ºå®¹å™¨å,ä¹Ÿå¯ä»¥æ ¹æ®å®¹å™¨idåˆ é™¤ æ¸…ç†æ‰€æœ‰å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ ç”¨ docker container ls -a å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å·²ç»åˆ›å»ºçš„åŒ…æ‹¬ç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ï¼Œå¦‚æœæ•°é‡å¤ªå¤šè¦ä¸€ä¸ªä¸ªåˆ é™¤å¯èƒ½ä¼šå¾ˆéº»çƒ¦ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æ¸…ç†æ‰æ‰€æœ‰å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚ docker container prune dockerfileå®šåˆ¶é•œåƒ æ¦‚è¿° Dockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶å†…åŒ…å«äº†ä¸€æ¡æ¡çš„ æŒ‡ä»¤(Instruction)ï¼Œæ¯ä¸€æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚ï¼Œå› æ­¤æ¯ä¸€æ¡æŒ‡ä»¤çš„å†…å®¹ï¼Œå°±æ˜¯æè¿°è¯¥å±‚åº”å½“å¦‚ä½•æ„å»ºã€‚ ä»¥ä¹‹å‰çš„ Nginx é•œåƒä¸ºä¾‹ï¼Œè¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨ Dockerfile æ¥å®šåˆ¶ã€‚åœ¨ä¸€ä¸ªç©ºç™½ç›®å½•ä¸­ï¼Œå»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶å‘½åä¸º Dockerfile mkdir mynginx cd mynginx touch Dockerfile å…¶å†…å®¹ä¸ºï¼š FROM nginx RUN echo '&lt;h1&gt;Hello, Docker!&lt;/h1&gt;' &gt; /usr/share/nginx/html/index.html è¿™ä¸ª Dockerfile å¾ˆç®€å•ï¼Œä¸€å…±å°±ä¸¤è¡Œã€‚æ¶‰åŠåˆ°äº†ä¸¤æ¡æŒ‡ä»¤ï¼ŒFROM å’Œ RUNã€‚ FROM æŒ‡å®šåŸºç¡€é•œåƒ æ‰€è°“å®šåˆ¶é•œåƒï¼Œé‚£ä¸€å®šæ˜¯ä»¥ä¸€ä¸ªé•œåƒä¸ºåŸºç¡€ï¼Œåœ¨å…¶ä¸Šè¿›è¡Œå®šåˆ¶ã€‚å°±åƒæˆ‘ä»¬ä¹‹å‰è¿è¡Œäº†ä¸€ä¸ª Nginx é•œåƒçš„å®¹å™¨ï¼Œå†è¿›è¡Œä¿®æ”¹ä¸€æ ·ï¼ŒåŸºç¡€é•œåƒæ˜¯å¿…é¡»æŒ‡å®šçš„ã€‚è€Œ FROM å°±æ˜¯æŒ‡å®š åŸºç¡€é•œåƒï¼Œå› æ­¤ä¸€ä¸ª Dockerfile ä¸­ FROM æ˜¯å¿…å¤‡çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤ã€‚ é™¤äº†é€‰æ‹©ç°æœ‰é•œåƒä¸ºåŸºç¡€é•œåƒå¤–ï¼ŒDocker è¿˜å­˜åœ¨ä¸€ä¸ªç‰¹æ®Šçš„é•œåƒï¼Œåä¸º scratchã€‚è¿™ä¸ªé•œåƒæ˜¯è™šæ‹Ÿçš„æ¦‚å¿µï¼Œå¹¶ä¸å®é™…å­˜åœ¨ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªç©ºç™½çš„é•œåƒã€‚ FROM scratch å¦‚æœä½ ä»¥ scratch ä¸ºåŸºç¡€é•œåƒçš„è¯ï¼Œæ„å‘³ç€ä½ ä¸ä»¥ä»»ä½•é•œåƒä¸ºåŸºç¡€ï¼Œæ¥ä¸‹æ¥æ‰€å†™çš„æŒ‡ä»¤å°†ä½œä¸ºé•œåƒç¬¬ä¸€å±‚å¼€å§‹å­˜åœ¨ã€‚ ä¸ä»¥ä»»ä½•ç³»ç»Ÿä¸ºåŸºç¡€ï¼Œç›´æ¥å°†å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶è¿›é•œåƒçš„åšæ³•å¹¶ä¸ç½•è§ï¼Œæ¯”å¦‚ swarmã€coreos/etcdã€‚å¯¹äº Linux ä¸‹é™æ€ç¼–è¯‘çš„ç¨‹åºæ¥è¯´ï¼Œå¹¶ä¸éœ€è¦æœ‰æ“ä½œç³»ç»Ÿæä¾›è¿è¡Œæ—¶æ”¯æŒï¼Œæ‰€éœ€çš„ä¸€åˆ‡åº“éƒ½å·²ç»åœ¨å¯æ‰§è¡Œæ–‡ä»¶é‡Œäº†ï¼Œå› æ­¤ç›´æ¥ FROM scratch ä¼šè®©é•œåƒä½“ç§¯æ›´åŠ å°å·§ã€‚ä½¿ç”¨ Go è¯­è¨€å¼€å‘çš„åº”ç”¨å¾ˆå¤šä¼šä½¿ç”¨è¿™ç§æ–¹å¼æ¥åˆ¶ä½œé•œåƒï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ‰äººè®¤ä¸º Go æ˜¯ç‰¹åˆ«é€‚åˆå®¹å™¨å¾®æœåŠ¡æ¶æ„è¯­è¨€çš„åŸå› ä¹‹ä¸€ã€‚ RUN æ‰§è¡Œå‘½ä»¤ RUN æŒ‡ä»¤æ˜¯ç”¨æ¥æ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤çš„ã€‚ç”±äºå‘½ä»¤è¡Œçš„å¼ºå¤§èƒ½åŠ›ï¼ŒRUN æŒ‡ä»¤åœ¨å®šåˆ¶é•œåƒæ—¶æ˜¯æœ€å¸¸ç”¨çš„æŒ‡ä»¤ä¹‹ä¸€ã€‚å…¶æ ¼å¼æœ‰ä¸¤ç§ï¼š shell æ ¼å¼ï¼š RUN &lt;å‘½ä»¤&gt;ï¼Œå°±åƒç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥çš„å‘½ä»¤ä¸€æ ·ã€‚åˆšæ‰å†™çš„ Dockerfile ä¸­çš„ RUN æŒ‡ä»¤å°±æ˜¯è¿™ç§æ ¼å¼ã€‚ RUN echo '&lt;h1&gt;Hello, Docker!&lt;/h1&gt;' &gt; /usr/share/nginx/html/index.html exec æ ¼å¼ï¼š RUN [&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;, &quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;]ï¼Œè¿™æ›´åƒæ˜¯å‡½æ•°è°ƒç”¨ä¸­çš„æ ¼å¼ã€‚ æ—¢ç„¶ RUN å°±åƒ Shell è„šæœ¬ä¸€æ ·å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å°±å¯ä»¥åƒ Shell è„šæœ¬ä¸€æ ·æŠŠæ¯ä¸ªå‘½ä»¤å¯¹åº”ä¸€ä¸ª RUN å‘¢ï¼Ÿæ¯”å¦‚è¿™æ ·ï¼š FROM debian:jessie RUN apt-get update RUN apt-get install -y gcc libc6-dev make RUN wget -O redis.tar.gz &quot;http://download.redis.io/releases/redis-3.2.5.tar.gz&quot; RUN mkdir -p /usr/src/redis RUN tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 RUN make -C /usr/src/redisRUN make -C /usr/src/redis install ä¹‹å‰è¯´è¿‡ï¼ŒDockerfile ä¸­æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šå»ºç«‹ä¸€å±‚ï¼ŒRUN ä¹Ÿä¸ä¾‹å¤–ã€‚æ¯ä¸€ä¸ª RUN çš„è¡Œä¸ºï¼Œå°±å’Œåˆšæ‰æˆ‘ä»¬æ‰‹å·¥å»ºç«‹é•œåƒçš„è¿‡ç¨‹ä¸€æ ·ï¼šæ–°å»ºç«‹ä¸€å±‚ï¼Œåœ¨å…¶ä¸Šæ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œæ‰§è¡Œç»“æŸåï¼Œcommit è¿™ä¸€å±‚çš„ä¿®æ”¹ï¼Œæ„æˆæ–°çš„é•œåƒã€‚ è€Œä¸Šé¢çš„è¿™ç§å†™æ³•ï¼Œåˆ›å»ºäº† 7 å±‚é•œåƒã€‚è¿™æ˜¯å®Œå…¨æ²¡æœ‰æ„ä¹‰çš„ï¼Œè€Œä¸”å¾ˆå¤šè¿è¡Œæ—¶ä¸éœ€è¦çš„ä¸œè¥¿ï¼Œéƒ½è¢«è£…è¿›äº†é•œåƒé‡Œï¼Œæ¯”å¦‚ç¼–è¯‘ç¯å¢ƒã€æ›´æ–°çš„è½¯ä»¶åŒ…ç­‰ç­‰ã€‚ç»“æœå°±æ˜¯äº§ç”Ÿéå¸¸è‡ƒè‚¿ã€éå¸¸å¤šå±‚çš„é•œåƒï¼Œä¸ä»…ä»…å¢åŠ äº†æ„å»ºéƒ¨ç½²çš„æ—¶é—´ï¼Œä¹Ÿå¾ˆå®¹æ˜“å‡ºé”™ã€‚è¿™æ˜¯å¾ˆå¤šåˆå­¦ Docker çš„äººå¸¸çŠ¯çš„ä¸€ä¸ªé”™è¯¯ã€‚ æ³¨æ„ï¼š Union FS æ˜¯æœ‰æœ€å¤§å±‚æ•°é™åˆ¶çš„ï¼Œæ¯”å¦‚ AUFSï¼Œæ›¾ç»æ˜¯æœ€å¤§ä¸å¾—è¶…è¿‡ 42 å±‚ï¼Œç°åœ¨æ˜¯ä¸å¾—è¶…è¿‡ 127 å±‚ã€‚ ä¸Šé¢çš„ Dockerfile æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯è¿™æ ·ï¼š FROM debian:jessie RUN buildDeps='gcc libc6-dev make' \\ &amp;&amp; apt-get update \\ &amp;&amp; apt-get install -y $buildDeps \\ &amp;&amp; wget -O redis.tar.gz &quot;http://download.redis.io/releases/redis-3.2.5.tar.gz&quot; \\ &amp;&amp; mkdir -p /usr/src/redis \\ &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \\ &amp;&amp; make -C /usr/src/redis \\ &amp;&amp; make -C /usr/src/redis install \\ &amp;&amp; rm -rf /var/lib/apt/lists/* \\ &amp;&amp; rm redis.tar.gz \\ &amp;&amp; rm -r /usr/src/redis \\ &amp;&amp; apt-get purge -y --auto-remove $buildDeps é¦–å…ˆï¼Œä¹‹å‰æ‰€æœ‰çš„å‘½ä»¤åªæœ‰ä¸€ä¸ªç›®çš„ï¼Œå°±æ˜¯ç¼–è¯‘ã€å®‰è£… Redis å¯æ‰§è¡Œæ–‡ä»¶ã€‚å› æ­¤æ²¡æœ‰å¿…è¦å»ºç«‹å¾ˆå¤šå±‚ï¼Œè¿™åªæ˜¯ä¸€å±‚çš„äº‹æƒ…ã€‚å› æ­¤ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨å¾ˆå¤šä¸ª RUN å¯¹ä¸€ä¸€å¯¹åº”ä¸åŒçš„å‘½ä»¤ï¼Œè€Œæ˜¯ä»…ä»…ä½¿ç”¨ä¸€ä¸ª RUN æŒ‡ä»¤ï¼Œå¹¶ä½¿ç”¨ &amp;&amp; å°†å„ä¸ªæ‰€éœ€å‘½ä»¤ä¸²è”èµ·æ¥ã€‚å°†ä¹‹å‰çš„ 7 å±‚ï¼Œç®€åŒ–ä¸ºäº† 1 å±‚ã€‚åœ¨æ’°å†™ Dockerfile çš„æ—¶å€™ï¼Œè¦ç»å¸¸æé†’è‡ªå·±ï¼Œè¿™å¹¶ä¸æ˜¯åœ¨å†™ Shell è„šæœ¬ï¼Œè€Œæ˜¯åœ¨å®šä¹‰æ¯ä¸€å±‚è¯¥å¦‚ä½•æ„å»ºã€‚ å¹¶ä¸”ï¼Œè¿™é‡Œä¸ºäº†æ ¼å¼åŒ–è¿˜è¿›è¡Œäº†æ¢è¡Œã€‚Dockerfile æ”¯æŒ Shell ç±»çš„è¡Œå°¾æ·»åŠ  \\ çš„å‘½ä»¤æ¢è¡Œæ–¹å¼ï¼Œä»¥åŠè¡Œé¦– # è¿›è¡Œæ³¨é‡Šçš„æ ¼å¼ã€‚è‰¯å¥½çš„æ ¼å¼ï¼Œæ¯”å¦‚æ¢è¡Œã€ç¼©è¿›ã€æ³¨é‡Šç­‰ï¼Œä¼šè®©ç»´æŠ¤ã€æ’éšœæ›´ä¸ºå®¹æ˜“ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¹ æƒ¯ã€‚ æ­¤å¤–ï¼Œè¿˜å¯ä»¥çœ‹åˆ°è¿™ä¸€ç»„å‘½ä»¤çš„æœ€åæ·»åŠ äº†æ¸…ç†å·¥ä½œçš„å‘½ä»¤ï¼Œåˆ é™¤äº†ä¸ºäº†ç¼–è¯‘æ„å»ºæ‰€éœ€è¦çš„è½¯ä»¶ï¼Œæ¸…ç†äº†æ‰€æœ‰ä¸‹è½½ã€å±•å¼€çš„æ–‡ä»¶ï¼Œå¹¶ä¸”è¿˜æ¸…ç†äº† apt ç¼“å­˜æ–‡ä»¶ã€‚è¿™æ˜¯å¾ˆé‡è¦çš„ä¸€æ­¥ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œé•œåƒæ˜¯å¤šå±‚å­˜å‚¨ï¼Œæ¯ä¸€å±‚çš„ä¸œè¥¿å¹¶ä¸ä¼šåœ¨ä¸‹ä¸€å±‚è¢«åˆ é™¤ï¼Œä¼šä¸€ç›´è·Ÿéšç€é•œåƒã€‚å› æ­¤é•œåƒæ„å»ºæ—¶ï¼Œä¸€å®šè¦ç¡®ä¿æ¯ä¸€å±‚åªæ·»åŠ çœŸæ­£éœ€è¦æ·»åŠ çš„ä¸œè¥¿ï¼Œä»»ä½•æ— å…³çš„ä¸œè¥¿éƒ½åº”è¯¥æ¸…ç†æ‰ã€‚ å¾ˆå¤šäººåˆå­¦ Docker åˆ¶ä½œå‡ºäº†å¾ˆè‡ƒè‚¿çš„é•œåƒçš„åŸå› ä¹‹ä¸€ï¼Œå°±æ˜¯å¿˜è®°äº†æ¯ä¸€å±‚æ„å»ºçš„æœ€åä¸€å®šè¦æ¸…ç†æ‰æ— å…³æ–‡ä»¶ã€‚ æ„å»ºé•œåƒ å¥½äº†ï¼Œè®©æˆ‘ä»¬å†å›åˆ°ä¹‹å‰å®šåˆ¶çš„ Nginx é•œåƒçš„ Dockerfile æ¥ã€‚ç°åœ¨æˆ‘ä»¬æ˜ç™½äº†è¿™ä¸ª Dockerfile çš„å†…å®¹ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬æ¥æ„å»ºè¿™ä¸ªé•œåƒå§ã€‚åœ¨ Dockerfile æ–‡ä»¶æ‰€åœ¨ç›®å½•æ‰§è¡Œï¼š docker build -t nginx:v3 . # è¾“å‡ºå¦‚ä¸‹ Sending build context to Docker daemon 2.048 kB Step 1 : FROM nginx ---&gt; e43d811ce2f4 Step 2 : RUN echo '&lt;h1&gt;Hello, Docker!&lt;/h1&gt;' &gt; /usr/share/nginx/html/index.html ---&gt; Running in 9cdc27646c7b ---&gt; 44aa4490ce2c Removing intermediate container 9cdc27646c7b Successfully built 44aa4490ce2c ä»å‘½ä»¤çš„è¾“å‡ºç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°é•œåƒçš„æ„å»ºè¿‡ç¨‹ã€‚åœ¨ Step 2 ä¸­ï¼Œå¦‚åŒæˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„é‚£æ ·ï¼ŒRUN æŒ‡ä»¤å¯åŠ¨äº†ä¸€ä¸ªå®¹å™¨ 9cdc27646c7bï¼Œæ‰§è¡Œäº†æ‰€è¦æ±‚çš„å‘½ä»¤ï¼Œå¹¶æœ€åæäº¤äº†è¿™ä¸€å±‚ 44aa4490ce2cï¼Œéšååˆ é™¤äº†æ‰€ç”¨åˆ°çš„è¿™ä¸ªå®¹å™¨ 9cdc27646c7bã€‚ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† docker build å‘½ä»¤è¿›è¡Œé•œåƒæ„å»ºã€‚å…¶æ ¼å¼ä¸ºï¼š docker build [é€‰é¡¹] &lt;ä¸Šä¸‹æ–‡è·¯å¾„/URL/-&gt; åœ¨è¿™é‡Œæˆ‘ä»¬æŒ‡å®šäº†æœ€ç»ˆé•œåƒçš„åç§° -t nginx:v3ï¼Œæ„å»ºæˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥åƒä¹‹å‰è¿è¡Œ nginx:v2 é‚£æ ·æ¥è¿è¡Œè¿™ä¸ªé•œåƒï¼Œå…¶ç»“æœä¼šå’Œ nginx:v2 ä¸€æ ·ã€‚ é•œåƒæ„å»ºä¸Šä¸‹æ–‡ å¦‚æœæ³¨æ„ï¼Œä¼šçœ‹åˆ° docker build å‘½ä»¤æœ€åæœ‰ä¸€ä¸ª .ã€‚. è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œè€Œ Dockerfile å°±åœ¨å½“å‰ç›®å½•ï¼Œå› æ­¤ä¸å°‘åˆå­¦è€…ä»¥ä¸ºè¿™ä¸ªè·¯å¾„æ˜¯åœ¨æŒ‡å®š Dockerfile æ‰€åœ¨è·¯å¾„ï¼Œè¿™ä¹ˆç†è§£å…¶å®æ˜¯ä¸å‡†ç¡®çš„ã€‚å¦‚æœå¯¹åº”ä¸Šé¢çš„å‘½ä»¤æ ¼å¼ï¼Œä½ å¯èƒ½ä¼šå‘ç°ï¼Œè¿™æ˜¯åœ¨æŒ‡å®š ä¸Šä¸‹æ–‡è·¯å¾„ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡å‘¢ï¼Ÿ é¦–å…ˆæˆ‘ä»¬è¦ç†è§£ docker build çš„å·¥ä½œåŸç†ã€‚Docker åœ¨è¿è¡Œæ—¶åˆ†ä¸º Docker å¼•æ“ï¼ˆä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å®ˆæŠ¤è¿›ç¨‹ï¼‰å’Œå®¢æˆ·ç«¯å·¥å…·ã€‚Docker çš„å¼•æ“æä¾›äº†ä¸€ç»„ REST APIï¼Œè¢«ç§°ä¸º Docker Remote APIï¼Œè€Œå¦‚ docker å‘½ä»¤è¿™æ ·çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œåˆ™æ˜¯é€šè¿‡è¿™ç»„ API ä¸ Docker å¼•æ“äº¤äº’ï¼Œä»è€Œå®Œæˆå„ç§åŠŸèƒ½ã€‚å› æ­¤ï¼Œè™½ç„¶è¡¨é¢ä¸Šæˆ‘ä»¬å¥½åƒæ˜¯åœ¨æœ¬æœºæ‰§è¡Œå„ç§ docker åŠŸèƒ½ï¼Œä½†å®é™…ä¸Šï¼Œä¸€åˆ‡éƒ½æ˜¯ä½¿ç”¨çš„è¿œç¨‹è°ƒç”¨å½¢å¼åœ¨æœåŠ¡ç«¯ï¼ˆDocker å¼•æ“ï¼‰å®Œæˆã€‚ä¹Ÿå› ä¸ºè¿™ç§ C/S è®¾è®¡ï¼Œè®©æˆ‘ä»¬æ“ä½œè¿œç¨‹æœåŠ¡å™¨çš„ Docker å¼•æ“å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚ å½“æˆ‘ä»¬è¿›è¡Œé•œåƒæ„å»ºçš„æ—¶å€™ï¼Œå¹¶éæ‰€æœ‰å®šåˆ¶éƒ½ä¼šé€šè¿‡ RUN æŒ‡ä»¤å®Œæˆï¼Œç»å¸¸ä¼šéœ€è¦å°†ä¸€äº›æœ¬åœ°æ–‡ä»¶å¤åˆ¶è¿›é•œåƒï¼Œæ¯”å¦‚é€šè¿‡ COPY æŒ‡ä»¤ã€ADD æŒ‡ä»¤ç­‰ã€‚è€Œ docker build å‘½ä»¤æ„å»ºé•œåƒï¼Œå…¶å®å¹¶éåœ¨æœ¬åœ°æ„å»ºï¼Œè€Œæ˜¯åœ¨æœåŠ¡ç«¯ï¼Œä¹Ÿå°±æ˜¯ Docker å¼•æ“ä¸­æ„å»ºçš„ã€‚é‚£ä¹ˆåœ¨è¿™ç§å®¢æˆ·ç«¯/æœåŠ¡ç«¯çš„æ¶æ„ä¸­ï¼Œå¦‚ä½•æ‰èƒ½è®©æœåŠ¡ç«¯è·å¾—æœ¬åœ°æ–‡ä»¶å‘¢ï¼Ÿ è¿™å°±å¼•å…¥äº†ä¸Šä¸‹æ–‡çš„æ¦‚å¿µã€‚å½“æ„å»ºçš„æ—¶å€™ï¼Œç”¨æˆ·ä¼šæŒ‡å®šæ„å»ºé•œåƒä¸Šä¸‹æ–‡çš„è·¯å¾„ï¼Œdocker build å‘½ä»¤å¾—çŸ¥è¿™ä¸ªè·¯å¾„åï¼Œä¼šå°†è·¯å¾„ä¸‹çš„æ‰€æœ‰å†…å®¹æ‰“åŒ…ï¼Œç„¶åä¸Šä¼ ç»™ Docker å¼•æ“ã€‚è¿™æ · Docker å¼•æ“æ”¶åˆ°è¿™ä¸ªä¸Šä¸‹æ–‡åŒ…åï¼Œå±•å¼€å°±ä¼šè·å¾—æ„å»ºé•œåƒæ‰€éœ€çš„ä¸€åˆ‡æ–‡ä»¶ã€‚ å¦‚æœåœ¨ Dockerfile ä¸­è¿™ä¹ˆå†™ï¼š COPY ./package.json /app/ è¿™å¹¶ä¸æ˜¯è¦å¤åˆ¶æ‰§è¡Œ docker build å‘½ä»¤æ‰€åœ¨çš„ç›®å½•ä¸‹çš„ package.jsonï¼Œä¹Ÿä¸æ˜¯å¤åˆ¶ Dockerfile æ‰€åœ¨ç›®å½•ä¸‹çš„ package.jsonï¼Œè€Œæ˜¯å¤åˆ¶ ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ ç›®å½•ä¸‹çš„ package.jsonã€‚ å› æ­¤ï¼ŒCOPY è¿™ç±»æŒ‡ä»¤ä¸­çš„æºæ–‡ä»¶çš„è·¯å¾„éƒ½æ˜¯ç›¸å¯¹è·¯å¾„ã€‚è¿™ä¹Ÿæ˜¯åˆå­¦è€…ç»å¸¸ä¼šé—®çš„ä¸ºä»€ä¹ˆ COPY ../package.json /app æˆ–è€… COPY /opt/xxxx /app æ— æ³•å·¥ä½œçš„åŸå› ï¼Œå› ä¸ºè¿™äº›è·¯å¾„å·²ç»è¶…å‡ºäº†ä¸Šä¸‹æ–‡çš„èŒƒå›´ï¼ŒDocker å¼•æ“æ— æ³•è·å¾—è¿™äº›ä½ç½®çš„æ–‡ä»¶ã€‚å¦‚æœçœŸçš„éœ€è¦é‚£äº›æ–‡ä»¶ï¼Œåº”è¯¥å°†å®ƒä»¬å¤åˆ¶åˆ°ä¸Šä¸‹æ–‡ç›®å½•ä¸­å»ã€‚ ç°åœ¨å°±å¯ä»¥ç†è§£åˆšæ‰çš„å‘½ä»¤ docker build -t nginx:v3 . ä¸­çš„è¿™ä¸ª .ï¼Œå®é™…ä¸Šæ˜¯åœ¨æŒ‡å®šä¸Šä¸‹æ–‡çš„ç›®å½•ï¼Œdocker build å‘½ä»¤ä¼šå°†è¯¥ç›®å½•ä¸‹çš„å†…å®¹æ‰“åŒ…äº¤ç»™ Docker å¼•æ“ä»¥å¸®åŠ©æ„å»ºé•œåƒã€‚ å¦‚æœè§‚å¯Ÿ docker build è¾“å‡ºï¼Œæˆ‘ä»¬å…¶å®å·²ç»çœ‹åˆ°äº†è¿™ä¸ªå‘é€ä¸Šä¸‹æ–‡çš„è¿‡ç¨‹ï¼š docker build -t nginx:v3 . # è¾“å‡ºå¦‚ä¸‹ Sending build context to Docker daemon 2.048 kB ç†è§£æ„å»ºä¸Šä¸‹æ–‡å¯¹äºé•œåƒæ„å»ºæ˜¯å¾ˆé‡è¦çš„ï¼Œé¿å…çŠ¯ä¸€äº›ä¸åº”è¯¥çš„é”™è¯¯ã€‚æ¯”å¦‚æœ‰äº›åˆå­¦è€…åœ¨å‘ç° COPY /opt/xxxx /app ä¸å·¥ä½œåï¼Œäºæ˜¯å¹²è„†å°† Dockerfile æ”¾åˆ°äº†ç¡¬ç›˜æ ¹ç›®å½•å»æ„å»ºï¼Œç»“æœå‘ç° docker build æ‰§è¡Œåï¼Œåœ¨å‘é€ä¸€ä¸ªå‡ å GB çš„ä¸œè¥¿ï¼Œæä¸ºç¼“æ…¢è€Œä¸”å¾ˆå®¹æ˜“æ„å»ºå¤±è´¥ã€‚é‚£æ˜¯å› ä¸ºè¿™ç§åšæ³•æ˜¯åœ¨è®© docker build æ‰“åŒ…æ•´ä¸ªç¡¬ç›˜ï¼Œè¿™æ˜¾ç„¶æ˜¯ä½¿ç”¨é”™è¯¯ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œåº”è¯¥ä¼šå°† Dockerfile ç½®äºä¸€ä¸ªç©ºç›®å½•ä¸‹ï¼Œæˆ–è€…é¡¹ç›®æ ¹ç›®å½•ä¸‹ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹æ²¡æœ‰æ‰€éœ€æ–‡ä»¶ï¼Œé‚£ä¹ˆåº”è¯¥æŠŠæ‰€éœ€æ–‡ä»¶å¤åˆ¶ä¸€ä»½è¿‡æ¥ã€‚å¦‚æœç›®å½•ä¸‹æœ‰äº›ä¸œè¥¿ç¡®å®ä¸å¸Œæœ›æ„å»ºæ—¶ä¼ ç»™ Docker å¼•æ“ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ .gitignore ä¸€æ ·çš„è¯­æ³•å†™ä¸€ä¸ª .dockerignoreï¼Œè¯¥æ–‡ä»¶æ˜¯ç”¨äºå‰”é™¤ä¸éœ€è¦ä½œä¸ºä¸Šä¸‹æ–‡ä¼ é€’ç»™ Docker å¼•æ“çš„ã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šæœ‰äººè¯¯ä»¥ä¸º . æ˜¯æŒ‡å®š Dockerfile æ‰€åœ¨ç›®å½•å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸é¢å¤–æŒ‡å®š Dockerfile çš„è¯ï¼Œä¼šå°†ä¸Šä¸‹æ–‡ç›®å½•ä¸‹çš„åä¸º Dockerfile çš„æ–‡ä»¶ä½œä¸º Dockerfileã€‚ è¿™åªæ˜¯é»˜è®¤è¡Œä¸ºï¼Œå®é™…ä¸Š Dockerfile çš„æ–‡ä»¶åå¹¶ä¸è¦æ±‚å¿…é¡»ä¸º Dockerfileï¼Œè€Œä¸”å¹¶ä¸è¦æ±‚å¿…é¡»ä½äºä¸Šä¸‹æ–‡ç›®å½•ä¸­ï¼Œæ¯”å¦‚å¯ä»¥ç”¨ -f ../Dockerfile.php å‚æ•°æŒ‡å®šæŸä¸ªæ–‡ä»¶ä½œä¸º Dockerfileã€‚ å½“ç„¶ï¼Œä¸€èˆ¬å¤§å®¶ä¹ æƒ¯æ€§çš„ä¼šä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶å Dockerfileï¼Œä»¥åŠä¼šå°†å…¶ç½®äºé•œåƒæ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ã€‚ dockerfile æŒ‡ä»¤ æ¦‚è¿° æˆ‘ä»¬å·²ç»ä»‹ç»äº† FROMï¼ŒRUNï¼Œè¿˜æåŠäº† COPY, ADDï¼Œå…¶å® Dockerfile åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œå®ƒæä¾›äº†åå¤šä¸ªæŒ‡ä»¤ã€‚ä¸‹é¢æˆ‘ä»¬ç»§ç»­è®²è§£å…¶ä»–çš„æŒ‡ä»¤ã€‚ COPY æ ¼å¼ï¼š COPY &lt;æºè·¯å¾„&gt;... &lt;ç›®æ ‡è·¯å¾„&gt; COPY [&quot;&lt;æºè·¯å¾„1&gt;&quot;,... &quot;&lt;ç›®æ ‡è·¯å¾„&gt;&quot;] å’Œ RUN æŒ‡ä»¤ä¸€æ ·ï¼Œä¹Ÿæœ‰ä¸¤ç§æ ¼å¼ï¼Œä¸€ç§ç±»ä¼¼äºå‘½ä»¤è¡Œï¼Œä¸€ç§ç±»ä¼¼äºå‡½æ•°è°ƒç”¨ã€‚ COPY æŒ‡ä»¤å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ &lt;æºè·¯å¾„&gt; çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„ &lt;ç›®æ ‡è·¯å¾„&gt; ä½ç½®ã€‚æ¯”å¦‚ï¼š COPY package.json /usr/src/app/ &lt;æºè·¯å¾„&gt; å¯ä»¥æ˜¯å¤šä¸ªï¼Œç”šè‡³å¯ä»¥æ˜¯é€šé…ç¬¦ï¼Œå…¶é€šé…ç¬¦è§„åˆ™è¦æ»¡è¶³ Go çš„ filepath.Matchè§„åˆ™ï¼Œå¦‚ï¼š COPY hom* /mydir/ COPY hom?.txt /mydir/ &lt;ç›®æ ‡è·¯å¾„&gt; å¯ä»¥æ˜¯å®¹å™¨å†…çš„ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äºå·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼ˆå·¥ä½œç›®å½•å¯ä»¥ç”¨ WORKDIR æŒ‡ä»¤æ¥æŒ‡å®šï¼‰ã€‚ç›®æ ‡è·¯å¾„ä¸éœ€è¦äº‹å…ˆåˆ›å»ºï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ä¼šåœ¨å¤åˆ¶æ–‡ä»¶å‰å…ˆè¡Œåˆ›å»ºç¼ºå¤±ç›®å½•ã€‚ æ­¤å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œä½¿ç”¨ COPY æŒ‡ä»¤ï¼Œæºæ–‡ä»¶çš„å„ç§å…ƒæ•°æ®éƒ½ä¼šä¿ç•™ã€‚æ¯”å¦‚è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€æ–‡ä»¶å˜æ›´æ—¶é—´ç­‰ã€‚è¿™ä¸ªç‰¹æ€§å¯¹äºé•œåƒå®šåˆ¶å¾ˆæœ‰ç”¨ã€‚ç‰¹åˆ«æ˜¯æ„å»ºç›¸å…³æ–‡ä»¶éƒ½åœ¨ä½¿ç”¨ Git è¿›è¡Œç®¡ç†çš„æ—¶å€™ã€‚ ADD ADD æŒ‡ä»¤å’Œ COPY çš„æ ¼å¼å’Œæ€§è´¨åŸºæœ¬ä¸€è‡´ã€‚ä½†æ˜¯åœ¨ COPY åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›åŠŸèƒ½ã€‚ æ¯”å¦‚ &lt;æºè·¯å¾„&gt; å¯ä»¥æ˜¯ä¸€ä¸ª URLï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒDocker å¼•æ“ä¼šè¯•å›¾å»ä¸‹è½½è¿™ä¸ªé“¾æ¥çš„æ–‡ä»¶æ”¾åˆ° &lt;ç›®æ ‡è·¯å¾„&gt; å»ã€‚ä¸‹è½½åçš„æ–‡ä»¶æƒé™è‡ªåŠ¨è®¾ç½®ä¸º 600ï¼Œå¦‚æœè¿™å¹¶ä¸æ˜¯æƒ³è¦çš„æƒé™ï¼Œé‚£ä¹ˆè¿˜éœ€è¦å¢åŠ é¢å¤–çš„ä¸€å±‚ RUN è¿›è¡Œæƒé™è°ƒæ•´ï¼Œå¦å¤–ï¼Œå¦‚æœä¸‹è½½çš„æ˜¯ä¸ªå‹ç¼©åŒ…ï¼Œéœ€è¦è§£å‹ç¼©ï¼Œä¹Ÿä¸€æ ·è¿˜éœ€è¦é¢å¤–çš„ä¸€å±‚ RUN æŒ‡ä»¤è¿›è¡Œè§£å‹ç¼©ã€‚æ‰€ä»¥ä¸å¦‚ç›´æ¥ä½¿ç”¨ RUN æŒ‡ä»¤ï¼Œç„¶åä½¿ç”¨ wget æˆ–è€… curl å·¥å…·ä¸‹è½½ï¼Œå¤„ç†æƒé™ã€è§£å‹ç¼©ã€ç„¶åæ¸…ç†æ— ç”¨æ–‡ä»¶æ›´åˆç†ã€‚å› æ­¤ï¼Œè¿™ä¸ªåŠŸèƒ½å…¶å®å¹¶ä¸å®ç”¨ï¼Œè€Œä¸”ä¸æ¨èä½¿ç”¨ã€‚ å¦‚æœ &lt;æºè·¯å¾„&gt; ä¸ºä¸€ä¸ª tar å‹ç¼©æ–‡ä»¶çš„è¯ï¼Œå‹ç¼©æ ¼å¼ä¸º gzip, bzip2 ä»¥åŠ xz çš„æƒ…å†µä¸‹ï¼ŒADD æŒ‡ä»¤å°†ä¼šè‡ªåŠ¨è§£å‹ç¼©è¿™ä¸ªå‹ç¼©æ–‡ä»¶åˆ° &lt;ç›®æ ‡è·¯å¾„&gt; å»ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè‡ªåŠ¨è§£å‹ç¼©çš„åŠŸèƒ½éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚å®˜æ–¹é•œåƒ ubuntu ä¸­ï¼š FROM scratch ADD ubuntu-xenial-core-cloudimg-amd64-root.tar.gz / ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çœŸçš„æ˜¯å¸Œæœ›å¤åˆ¶ä¸ªå‹ç¼©æ–‡ä»¶è¿›å»ï¼Œè€Œä¸è§£å‹ç¼©ï¼Œè¿™æ—¶å°±ä¸å¯ä»¥ä½¿ç”¨ ADD å‘½ä»¤äº†ã€‚ åœ¨ Docker å®˜æ–¹çš„ Dockerfile æœ€ä½³å®è·µæ–‡æ¡£ ä¸­è¦æ±‚ï¼Œå°½å¯èƒ½çš„ä½¿ç”¨ COPYï¼Œå› ä¸º COPY çš„è¯­ä¹‰å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯å¤åˆ¶æ–‡ä»¶è€Œå·²ï¼Œè€Œ ADD åˆ™åŒ…å«äº†æ›´å¤æ‚çš„åŠŸèƒ½ï¼Œå…¶è¡Œä¸ºä¹Ÿä¸ä¸€å®šå¾ˆæ¸…æ™°ã€‚æœ€é€‚åˆä½¿ç”¨ ADD çš„åœºåˆï¼Œå°±æ˜¯æ‰€æåŠçš„éœ€è¦è‡ªåŠ¨è§£å‹ç¼©çš„åœºåˆã€‚ å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒADD æŒ‡ä»¤ä¼šä»¤é•œåƒæ„å»ºç¼“å­˜å¤±æ•ˆï¼Œä»è€Œå¯èƒ½ä¼šä»¤é•œåƒæ„å»ºå˜å¾—æ¯”è¾ƒç¼“æ…¢ã€‚ å› æ­¤åœ¨ COPY å’Œ ADD æŒ‡ä»¤ä¸­é€‰æ‹©çš„æ—¶å€™ï¼Œå¯ä»¥éµå¾ªè¿™æ ·çš„åŸåˆ™ï¼Œæ‰€æœ‰çš„æ–‡ä»¶å¤åˆ¶å‡ä½¿ç”¨ COPY æŒ‡ä»¤ï¼Œä»…åœ¨éœ€è¦è‡ªåŠ¨è§£å‹ç¼©çš„åœºåˆä½¿ç”¨ ADDã€‚ CMD CMD æŒ‡ä»¤çš„æ ¼å¼å’Œ RUN ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ä¸¤ç§æ ¼å¼ï¼š shell æ ¼å¼ï¼šCMD &lt;å‘½ä»¤&gt; exec æ ¼å¼ï¼šCMD [&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;, &quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;...] å‚æ•°åˆ—è¡¨æ ¼å¼ï¼šCMD [&quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;...]ã€‚åœ¨æŒ‡å®šäº† ENTRYPOINT æŒ‡ä»¤åï¼Œç”¨ CMD æŒ‡å®šå…·ä½“çš„å‚æ•°ã€‚ ä¹‹å‰ä»‹ç»å®¹å™¨çš„æ—¶å€™æ›¾ç»è¯´è¿‡ï¼ŒDocker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå®¹å™¨å°±æ˜¯è¿›ç¨‹ã€‚æ—¢ç„¶æ˜¯è¿›ç¨‹ï¼Œé‚£ä¹ˆåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šæ‰€è¿è¡Œçš„ç¨‹åºåŠå‚æ•°ã€‚CMD æŒ‡ä»¤å°±æ˜¯ç”¨äºæŒ‡å®šé»˜è®¤çš„å®¹å™¨ä¸»è¿›ç¨‹çš„å¯åŠ¨å‘½ä»¤çš„ã€‚ åœ¨è¿è¡Œæ—¶å¯ä»¥æŒ‡å®šæ–°çš„å‘½ä»¤æ¥æ›¿ä»£é•œåƒè®¾ç½®ä¸­çš„è¿™ä¸ªé»˜è®¤å‘½ä»¤ï¼Œæ¯”å¦‚ï¼Œubuntu é•œåƒé»˜è®¤çš„ CMD æ˜¯ /bin/bashï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ docker run -it ubuntu çš„è¯ï¼Œä¼šç›´æ¥è¿›å…¥ bashã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶æŒ‡å®šè¿è¡Œåˆ«çš„å‘½ä»¤ï¼Œå¦‚ docker run -it ubuntu cat /etc/os-releaseã€‚è¿™å°±æ˜¯ç”¨ cat /etc/os-release å‘½ä»¤æ›¿æ¢äº†é»˜è®¤çš„ /bin/bash å‘½ä»¤äº†ï¼Œè¾“å‡ºäº†ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ã€‚ åœ¨æŒ‡ä»¤æ ¼å¼ä¸Šï¼Œä¸€èˆ¬æ¨èä½¿ç”¨ exec æ ¼å¼ï¼Œè¿™ç±»æ ¼å¼åœ¨è§£ææ—¶ä¼šè¢«è§£æä¸º JSON æ•°ç»„ï¼Œå› æ­¤ä¸€å®šè¦ä½¿ç”¨åŒå¼•å· &quot;ï¼Œè€Œä¸è¦ä½¿ç”¨å•å¼•å·ã€‚ å¦‚æœä½¿ç”¨ shell æ ¼å¼çš„è¯ï¼Œå®é™…çš„å‘½ä»¤ä¼šè¢«åŒ…è£…ä¸º sh -c çš„å‚æ•°çš„å½¢å¼è¿›è¡Œæ‰§è¡Œã€‚æ¯”å¦‚ï¼š CMD echo $HOME åœ¨å®é™…æ‰§è¡Œä¸­ï¼Œä¼šå°†å…¶å˜æ›´ä¸ºï¼š CMD [ &quot;sh&quot;, &quot;-c&quot;, &quot;echo $HOME&quot; ] è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡çš„åŸå› ï¼Œå› ä¸ºè¿™äº›ç¯å¢ƒå˜é‡ä¼šè¢« shell è¿›è¡Œè§£æå¤„ç†ã€‚ æåˆ° CMD å°±ä¸å¾—ä¸æå®¹å™¨ä¸­åº”ç”¨åœ¨å‰å°æ‰§è¡Œå’Œåå°æ‰§è¡Œçš„é—®é¢˜ã€‚è¿™æ˜¯åˆå­¦è€…å¸¸å‡ºç°çš„ä¸€ä¸ªæ··æ·†ã€‚ Docker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå®¹å™¨ä¸­çš„åº”ç”¨éƒ½åº”è¯¥ä»¥å‰å°æ‰§è¡Œï¼Œè€Œä¸æ˜¯åƒè™šæ‹Ÿæœºã€ç‰©ç†æœºé‡Œé¢é‚£æ ·ï¼Œç”¨ upstart/systemd å»å¯åŠ¨åå°æœåŠ¡ï¼Œå®¹å™¨å†…æ²¡æœ‰åå°æœåŠ¡çš„æ¦‚å¿µã€‚ ä¸€äº›åˆå­¦è€…å°† CMD å†™ä¸ºï¼š CMD service nginx start ç„¶åå‘ç°å®¹å™¨æ‰§è¡Œåå°±ç«‹å³é€€å‡ºäº†ã€‚ç”šè‡³åœ¨å®¹å™¨å†…å»ä½¿ç”¨ systemctl å‘½ä»¤ç»“æœå´å‘ç°æ ¹æœ¬æ‰§è¡Œä¸äº†ã€‚è¿™å°±æ˜¯å› ä¸ºæ²¡æœ‰ææ˜ç™½å‰å°ã€åå°çš„æ¦‚å¿µï¼Œæ²¡æœ‰åŒºåˆ†å®¹å™¨å’Œè™šæ‹Ÿæœºçš„å·®å¼‚ï¼Œä¾æ—§åœ¨ä»¥ä¼ ç»Ÿè™šæ‹Ÿæœºçš„è§’åº¦å»ç†è§£å®¹å™¨ã€‚ å¯¹äºå®¹å™¨è€Œè¨€ï¼Œå…¶å¯åŠ¨ç¨‹åºå°±æ˜¯å®¹å™¨åº”ç”¨è¿›ç¨‹ï¼Œå®¹å™¨å°±æ˜¯ä¸ºäº†ä¸»è¿›ç¨‹è€Œå­˜åœ¨çš„ï¼Œä¸»è¿›ç¨‹é€€å‡ºï¼Œå®¹å™¨å°±å¤±å»äº†å­˜åœ¨çš„æ„ä¹‰ï¼Œä»è€Œé€€å‡ºï¼Œå…¶å®ƒè¾…åŠ©è¿›ç¨‹ä¸æ˜¯å®ƒéœ€è¦å…³å¿ƒçš„ä¸œè¥¿ã€‚ è€Œä½¿ç”¨ service nginx start å‘½ä»¤ï¼Œåˆ™æ˜¯å¸Œæœ› upstart æ¥ä»¥åå°å®ˆæŠ¤è¿›ç¨‹å½¢å¼å¯åŠ¨ nginx æœåŠ¡ã€‚è€Œåˆšæ‰è¯´äº† CMD service nginx start ä¼šè¢«ç†è§£ä¸º CMD [ &quot;sh&quot;, &quot;-c&quot;, &quot;service nginx start&quot;]ï¼Œå› æ­¤ä¸»è¿›ç¨‹å®é™…ä¸Šæ˜¯ shã€‚é‚£ä¹ˆå½“ service nginx start å‘½ä»¤ç»“æŸåï¼Œsh ä¹Ÿå°±ç»“æŸäº†ï¼Œsh ä½œä¸ºä¸»è¿›ç¨‹é€€å‡ºäº†ï¼Œè‡ªç„¶å°±ä¼šä»¤å®¹å™¨é€€å‡ºã€‚ æ­£ç¡®çš„åšæ³•æ˜¯ç›´æ¥æ‰§è¡Œ nginx å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”è¦æ±‚ä»¥å‰å°å½¢å¼è¿è¡Œã€‚æ¯”å¦‚ï¼š CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;] ENTRYPOINT ENTRYPOINT çš„æ ¼å¼å’Œ RUN æŒ‡ä»¤æ ¼å¼ä¸€æ ·ï¼Œåˆ†ä¸º exec æ ¼å¼å’Œ shell æ ¼å¼ã€‚ ENTRYPOINT çš„ç›®çš„å’Œ CMD ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨æŒ‡å®šå®¹å™¨å¯åŠ¨ç¨‹åºåŠå‚æ•°ã€‚ENTRYPOINT åœ¨è¿è¡Œæ—¶ä¹Ÿå¯ä»¥æ›¿ä»£ï¼Œä¸è¿‡æ¯” CMD è¦ç•¥æ˜¾ç¹çï¼Œéœ€è¦é€šè¿‡ docker run çš„å‚æ•° --entrypoint æ¥æŒ‡å®šã€‚ å½“æŒ‡å®šäº† ENTRYPOINT åï¼ŒCMD çš„å«ä¹‰å°±å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸å†æ˜¯ç›´æ¥çš„è¿è¡Œå…¶å‘½ä»¤ï¼Œè€Œæ˜¯å°† CMD çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ ç»™ ENTRYPOINT æŒ‡ä»¤ï¼Œæ¢å¥è¯è¯´å®é™…æ‰§è¡Œæ—¶ï¼Œå°†å˜ä¸ºï¼š &lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot; é‚£ä¹ˆæœ‰äº† CMD åï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ ENTRYPOINT å‘¢ï¼Ÿè¿™ç§ &lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot; æœ‰ä»€ä¹ˆå¥½å¤„ä¹ˆï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªåœºæ™¯ã€‚ åœºæ™¯ä¸€ï¼šè®©é•œåƒå˜æˆåƒå‘½ä»¤ä¸€æ ·ä½¿ç”¨ å‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¾—çŸ¥è‡ªå·±å½“å‰å…¬ç½‘ IP çš„é•œåƒï¼Œé‚£ä¹ˆå¯ä»¥å…ˆç”¨ CMD æ¥å®ç°ï¼š FROM ubuntu:16.04 RUN apt-get update \\ &amp;&amp; apt-get install -y curl \\ &amp;&amp; rm -rf /var/lib/apt/lists/* CMD [ &quot;curl&quot;, &quot;-s&quot;, &quot;http://ip.cn&quot; ] å‡å¦‚æˆ‘ä»¬ä½¿ç”¨ docker build -t myip . æ¥æ„å»ºé•œåƒçš„è¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æŸ¥è¯¢å½“å‰å…¬ç½‘ IPï¼Œåªéœ€è¦æ‰§è¡Œï¼š docker run myip å½“å‰ IPï¼š61.148.226.66 æ¥è‡ªï¼šåŒ—äº¬å¸‚ è”é€š å—¯ï¼Œè¿™ä¹ˆçœ‹èµ·æ¥å¥½åƒå¯ä»¥ç›´æ¥æŠŠé•œåƒå½“åšå‘½ä»¤ä½¿ç”¨äº†ï¼Œä¸è¿‡å‘½ä»¤æ€»æœ‰å‚æ•°ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›åŠ å‚æ•°å‘¢ï¼Ÿæ¯”å¦‚ä»ä¸Šé¢çš„ CMD ä¸­å¯ä»¥çœ‹åˆ°å®è´¨çš„å‘½ä»¤æ˜¯ curlï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¸Œæœ›æ˜¾ç¤º HTTP å¤´ä¿¡æ¯ï¼Œå°±éœ€è¦åŠ ä¸Š -i å‚æ•°ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥åŠ  -i å‚æ•°ç»™ docker run myip ä¹ˆï¼Ÿ docker run myip -i docker: Error response from daemon: invalid header field value &quot;oci runtime error: container_linux.go:247: starting container process caused \\&quot;exec: \\\\\\&quot;-i\\\\\\&quot;: executable file not found in $PATH\\&quot;\\n&quot;. æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯æ‰§è¡Œæ–‡ä»¶æ‰¾ä¸åˆ°çš„æŠ¥é”™ï¼Œexecutable file not foundã€‚ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œè·Ÿåœ¨é•œåƒååé¢çš„æ˜¯ commandï¼Œè¿è¡Œæ—¶ä¼šæ›¿æ¢ CMD çš„é»˜è®¤å€¼ã€‚å› æ­¤è¿™é‡Œçš„ -i æ›¿æ¢äº†åŸæ¥çš„ CMDï¼Œè€Œä¸æ˜¯æ·»åŠ åœ¨åŸæ¥çš„ curl -s http://ip.cn åé¢ã€‚è€Œ -i æ ¹æœ¬ä¸æ˜¯å‘½ä»¤ï¼Œæ‰€ä»¥è‡ªç„¶æ‰¾ä¸åˆ°ã€‚ é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¸Œæœ›åŠ å…¥ -i è¿™å‚æ•°ï¼Œæˆ‘ä»¬å°±å¿…é¡»é‡æ–°å®Œæ•´çš„è¾“å…¥è¿™ä¸ªå‘½ä»¤ï¼š docker run myip curl -s http://ip.cn -i è¿™æ˜¾ç„¶ä¸æ˜¯å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œä½¿ç”¨ ENTRYPOINT å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç°åœ¨æˆ‘ä»¬é‡æ–°ç”¨ ENTRYPOINT æ¥å®ç°è¿™ä¸ªé•œåƒï¼š FROM ubuntu:16.04 RUN apt-get update \\ &amp;&amp; apt-get install -y curl \\ &amp;&amp; rm -rf /var/lib/apt/lists/* ENTRYPOINT [ &quot;curl&quot;, &quot;-s&quot;, &quot;http://ip.cn&quot; ] è¿™æ¬¡æˆ‘ä»¬å†æ¥å°è¯•ç›´æ¥ä½¿ç”¨ docker run myip -iï¼š docker run myip å½“å‰ IPï¼š61.148.226.66 æ¥è‡ªï¼šåŒ—äº¬å¸‚ è”é€š docker run myip -i HTTP/1.1 200 OK Server: nginx/1.8.0 Date: Tue, 22 Nov 2016 05:12:40 GMT Content-Type: text/html; charset=UTF-8 Vary: Accept-Encoding X-Powered-By: PHP/5.6.24-1~dotdeb+7.1 X-Cache: MISS from cache-2 X-Cache-Lookup: MISS from cache-2:80 X-Cache: MISS from proxy-2_6 Transfer-Encoding: chunked Via: 1.1 cache-2:80, 1.1 proxy-2_6:8006 Connection: keep-aliveå½“å‰ IPï¼š61.148.226.66 æ¥è‡ªï¼šåŒ—äº¬å¸‚ è”é€š å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¬¡æˆåŠŸäº†ã€‚è¿™æ˜¯å› ä¸ºå½“å­˜åœ¨ ENTRYPOINT åï¼ŒCMD çš„å†…å®¹å°†ä¼šä½œä¸ºå‚æ•°ä¼ ç»™ ENTRYPOINTï¼Œè€Œè¿™é‡Œ -i å°±æ˜¯æ–°çš„ CMDï¼Œå› æ­¤ä¼šä½œä¸ºå‚æ•°ä¼ ç»™ curlï¼Œä»è€Œè¾¾åˆ°äº†æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœã€‚ åœºæ™¯äºŒï¼šåº”ç”¨è¿è¡Œå‰çš„å‡†å¤‡å·¥ä½œ å¯åŠ¨å®¹å™¨å°±æ˜¯å¯åŠ¨ä¸»è¿›ç¨‹ï¼Œä½†æœ‰äº›æ—¶å€™ï¼Œå¯åŠ¨ä¸»è¿›ç¨‹å‰ï¼Œéœ€è¦ä¸€äº›å‡†å¤‡å·¥ä½œã€‚ æ¯”å¦‚ mysql ç±»çš„æ•°æ®åº“ï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ•°æ®åº“é…ç½®ã€åˆå§‹åŒ–çš„å·¥ä½œï¼Œè¿™äº›å·¥ä½œè¦åœ¨æœ€ç»ˆçš„ mysql æœåŠ¡å™¨è¿è¡Œä¹‹å‰è§£å†³ã€‚ æ­¤å¤–ï¼Œå¯èƒ½å¸Œæœ›é¿å…ä½¿ç”¨ root ç”¨æˆ·å»å¯åŠ¨æœåŠ¡ï¼Œä»è€Œæé«˜å®‰å…¨æ€§ï¼Œè€Œåœ¨å¯åŠ¨æœåŠ¡å‰è¿˜éœ€è¦ä»¥ root èº«ä»½æ‰§è¡Œä¸€äº›å¿…è¦çš„å‡†å¤‡å·¥ä½œï¼Œæœ€ååˆ‡æ¢åˆ°æœåŠ¡ç”¨æˆ·èº«ä»½å¯åŠ¨æœåŠ¡ã€‚æˆ–è€…é™¤äº†æœåŠ¡å¤–ï¼Œå…¶å®ƒå‘½ä»¤ä¾æ—§å¯ä»¥ä½¿ç”¨ root èº«ä»½æ‰§è¡Œï¼Œæ–¹ä¾¿è°ƒè¯•ç­‰ã€‚ è¿™äº›å‡†å¤‡å·¥ä½œæ˜¯å’Œå®¹å™¨ CMD æ— å…³çš„ï¼Œæ— è®º CMD ä¸ºä»€ä¹ˆï¼Œéƒ½éœ€è¦äº‹å…ˆè¿›è¡Œä¸€ä¸ªé¢„å¤„ç†çš„å·¥ä½œã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å†™ä¸€ä¸ªè„šæœ¬ï¼Œç„¶åæ”¾å…¥ ENTRYPOINT ä¸­å»æ‰§è¡Œï¼Œè€Œè¿™ä¸ªè„šæœ¬ä¼šå°†æ¥åˆ°çš„å‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ &lt;CMD&gt;ï¼‰ä½œä¸ºå‘½ä»¤ï¼Œåœ¨è„šæœ¬æœ€åæ‰§è¡Œã€‚æ¯”å¦‚å®˜æ–¹é•œåƒ redis ä¸­å°±æ˜¯è¿™ä¹ˆåšçš„ï¼š FROM alpine:3.4 RUN addgroup -S redis &amp;&amp; adduser -S -G redis redis ENTRYPOINT [&quot;docker-entrypoint.sh&quot;] EXPOSE 6379 CMD [ &quot;redis-server&quot; ] å¯ä»¥çœ‹åˆ°å…¶ä¸­ä¸ºäº† redis æœåŠ¡åˆ›å»ºäº† redis ç”¨æˆ·ï¼Œå¹¶åœ¨æœ€åæŒ‡å®šäº† ENTRYPOINT ä¸º docker-entrypoint.sh è„šæœ¬ã€‚ #!/bin/sh # allow the container to be started with `--user` if [ &quot;$1&quot; = 'redis-server' -a &quot;$(id -u)&quot; = '0' ]; then chown -R redis . exec su-exec redis &quot;$0&quot; &quot;$@&quot; fi exec &quot;$@&quot; è¯¥è„šæœ¬çš„å†…å®¹å°±æ˜¯æ ¹æ® CMD çš„å†…å®¹æ¥åˆ¤æ–­ï¼Œå¦‚æœæ˜¯ redis-server çš„è¯ï¼Œåˆ™åˆ‡æ¢åˆ° redis ç”¨æˆ·èº«ä»½å¯åŠ¨æœåŠ¡å™¨ï¼Œå¦åˆ™ä¾æ—§ä½¿ç”¨ root èº«ä»½æ‰§è¡Œã€‚æ¯”å¦‚ï¼š docker run -it redis id uid=0(root) gid=0(root) groups=0(root) ENV æ ¼å¼æœ‰ä¸¤ç§ï¼š ENV &lt;key&gt; &lt;value&gt; ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;... è¿™ä¸ªæŒ‡ä»¤å¾ˆç®€å•ï¼Œå°±æ˜¯è®¾ç½®ç¯å¢ƒå˜é‡è€Œå·²ï¼Œæ— è®ºæ˜¯åé¢çš„å…¶å®ƒæŒ‡ä»¤ï¼Œå¦‚ RUNï¼Œè¿˜æ˜¯è¿è¡Œæ—¶çš„åº”ç”¨ï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™é‡Œå®šä¹‰çš„ç¯å¢ƒå˜é‡ã€‚ ENV VERSION=1.0 DEBUG=on \\ NAME=&quot;Happy Feet&quot; è¿™ä¸ªä¾‹å­ä¸­æ¼”ç¤ºäº†å¦‚ä½•æ¢è¡Œï¼Œä»¥åŠå¯¹å«æœ‰ç©ºæ ¼çš„å€¼ç”¨åŒå¼•å·æ‹¬èµ·æ¥çš„åŠæ³•ï¼Œè¿™å’Œ Shell ä¸‹çš„è¡Œä¸ºæ˜¯ä¸€è‡´çš„ã€‚ å®šä¹‰äº†ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆåœ¨åç»­çš„æŒ‡ä»¤ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç¯å¢ƒå˜é‡ã€‚æ¯”å¦‚åœ¨å®˜æ–¹ node é•œåƒ Dockerfile ä¸­ï¼Œå°±æœ‰ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š ENV NODE_VERSION 7.2.0 RUN curl -SLO &quot;https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz&quot; \\ &amp;&amp; curl -SLO &quot;https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc&quot; \\ &amp;&amp; gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \\ &amp;&amp; grep &quot; node-v$NODE_VERSION-linux-x64.tar.xz\\$&quot; SHASUMS256.txt | sha256sum -c - \\ &amp;&amp; tar -xJf &quot;node-v$NODE_VERSION-linux-x64.tar.xz&quot; -C /usr/local --strip-components=1 \\ &amp;&amp; rm &quot;node-v$NODE_VERSION-linux-x64.tar.xz&quot; SHASUMS256.txt.asc SHASUMS256.txt \\ &amp;&amp; ln -s /usr/local/bin/node /usr/local/bin/nodejs åœ¨è¿™é‡Œå…ˆå®šä¹‰äº†ç¯å¢ƒå˜é‡ NODE_VERSIONï¼Œå…¶åçš„ RUN è¿™å±‚é‡Œï¼Œå¤šæ¬¡ä½¿ç”¨ $NODE_VERSION æ¥è¿›è¡Œæ“ä½œå®šåˆ¶ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå°†æ¥å‡çº§é•œåƒæ„å»ºç‰ˆæœ¬çš„æ—¶å€™ï¼Œåªéœ€è¦æ›´æ–° 7.2.0 å³å¯ï¼ŒDockerfile æ„å»ºç»´æŠ¤å˜å¾—æ›´è½»æ¾äº†ã€‚ ä¸‹åˆ—æŒ‡ä»¤å¯ä»¥æ”¯æŒç¯å¢ƒå˜é‡å±•å¼€ï¼š ADDã€COPYã€ENVã€EXPOSEã€LABELã€USERã€WORKDIRã€VOLUMEã€STOPSIGNALã€ONBUILDã€‚ å¯ä»¥ä»è¿™ä¸ªæŒ‡ä»¤åˆ—è¡¨é‡Œæ„Ÿè§‰åˆ°ï¼Œç¯å¢ƒå˜é‡å¯ä»¥ä½¿ç”¨çš„åœ°æ–¹å¾ˆå¤šï¼Œå¾ˆå¼ºå¤§ã€‚é€šè¿‡ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥è®©ä¸€ä»½ Dockerfile åˆ¶ä½œæ›´å¤šçš„é•œåƒï¼Œåªéœ€ä½¿ç”¨ä¸åŒçš„ç¯å¢ƒå˜é‡å³å¯ã€‚ VOLUME æ ¼å¼ä¸ºï¼š VOLUME [&quot;&lt;è·¯å¾„1&gt;&quot;, &quot;&lt;è·¯å¾„2&gt;&quot;...] VOLUME &lt;è·¯å¾„&gt; ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œå®¹å™¨è¿è¡Œæ—¶åº”è¯¥å°½é‡ä¿æŒå®¹å™¨å­˜å‚¨å±‚ä¸å‘ç”Ÿå†™æ“ä½œï¼Œå¯¹äºæ•°æ®åº“ç±»éœ€è¦ä¿å­˜åŠ¨æ€æ•°æ®çš„åº”ç”¨ï¼Œå…¶æ•°æ®åº“æ–‡ä»¶åº”è¯¥ä¿å­˜äºå·(volume)ä¸­ï¼Œåé¢çš„ç« èŠ‚æˆ‘ä»¬ä¼šè¿›ä¸€æ­¥ä»‹ç» Docker å·çš„æ¦‚å¿µã€‚ä¸ºäº†é˜²æ­¢è¿è¡Œæ—¶ç”¨æˆ·å¿˜è®°å°†åŠ¨æ€æ–‡ä»¶æ‰€ä¿å­˜ç›®å½•æŒ‚è½½ä¸ºå·ï¼Œåœ¨ Dockerfile ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº‹å…ˆæŒ‡å®šæŸäº›ç›®å½•æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å¦‚æœç”¨æˆ·ä¸æŒ‡å®šæŒ‚è½½ï¼Œå…¶åº”ç”¨ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šå‘å®¹å™¨å­˜å‚¨å±‚å†™å…¥å¤§é‡æ•°æ®ã€‚ VOLUME /data è¿™é‡Œçš„ /data ç›®å½•å°±ä¼šåœ¨è¿è¡Œæ—¶è‡ªåŠ¨æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œä»»ä½•å‘ /data ä¸­å†™å…¥çš„ä¿¡æ¯éƒ½ä¸ä¼šè®°å½•è¿›å®¹å™¨å­˜å‚¨å±‚ï¼Œä»è€Œä¿è¯äº†å®¹å™¨å­˜å‚¨å±‚çš„æ— çŠ¶æ€åŒ–ã€‚å½“ç„¶ï¼Œè¿è¡Œæ—¶å¯ä»¥è¦†ç›–è¿™ä¸ªæŒ‚è½½è®¾ç½®ã€‚æ¯”å¦‚ï¼š docker run -d -v mydata:/data xxxx åœ¨è¿™è¡Œå‘½ä»¤ä¸­ï¼Œå°±ä½¿ç”¨äº† mydata è¿™ä¸ªå‘½åå·æŒ‚è½½åˆ°äº† /data è¿™ä¸ªä½ç½®ï¼Œæ›¿ä»£äº† Dockerfile ä¸­å®šä¹‰çš„åŒ¿åå·çš„æŒ‚è½½é…ç½®ã€‚ EXPOSE æ ¼å¼ä¸º EXPOSE &lt;ç«¯å£1&gt; [&lt;ç«¯å£2&gt;...]ã€‚ EXPOSE æŒ‡ä»¤æ˜¯å£°æ˜è¿è¡Œæ—¶å®¹å™¨æä¾›æœåŠ¡ç«¯å£ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå£°æ˜ï¼Œåœ¨è¿è¡Œæ—¶å¹¶ä¸ä¼šå› ä¸ºè¿™ä¸ªå£°æ˜åº”ç”¨å°±ä¼šå¼€å¯è¿™ä¸ªç«¯å£çš„æœåŠ¡ã€‚åœ¨ Dockerfile ä¸­å†™å…¥è¿™æ ·çš„å£°æ˜æœ‰ä¸¤ä¸ªå¥½å¤„ï¼Œä¸€ä¸ªæ˜¯å¸®åŠ©é•œåƒä½¿ç”¨è€…ç†è§£è¿™ä¸ªé•œåƒæœåŠ¡çš„å®ˆæŠ¤ç«¯å£ï¼Œä»¥æ–¹ä¾¿é…ç½®æ˜ å°„ï¼›å¦ä¸€ä¸ªç”¨å¤„åˆ™æ˜¯åœ¨è¿è¡Œæ—¶ä½¿ç”¨éšæœºç«¯å£æ˜ å°„æ—¶ï¼Œä¹Ÿå°±æ˜¯ docker run -P æ—¶ï¼Œä¼šè‡ªåŠ¨éšæœºæ˜ å°„ EXPOSE çš„ç«¯å£ã€‚ æ­¤å¤–ï¼Œåœ¨æ—©æœŸ Docker ç‰ˆæœ¬ä¸­è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç”¨å¤„ã€‚ä»¥å‰æ‰€æœ‰å®¹å™¨éƒ½è¿è¡Œäºé»˜è®¤æ¡¥æ¥ç½‘ç»œä¸­ï¼Œå› æ­¤æ‰€æœ‰å®¹å™¨äº’ç›¸ä¹‹é—´éƒ½å¯ä»¥ç›´æ¥è®¿é—®ï¼Œè¿™æ ·å­˜åœ¨ä¸€å®šçš„å®‰å…¨æ€§é—®é¢˜ã€‚äºæ˜¯æœ‰äº†ä¸€ä¸ª Docker å¼•æ“å‚æ•° --icc=falseï¼Œå½“æŒ‡å®šè¯¥å‚æ•°åï¼Œå®¹å™¨é—´å°†é»˜è®¤æ— æ³•äº’è®¿ï¼Œé™¤éäº’ç›¸é—´ä½¿ç”¨äº† --links å‚æ•°çš„å®¹å™¨æ‰å¯ä»¥äº’é€šï¼Œå¹¶ä¸”åªæœ‰é•œåƒä¸­ EXPOSE æ‰€å£°æ˜çš„ç«¯å£æ‰å¯ä»¥è¢«è®¿é—®ã€‚è¿™ä¸ª --icc=false çš„ç”¨æ³•ï¼Œåœ¨å¼•å…¥äº† docker network åå·²ç»åŸºæœ¬ä¸ç”¨äº†ï¼Œé€šè¿‡è‡ªå®šä¹‰ç½‘ç»œå¯ä»¥å¾ˆè½»æ¾çš„å®ç°å®¹å™¨é—´çš„äº’è”ä¸éš”ç¦»ã€‚ è¦å°† EXPOSE å’Œåœ¨è¿è¡Œæ—¶ä½¿ç”¨ -p &lt;å®¿ä¸»ç«¯å£&gt;:&lt;å®¹å™¨ç«¯å£&gt; åŒºåˆ†å¼€æ¥ã€‚-pï¼Œæ˜¯æ˜ å°„å®¿ä¸»ç«¯å£å’Œå®¹å™¨ç«¯å£ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯å°†å®¹å™¨çš„å¯¹åº”ç«¯å£æœåŠ¡å…¬å¼€ç»™å¤–ç•Œè®¿é—®ï¼Œè€Œ EXPOSE ä»…ä»…æ˜¯å£°æ˜å®¹å™¨æ‰“ç®—ä½¿ç”¨ä»€ä¹ˆç«¯å£è€Œå·²ï¼Œå¹¶ä¸ä¼šè‡ªåŠ¨åœ¨å®¿ä¸»è¿›è¡Œç«¯å£æ˜ å°„ã€‚ WORKDIR æ ¼å¼ä¸º WORKDIR &lt;å·¥ä½œç›®å½•è·¯å¾„&gt;ã€‚ ä½¿ç”¨ WORKDIR æŒ‡ä»¤å¯ä»¥æ¥æŒ‡å®šå·¥ä½œç›®å½•ï¼ˆæˆ–è€…ç§°ä¸ºå½“å‰ç›®å½•ï¼‰ï¼Œä»¥åå„å±‚çš„å½“å‰ç›®å½•å°±è¢«æ”¹ä¸ºæŒ‡å®šçš„ç›®å½•ï¼Œå¦‚è¯¥ç›®å½•ä¸å­˜åœ¨ï¼ŒWORKDIR ä¼šå¸®ä½ å»ºç«‹ç›®å½•ã€‚ ä¹‹å‰æåˆ°ä¸€äº›åˆå­¦è€…å¸¸çŠ¯çš„é”™è¯¯æ˜¯æŠŠ Dockerfile ç­‰åŒäº Shell è„šæœ¬æ¥ä¹¦å†™ï¼Œè¿™ç§é”™è¯¯çš„ç†è§£è¿˜å¯èƒ½ä¼šå¯¼è‡´å‡ºç°ä¸‹é¢è¿™æ ·çš„é”™è¯¯ï¼š RUN cd /app RUN echo &quot;hello&quot; &gt; world.txt å¦‚æœå°†è¿™ä¸ª Dockerfile è¿›è¡Œæ„å»ºé•œåƒè¿è¡Œåï¼Œä¼šå‘ç°æ‰¾ä¸åˆ° /app/world.txt æ–‡ä»¶ï¼Œæˆ–è€…å…¶å†…å®¹ä¸æ˜¯ helloã€‚åŸå› å…¶å®å¾ˆç®€å•ï¼Œåœ¨ Shell ä¸­ï¼Œè¿ç»­ä¸¤è¡Œæ˜¯åŒä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œç¯å¢ƒï¼Œå› æ­¤å‰ä¸€ä¸ªå‘½ä»¤ä¿®æ”¹çš„å†…å­˜çŠ¶æ€ï¼Œä¼šç›´æ¥å½±å“åä¸€ä¸ªå‘½ä»¤ï¼›è€Œåœ¨ Dockerfile ä¸­ï¼Œè¿™ä¸¤è¡Œ RUN å‘½ä»¤çš„æ‰§è¡Œç¯å¢ƒæ ¹æœ¬ä¸åŒï¼Œæ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„å®¹å™¨ã€‚è¿™å°±æ˜¯å¯¹ Dockerfile æ„å»ºåˆ†å±‚å­˜å‚¨çš„æ¦‚å¿µä¸äº†è§£æ‰€å¯¼è‡´çš„é”™è¯¯ã€‚ ä¹‹å‰è¯´è¿‡æ¯ä¸€ä¸ª RUN éƒ½æ˜¯å¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€æ‰§è¡Œå‘½ä»¤ã€ç„¶åæäº¤å­˜å‚¨å±‚æ–‡ä»¶å˜æ›´ã€‚ç¬¬ä¸€å±‚ RUN cd /app çš„æ‰§è¡Œä»…ä»…æ˜¯å½“å‰è¿›ç¨‹çš„å·¥ä½œç›®å½•å˜æ›´ï¼Œä¸€ä¸ªå†…å­˜ä¸Šçš„å˜åŒ–è€Œå·²ï¼Œå…¶ç»“æœä¸ä¼šé€ æˆä»»ä½•æ–‡ä»¶å˜æ›´ã€‚è€Œåˆ°ç¬¬äºŒå±‚çš„æ—¶å€™ï¼Œå¯åŠ¨çš„æ˜¯ä¸€ä¸ªå…¨æ–°çš„å®¹å™¨ï¼Œè·Ÿç¬¬ä¸€å±‚çš„å®¹å™¨æ›´å®Œå…¨æ²¡å…³ç³»ï¼Œè‡ªç„¶ä¸å¯èƒ½ç»§æ‰¿å‰ä¸€å±‚æ„å»ºè¿‡ç¨‹ä¸­çš„å†…å­˜å˜åŒ–ã€‚ å› æ­¤å¦‚æœéœ€è¦æ”¹å˜ä»¥åå„å±‚çš„å·¥ä½œç›®å½•çš„ä½ç½®ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨ WORKDIR æŒ‡ä»¤ã€‚ docker compose ç®€ä»‹ æ¦‚è¿° Compose é¡¹ç›®æ˜¯ Docker å®˜æ–¹çš„å¼€æºé¡¹ç›®ï¼Œè´Ÿè´£å®ç°å¯¹ Docker å®¹å™¨é›†ç¾¤çš„å¿«é€Ÿç¼–æ’ã€‚ä»åŠŸèƒ½ä¸Šçœ‹ï¼Œè·Ÿ OpenStack ä¸­çš„ Heat ååˆ†ç±»ä¼¼ã€‚ å…¶ä»£ç ç›®å‰åœ¨ https://github.com/docker/composeä¸Šå¼€æºã€‚ Compose å®šä½æ˜¯ ã€Œå®šä¹‰å’Œè¿è¡Œå¤šä¸ª Docker å®¹å™¨çš„åº”ç”¨ï¼ˆDefining and running multi-container Docker applicationsï¼‰ã€ï¼Œå…¶å‰èº«æ˜¯å¼€æºé¡¹ç›® Figã€‚ æˆ‘ä»¬çŸ¥é“ä½¿ç”¨ä¸€ä¸ª Dockerfile æ¨¡æ¿æ–‡ä»¶ï¼Œå¯ä»¥è®©ç”¨æˆ·å¾ˆæ–¹ä¾¿çš„å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨å®¹å™¨ã€‚ç„¶è€Œï¼Œåœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œç»å¸¸ä¼šç¢°åˆ°éœ€è¦å¤šä¸ªå®¹å™¨ç›¸äº’é…åˆæ¥å®ŒæˆæŸé¡¹ä»»åŠ¡çš„æƒ…å†µã€‚ä¾‹å¦‚è¦å®ç°ä¸€ä¸ª Web é¡¹ç›®ï¼Œé™¤äº† Web æœåŠ¡å®¹å™¨æœ¬èº«ï¼Œå¾€å¾€è¿˜éœ€è¦å†åŠ ä¸Šåç«¯çš„æ•°æ®åº“æœåŠ¡å®¹å™¨ï¼Œç”šè‡³è¿˜åŒ…æ‹¬è´Ÿè½½å‡è¡¡å®¹å™¨ç­‰ã€‚ Compose æ°å¥½æ»¡è¶³äº†è¿™æ ·çš„éœ€æ±‚ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ docker-compose.yml æ¨¡æ¿æ–‡ä»¶ï¼ˆYAML æ ¼å¼ï¼‰æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ä¸ºä¸€ä¸ªé¡¹ç›®ï¼ˆProjectï¼‰ã€‚Compose ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š æœåŠ¡ (Service)ï¼šä¸€ä¸ªåº”ç”¨çš„å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥åŒ…æ‹¬è‹¥å¹²è¿è¡Œç›¸åŒé•œåƒçš„å®¹å™¨å®ä¾‹ã€‚ é¡¹ç›® (Project)ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨ docker-compose.yml æ–‡ä»¶ä¸­å®šä¹‰ã€‚ Compose çš„é»˜è®¤ç®¡ç†å¯¹è±¡æ˜¯é¡¹ç›®ï¼Œé€šè¿‡å­å‘½ä»¤å¯¹é¡¹ç›®ä¸­çš„ä¸€ç»„å®¹å™¨è¿›è¡Œä¾¿æ·åœ°ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚Compose é¡¹ç›®ç”± Python ç¼–å†™ï¼Œå®ç°ä¸Šè°ƒç”¨äº† Docker æœåŠ¡æä¾›çš„ API æ¥å¯¹å®¹å™¨è¿›è¡Œç®¡ç†ã€‚å› æ­¤ï¼Œåªè¦æ‰€æ“ä½œçš„å¹³å°æ”¯æŒ Docker APIï¼Œå°±å¯ä»¥åœ¨å…¶ä¸Šåˆ©ç”¨ Compose æ¥è¿›è¡Œç¼–æ’ç®¡ç†ã€‚ å®‰è£… Docker Compose Compose æ”¯æŒ Linuxã€macOSã€Windows 10 ä¸‰å¤§å¹³å°ã€‚åœ¨ Linux ä¸Šçš„ä¹Ÿå®‰è£…ååˆ†ç®€å•ï¼Œä» å®˜æ–¹ GitHub Release å¤„ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚ curl -L https://github.com/docker/compose/releases/download/1.24.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose # ä¸Šé¢æ˜¯å®˜æ–¹æä¾›çš„ä¸‹è½½åœ°å€ å¯èƒ½ä¼šé“¾æ¥ä¸ç¨³å®šå¯¼è‡´ä¸‹è½½ä¸ä¸‹æ¥ å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªåœ°å€è¿›è¡Œå®‰è£… curl -L https://get.daocloud.io/docker/compose/releases/download/1.24.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose dockercompose chmod +x /usr/local/bin/docker-compose éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ docker-compose version # è¾“å‡ºå¦‚ä¸‹ docker-compose version 1.24.0, build 0aa59064 docker-py version: 3.7.2 CPython version: 3.6.8 OpenSSL version: OpenSSL 1.1.0j 20 Nov 2018 docker compose ä½¿ç”¨ æœ¯è¯­ é¦–å…ˆä»‹ç»å‡ ä¸ªæœ¯è¯­ã€‚ æœåŠ¡ (Service)ï¼šä¸€ä¸ªåº”ç”¨å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥è¿è¡Œå¤šä¸ªç›¸åŒé•œåƒçš„å®ä¾‹ã€‚ é¡¹ç›® (Project)ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒã€‚ å¯è§ï¼Œä¸€ä¸ªé¡¹ç›®å¯ä»¥ç”±å¤šä¸ªæœåŠ¡ï¼ˆå®¹å™¨ï¼‰å…³è”è€Œæˆï¼ŒCompose é¢å‘é¡¹ç›®è¿›è¡Œç®¡ç†ã€‚ åœºæ™¯ æœ€å¸¸è§çš„é¡¹ç›®æ˜¯ Web ç½‘ç«™ï¼Œè¯¥é¡¹ç›®åº”è¯¥åŒ…å« Web åº”ç”¨å’Œç¼“å­˜ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨ Python æ¥å»ºç«‹ä¸€ä¸ªèƒ½å¤Ÿè®°å½•é¡µé¢è®¿é—®æ¬¡æ•°çš„ Web ç½‘ç«™ã€‚ Python åº”ç”¨ æ–°å»ºæ–‡ä»¶å¤¹ï¼Œåœ¨è¯¥ç›®å½•ä¸­ç¼–å†™ app.py æ–‡ä»¶ from flask import Flask from redis import Redis app = Flask(__name__) redis = Redis(host='redis', port=6379) @app.route('/')d ef hello(): count = redis.incr('hits') return 'Hello World! è¯¥é¡µé¢å·²è¢«è®¿é—® {} æ¬¡ã€‚\\n'.format(count) if __name__ == &quot;__main__&quot;: app.run(host=&quot;0.0.0.0&quot;, debug=True) Dockerfile ç¼–å†™ Dockerfile æ–‡ä»¶ï¼Œå†…å®¹ä¸º FROM python:3.6-alpine ADD . /code WORKDIR /code RUN pip install redis flask CMD [&quot;python&quot;, &quot;app.py&quot;] Docker Compose æ¨¡æ¿ ç¼–å†™ docker-compose.yml æ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯ Compose ä½¿ç”¨çš„ä¸»æ¨¡æ¿æ–‡ä»¶ã€‚ version: '3' services: web: build: . ports: - &quot;5000:5000&quot; redis: image: &quot;redis:alpine&quot; è¿è¡Œ Compose é¡¹ç›® docker-compose up -d æ­¤æ—¶è®¿é—®æœ¬åœ° 5000 ç«¯å£ï¼Œæ¯æ¬¡åˆ·æ–°é¡µé¢ï¼Œè®¡æ•°å°±ä¼šåŠ  1ã€‚ ###ä½¿ç”¨docker compose å®‰è£…å¯åŠ¨tomcat cd /usr/local/:åˆ°usr/localç›®å½•ä¸‹ mkdir -p docker/tomcat:åˆ›å»ºæµ‹è¯•ç›®å½• vi docker-compose.yml:åˆ›å»ºdocker compose ymlæ–‡ä»¶ # ç²˜è´´å†…å®¹åˆ°ymlä¸­,éœ€è¦åŸæ ·ç²˜è´´ version: '3.1' services: tomcat: restart: always image: tomcat container_name: tomcat ports: - 8080:8080 docker-compose up:åˆ›å»ºæˆåŠŸåæ‰§è¡Œdocker-compose up [-d]æ–‡ä»¶ -då®ˆæŠ¤æ€è¿è¡Œ æ‰©å±•é˜…è¯» YAML é…ç½®æ–‡ä»¶è¯­è¨€ YAML æ˜¯ä¸“é—¨ç”¨æ¥å†™é…ç½®æ–‡ä»¶çš„è¯­è¨€ï¼Œéå¸¸ç®€æ´å’Œå¼ºå¤§ï¼Œè¿œæ¯” JSON æ ¼å¼æ–¹ä¾¿ã€‚YAML è¯­è¨€çš„è®¾è®¡ç›®æ ‡ï¼Œå°±æ˜¯æ–¹ä¾¿äººç±»è¯»å†™ã€‚å®ƒå®è´¨ä¸Šæ˜¯ä¸€ç§é€šç”¨çš„æ•°æ®ä¸²è¡ŒåŒ–æ ¼å¼ã€‚å®ƒçš„åŸºæœ¬è¯­æ³•è§„åˆ™å¦‚ä¸‹ï¼š å¤§å°å†™æ•æ„Ÿ ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³» ç¼©è¿›æ—¶ä¸å…è®¸ä½¿ç”¨ TAB é”®ï¼Œåªå…è®¸ä½¿ç”¨ç©ºæ ¼ã€‚ ç¼©è¿›çš„ç©ºæ ¼æ•°ç›®ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦ä¾§å¯¹é½å³å¯ # è¡¨ç¤ºæ³¨é‡Šï¼Œä»è¿™ä¸ªå­—ç¬¦ä¸€ç›´åˆ°è¡Œå°¾ï¼Œéƒ½ä¼šè¢«è§£æå™¨å¿½ç•¥ã€‚YAML æ”¯æŒçš„æ•°æ®ç»“æ„æœ‰ä¸‰ç§ï¼š å¯¹è±¡ï¼š é”®å€¼å¯¹çš„é›†åˆï¼Œåˆç§°ä¸ºæ˜ å°„ï¼ˆmappingï¼‰/ å“ˆå¸Œï¼ˆhashesï¼‰ / å­—å…¸ï¼ˆdictionaryï¼‰ æ•°ç»„ï¼š ä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ï¼Œåˆç§°ä¸ºåºåˆ—ï¼ˆsequenceï¼‰ / åˆ—è¡¨ï¼ˆlistï¼‰ çº¯é‡ï¼ˆscalarsï¼‰ï¼š å•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼ YAML å¯¹è±¡ å¯¹è±¡çš„ä¸€ç»„é”®å€¼å¯¹ï¼Œä½¿ç”¨å†’å·ç»“æ„è¡¨ç¤º animal: pets YAML æ•°ç»„ ä¸€ç»„è¿è¯çº¿å¼€å¤´çš„è¡Œï¼Œæ„æˆä¸€ä¸ªæ•°ç»„ - Cat - Dog - Goldfish æ•°æ®ç»“æ„çš„å­æˆå‘˜æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™å¯ä»¥åœ¨è¯¥é¡¹ä¸‹é¢ç¼©è¿›ä¸€ä¸ªç©ºæ ¼ - Array - Cat - Dog - Goldfish YAML å¤åˆç»“æ„ å¯¹è±¡å’Œæ•°ç»„å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œå½¢æˆå¤åˆç»“æ„ languages: - Ruby - Perl - Python websites: YAML: yaml.org Ruby: ruby-lang.org Python: python.org Perl: use.perl.org YAML çº¯é‡ çº¯é‡æ˜¯æœ€åŸºæœ¬çš„ã€ä¸å¯å†åˆ†çš„å€¼ã€‚ä»¥ä¸‹æ•°æ®ç±»å‹éƒ½å±äº JavaScript çš„çº¯é‡ å­—ç¬¦ä¸² å¸ƒå°”å€¼ æ•´æ•° æµ®ç‚¹æ•° Null æ—¶é—´ æ—¥æœŸ ä¿®æ”¹ IP å’Œ DNS è¯¾ç¨‹æ¼”ç¤ºä¼šé‡‡ç”¨å¤šè™šæ‹Ÿæœºæ¨¡æ‹Ÿåˆ†å¸ƒå¼åœºæ™¯ï¼Œä¸ºé˜²æ­¢ IP å†²çªï¼Œæ— æ³•è”ç½‘ç­‰é—®é¢˜ï¼Œéœ€è¦é¢„å…ˆè®¾ç½®å¥½ä¸»æœºåã€IPã€DNS é…ç½®(ä¿®æ”¹å®Œå¾—é‡å¯ç³»ç»Ÿ) ä¿®æ”¹ä¸»æœºå ä¿®æ”¹ cloud.cfg é˜²æ­¢é‡å¯åä¸»æœºåè¿˜åŸ vi /etc/cloud/cloud.cfg # è¯¥é…ç½®é»˜è®¤ä¸º falseï¼Œä¿®æ”¹ä¸º true å³å¯ preserve_hostname: true ä¿®æ”¹ä¸»æœºå # ä¿®æ”¹ä¸»æœºå hostnamectl set-hostname deployment # é…ç½® hosts cat &gt;&gt; /etc/hosts &lt;&lt; EOF 192.168.141.130 deployment EOF ä¿®æ”¹ IP ç¼–è¾‘ vi /etc/netplan/50-cloud-init.yaml é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹å†…å®¹å¦‚ä¸‹ network: ethernets: ens33: addresses: [192.168.141.130/24] gateway4: 192.168.141.2 nameservers: addresses: [192.168.141.2] version: 2 ä½¿ç”¨ netplan apply å‘½ä»¤è®©é…ç½®ç”Ÿæ•ˆ ä¿®æ”¹ DNS # å–æ¶ˆ DNS è¡Œæ³¨é‡Šï¼Œå¹¶å¢åŠ  DNS é…ç½®å¦‚ï¼š114.114.114.114ï¼Œä¿®æ”¹åé‡å¯ä¸‹è®¡ç®—æœº vi /etc/systemd/resolved.conf docker compose éƒ¨ç½²åº”ç”¨ç¨‹åº éƒ¨ç½² Tomcat version: '3.1' services: tomcat: restart: always image: tomcat container_name: tomcat ports: - 8080:8080 volumes: - ./webapps:/usr/local/tomcat/webapps environment: TZ: Asia/Shanghai éƒ¨ç½² MySQL version: '3.1' services: db: # ç›®å‰ latest ç‰ˆæœ¬ä¸º MySQL8.x image: mysql restart: always environment: MYSQL_ROOT_PASSWORD: 123456 command: --default-authentication-plugin=mysql_native_password --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci --explicit_defaults_for_timestamp=true --lower_case_table_names=1 ports: - 3306:3306 volumes: - ./data:/var/lib/mysql # MySQL çš„ Web å®¢æˆ·ç«¯ adminer: image: adminer restart: always ports: - 8081:8080 docker compose éƒ¨ç½² GitLab ä»€ä¹ˆæ˜¯ GitLab GitLab æ˜¯åˆ©ç”¨ Ruby on Rails ä¸€ä¸ªå¼€æºçš„ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿï¼Œå®ç°ä¸€ä¸ªè‡ªæ‰˜ç®¡çš„ Git é¡¹ç›®ä»“åº“ï¼Œå¯é€šè¿‡ Web ç•Œé¢è¿›è¡Œè®¿é—®å…¬å¼€çš„æˆ–è€…ç§äººé¡¹ç›®ã€‚å®ƒæ‹¥æœ‰ä¸ Github ç±»ä¼¼çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿæµè§ˆæºä»£ç ï¼Œç®¡ç†ç¼ºé™·å’Œæ³¨é‡Šã€‚å¯ä»¥ç®¡ç†å›¢é˜Ÿå¯¹ä»“åº“çš„è®¿é—®ï¼Œå®ƒéå¸¸æ˜“äºæµè§ˆæäº¤è¿‡çš„ç‰ˆæœ¬å¹¶æä¾›ä¸€ä¸ªæ–‡ä»¶å†å²åº“ã€‚å›¢é˜Ÿæˆå‘˜å¯ä»¥åˆ©ç”¨å†…ç½®çš„ç®€å•èŠå¤©ç¨‹åº (Wall) è¿›è¡Œäº¤æµã€‚å®ƒè¿˜æä¾›ä¸€ä¸ªä»£ç ç‰‡æ®µæ”¶é›†åŠŸèƒ½å¯ä»¥è½»æ¾å®ç°ä»£ç å¤ç”¨ï¼Œä¾¿äºæ—¥åæœ‰éœ€è¦çš„æ—¶å€™è¿›è¡ŒæŸ¥æ‰¾ã€‚ éƒ¨ç½² GitLab æˆ‘ä»¬ä½¿ç”¨ Docker æ¥å®‰è£…å’Œè¿è¡Œ GitLab ä¸­æ–‡ç‰ˆï¼Œdocker-compose.yml é…ç½®å¦‚ä¸‹ï¼š version: '3' services: web: image: 'twang2218/gitlab-ce-zh' restart: always hostname: '192.168.75.145' environment: TZ: 'Asia/Shanghai' GITLAB_OMNIBUS_CONFIG: | external_url 'http://192.168.75.145' gitlab_rails['gitlab_shell_ssh_port'] = 2222 unicorn['port'] = 8888 nginx['listen_port'] = 80 ports: - '80:80' - '443:443' - '2222:22' volumes: - ./config:/etc/gitlab - ./data:/var/opt/gitlab - ./logs:/var/log/gitlab é…ç½® GitLab è®¿é—®åœ°å€ï¼šhttp://ip:8080 è®¾ç½®ç®¡ç†å‘˜åˆå§‹å¯†ç ï¼Œè¿™é‡Œçš„å¯†ç æœ€å¥½æ˜¯ å­—æ¯ + æ•°å­—ç»„åˆï¼Œå¹¶ä¸”å¤§äºç­‰äº 8 ä½ é…ç½®å®Œæˆåç™»å½•ï¼Œç®¡ç†å‘˜è´¦å·æ˜¯ root æ³¨æ„ï¼š å¦‚æœæœåŠ¡å™¨é…ç½®è¾ƒä½ï¼Œå¯åŠ¨è¿è¡Œå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾… è®¾ç½® GitLab ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶å¯ä»¥åšä¸€äº›åˆå§‹åŒ–è®¾ç½®ï¼Œç‚¹å‡» ç®¡ç†åŒºåŸŸ -&gt; è®¾ç½® å…³é—­å¤´åƒåŠŸèƒ½ï¼Œç”±äº Gravatar å¤´åƒä¸ºç½‘ç»œå¤´åƒï¼Œåœ¨ç½‘ç»œæƒ…å†µä¸ç†æƒ³æ—¶å¯èƒ½å¯¼è‡´è®¿é—®æ—¶å¡é¡¿ ç”±äºæ˜¯å†…éƒ¨ä»£ç æ‰˜ç®¡æœåŠ¡å™¨ï¼Œå¯ä»¥ç›´æ¥å…³é—­æ³¨å†ŒåŠŸèƒ½ï¼Œç”±ç®¡ç†å‘˜ç»Ÿä¸€åˆ›å»ºç”¨æˆ·å³å¯ è´¦æˆ·ç®¡ç† ä½¿ç”¨æ—¶è¯·ä¸è¦ç›´æ¥é€šè¿‡ root ç”¨æˆ·æ“ä½œï¼Œéœ€è¦å…ˆåˆ›å»ºç”¨æˆ·ï¼Œç„¶åé€šè¿‡åˆ›å»ºçš„ç”¨æˆ·æ“ä½œï¼Œå¦‚æœä½ æ˜¯ç®¡ç†å‘˜è¿˜éœ€è¦ä¸ºå…¶ä»–å¼€å‘äººå‘˜åˆ†é…è´¦æˆ· åˆ›å»ºè´¦æˆ·ï¼Œç‚¹å‡» ç®¡ç†åŒºåŸŸ -&gt; æ–°å»ºç”¨æˆ· è®¾ç½®è´¦æˆ·ä¿¡æ¯ï¼ŒåŒæ—¶ä½ å¯ä»¥å°†è‡ªå·±è®¾ç½®ä¸ºç®¡ç†å‘˜ ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼Œç”±äºæˆ‘ä»¬åˆ›å»ºæ—¶å¹¶æ²¡æœ‰é…ç½®é‚®ç®±ï¼Œæ‰€ä»¥è¿˜éœ€è¦é‡æ–°ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯å¹¶æ‰‹åŠ¨è®¾ç½®å¯†ç  é€€å‡ºå¹¶ä½¿ç”¨æ–°è´¦æˆ·ç™»å½• æ³¨æ„ï¼š åˆ›å»ºå®Œè´¦æˆ·ï¼Œç¬¬ä¸€æ¬¡ç™»å½•æ—¶è¿˜ä¼šæç¤ºä½ ä¿®æ”¹ç™»å½•å¯†ç  é¡¹ç›®ç®¡ç† ç‚¹å‡» + å· -&gt; æ–°å»ºé¡¹ç›® è¾“å…¥é¡¹ç›®åç§°åŠæè¿°ä¿¡æ¯ï¼Œè®¾ç½®å¯è§ç­‰çº§ä¸ºç§æœ‰ï¼Œè¿™æ ·åˆ«äººå°±çœ‹ä¸è§ä½ çš„é¡¹ç›® æˆ‘ä»¬é€‰æ‹©é€šè¿‡å¢åŠ ä¸€ä¸ª README çš„æ–¹å¼æ¥åˆå§‹åŒ–é¡¹ç›® ç›´æ¥æäº¤ä¿®æ”¹å³å¯ ä½¿ç”¨ SSH æ–¹å¼æ‹‰å–å’Œæ¨é€ ç”Ÿæˆ SSH KEY ä½¿ç”¨ ssh-keygen å·¥å…·ç”Ÿæˆï¼Œä½ç½®åœ¨ Git å®‰è£…ç›®å½•ä¸‹ï¼Œæˆ‘çš„æ˜¯ C:\\Program Files\\Git\\usr\\binï¼Œè¾“å…¥å‘½ä»¤ï¼š ssh-keygen -t rsa -C &quot;your_email@example.com&quot; æ‰§è¡ŒæˆåŠŸåçš„æ•ˆæœï¼š Microsoft Windows [ç‰ˆæœ¬ 10.0.14393] (c) 2016 Microsoft Corporationã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚ C:\\Program Files\\Git\\usr\\bin&gt;ssh-keygen -t rsa -C &quot;topsale@vip.qq.com&quot; Generating public/private rsa key pair. Enter file in which to save the key (/c/Users/Lusifer/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /c/Users/Lusifer/.ssh/id_rsa. Your public key has been saved in /c/Users/Lusifer/.ssh/id_rsa.pub. The key fingerprint is: SHA256:cVesJKa5VnQNihQOTotXUAIyphsqjb7Z9lqOji2704E topsale@vip.qq.com The key's randomart image is: +---[RSA 2048]----+ | + ..=o=. .+. | | o o + B .+.o.o | |o . + +=o+.. | |.= . oo... | |= o So | |oE . o | | .. .. . | | o*o+ | | *B*oo | +----[SHA256]-----+ C:\\Program Files\\Git\\usr\\bin&gt; å¤åˆ¶ SSH-KEY ä¿¡æ¯åˆ° GitLab å¯†é’¥ä½ç½®åœ¨ï¼šC:\\Users\\ä½ çš„ç”¨æˆ·å\\.ssh ç›®å½•ä¸‹ï¼Œæ‰¾åˆ° id_rsa.pub å¹¶ä½¿ç”¨ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå¦‚ï¼š ç™»å½• GitLabï¼Œç‚¹å‡»â€œç”¨æˆ·å¤´åƒâ€--&gt;â€œè®¾ç½®â€--&gt;â€œSSH å¯†é’¥â€ æˆåŠŸå¢åŠ å¯†é’¥åçš„æ•ˆæœ ä½¿ç”¨ TortoiseGit å…‹éš†é¡¹ç›® æ–°å»ºä¸€ä¸ªå­˜æ”¾ä»£ç ä»“åº“çš„æœ¬åœ°æ–‡ä»¶å¤¹ åœ¨æ–‡ä»¶å¤¹ç©ºç™½å¤„æŒ‰å³é”® é€‰æ‹© Git å…‹éš†... å¤åˆ¶é¡¹ç›®åœ°å€åˆ° URL å¦‚æœå¼¹å‡ºè¿æ¥ä¿¡æ¯è¯·é€‰æ‹©æ˜¯ æˆåŠŸå…‹éš†é¡¹ç›®åˆ°æœ¬åœ° æ¨é€é¡¹ç›® åˆ›å»ºæˆ–ä¿®æ”¹æ–‡ä»¶ï¼ˆè¿™é‡Œçš„æ–‡ä»¶ä¸ºæ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬ï¼šä»£ç ã€å›¾ç‰‡ç­‰ï¼‰ æˆ‘ä»¬ä»¥åˆ›å»º .gitignore è¿‡æ»¤é…ç½®æ–‡ä»¶ä¸ºä¾‹ï¼Œè¯¥æ–‡ä»¶çš„ä¸»è¦ä½œç”¨ä¸ºè¿‡æ»¤ä¸éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼šIDE ç”Ÿæˆçš„å·¥ç¨‹æ–‡ä»¶ã€ç¼–è¯‘åçš„ class æ–‡ä»¶ç­‰ åœ¨å·¥ç¨‹ç›®å½•ä¸‹ï¼Œæ–°å»º .gitignore æ–‡ä»¶ï¼Œå¹¶å¡«å…¥å¦‚ä¸‹é…ç½® target/ !.mvn/wrapper/maven-wrapper.jar ## STS ## .apt_generated .classpath .factorypath .project .settings .springBeans ## IntelliJ IDEA ## .idea *.iws *.iml *.ipr ## JRebel ## rebel.xml ## MAC ## .DS_Store ## Other ## logs/ temp/ å³é”®å‘¼å‡ºèœå•ï¼Œé€‰æ‹© æäº¤ Master... ç‚¹å‡» å…¨éƒ¨ å¹¶å¡«å…¥ æ—¥å¿—ä¿¡æ¯ ç‚¹å‡» æäº¤å¹¶æ¨é€ æˆåŠŸåçš„æ•ˆæœå›¾ æŸ¥çœ‹ GitLab ç¡®è®¤æäº¤æˆåŠŸ docker compose éƒ¨ç½² Nexus ä»€ä¹ˆæ˜¯ Nexus Nexus æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Maven ä»“åº“ç®¡ç†å™¨ï¼Œæå¤§åœ°ç®€åŒ–äº†å†…éƒ¨ä»“åº“çš„ç»´æŠ¤å’Œå¤–éƒ¨ä»“åº“çš„è®¿é—®ã€‚2016 å¹´ 4 æœˆ 6 æ—¥ Nexus 3.0 ç‰ˆæœ¬å‘å¸ƒï¼Œç›¸è¾ƒ 2.x ç‰ˆæœ¬æœ‰äº†å¾ˆå¤§çš„æ”¹å˜ å¯¹ä½å±‚ä»£ç è¿›è¡Œäº†å¤§è§„æ¨¡é‡æ„ï¼Œæå‡æ€§èƒ½ï¼Œå¢åŠ å¯æ‰©å±•æ€§ä»¥åŠæ”¹å–„ç”¨æˆ·ä½“éªŒã€‚ å‡çº§ç•Œé¢ï¼Œæå¤§çš„ç®€åŒ–äº†ç”¨æˆ·ç•Œé¢çš„æ“ä½œå’Œç®¡ç†ã€‚ æä¾›æ–°çš„å®‰è£…åŒ…ï¼Œè®©éƒ¨ç½²æ›´åŠ ç®€å•ã€‚ å¢åŠ å¯¹ Docker, NeGet, npm, Bower çš„æ”¯æŒã€‚ æä¾›æ–°çš„ç®¡ç†æ¥å£ï¼Œä»¥åŠå¢å¼ºå¯¹è‡ªåŠ¨ä»»åŠ¡çš„ç®¡ç†ã€‚ éƒ¨ç½² Nexus æˆ‘ä»¬ä½¿ç”¨ Docker æ¥å®‰è£…å’Œè¿è¡Œ Nexusï¼Œdocker-compose.yml é…ç½®å¦‚ä¸‹ï¼š version: '3.1' services: nexus: restart: always image: sonatype/nexus3 container_name: nexus ports: - 80:8081 volumes: - data:/nexus-data volumes: data: éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ åœ°å€ï¼š http://ip:port/ ç”¨æˆ·åï¼š admin å¯†ç ï¼š admin123 æ³¨æ„ï¼š æ–°ç‰ˆæœ¬å¯†ç åœ¨ cat /var/lib/docker/volumes/nexus_data/_data/admin.password Maven ä»“åº“ä»‹ç» ä»£ç†ä»“åº“(Proxy Repository) ç¬¬ä¸‰æ–¹ä»“åº“ maven-central nuget.org-proxy ç‰ˆæœ¬ç­–ç•¥(Version Policy) Releaseï¼š æ­£å¼ç‰ˆæœ¬ Snapshotï¼š å¿«ç…§ç‰ˆæœ¬ Mixedï¼š æ··åˆæ¨¡å¼ å¸ƒå±€ç­–ç•¥(Layout Policy) Strictï¼š ä¸¥æ ¼ Permissiveï¼š å®½æ¾ å®¿ä¸»ä»“åº“(Hosted Repository) å­˜å‚¨æœ¬åœ°ä¸Šä¼ çš„ç»„ä»¶å’Œèµ„æºçš„ maven-releases maven-snapshots nuget-hosted éƒ¨ç½²ç­–ç•¥(Deployment Policy) Allow Redeployï¼š å…è®¸é‡æ–°éƒ¨ç½² Disable Redeployï¼š ç¦æ­¢é‡æ–°éƒ¨ç½² Read-Onlyï¼š åªè¯» ä»“åº“ç»„(Repository Group) é€šå¸¸åŒ…å«äº†å¤šä¸ªä»£ç†ä»“åº“å’Œå®¿ä¸»ä»“åº“ï¼Œåœ¨é¡¹ç›®ä¸­åªè¦å¼•å…¥ä»“åº“ç»„å°±å¯ä»¥ä¸‹è½½åˆ°ä»£ç†ä»“åº“å’Œå®¿ä¸»ä»“åº“ä¸­çš„åŒ… maven-public nuget-group åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Nexus é…ç½®è®¤è¯ä¿¡æ¯ åœ¨ Maven settings.xml ä¸­æ·»åŠ  Nexus è®¤è¯ä¿¡æ¯ (servers èŠ‚ç‚¹ä¸‹) &lt;server&gt; &lt;id&gt;nexus-releases&lt;/id&gt; &lt;username&gt;admin&lt;/username&gt; &lt;password&gt;admin123&lt;/password&gt; &lt;/server&gt; &lt;server&gt; &lt;id&gt;nexus-snapshots&lt;/id&gt; &lt;username&gt;admin&lt;/username&gt; &lt;password&gt;admin123&lt;/password&gt; &lt;/server&gt; Snapshots ä¸ Releases çš„åŒºåˆ« nexus-releasesï¼š ç”¨äºå‘å¸ƒ Release ç‰ˆæœ¬ nexus-snapshotsï¼š ç”¨äºå‘å¸ƒ Snapshot ç‰ˆæœ¬ï¼ˆå¿«ç…§ç‰ˆï¼‰ Release ç‰ˆæœ¬ä¸ Snapshot å®šä¹‰ Release: 1.0.0/1.0.0-RELEASE Snapshot: 1.0.0-SNAPSHOT åœ¨é¡¹ç›® pom.xml ä¸­è®¾ç½®çš„ç‰ˆæœ¬å·æ·»åŠ  SNAPSHOT æ ‡è¯†çš„éƒ½ä¼šå‘å¸ƒä¸º SNAPSHOT ç‰ˆæœ¬ï¼Œæ²¡æœ‰ SNAPSHOT æ ‡è¯†çš„éƒ½ä¼šå‘å¸ƒä¸º RELEASE ç‰ˆæœ¬ã€‚ SNAPSHOT ç‰ˆæœ¬ä¼šè‡ªåŠ¨åŠ ä¸€ä¸ªæ—¶é—´ä½œä¸ºæ ‡è¯†ï¼Œå¦‚ï¼š1.0.0-SNAPSHOT å‘å¸ƒåä¸ºå˜æˆ 1.0.0-SNAPSHOT-20180522.123456-1.jar é…ç½®è‡ªåŠ¨åŒ–éƒ¨ç½² åœ¨ pom.xml ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç  &lt;distributionManagement&gt; &lt;repository&gt; &lt;id&gt;nexus-releases&lt;/id&gt; &lt;name&gt;Nexus Release Repository&lt;/name&gt; &lt;url&gt;http://127.0.0.1:8081/repository/maven-releases/&lt;/url&gt; &lt;/repository&gt; &lt;snapshotRepository&gt; &lt;id&gt;nexus-snapshots&lt;/id&gt; &lt;name&gt;Nexus Snapshot Repository&lt;/name&gt; &lt;url&gt;http://127.0.0.1:8081/repository/maven-snapshots/&lt;/url&gt; &lt;/snapshotRepository&gt; &lt;/distributionManagement&gt; æ³¨æ„äº‹é¡¹ ID åç§°å¿…é¡»è¦ä¸ settings.xml ä¸­ Servers é…ç½®çš„ ID åç§°ä¿æŒä¸€è‡´ é¡¹ç›®ç‰ˆæœ¬å·ä¸­æœ‰ SNAPSHOT æ ‡è¯†çš„ï¼Œä¼šå‘å¸ƒåˆ° Nexus Snapshots Repositoryï¼Œ å¦åˆ™å‘å¸ƒåˆ° Nexus Release Repositoryï¼Œå¹¶æ ¹æ® ID å»åŒ¹é…æˆæƒè´¦å· éƒ¨ç½²åˆ°ä»“åº“ mvn deploy é…ç½®ä»£ç†ä»“åº“ &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;nexus&lt;/id&gt; &lt;name&gt;Nexus Repository&lt;/name&gt; &lt;url&gt;http://127.0.0.1:8081/repository/maven-public/&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;pluginRepositories&gt; &lt;pluginRepository&gt; &lt;id&gt;nexus&lt;/id&gt; &lt;name&gt;Nexus Plugin Repository&lt;/name&gt; &lt;url&gt;http://127.0.0.1:8081/repository/maven-public/&lt;/url&gt; &lt;snapshots&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/snapshots&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;/pluginRepository&gt; &lt;/pluginRepositories&gt; æ‰©å±•é˜…è¯» æ‰‹åŠ¨ä¸Šä¼ ç¬¬ä¸‰æ–¹ä¾èµ– Nexus 3.1.x å¼€å§‹æ”¯æŒé¡µé¢ä¸Šä¼ ç¬¬ä¸‰æ–¹ä¾èµ–åŠŸèƒ½ï¼Œä»¥ä¸‹ä¸ºæ‰‹åŠ¨ä¸Šä¼ å‘½ä»¤ # å¦‚ç¬¬ä¸‰æ–¹JARåŒ…ï¼šaliyun-sdk-oss-2.2.3.jar mvn deploy:deploy-file -DgroupId=com.aliyun.oss -DartifactId=aliyun-sdk-oss -Dversion=2.2.3 -Dpackaging=jar -Dfile=D:\\aliyun-sdk-oss-2.2.3.jar -Durl=http://127.0.0.1:8081/repository/maven-3rd/ -DrepositoryId=nexus-releases æ³¨æ„äº‹é¡¹ å»ºè®®åœ¨ä¸Šä¼ ç¬¬ä¸‰æ–¹ JAR åŒ…æ—¶ï¼Œåˆ›å»ºå•ç‹¬çš„ç¬¬ä¸‰æ–¹ JAR åŒ…ç®¡ç†ä»“åº“ï¼Œä¾¿äºç®¡ç†æœ‰ç»´æŠ¤ã€‚ï¼ˆmaven-3rdï¼‰ -DrepositoryId=nexus-releases å¯¹åº”çš„æ˜¯ settings.xml ä¸­ Servers é…ç½®çš„ ID åç§°ã€‚ï¼ˆæˆæƒï¼‰ docker compose éƒ¨ç½² Harbor ä»€ä¹ˆæ˜¯ Harbor Harbor æ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨å’Œåˆ†å‘ Docker é•œåƒçš„ä¼ä¸šçº§ Registry æœåŠ¡å™¨ï¼Œé€šè¿‡æ·»åŠ ä¸€äº›ä¼ä¸šå¿…éœ€çš„åŠŸèƒ½ç‰¹æ€§ï¼Œä¾‹å¦‚å®‰å…¨ã€æ ‡è¯†å’Œç®¡ç†ç­‰ï¼Œæ‰©å±•äº†å¼€æº Docker Distributionã€‚ä½œä¸ºä¸€ä¸ªä¼ä¸šçº§ç§æœ‰ Registry æœåŠ¡å™¨ï¼ŒHarbor æä¾›äº†æ›´å¥½çš„æ€§èƒ½å’Œå®‰å…¨ã€‚æå‡ç”¨æˆ·ä½¿ç”¨ Registry æ„å»ºå’Œè¿è¡Œç¯å¢ƒä¼ è¾“é•œåƒçš„æ•ˆç‡ã€‚Harbor æ”¯æŒå®‰è£…åœ¨å¤šä¸ª Registry èŠ‚ç‚¹çš„é•œåƒèµ„æºå¤åˆ¶ï¼Œé•œåƒå…¨éƒ¨ä¿å­˜åœ¨ç§æœ‰ Registry ä¸­ï¼Œ ç¡®ä¿æ•°æ®å’ŒçŸ¥è¯†äº§æƒåœ¨å…¬å¸å†…éƒ¨ç½‘ç»œä¸­ç®¡æ§ã€‚å¦å¤–ï¼ŒHarbor ä¹Ÿæä¾›äº†é«˜çº§çš„å®‰å…¨ç‰¹æ€§ï¼Œè¯¸å¦‚ç”¨æˆ·ç®¡ç†ï¼Œè®¿é—®æ§åˆ¶å’Œæ´»åŠ¨å®¡è®¡ç­‰ã€‚ Harbor ç‰¹æ€§ åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ ï¼š ç”¨æˆ·ä¸ Docker é•œåƒä»“åº“é€šè¿‡ â€œé¡¹ç›®â€ è¿›è¡Œç»„ç»‡ç®¡ç†ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥å¯¹å¤šä¸ªé•œåƒä»“åº“åœ¨åŒä¸€å‘½åç©ºé—´ï¼ˆprojectï¼‰é‡Œæœ‰ä¸åŒçš„æƒé™ã€‚ é•œåƒå¤åˆ¶ ï¼š é•œåƒå¯ä»¥åœ¨å¤šä¸ª Registry å®ä¾‹ä¸­å¤åˆ¶ï¼ˆåŒæ­¥ï¼‰ã€‚å°¤å…¶é€‚åˆäºè´Ÿè½½å‡è¡¡ï¼Œé«˜å¯ç”¨ï¼Œæ··åˆäº‘å’Œå¤šäº‘çš„åœºæ™¯ã€‚ å›¾å½¢åŒ–ç”¨æˆ·ç•Œé¢ ï¼š ç”¨æˆ·å¯ä»¥é€šè¿‡æµè§ˆå™¨æ¥æµè§ˆï¼Œæ£€ç´¢å½“å‰ Docker é•œåƒä»“åº“ï¼Œç®¡ç†é¡¹ç›®å’Œå‘½åç©ºé—´ã€‚ AD/LDAP æ”¯æŒ ï¼š Harbor å¯ä»¥é›†æˆä¼ä¸šå†…éƒ¨å·²æœ‰çš„ AD/LDAPï¼Œç”¨äºé‰´æƒè®¤è¯ç®¡ç†ã€‚ å®¡è®¡ç®¡ç† ï¼š æ‰€æœ‰é’ˆå¯¹é•œåƒä»“åº“çš„æ“ä½œéƒ½å¯ä»¥è¢«è®°å½•è¿½æº¯ï¼Œç”¨äºå®¡è®¡ç®¡ç†ã€‚ å›½é™…åŒ– ï¼š å·²æ‹¥æœ‰è‹±æ–‡ã€ä¸­æ–‡ã€å¾·æ–‡ã€æ—¥æ–‡å’Œä¿„æ–‡çš„æœ¬åœ°åŒ–ç‰ˆæœ¬ã€‚æ›´å¤šçš„è¯­è¨€å°†ä¼šæ·»åŠ è¿›æ¥ã€‚ RESTful API ï¼š RESTful API æä¾›ç»™ç®¡ç†å‘˜å¯¹äº Harbor æ›´å¤šçš„æ“æ§ï¼Œä½¿å¾—ä¸å…¶å®ƒç®¡ç†è½¯ä»¶é›†æˆå˜å¾—æ›´å®¹æ˜“ã€‚ éƒ¨ç½²ç®€å• ï¼š æä¾›åœ¨çº¿å’Œç¦»çº¿ä¸¤ç§å®‰è£…å·¥å…·ï¼Œ ä¹Ÿå¯ä»¥å®‰è£…åˆ° vSphere å¹³å° (OVA æ–¹å¼) è™šæ‹Ÿè®¾å¤‡ã€‚ Harbor ç»„ä»¶ Proxyï¼š Harbor çš„ registry, UI, token ç­‰æœåŠ¡ï¼Œé€šè¿‡ä¸€ä¸ªå‰ç½®çš„åå‘ä»£ç†ç»Ÿä¸€æ¥æ”¶æµè§ˆå™¨ã€Docker å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘ç»™åç«¯ä¸åŒçš„æœåŠ¡ã€‚ Registryï¼š è´Ÿè´£å‚¨å­˜ Docker é•œåƒï¼Œå¹¶å¤„ç† docker push/pull å‘½ä»¤ã€‚ç”±äºæˆ‘ä»¬è¦å¯¹ç”¨æˆ·è¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œå³ä¸åŒç”¨æˆ·å¯¹ Docker image æœ‰ä¸åŒçš„è¯»å†™æƒé™ï¼ŒRegistry ä¼šæŒ‡å‘ä¸€ä¸ª token æœåŠ¡ï¼Œå¼ºåˆ¶ç”¨æˆ·çš„æ¯æ¬¡ docker pull/push è¯·æ±‚éƒ½è¦æºå¸¦ä¸€ä¸ªåˆæ³•çš„ token, Registry ä¼šé€šè¿‡å…¬é’¥å¯¹ token è¿›è¡Œè§£å¯†éªŒè¯ã€‚ Core servicesï¼š è¿™æ˜¯ Harbor çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸»è¦æä¾›ä»¥ä¸‹æœåŠ¡ï¼š UIï¼š æä¾›å›¾å½¢åŒ–ç•Œé¢ï¼Œå¸®åŠ©ç”¨æˆ·ç®¡ç† registry ä¸Šçš„é•œåƒï¼ˆimageï¼‰, å¹¶å¯¹ç”¨æˆ·è¿›è¡Œæˆæƒã€‚ WebHookï¼š ä¸ºäº†åŠæ—¶è·å– registry ä¸Š image çŠ¶æ€å˜åŒ–çš„æƒ…å†µï¼Œ åœ¨ Registry ä¸Šé…ç½® webhookï¼ŒæŠŠçŠ¶æ€å˜åŒ–ä¼ é€’ç»™ UI æ¨¡å—ã€‚ Tokenï¼š è´Ÿè´£æ ¹æ®ç”¨æˆ·æƒé™ç»™æ¯ä¸ª docker push/pull å‘½ä»¤ç­¾å‘ token. Docker å®¢æˆ·ç«¯å‘ - Registry æœåŠ¡å‘èµ·çš„è¯·æ±‚ï¼Œå¦‚æœä¸åŒ…å« tokenï¼Œä¼šè¢«é‡å®šå‘åˆ°è¿™é‡Œï¼Œè·å¾— token åå†é‡æ–°å‘ Registry è¿›è¡Œè¯·æ±‚ã€‚ Databaseï¼š ä¸º core services æä¾›æ•°æ®åº“æœåŠ¡ï¼Œè´Ÿè´£å‚¨å­˜ç”¨æˆ·æƒé™ã€å®¡è®¡æ—¥å¿—ã€Docker image åˆ†ç»„ä¿¡æ¯ç­‰æ•°æ®ã€‚ Job Servicesï¼š æä¾›é•œåƒè¿œç¨‹å¤åˆ¶åŠŸèƒ½ï¼Œå¯ä»¥æŠŠæœ¬åœ°é•œåƒåŒæ­¥åˆ°å…¶ä»– Harbor å®ä¾‹ä¸­ã€‚ Log Collectorï¼š ä¸ºäº†å¸®åŠ©ç›‘æ§ Harbor è¿è¡Œï¼Œè´Ÿè´£æ”¶é›†å…¶ä»–ç»„ä»¶çš„ logï¼Œä¾›æ—¥åè¿›è¡Œåˆ†æã€‚ å®‰è£… Harbor å®˜æ–¹ GitHub ä¸Šä¸‹è½½æœ€æ–°ç¦»çº¿å®‰è£…ç‰ˆï¼ˆæˆ‘å·²ç»ä¸‹è½½å¹¶æ”¾ç½®åœ¨ç¾¤åˆ†äº«çš„ Linux ç›®å½•ä¸‹ï¼‰å¹¶ä¸Šä¼ è‡³æœåŠ¡å™¨ è§£å‹å®‰è£…åŒ… tar -zxvf harbor-offline-installer-v1.8.0.tgz # è¾“å‡ºå¦‚ä¸‹ harbor/harbor.v1.8.0.tar.gz harbor/prepare harbor/LICENSE harbor/install.sh harbor/harbor.yml ä¿®æ”¹é…ç½®æ–‡ä»¶ vi harbor.yml # ä¿®æ”¹ä¸ºåŸŸåæˆ–ä½ æœåŠ¡å™¨ IP hostname: 192.168.141.150 æ‰§è¡Œå®‰è£…è„šæœ¬ ./install.sh # è¾“å‡ºå¦‚ä¸‹ [Step 0]: checking installation environment ... Note: docker version: 18.09.6 Note: docker-compose version: 1.24.0 [Step 1]: loading Harbor images ... 23d9f72a5270: Loading layer [==================================================&gt;] 33.25MB/33.25MB 1d4a1da12c02: Loading layer [==================================================&gt;] 50.51MB/50.51MB 8eb1a006f3b0: Loading layer [==================================================&gt;] 3.584kB/3.584kB 41b6f75847f4: Loading layer [==================================================&gt;] 3.072kB/3.072kB ec9bd6e4d4e8: Loading layer [==================================================&gt;] 2.56kB/2.56kB 6d852bb664c2: Loading layer [==================================================&gt;] 3.072kB/3.072kB 0e4ed2b5a5b8: Loading layer [==================================================&gt;] 3.584kB/3.584kB 8dfb2b644f30: Loading layer [==================================================&gt;] 12.29kB/12.29kB Loaded image: goharbor/harbor-log:v1.8.0 d8c53538042b: Loading layer [==================================================&gt;] 63.34MB/63.34MB 1b5fb7ee22e0: Loading layer [==================================================&gt;] 47.96MB/47.96MB a8bdca5e9d71: Loading layer [==================================================&gt;] 6.656kB/6.656kB f7cec940b52c: Loading layer [==================================================&gt;] 2.048kB/2.048kB 301a4a2af7db: Loading layer [==================================================&gt;] 7.68kB/7.68kB e588e1e3a775: Loading layer [==================================================&gt;] 2.56kB/2.56kB 539f28a5d0ea: Loading layer [==================================================&gt;] 2.56kB/2.56kB 8b4a72241226: Loading layer [==================================================&gt;] 2.56kB/2.56kB Loaded image: goharbor/harbor-db:v1.8.0 c88db349fb2f: Loading layer [==================================================&gt;] 8.972MB/8.972MB 1f2d4d72bba2: Loading layer [==================================================&gt;] 35.77MB/35.77MB dddbcf598df5: Loading layer [==================================================&gt;] 2.048kB/2.048kB 0ced476c2d9c: Loading layer [==================================================&gt;] 3.072kB/3.072kB af24eb0bf40b: Loading layer [==================================================&gt;] 35.77MB/35.77MB Loaded image: goharbor/chartmuseum-photon:v0.8.1-v1.8.0 b185d348bd7d: Loading layer [==================================================&gt;] 2.56kB/2.56kB f032ded7f92e: Loading layer [==================================================&gt;] 1.536kB/1.536kB c6c822edbc47: Loading layer [==================================================&gt;] 66.9MB/66.9MB 73ef3c4363bf: Loading layer [==================================================&gt;] 39.75MB/39.75MB 0c490e002448: Loading layer [==================================================&gt;] 144.4kB/144.4kB 31afe2abafb4: Loading layer [==================================================&gt;] 3.004MB/3.004MB Loaded image: goharbor/prepare:v1.8.0 257ebcc1c9c4: Loading layer [==================================================&gt;] 8.967MB/8.967MB 7579d3c94fca: Loading layer [==================================================&gt;] 38.68MB/38.68MB 323611f7dd17: Loading layer [==================================================&gt;] 38.68MB/38.68MB Loaded image: goharbor/harbor-jobservice:v1.8.0 587a5757a7f6: Loading layer [==================================================&gt;] 3.548MB/3.548MB Loaded image: goharbor/nginx-photon:v1.8.0 a61ab2060e6e: Loading layer [==================================================&gt;] 8.967MB/8.967MB 25359ae00f57: Loading layer [==================================================&gt;] 5.143MB/5.143MB 610a1668f8bf: Loading layer [==================================================&gt;] 15.13MB/15.13MB db2252abd9e0: Loading layer [==================================================&gt;] 26.47MB/26.47MB 4f406312560b: Loading layer [==================================================&gt;] 22.02kB/22.02kB 1cee0947e5a7: Loading layer [==================================================&gt;] 3.072kB/3.072kB 48db2b9b0752: Loading layer [==================================================&gt;] 46.74MB/46.74MB Loaded image: goharbor/notary-server-photon:v0.6.1-v1.8.0 aaf447150765: Loading layer [==================================================&gt;] 113MB/113MB 6835441e1a1d: Loading layer [==================================================&gt;] 10.94MB/10.94MB 9f4739e3a532: Loading layer [==================================================&gt;] 2.048kB/2.048kB 928f489135f0: Loading layer [==================================================&gt;] 48.13kB/48.13kB 1495a1a09ada: Loading layer [==================================================&gt;] 3.072kB/3.072kB 1a5f5b141717: Loading layer [==================================================&gt;] 10.99MB/10.99MB Loaded image: goharbor/clair-photon:v2.0.8-v1.8.0 66006ea937c6: Loading layer [==================================================&gt;] 337.8MB/337.8MB d272ba122880: Loading layer [==================================================&gt;] 106.5kB/106.5kB Loaded image: goharbor/harbor-migrator:v1.8.0 05bc5efb1724: Loading layer [==================================================&gt;] 8.967MB/8.967MB af3a6f89469a: Loading layer [==================================================&gt;] 46.85MB/46.85MB 452d238b3e48: Loading layer [==================================================&gt;] 5.632kB/5.632kB 36e1cb2d6ffa: Loading layer [==================================================&gt;] 27.14kB/27.14kB 5385ffb8451e: Loading layer [==================================================&gt;] 46.85MB/46.85MB Loaded image: goharbor/harbor-core:v1.8.0 268091c30a67: Loading layer [==================================================&gt;] 71.66MB/71.66MB 4433bcd802e7: Loading layer [==================================================&gt;] 3.072kB/3.072kB 420b26399278: Loading layer [==================================================&gt;] 59.9kB/59.9kB 8864c4b9ac3d: Loading layer [==================================================&gt;] 61.95kB/61.95kB Loaded image: goharbor/redis-photon:v1.8.0 63645c97bf5d: Loading layer [==================================================&gt;] 8.968MB/8.968MB ccb295818ad9: Loading layer [==================================================&gt;] 3.072kB/3.072kB 1ec2d1eefa8f: Loading layer [==================================================&gt;] 2.56kB/2.56kB b88acf0f9f5f: Loading layer [==================================================&gt;] 20.1MB/20.1MB 0e7375de12e6: Loading layer [==================================================&gt;] 20.1MB/20.1MB Loaded image: goharbor/registry-photon:v2.7.1-patch-2819-v1.8.0 444b0c8bfeee: Loading layer [==================================================&gt;] 3.548MB/3.548MB ed0415346760: Loading layer [==================================================&gt;] 6.568MB/6.568MB 572bd51089e0: Loading layer [==================================================&gt;] 160.8kB/160.8kB 1410c2919a92: Loading layer [==================================================&gt;] 215kB/215kB 8ecdca210598: Loading layer [==================================================&gt;] 3.584kB/3.584kB Loaded image: goharbor/harbor-portal:v1.8.0 7fb66591fb58: Loading layer [==================================================&gt;] 8.968MB/8.968MB 42ec4a6394bf: Loading layer [==================================================&gt;] 3.072kB/3.072kB be6c2180cb57: Loading layer [==================================================&gt;] 20.1MB/20.1MB d956d9e974c5: Loading layer [==================================================&gt;] 3.072kB/3.072kB e2e0b4f17ad8: Loading layer [==================================================&gt;] 7.465MB/7.465MB 7e29d670afe9: Loading layer [==================================================&gt;] 27.56MB/27.56MB Loaded image: goharbor/harbor-registryctl:v1.8.0 453732ea69d4: Loading layer [==================================================&gt;] 13.72MB/13.72MB c985f3824f33: Loading layer [==================================================&gt;] 26.47MB/26.47MB 76eaa2763221: Loading layer [==================================================&gt;] 22.02kB/22.02kB 0ef55a752948: Loading layer [==================================================&gt;] 3.072kB/3.072kB c5749b90723d: Loading layer [==================================================&gt;] 45.33MB/45.33MB Loaded image: goharbor/notary-signer-photon:v0.6.1-v1.8.0 [Step 2]: preparing environment ... prepare base dir is set to /usr/local/docker/harbor/harbor Generated configuration file: /config/log/logrotate.conf Generated configuration file: /config/nginx/nginx.conf Generated configuration file: /config/core/env Generated configuration file: /config/core/app.conf Generated configuration file: /config/registry/config.yml Generated configuration file: /config/registryctl/env Generated configuration file: /config/db/env Generated configuration file: /config/jobservice/env Generated configuration file: /config/jobservice/config.yml Generated and saved secret to file: /secret/keys/secretkey Generated certificate, key file: /secret/core/private_key.pem, cert file: /secret/registry/root.crt Generated configuration file: /compose_location/docker-compose.yml Clean up the input dir [Step 3]: starting Harbor ... Creating network &quot;harbor_harbor&quot; with the default driver Creating harbor-log ... done Creating harbor-db ... done Creating registryctl ... done Creating redis ... done Creating registry ... done Creating harbor-core ... done Creating harbor-jobservice ... done Creating harbor-portal ... done Creating nginx ... done âœ” ----Harbor has been installed and started successfully.---- Now you should be able to visit the admin portal at http://192.168.141.150. For more details, please visit https://github.com/goharbor/harbor . éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ é€šè¿‡æµè§ˆå™¨è®¿é—® http://192.168.141.150ï¼Œçœ‹åˆ°ç™»å½•é¡µé¢ è¾“å…¥è´¦å· adminï¼Œå¯†ç  Harbor12345ï¼Œç™»å½•æˆåŠŸå Harbor å¯åŠ¨å’Œåœæ­¢ Harbor çš„æ—¥å¸¸è¿ç»´ç®¡ç†æ˜¯é€šè¿‡ docker-compose æ¥å®Œæˆçš„ï¼ŒHarbor æœ¬èº«æœ‰å¤šä¸ªæœåŠ¡è¿›ç¨‹ï¼Œéƒ½æ”¾åœ¨ docker å®¹å™¨ä¹‹ä¸­è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ docker ps å‘½ä»¤æŸ¥çœ‹ã€‚ docker ps | grep goharbor # è¾“å‡ºå¦‚ä¸‹ 07b401504357 goharbor/nginx-photon:v1.8.0 &quot;nginx -g 'daemon ofâ€¦&quot; 23 minutes ago Up 23 minutes (healthy) 0.0.0.0:80-&gt;80/tcp nginx 050f39a147bc goharbor/harbor-portal:v1.8.0 &quot;nginx -g 'daemon ofâ€¦&quot; 23 minutes ago Up 23 minutes (healthy) 80/tcp harbor-portal 305077bc0a3e goharbor/harbor-jobservice:v1.8.0 &quot;/harbor/start.sh&quot; 23 minutes ago Up 23 minutes harbor-jobservice 4eb33b09b268 goharbor/harbor-core:v1.8.0 &quot;/harbor/start.sh&quot; 23 minutes ago Up 23 minutes (healthy) harbor-core e9efb7a6abf9 goharbor/registry-photon:v2.7.1-patch-2819-v1.8.0 &quot;/entrypoint.sh /etcâ€¦&quot; 24 minutes ago Up 23 minutes (healthy) 5000/tcp registry f9bc75d47752 goharbor/harbor-registryctl:v1.8.0 &quot;/harbor/start.sh&quot; 24 minutes ago Up 23 minutes (healthy) registryctl 76d33d1755f6 goharbor/redis-photon:v1.8.0 &quot;docker-entrypoint.sâ€¦&quot; 24 minutes ago Up 23 minutes 6379/tcp redis 3870b3b93f46 goharbor/harbor-db:v1.8.0 &quot;/entrypoint.sh postâ€¦&quot; 24 minutes ago Up 23 minutes (healthy) 5432/tcp harbor-db 6e848e4d8bc2 goharbor/harbor-log:v1.8.0 &quot;/bin/sh -c /usr/locâ€¦&quot; 24 minutes ago Up 24 minutes (healthy) 127.0.0.1:1514-&gt;10514/tcp harbor-log # å¯åŠ¨ docker-compose start # åœæ­¢ `docker-comose stop # é‡å¯ docker-compose restart è¯´æ˜ï¼š nginxï¼š nginx è´Ÿè´£æµé‡è½¬å‘å’Œå®‰å…¨éªŒè¯ï¼Œå¯¹å¤–æä¾›çš„æµé‡éƒ½æ˜¯ä» nginx ä¸­è½¬ï¼Œæ‰€ä»¥å¼€æ”¾ https çš„ 443 ç«¯å£ï¼Œå®ƒå°†æµé‡åˆ†å‘åˆ°åç«¯çš„ ui å’Œæ­£åœ¨ docker é•œåƒå­˜å‚¨çš„ docker registryã€‚ harbor-jobserviceï¼š harbor-jobservice æ˜¯ harbor çš„ job ç®¡ç†æ¨¡å—ï¼Œjob åœ¨ harbor é‡Œé¢ä¸»è¦æ˜¯ä¸ºäº†é•œåƒä»“åº“ä¹‹å‰åŒæ­¥ä½¿ç”¨çš„ï¼› harbor-uiï¼š harbor-ui æ˜¯ web ç®¡ç†é¡µé¢ï¼Œä¸»è¦æ˜¯å‰ç«¯çš„é¡µé¢å’Œåç«¯ CURD çš„æ¥å£ï¼› registryï¼š registry å°±æ˜¯ docker åŸç”Ÿçš„ä»“åº“ï¼Œè´Ÿè´£ä¿å­˜é•œåƒã€‚ harbor-adminserverï¼š harbor-adminserver æ˜¯ harbor ç³»ç»Ÿç®¡ç†æ¥å£ï¼Œå¯ä»¥ä¿®æ”¹ç³»ç»Ÿé…ç½®ä»¥åŠè·å–ç³»ç»Ÿä¿¡æ¯ã€‚ harbor-dbï¼š harbor-db æ˜¯ harbor çš„æ•°æ®åº“ï¼Œè¿™é‡Œä¿å­˜äº†ç³»ç»Ÿçš„ job ä»¥åŠé¡¹ç›®ã€äººå‘˜æƒé™ç®¡ç†ã€‚ç”±äºæœ¬ harbor çš„è®¤è¯ä¹Ÿæ˜¯é€šè¿‡æ•°æ®ï¼Œåœ¨ç”Ÿäº§ç¯èŠ‚å¤§å¤šå¯¹æ¥åˆ°ä¼ä¸šçš„ ldap ä¸­ï¼› harbor-logï¼š harbor-log æ˜¯ harbor çš„æ—¥å¿—æœåŠ¡ï¼Œç»Ÿä¸€ç®¡ç† harbor çš„æ—¥å¿—ã€‚é€šè¿‡ inspect å¯ä»¥çœ‹å‡ºå®¹å™¨ç»Ÿä¸€å°†æ—¥å¿—è¾“å‡ºçš„ syslogã€‚ è¿™å‡ ä¸ªå®¹å™¨é€šè¿‡ Docker link çš„å½¢å¼è¿æ¥åœ¨ä¸€èµ·ï¼Œè¿™æ ·ï¼Œåœ¨å®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡å®¹å™¨åå­—äº’ç›¸è®¿é—®ã€‚å¯¹ç»ˆç«¯ç”¨æˆ·è€Œè¨€ï¼Œåªéœ€è¦æš´éœ² proxy ï¼ˆå³ Nginxï¼‰çš„æœåŠ¡ç«¯å£ã€‚ é…ç½®å®¢æˆ·ç«¯ åœ¨ /etc/docker/daemon.json ä¸­å¢åŠ å¦‚ä¸‹å†…å®¹ï¼ˆå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨è¯·æ–°å»ºè¯¥æ–‡ä»¶ï¼‰ { &quot;registry-mirrors&quot;: [ &quot;https://registry.docker-cn.com&quot; ], &quot;insecure-registries&quot;: [ &quot;192.168.141.150&quot; ] } æ³¨æ„ï¼š è¯¥æ–‡ä»¶å¿…é¡»ç¬¦åˆ JSON è§„èŒƒï¼Œå¦åˆ™ Docker å°†ä¸èƒ½å¯åŠ¨ã€‚ é‡å¯æœåŠ¡ systemctl daemon-reload systemctl restart docker æ£€æŸ¥å®¢æˆ·ç«¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ ä½¿ç”¨ docker info å‘½ä»¤æ‰‹åŠ¨æ£€æŸ¥ï¼Œå¦‚æœä»é…ç½®ä¸­çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼Œè¯´æ˜é…ç½®æˆåŠŸ Insecure Registries: 192.168.141.150 127.0.0.0/8 Harbor ä¸Šä¼ é•œåƒ æ–°å»ºé¡¹ç›® æˆ‘ä»¬ä»¥æ¨é€ Nginx ä¸ºä¾‹ï¼Œé¦–å…ˆéœ€è¦åœ¨ Harbor ä¸Šåˆ›å»ºä¸€ä¸ª å…¬å¼€/ç§æœ‰ çš„é¡¹ç›® æ¨é€é•œåƒ # åœ¨é¡¹ç›®ä¸­æ ‡è®°é•œåƒ docker tag nginx 192.168.141.150/myshop/nginx:latest # ç™»å½• Harbor docker login 192.168.141.150 -u admin -p Harbor12345 # æ¨é€é•œåƒåˆ°é¡¹ç›® docker push 192.168.141.150/myshop/nginx:latest æŸ¥çœ‹é•œåƒ Harbor ä¸‹è½½é•œåƒ åœ¨å…¶å®ƒæœºå™¨ä¸‹è½½é•œåƒåªéœ€è¦é…ç½®å¥½å®¢æˆ·ç«¯å³å¯ docker pull 192.168.141.150/myshop/nginx:latest docker compose ç½‘ç»œè®¾ç½® æ¦‚è¿° é»˜è®¤æƒ…å†µä¸‹ï¼ŒCompose ä¼šä¸ºæˆ‘ä»¬çš„åº”ç”¨åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼ŒæœåŠ¡çš„æ¯ä¸ªå®¹å™¨éƒ½ä¼šåŠ å…¥è¯¥ç½‘ç»œä¸­ã€‚è¿™æ ·ï¼Œå®¹å™¨å°±å¯è¢«è¯¥ç½‘ç»œä¸­çš„å…¶ä»–å®¹å™¨è®¿é—®ï¼Œä¸ä»…å¦‚æ­¤ï¼Œè¯¥å®¹å™¨è¿˜èƒ½ä»¥æœåŠ¡åç§°ä½œä¸º Hostname è¢«å…¶ä»–å®¹å™¨è®¿é—®ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºçš„ç½‘ç»œåç§°åŸºäº Compose çš„å·¥ç¨‹åç§°ï¼Œè€Œé¡¹ç›®åç§°åŸºäº docker-compose.yml æ‰€åœ¨ç›®å½•çš„åç§°ã€‚å¦‚éœ€ä¿®æ”¹å·¥ç¨‹åç§°ï¼Œå¯ä½¿ç”¨ --project-name æ ‡è¯†æˆ– COMPOSE_PORJECT_NAME ç¯å¢ƒå˜é‡ã€‚ å‡å¦‚ä¸€ä¸ªåº”ç”¨ç¨‹åºåœ¨åä¸º myapp çš„ç›®å½•ä¸­ï¼Œå¹¶ä¸” docker-compose.yml å¦‚ä¸‹æ‰€ç¤ºï¼š version: '2' services: web: build: . ports: - &quot;8000:8000&quot; db: image: postgres å½“æˆ‘ä»¬è¿è¡Œ docker-compose up æ—¶ï¼Œå°†ä¼šæ‰§è¡Œä»¥ä¸‹å‡ æ­¥ï¼š åˆ›å»ºä¸€ä¸ªåä¸º myapp_default çš„ç½‘ç»œ ä½¿ç”¨ web æœåŠ¡çš„é…ç½®åˆ›å»ºå®¹å™¨ï¼Œå®ƒä»¥ web è¿™ä¸ªåç§°åŠ å…¥ç½‘ç»œ myapp_default ä½¿ç”¨ db æœåŠ¡çš„é…ç½®åˆ›å»ºå®¹å™¨ï¼Œå®ƒä»¥ db è¿™ä¸ªåç§°åŠ å…¥ç½‘ç»œ myapp_default å®¹å™¨é—´å¯ä½¿ç”¨æœåŠ¡åç§°ï¼ˆweb æˆ– dbï¼‰ä½œä¸º Hostname ç›¸äº’è®¿é—®ã€‚ä¾‹å¦‚ï¼Œweb è¿™ä¸ªæœåŠ¡å¯ä½¿ç”¨ postgres://db:5432 è®¿é—® db å®¹å™¨ã€‚ å½“æœåŠ¡çš„é…ç½®å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œå¯ä½¿ç”¨ docker-compose up å‘½ä»¤æ›´æ–°é…ç½®ã€‚æ­¤æ—¶ï¼ŒCompose ä¼šåˆ é™¤æ—§å®¹å™¨å¹¶åˆ›å»ºæ–°å®¹å™¨ã€‚æ–°å®¹å™¨ä¼šä»¥ä¸åŒçš„ IP åœ°å€åŠ å…¥ç½‘ç»œï¼Œåç§°ä¿æŒä¸å˜ã€‚ä»»ä½•æŒ‡å‘æ—§å®¹å™¨çš„è¿æ¥éƒ½ä¼šè¢«å…³é—­ï¼Œå®¹å™¨ä¼šé‡æ–°æ‰¾åˆ°æ–°å®¹å™¨å¹¶è¿æ¥ä¸Šå»ã€‚ ä½¿ç”¨ links é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡ä¹‹é—´å¯ä½¿ç”¨æœåŠ¡åç§°ç›¸äº’è®¿é—®ã€‚links å…è®¸æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåˆ«åï¼Œä»è€Œä½¿ç”¨è¯¥åˆ«åè®¿é—®å…¶ä»–æœåŠ¡ã€‚ version: '2' services: web: build: . links: - &quot;db:database&quot; db: image: postgres è‡ªå®šä¹‰ç½‘ç»œ ä¸€äº›åœºæ™¯ä¸‹ï¼Œé»˜è®¤çš„ç½‘ç»œé…ç½®æ»¡è¶³ä¸äº†æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä½¿ç”¨ networks å‘½ä»¤è‡ªå®šä¹‰ç½‘ç»œã€‚networks å‘½ä»¤å…è®¸æˆ‘ä»¬åˆ›å»ºæ›´åŠ å¤æ‚çš„ç½‘ç»œæ‹“æ‰‘å¹¶æŒ‡å®šè‡ªå®šä¹‰ç½‘ç»œé©±åŠ¨å’Œé€‰é¡¹ã€‚ä¸ä»…å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜å¯ä½¿ç”¨ networks å°†æœåŠ¡è¿æ¥åˆ°ä¸æ˜¯ç”± Compose ç®¡ç†çš„ã€å¤–éƒ¨åˆ›å»ºçš„ç½‘ç»œã€‚ version: '2' services: proxy: build: ./proxy networks: - front app: build: ./app networks: - front - back db: image: postgres networks: - back networks: front: # Use a custom driver driver: custom-driver-1 back: # Use a custom driver which takes special options driver: custom-driver-2 driver_opts: foo: &quot;1&quot; bar: &quot;2&quot; å…¶ä¸­ï¼Œproxy æœåŠ¡ä¸ db æœåŠ¡éš”ç¦»ï¼Œä¸¤è€…åˆ†åˆ«ä½¿ç”¨è‡ªå·±çš„ç½‘ç»œï¼›app æœåŠ¡å¯ä¸ä¸¤è€…é€šä¿¡ã€‚ä½¿ç”¨ networks å‘½ä»¤ï¼Œå³å¯æ–¹ä¾¿å®ç°æœåŠ¡é—´çš„ç½‘ç»œéš”ç¦»ä¸è¿æ¥ã€‚ é…ç½®é»˜è®¤ç½‘ç»œ version: '2' services: web: build: . ports: - &quot;8000:8000&quot; db: image: postgres networks: default: # Use a custom driver driver: custom-driver-1 è¿™æ ·ï¼Œå°±å¯ä¸ºè¯¥åº”ç”¨æŒ‡å®šè‡ªå®šä¹‰çš„ç½‘ç»œé©±åŠ¨ å·²å­˜åœ¨çš„ç½‘ç»œ æˆ‘ä»¬å¯ä»¥é¢„å…ˆåˆ›å»ºä¸€ä¸ªåä¸º myapp çš„ç½‘ç»œï¼Œè®© Compose åŠ å…¥è¿™ä¸ªæ–°åˆ›å»ºçš„ç½‘ç»œï¼Œä½¿æ‰€æœ‰ Compose å¯ä»¥é€šä¿¡ï¼Œæ­¤æ—¶ä½¿ç”¨ external é€‰é¡¹ã€‚ # åˆ›å»ºç½‘ç»œ docker network create &lt;Network Name&gt; # æŸ¥çœ‹å·²å­˜åœ¨çš„ç½‘ç»œ docker network list networks: default: external: name: myapp ","link":"http://blog.ludangxin.club/post/docker/"},{"title":"Linux","content":"æ–‡ä»¶ç›®å½•ä»‹ç»åŠæ–‡ä»¶é¢œè‰²åŒºåˆ« ç›®å½•ä»‹ç» ç›®å½• è¯´æ˜ bin å­˜æ”¾äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶(ls,cat,madirç­‰) boot å­˜æ”¾ç”¨äºç³»ç»Ÿå¼•å¯¼æ—¶ä½¿ç”¨çš„å„ç§æ–‡ä»¶ dev ç”¨äºå­˜æ”¾è®¾å¤‡æ–‡ä»¶ etc å­˜æ”¾ç³»ç»Ÿé…ç½®æ–‡ä»¶ home å­˜æ”¾æ‰€æœ‰ç”¨æˆ·æ–‡ä»¶çš„æ ¹ç›®å½• lib å­˜æ”¾è·Ÿæ–‡ä»¶ç³»ç»Ÿä¸­çš„ç¨‹åºè¿è¡Œæ‰€éœ€è¦çš„å…±äº«åº“åŠå†…æ ¸æ¨¡å— mnt ç³»ç»Ÿç®¡ç†å‘˜å®‰è£…ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿçš„å®‰è£…ç‚¹ opt é¢å¤–å®‰è£…çš„å¯é€‰åº”ç”¨ç¨‹åºåŒ…æ‰€æ”¾ç½®çš„ä½ç½® proc è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ,å­˜æ”¾å½“å‰å†…å­˜çš„æ˜ å°„ root è¶…çº§ç”¨æˆ·ç›®å½• sbin å­˜æ”¾äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶,åªæœ‰rootæ‰èƒ½è®¿é—® tmp ç”¨äºå­˜æ”¾å„ç§ä¸´æ—¶æ–‡ä»¶ usr ç”¨äºå­˜æ”¾ç³»ç»Ÿåº”ç”¨ç¨‹åº,æ¯”è¾ƒé‡è¦çš„ç›®å½•/usr/localæœ¬åœ°ç®¡ç†å‘˜è½¯ä»¶å®‰è£…ç›®å½• var ç”¨äºå­˜æ”¾è¿è¡Œæ—¶éœ€è¦æ”¹å˜æ•°æ®çš„æ–‡ä»¶ é¢œè‰²åŒºåˆ† é¢œè‰² æ–‡ä»¶ç±»å‹ ç™½è‰² æ™®é€šæ–‡ä»¶ è“è‰² ç›®å½• ç»¿è‰² å¯æ‰§è¡Œæ–‡ä»¶ çº¢è‰² å‹ç¼©æ–‡ä»¶ æµ…è“è‰² é“¾æ¥æ–‡ä»¶ çº¢è‰²é—ªçƒ é“¾æ¥çš„æ–‡ä»¶æœ‰é—®é¢˜ é»„è‰² è®¾å¤‡æ–‡ä»¶ ç°è‰² å…¶å®ƒæ–‡ä»¶ ç³»ç»Ÿç®¡ç†å‘½ä»¤ å‘½ä»¤ è¯´æ˜ å¤‡æ³¨ lscpu cupæŸ¥çœ‹ free -h å†…å­˜ ip a æŸ¥çœ‹IP whoami æŸ¥çœ‹ç”¨æˆ·å who å½“å‰ç™»é™†äººåˆ—è¡¨ lsb_release -a æŸ¥çœ‹æ“ä½œç³»ç»Ÿç‰ˆæœ¬ å…¶description:ä¸­ç‰ˆæœ¬ä»‹ç»ä¸­çš„LTSæ˜¯é•¿æœŸç»´æŠ¤ç‰ˆçš„æ„æ€,æœ€å¥½ç”¨LTSç‰ˆæœ¬Codename:å½“å‰ç‰ˆæœ¬ä»£å· hostname ä¸»æœºå clear æ¸…å± top æ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸­è€—è´¹èµ„æºæœ€å¤šçš„è¿›ç¨‹ stat æ˜¾ç¤ºæŒ‡å®šæ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯,æ¯”lså‘½ä»¤æ˜¾ç¤ºå†…å®¹æ›´å¤š stat test.txt : æŸ¥çœ‹test.txtçš„æ–‡ä»¶è¯¦æƒ… ps æ˜¾ç¤ºå½“ç¬é—´çš„è¿›ç¨‹çŠ¶æ€ ps -ef | grep java: æŸ¥çœ‹å…³äºjavaçš„è¿›ç¨‹ä¿¡æ¯ df -h æ˜¾ç¤ºæ–‡ä»¶ç³»ç»Ÿç£ç›˜ç©ºé—´çš„ä½¿ç”¨æƒ…å†µ ping å¿ƒè·³æ£€æµ‹ æ£€æŸ¥ç½‘ç»œæƒ…å†µ netstat æ˜¾ç¤ºç½‘ç»œçŠ¶æ€ä¿¡æ¯ kill æ€æ­»ä¸€ä¸ªè¿›ç¨‹ kill 666: æ€æ­»è¿›ç¨‹idä¸º666çš„è¿›ç¨‹ sudo ææƒ(ç”±äºå½“å‰è´¦å·æƒé™å¤ªä½ä¸å¯ä½¿ç”¨ç›¸å…³æ“ä½œæ—¶å¯ä»¥ææƒå†ä½¿ç”¨) sudo reboot : é‡å¯ shutdown -h now: å…³æœº å¿«æ·é”® å‰ªåˆ‡å­—ç¬¦ Ctrl+Kï¼šå‰ªåˆ‡å…‰æ ‡å¤„åˆ°è¡Œå°¾çš„å­—ç¬¦ï¼ˆåŒ…æ‹¬å…‰æ ‡å¤„å­—ç¬¦ï¼‰ Ctrl+Uï¼šå‰ªåˆ‡å…‰æ ‡å¤„åˆ°è¡Œé¦–çš„å­—ç¬¦ï¼ˆä¸åŒ…å«å…‰æ ‡å¤„å­—ç¬¦ï¼‰ Ctrl+Yï¼šå°†å‰ªåˆ‡çš„å­—ç¬¦è¿›è¡Œç²˜è´´ å¤åˆ¶ç²˜è´´ Ctrl+Insï¼šå¤åˆ¶ Shift+Insï¼šç²˜è´´ Ctrl+C : ç»ˆç«¯æ­£åœ¨è¿è¡Œçš„å‘½ä»¤ Ctrl+D : é€€å‡ºXshell Ctrl+R : æœç´¢å‘½ä»¤è¡Œä½¿ç”¨è¿‡çš„å†å²å‘½ä»¤è®°å½• Ctrl+L : æ¸…å± Ctrl+Z : æš‚åœ Ctrl+S : é”å± Ctrl+Q : è§£é™¤é”å± !! : æ‰§è¡Œä¸Šä¸€æ¡å‘½ä»¤ æ–‡ä»¶ç›®å½•æ“ä½œ å‘½ä»¤ è¯´æ˜ è¯­æ³• å‚æ•° å‚æ•°è¯´æ˜ å¤‡æ³¨ pwd æŸ¥çœ‹å½“å‰ç»å¯¹è·¯å¾„ ls æ˜¾ç¤ºæ–‡ä»¶å’Œç›®å½•åˆ—è¡¨ ls [OPTION]... [FILE]... ls -lS:æŒ‰ç…§ä»å¤§åˆ°å°åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶è¯¦ç»†ä¿¡æ¯ [OPTION] -l åˆ†è¡Œåˆ—å‡ºæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ [OPTION] -a åˆ—å‡ºå½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶,åŒ…å«éšè—æ–‡ä»¶ [OPTION] -S æŒ‰ä»å¤§åˆ°å°æ’åº [OPTION] -X æŒ‰æ–‡ä»¶åç¼€æ’åº l. åªæ˜¾ç¤ºéšè—æ–‡ä»¶ cd åˆ‡æ¢ç›®å½• cd [dir] - å›åˆ°ä¸Šæ¬¡åœç•™çš„ç›®å½•ä¸‹ cd /: åˆ°æ ¹ç›®å½•ä¸‹ mkdir åˆ›å»ºç›®å½• mkdir [OPTION]... [dirName] mkdir test/test.txt [OPTION] -p çˆ¶ç›®å½•ä¸å­˜åœ¨æƒ…å†µä¸‹å…ˆç”Ÿæˆçˆ¶ç›®å½• touch ç”Ÿæˆä¸€ä¸ªç©ºæ–‡ä»¶ touch [fileName] touch test.txt : ç”Ÿæˆä¸€ä¸ªtest.txtçš„ç©ºæ–‡ä»¶ echo ç”Ÿæˆä¸€ä¸ªå¸¦å†…å®¹æ–‡ä»¶ echo [content] &gt; fileName; echo [content] &gt;&gt; fileNmae &gt;;&gt;&gt; &gt;:è¦†ç›–æ–‡ä»¶å†…å®¹;&gt;&gt;:è¿½åŠ å†…å®¹åˆ°æ–‡ä»¶ä¸­ cat æ˜¾ç¤ºæ–‡æœ¬æ–‡ä»¶å†…å®¹ cat [fileName] cat test.txt: æŸ¥çœ‹test.txtæ–‡ä»¶çš„å†…å®¹ cp å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½• cp [OPTION] [source dest] cp test.txt : å¤åˆ¶test.txtæ–‡ä»¶ rm åˆ é™¤æ–‡ä»¶ rm [OPTION] [name]... rm -rf test:åˆ é™¤testæ–‡ä»¶å¤¹åŠå…¶å­æ–‡ä»¶ [OPTION] -f force:æ˜¯å¼ºåˆ¶åˆ é™¤æ–‡ä»¶æˆ–ç›®å½• [OPTION] -r recursive:é€’å½’å¤„ç† mv ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½• mv [OPTION] [source dest] mv test.txt .. : å°†test.txtæ–‡ä»¶ç§»åŠ¨åˆ°ä¸Šçº§ç›®å½• find åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æŸ¥æ‰¾æŒ‡å®šçš„æ–‡ä»¶ find [OPTION] [fileName] find . -name test.txt: åœ¨å½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾åä¸ºtest.txtçš„æ–‡ä»¶ [OPTION] -name æ–‡ä»¶å grep åœ¨æŒ‡å®šçš„æ–‡æœ¬æ–‡ä»¶ä¸­æŸ¥æ‰¾æŒ‡å®šçš„å­—ç¬¦ä¸² cat test.txt | grep hello: åœ¨test.txtæ–‡ä»¶ä¸­æŸ¥æ‰¾helloå­—ç¬¦ä¸² ln å»ºç«‹è½¯é“¾æ¥(ç±»ä¼¼äºåˆ›å»ºå¿«æ·æ–¹å¼) ln test1.txt test2.txt: åˆ›å»ºtest1.txtçš„è½¯è¿æ¥ä¸ºtest2.txt (ä¸æ˜¯å¤åˆ¶) more åˆ†é¡µæ˜¾ç¤ºæ–‡æœ¬æ–‡ä»¶å†…å®¹ more test.txt:åˆ†é¡µæŸ¥çœ‹test.txtæ–‡ä»¶å†…å®¹;å›è½¦æ¢é¡µ head æ˜¾ç¤ºæ–‡ä»¶å¼€å¤´å†…å®¹ head test.txt :æŸ¥çœ‹test.txtæ–‡ä»¶å¼€å¤´çš„å†…å®¹ tail æ˜¾ç¤ºæ–‡ä»¶ç»“å°¾å†…å®¹ tail test.txt: æŸ¥çœ‹test.txtæ–‡ä»¶ç»“å°¾å†…å®¹ -f è·Ÿè¸ªè¾“å‡º å‹ç¼©è§£å‹ç¼© tar å‘½ä»¤ è¯­æ³• å‚æ•° å‚æ•°è¯´æ˜ tar tar [-cxzjvf] å‹ç¼©æ‰“åŒ…æ–‡æ¡£çš„åç§° æ¬²æ‰“åŒ…ç›®å½• -c å»ºç«‹ä¸€ä¸ªå½’æ¡£æ–‡ä»¶ -x è§£å¼€ä¸€ä¸ªå½’æ¡£æ–‡ä»¶ -z æ˜¯å¦éœ€è¦ç”¨gzipå‹ç¼©(å¸¸ç”¨) -j æ˜¯å¦éœ€è¦ç”¨bzip2å‹ç¼©(ä¸å¸¸ç”¨) -v å‹ç¼©çš„è¿‡ç¨‹ä¸­æ˜¾ç¤ºæ–‡ä»¶ -f ä½¿ç”¨æ¡£å,åœ¨fä¹‹åè¦ç«‹å³æ¥æ¡£å -tf æŸ¥çœ‹å½’æ¡£æ–‡ä»¶é‡Œé¢çš„æ–‡ä»¶ ä¾‹å­: å‹ç¼©æ–‡ä»¶å¤¹: tar -zcvf test.tar.gz test\\ è§£å‹æ–‡ä»¶å¤¹: tar -zxvf test.tar.gz Vim ç¼–è¾‘å™¨ æ¦‚è¿° â€‹ Vimæ˜¯ä»viå‘å±•å‡ºæ¥çš„ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨.ä»£ç è¡¥å®Œ,ç¼–è¯‘åŠé”™è¯¯è·³è½¬ç­‰æ–¹ä¾¿ç¼–ç¨‹çš„åŠŸèƒ½ç‰¹åˆ«ä¸°å¯Œ,åœ¨ç¨‹åºå‘˜ä¸­è¢«å¹¿æ³›ä½¿ç”¨. ç®€å•çš„æ¥è¯´,viæ˜¯è€å¸ˆçš„å­—å¤„ç†å™¨,ä¸è¿‡åŠŸèƒ½å·²ç»å¾ˆé½å…¨äº†,ä½†æ˜¯è¿˜æ˜¯æœ‰å¯ä»¥è¿›æ­¥çš„åœ°æ–¹.vimåˆ™å¯ä»¥è¯´æ˜¯ç¨‹åºå¼€å‘è€…çš„ ä¸€é¡¹å¾ˆå¥½ç”¨çš„å·¥å…·. è¿è¡Œæ¨¡å¼ ç¼–è¾‘æ¨¡å¼: vi fieleNameè¿›å…¥æ–‡ä»¶ç¼–è¾‘æ¨¡å¼ æ’å…¥æ¨¡å¼: ç¼–è¾‘æ¨¡å¼ä¸‹,è¾“å…¥iæˆ–æŒ‰Inserté”®è¿›å…¥æ’å…¥æ¨¡å¼,æ’å…¥æ–‡æœ¬ä¿¡æ¯,ç¼–è¾‘å®Œæ¯•åæŒ‰Escé”®è¿›å…¥ç¼–è¾‘æ¨¡å¼ å‘½ä»¤æ¨¡å¼: åœ¨ç¼–è¾‘æ¨¡å¼ä¸‹,è¾“å…¥: è¿›è¡Œå‘½ä»¤æ¨¡å¼ å‘½ä»¤æ¨¡å¼ å‘½ä»¤ è¯´æ˜ :q quit:ç›´æ¥é€€å‡ºvi :wq write quit:ä¿å­˜åé€€å‡ºvi,å¹¶å¯ä»¥æ–°å»ºæ–‡ä»¶ :q! å¼ºåˆ¶é€€å‡º w file å°†å½“å‰å†…å®¹ä¿å­˜æˆæŸä¸ªæ–‡ä»¶ / æŸ¥æ‰¾å­—ç¬¦ä¸² :set number åœ¨ç¼–è¾‘æ–‡ä»¶æ˜¾ç¤ºè¡Œå· :set nonumber åœ¨ç¼–è¾‘æ–‡ä»¶ä¸æ˜¾ç¤ºè¡Œå· :set paste åŸæ ·ç²˜è´´ Linuxç”¨æˆ·å’Œç»„ sudo passwd root: ä¿®æ”¹rootå¯†ç  su: åˆ‡æ¢åˆ°rootç”¨æˆ·ä¸‹ su ludangxin: åˆ‡æ¢åˆ°ludangxinç”¨æˆ·ä¸‹ è®¾ç½®å…è®¸è¿œç¨‹ç™»é™†Root (Ubuntuæ“ä½œç³»ç»Ÿ) vi /etc/ssh/sshd_config: æ‰“å¼€é…ç½®æ–‡ä»¶ æ‰“å¼€PermitRootLogin prohibit-password ä¸”å°†prohibit-password æ”¹ä¸ºyes,ä¿å­˜é€€å‡º service ssh restart : é‡å¯sshæœåŠ¡ Linux æ–‡ä»¶æƒé™ç®¡ç† æŸ¥çœ‹æ–‡ä»¶å’Œç›®å½•çš„æƒé™ æ¦‚è¿° ls -al:ä½¿ç”¨lsä¸å¸¦å‚æ•°åªæ˜¾ç¤ºæ–‡ä»¶åç§°,é€šè¿‡ls -alå¯ä»¥æ˜¾ç¤ºæ–‡ä»¶æˆ–è€…ç›®å½•çš„æƒé™ä¿¡æ¯. ls -l æ–‡ä»¶å æ˜¾ç¤ºä¿¡æ¯åŒ…æ‹¬ : æ–‡ä»¶ç±»å‹(dç›®å½•,-æ™®é€šæ–‡ä»¶,lé“¾æ¥æ–‡ä»¶),æ–‡ä»¶æƒé™,æ–‡ä»¶çš„ç”¨æˆ·,æ–‡ä»¶çš„æ‰€å±ç»„,æ–‡ä»¶çš„å¤§å°,æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´,æ–‡ä»¶çš„åç§° rwx===read write excute -rw-r--r-- 1 ludangxin ludangxin 675 Oct26 17:20 .prifile -:æ™®é€šæ–‡ä»¶ rw-: è¯´æ˜ç”¨æˆ·ludangxinæœ‰è¯»å†™æƒé™,æ²¡æœ‰è¿è¡Œæƒé™ r--: è¡¨ç¤ºç”¨æˆ·ç»„ludangxinåªæœ‰è¯»æƒé™,æ²¡æœ‰å†™å’Œè¿è¡Œçš„æƒé™ r--:å…¶ä»–ç”¨æˆ·åªæœ‰è¯»æƒé™,æ²¡æœ‰å†™æƒé™å’Œè¿è¡Œçš„æƒé™ |-rw-r--r-- | 1 | ludangxin | ludangxin | 675 | Oct 26 17:20 | .profile | | :-: | :-: | :-: | :-: | :-: | :-: | :-: | |æ–‡æ¡£ç±»å‹åŠæƒé™ | è¿æ¥æ•° | æ–‡æ¡£æ‰€å±ç”¨æˆ· | æ–‡æ¡£æ‰€å±ç»„ | æ–‡æ¡£å¤§å° | æ–‡æ¡£æœ€åè¢«ä¿®æ”¹æ—¥æœŸ | æ–‡æ¡£åç§° | - rw- r-- r-- æ–‡æ¡£ç±»å‹ æ–‡æ¡£æ‰€æœ‰è€…æƒé™(user) æ–‡æ¡£æ‰€å±ç”¨æˆ·ç»„æƒé™(group) å…¶ä»–ç”¨æˆ·æƒé™(other) ###æ–‡æ¡£ç±»å‹ d è¡¨ç¤ºç›®å½• -è¡¨ç¤ºæ™®é€šæ–‡ä»¶ l é“¾æ¥æ–‡ä»¶ æ›´æ”¹æ“ä½œæƒé™ å‘½ä»¤ è¯´æ˜ è¯­æ³• å‚æ•° å‚æ•°è¯´æ˜ å¤‡æ³¨ chmod change modify:æ–‡ä»¶æˆæƒ chmod [OPTION] [MODE] [fileName] chmod +x test.sh:ç»™test.shæ–‡ä»¶å¢åŠ å¯æ‰§è¡Œçš„æƒé™ [OPTION] u user:ç”¨æˆ· [OPTION] g group:ç”¨æˆ·ç»„ [OPTION] o others:è¡¨ç¤ºå…¶ä»–ç”¨æˆ· [OPTION] a all:è¡¨ç¤ºæ‰€æœ‰ç”¨æˆ·æ˜¯ç³»ç»Ÿé»˜è®¤çš„ [MODE] + å¢åŠ æƒé™ [MODE] - å–æ¶ˆæƒé™ [MODE] = èµ‹äºˆç»™å®šçš„æƒé™,å–æ¶ˆæ–‡æ¡£ä»¥å‰çš„æ‰€æœ‰æƒé™ chown change owner:ä¸»è¦ä½œç”¨å°±æ˜¯æ”¹å˜æ–‡ä»¶æˆ–è€…ç›®å½•æ‰€æœ‰è€…,æ‰€æœ‰ç€åŒ…å«ç”¨æˆ·å’Œç”¨æˆ·ç»„ chown [-R] ç”¨æˆ·åç§° æ–‡ä»¶æˆ–è€…ç›®å½•chown [-R] ç”¨æˆ·åç§°:ç”¨æˆ·ç»„åç§° æ–‡ä»¶æˆ–ç›®å½• -R è¿›è¡Œé€’å½’å¼çš„æƒé™æ›´æ”¹,å°†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶,å­ç›®å½•æ›´æ–°ä¸ºæŒ‡å®šç”¨æˆ·ç»„æƒé™ æ•°å­—è®¾å®šæ³•(æƒé™) æ•°å­—è®¾å®šæ³•ä¸­æ•°å­—è¡¨ç¤ºçš„å«ä¹‰ 0 : è¡¨ç¤ºæ²¡æœ‰ä»»ä½•æƒé™ 1 : è¡¨ç¤ºæœ‰å¯æ‰§è¡Œæƒé™ = x 2 : è¡¨ç¤ºæœ‰å¯å†™æƒé™ = w 4 : è¡¨ç¤ºæœ‰å¯è¯»æƒé™ = r ä¹Ÿå¯ä»¥ç”¨æ•°å­—æ¥è¡¨ç¤ºæƒé™å¦‚ chmod 755 fileNmae r w x r - x r - x 4 2 1 4 - 1 4 - 1 user group others è‹¥è¦ rwx å±æ€§åˆ™ 4+2+1=7 è‹¥è¦rw-å±æ€§åˆ™ 4+2=6 è‹¥è¦r-xå±æ€§åˆ™ 4+1=5 ä¾‹: â€‹ è‹¥è¦ç»™test.shæ–‡ä»¶èµ‹äºˆä»¥ä¸Šæƒé™åˆ™:chmod 765 test.sh å‘½ä»¤è¡Œæ“ä½œ history:æŸ¥çœ‹å†å²å‘½ä»¤ history -c: åˆ é™¤å†…å­˜ä¸­çš„ä¾‹æ˜¯å‘½ä»¤ ![å†å²å‘½ä»¤ç¼–å·]: æ‰§è¡Œå†å²å‘½ä»¤ Linux éƒ¨ç½²åº”ç”¨ç¨‹åº å®‰è£…JDK ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•å¹¶è§£å‹ç¼© sudo mkdir /usr/local/java : åœ¨/usr/localç›®å½•ä¸‹æ–°å»ºjavaæ–‡ä»¶å¤¹ mv jdk-8u171-linux-x64.tar.gz /usr/local/java: å°†jdkæ–‡ä»¶ç§»åŠ¨åˆ°javaç›®å½•ä¸‹ cd /usr/local/java : è¿›å…¥javaç›®å½• sudo tar -zxvf jdk-8u171-linux-x64.tar.gz: è§£å‹ç¼© sudo rm jdk-8u171-linux-x64.tar.gz: åˆ é™¤å‹ç¼©åŒ… chown -R root:root /usr/local/java: å°†æ–‡ä»¶çš„æ‰€æœ‰æƒèµ‹ç»™root é…ç½®ç¯å¢ƒå˜é‡ sudo vi /etc/profile: é…ç½®ç¯å¢ƒå˜é‡ ä¿®æ”¹ç³»ç»Ÿç¯å¢ƒå˜é‡ (ç­‰å·ä¸¤ä¾§ä¸è¦åŠ å…¥ç©ºæ ¼ï¼Œä¸ç„¶ä¼šå‡ºç°â€œä¸æ˜¯æœ‰æ•ˆçš„æ ‡è¯†ç¬¦â€ï¼Œå› ä¸ºsource /etc/profile æ—¶ä¸èƒ½è¯†åˆ«å¤šä½™åˆ°ç©ºæ ¼ï¼Œä¼šç†è§£ä¸ºæ˜¯è·¯å¾„ä¸€éƒ¨åˆ†) export JAVA_HOME=/usr/local/java/jdk1.8.0_211 export JRE_HOME=/usr/local/java/jdk1.8.0_211/jre export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH export PATH=$JAVA_HOME/bin:$PATH source /etc/profile: ä½¿profileç«‹å³ç”Ÿæ•ˆ æ•°æ®æºé…ç½® centos cd /etc/yum.repos.d:åˆ°é…ç½®æ•°æ®æºçš„æ–‡ä»¶å¤¹ä¸‹ cp CentOS-Base.repo CentOS-Base.repo.backup:å…ˆå¤‡ä»½æ•°æ®æºæ–‡ä»¶ wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo:ä¸‹è½½é˜¿é‡Œæ•°æ®æºæ–‡ä»¶ æˆ–è€… curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo: ä¸‹è½½é˜¿é‡Œæ•°æ®æºæ–‡ä»¶ æ³¨æ„æ•°æ®æºç‰ˆæœ¬éœ€å’Œæ“ä½œç³»ç»Ÿç‰ˆæœ¬ä¸€è‡´,å¦‚éœ€è¦ä¸‹è½½å…¶ä»–ç‰ˆæœ¬ä¿®æ”¹7ä¸ºè‡ªå·±çš„ç‰ˆæœ¬å³å¯ wget https://mirrors.163.com/.help/CentOS7-Base-163.repo: 163çš„æ•°æ®æºæ–‡ä»¶ yum clean all: æ¸…é™¤ç¼“å­˜ yum makecache: ç”Ÿæˆç¼“å­˜ éé˜¿é‡Œäº‘ECSç”¨æˆ·ä¼šå‡ºç° Couldn't resolve host 'mirrors.cloud.aliyuncs.com' ä¿¡æ¯ï¼Œä¸å½±å“ä½¿ç”¨ã€‚ç”¨æˆ·ä¹Ÿå¯è‡ªè¡Œä¿®æ”¹ç›¸å…³é…ç½®: eg:sed -i -e '/mirrors.cloud.aliyuncs.com/d' -e '/mirrors.aliyuncs.com/d' /etc/yum.repos.d/CentOS-Base.repo ubuntu cd /etc/apt:åˆ°é…ç½®æ•°æ®æºçš„æ–‡ä»¶å¤¹ä¸‹ vi sources.list:æ‰“å¼€é…ç½®æ•°æ®æºçš„æ–‡ä»¶,ubuntu 18.04(bionic) é…ç½®å¦‚ä¸‹å°†æ–‡ä»¶å†…å®¹æ›¿æ¢ä¸º deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse apt-get update: æ›´æ–°æ•°æ®æº å¸¸ç”¨APTå‘½ä»¤ å‘½ä»¤ è¯´æ˜ apt-mark showmanual æ‰“å°æ‰‹åŠ¨å®‰è£…çš„è½¯ä»¶åŒ…åˆ—è¡¨ apt-get install &lt;Package Name&gt; å®‰è£…è½¯ä»¶åŒ… apt-get remove &lt;Package Name&gt; åˆ é™¤å®‰è£…åŒ… apt-get update æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ apt-get upgrade å‡çº§æœ‰å¯ç”¨æ›´æ–°çš„ç³»ç»Ÿ(æ…ç”¨) apt-cache search &lt;Package Name&gt; æœç´¢è½¯ä»¶åŒ… apt-cache show &lt;Package Name&gt; è·å–åŒ…ä¿¡æ¯ apt-get remove --purge &lt;Package Name&gt; åˆ é™¤åŒ…åŠé…ç½®æ–‡ä»¶ apt-cache depends &lt;Package Name&gt; äº†è§£ä½¿ç”¨ä¾èµ– apt-cache rdepends &lt;Package Name&gt; æŸ¥çœ‹è¢«é‚£äº›åŒ…ä¾èµ– apt-get build-dep &lt;Package Name&gt; å®‰è£…ç›¸å…³çš„ç¼–è¯‘ç¯å¢ƒ apt-get source &lt;Package Name&gt; ä¸‹è½½æºä»£ç  apt-get clean &amp;&amp; apt-get autoclean æ¸…ç†æ— ç”¨åŒ… apt-get check æ£€æŸ¥æ˜¯å¦æœ‰æŸåçš„ä¾èµ– ","link":"http://blog.ludangxin.club/post/linux/"},{"title":"Java8æ–°ç‰¹æ€§","content":"java8æ–°ç‰¹æ€§ä»‹ç» é€Ÿåº¦æ›´å¿« ä»£ç æ›´å°‘ å¼ºå¤§çš„stream API ä¾¿äºå¹¶è¡Œ æœ€å¤§åŒ–å‡å°‘ç©ºæŒ‡é’ˆå¼‚å¸¸ Optional Lanmbda lambdaæ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠlambdaè¡¨è¾¾å¼ç†è§£ä¸ºæ˜¯ä¸€æ®µå¯ä»¥ ä¼ é€’çš„ä»£ç ï¼ˆå°†ä»£ç åƒæ•°æ®ä¸€æ ·è¿›è¡Œä¼ é€’ï¼‰ã€‚å¯ä»¥ç»†å†™å‡ºæ›´ç®€æ´ï¼Œæ›´çµæ´»çš„ä»£ç ã€‚ Lanmbda è¯­æ³•ï¼š æ¨ªæ‰¹ï¼šèƒ½çœåˆ™çœ ä¸Šè”ï¼šå·¦å³é‡ä¸€æ‹¬å·çœ ä¸‹è”ï¼šå·¦ä¾§æ¨æ–­ç±»å‹çœ æ–¹æ³•å¼•ç”¨ï¼šè‹¥Lambda ä½“å†…çš„å†…å®¹æœ‰æ–¹æ³•å·²ç»å®ç°äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œæ–¹æ³•å¼•ç”¨â€ï¼ˆå¯ä»¥ç†è§£ä¸ºæ–¹æ³•å¼•ç”¨æ˜¯Lambdaè¡¨è¾¾å¼çš„å¦å¤–ä¸€ç§è¡¨ç°å½¢å¼ï¼‰ ä¸»è¦æœ‰ä¸‰ç§è¯­æ³•æ ¼å¼ï¼šæ³¨æ„ï¼šLambda ä½“ä¸­è°ƒç”¨çš„æ–¹æ³•å‚æ•°åˆ—è¡¨ä¸è¿”å›å€¼ç±»å‹å¿…é¡»ä¸å‡½æ•°çš„æŠ½è±¡æ–¹æ³•ä¸€è‡´ å¯¹è±¡::å®ä¾‹æ–¹æ³•å ç±»::é™æ€æ–¹æ³•å ç±»::å®ä¾‹æ–¹æ³•å æ„é€ å™¨å¼•ç”¨ï¼šå…·ä½“ä½¿ç”¨å“ªä¸ªæ„é€ å™¨ï¼Œå–å†³äºLambda å‡½æ•°æŠ½è±¡ç±»çš„å‚æ•°åˆ—è¡¨ æ ¼å¼ï¼šClassName::new æ•°ç»„å¼•ç”¨ï¼š æ ¼å¼ï¼šType[]::new Java8 å†…ç½®çš„å››å¤§æ ¸å¿ƒå‡½æ•°æ˜¯æ¥å£ Consumer : æ¶ˆè´¹å‹æ¥å£ void accept(T t); Supplier : ä¾›ç»™å‹æ¥å£ T get(); Function&lt;T,R&gt; : å‡½æ•°å‹æ¥å£ R apply(T t); Predicate : æ–­è¨€å‹æ¥å£ boolean test(T t); Stream API(java.unil.stream.*) Streamæ˜¯java8ä¸­å¤„ç†é›†åˆçš„å…³é”®æŠ½è±¡æ¦‚å¿µï¼Œå®ƒå¯ä»¥æŒ‡å®šä½ å¸Œæœ›å¯¹é›†åˆè¿›è¡Œçš„æ“ä½œï¼Œå¯ä»¥æ‰§è¡Œéå¸¸è´Ÿè´£çš„æŸ¥æ‰¾ï¼Œè¿‡æ»¤å’Œæ˜ å°„æ•°æ®ç­‰æ“ä½œã€‚ ä½¿ç”¨Stream API å¯¹é›†åˆæ•°æ®è¿›è¡Œæ“ä½œï¼Œå°±ç±»ä¼¼äºä½¿ç”¨è¿‡SQLæ‰§è¡Œçš„æ•°æ®æŸ¥è¯¢ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨Stream APIæ¥å¹¶è¡Œæ‰§è¡Œæ“ä½œã€‚ç®€è€Œè¨€ä¹‹ï¼Œ StreamAPIæä¾›äº†ä¸€ç§é«˜æ ¡ä¸”æ˜“äºä½¿ç”¨çš„å¤„ç†æ•°æ®çš„æ–¹å¼ã€‚ ä»€ä¹ˆæ˜¯æµï¼ˆStreamï¼‰ï¼Ÿ æ˜¯æ•°æ®æ¸ é“ï¼Œç”¨äºæ“ä½œæ•°æ®æºï¼ˆé›†åˆï¼Œæ•°ç»„ç­‰ï¼‰æ‰€ç”Ÿæˆçš„å…ƒç´ åºåˆ—ã€‚â€œé›†åˆè®²çš„æ˜¯æ•°æ®ï¼Œæµè®²çš„æ˜¯è®¡ç®—â€ Streamè‡ªå·±ä¸ä¼šå­˜å‚¨å…ƒç´  Streamä¸ä¼šæ”¹å˜æºå¯¹è±¡ã€‚ç›¸åï¼Œä»–ä»¬ä¼šè¿”å›ä¸€ä¸ªæŒæœ‰ç»“æœçš„æ–°Streamã€‚ Streamæ“ä½œæ—¶å»¶è¿Ÿæ‰§è¡Œçš„ã€‚è¿™æ„å‘³ç€ä»–ä»¬ç­‰åˆ°éœ€è¦ç»“æœçš„æ—¶å€™æ‰æ‰§è¡Œã€‚ Streamçš„æ“ä½œä¸‰ä¸ªæ­¥éª¤ åˆ›å»ºStreamï¼šä¸€ä¸ªæ•°æ®æºï¼ˆå¦‚ï¼šé›†åˆï¼Œæ•°ç»„ï¼‰ï¼Œè·å–ä¸€ä¸ªæµ ä¸­é—´æ“ä½œï¼šä¸€ä¸ªä¸­é—´æ“ä½œé“¾ï¼Œå¯¹æ•°æ®æºçš„æ•°æ®è¿›è¡Œå¤„ç† ç»ˆæ­¢æ“ä½œï¼ˆç»ˆç«¯æ“ä½œï¼‰ï¼šä¸€ä¸ªç»ˆæ­¢æ“ä½œï¼Œæ‰§è¡Œä¸­é—´æ“ä½œé“¾ï¼Œå¹¶äº§ç”Ÿç»“æœ Stream Api å…³äºä¸­é—´æ“ä½œçš„ ç­›é€‰ä¸åˆ‡ç‰‡ filter ï¼šæ¥å—Lambdaï¼Œä»æµä¸­æ´¾å‡ºæŸäº›å…ƒç´  limit ï¼šæˆªæ–­æµï¼Œä½¿å…¶å…ƒç´ ä¸è¶…è¿‡ç»™å®šæ•°é‡ skip(n) ï¼šè·³è¿‡å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªæ‰”æ‰äº†å‰nä¸ªå…ƒç´ çš„æµã€‚è‹¥æµä¸­å…ƒç´ ä¸è¶³nä¸ªï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºç•™ã€‚ä¸limit(n)äº’è¡¥ distinct ï¼šç­›é€‰ï¼Œé€šè¿‡æµæ‰€ç”Ÿæˆå…ƒç´ çš„hashCode() å’Œ equals()å»é™¤é‡å¤å…ƒç´  æ˜ å°„ map:æ¥æ”¶Lambdaï¼Œå°†å…ƒç´ è½¬æ¢æˆå…¶ä»–å½¢å¼æˆ–æå–ä¿¡æ¯ã€‚æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ ã€‚ flatMap:æ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå°†æµä¸­çš„æ¯ä¸ªå€¼éƒ½æ¢æˆå¦ä¸€ä¸ªæµï¼Œç„¶åæŠŠæ‰€æœ‰æµè¿æ¥æˆä¸€ä¸ªæµ æ’åº sorted():è‡ªç„¶æ’åº(Comparable) sorted(Comparator com):å®šåˆ¶æ’åº(Comparator) å…³äºç»ˆæ­¢æ“ä½œ æŸ¥æ‰¾ä¸åŒ¹é… allMatch:æ£€æŸ¥æ˜¯å¦åŒ¹é…æ‰€æœ‰å…ƒç´  anyMatch:æ£€æŸ¥æ˜¯å¦è‡³å°‘åŒ¹é…ä¸€ä¸ªå…ƒç´  noneMatch:æ£€æŸ¥æ˜¯å¦æ²¡æœ‰åŒ¹é…æ‰€æœ‰å…ƒç´  findFirst:è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´  findAny:è¿”å›å½“å‰åˆ˜å¿ å¾·ä»»æ„å…ƒç´  count:è¿”å›æµä¸­å…ƒç´ çš„æ€»ä¸ªæ•° max:è¿”å›æµä¸­çš„æœ€å¤§å€¼ min:è¿”å›æµä¸­æœ€å°å€¼ è§„çº¦ reduce(T identity,BinaryOperator)/reduce(BinaryOperator):å¯ä»¥å°†æµä¸­å…ƒç´ åå¤ç»“åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªå€¼ æ”¶é›† collect:å°†æµè½¬åŒ–ä¸ºå…¶ä»–å½¢å¼ã€‚æ¥å—ä¸€ä¸ªCollectoræ¥å£çš„å®ç°ï¼Œç”¨äºStreamä¸­å…ƒç´ åšæ±‡æ€»çš„æ–¹æ³• å¹¶è¡Œæµ å¹¶è¡Œæµå°±æ˜¯æŠŠä¸€ä¸ªå†…å®¹åˆ†æˆå¤šä¸ªæ•°æ®å—ï¼Œå¹¶ç”¨ä¸åŒçš„å¿åŸåˆ†åˆ«å¤„ç†æ¯ä¸ªæ•°æ®å—çš„æµï¼Œå…¶åº•å±‚åŸç†ç”¨çš„æ—¶fork/joinã€‚ Java8ä¸­å°†å¹¶è¡Œè¿›è¡Œäº†ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„å¯¹æ•°æ®è¿›è¡Œå¹¶è¡Œæ“ä½œã€‚StreamApiå¯ä»¥å£°æ˜æ€§çš„é€šè¿‡parallel()ä¸sequential()åœ¨å¹¶è¡Œæµä¸é¡ºåºæµä¹‹é—´è¿›è¡Œåˆ‡æ¢ Fork/Joinæ¡†æ¶ï¼ˆäº†è§£ï¼‰ å°±æ—¶åœ¨å¿…è¦çš„æƒ…å†µä¸‹ï¼Œå°†ä¸€ä¸ªå¤§ä»»åŠ¡ï¼Œè¿›è¡Œæ‹†åˆ†(fork)æˆè‹¥å¹²ä¸ªå°ä»»åŠ¡ï¼ˆæ‹†åˆ°ä¸å¯å†æ‹†æ—¶ï¼‰ï¼Œå†å°†ä¸€ä¸ªä¸ªçš„å°ä»»åŠ¡è¿ç®—çš„ç»“æœè¿›è¡Œjoinæ±‡æ€»ã€‚ æ€»ä½“å®ç°è¿‡ç¨‹ç±»ä¼¼ä¸å°†ä¸€ä¸ªå¤§ä»»åŠ¡ä»¥äºŒå‰æ ‘çš„å½¢å¼æ‹†åˆ†åˆ°ä¸å¯æ‹†åˆ†ï¼Œåœ¨æŠŠæœ€å°å•å…ƒè¿›è¡Œè¿ç®—ç±»ä¼¼äºå€’ç€çš„äºŒå‰æ ‘è¿›è¡Œæ±‡æ€» Optionalç±» Optional ç±»(java.unit.Optional)æ˜¯ä¸€ä¸ªå®¹å™¨ç±»ï¼Œä»£è¡¨ä¸€ä¸ªå€¼å­˜åœ¨æˆ–ä¸å­˜åœ¨ï¼ŒåŸæ¥ç”¨nullè¡¨ç¤ºä¸€ä¸ªå€¼ä¸å­˜åœ¨ï¼Œç°åœ¨Optionalå¯ä»¥æ›´å¥½çš„è¡¨è¾¾è¿™ä¸ªæ¦‚å¿µã€‚å¹¶ä¸”å¯ä»¥é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ å¸¸ç”¨æ–¹æ³•ï¼š Optional.of(T t):åˆ›å»ºä¸€ä¸ªOptionalå®ä¾‹ Optional.empty():åˆ›å»ºä¸€ä¸ªç©ºçš„Optionalå®ä¾‹ Optional.ofNullable(T t):è‹¥tä¸ä¸ºnull,åˆ›å»ºOptionalå®ä¾‹,å¦åˆ™åˆ›å»ºç©ºå®ä¾‹ isPresent():åˆ¤æ–­æ˜¯å¦åŒ…å«å€¼ orElse(T t): å¦‚æœè°ƒç”¨å¯¹è±¡åŒ…å«å€¼,è¿”å›è¯¥å€¼ï¼Œå¦åˆ™è¿”å›t orElseGet(Supplier s):å¦‚æœè°ƒç”¨å¯¹è±¡åŒ…å«å€¼ï¼Œè¿”å›è¯¥å€¼ï¼Œå¦åˆ™è¿”å›sè·å–çš„å€¼ map(Function f):å¦‚æœæœ‰å€¼å¯¹å…¶å¤„ç†,å¹¶è¿”å›å¤„ç†åçš„Optional,å¦åˆ™è¿”å›Optional.empty() flatMap(Function mapper):ä¸mapç±»ä¼¼ï¼Œè¦æ±‚è¿”å›å€¼å¿…é¡»æ˜¯Optionaljava8 ","link":"http://blog.ludangxin.club/post/java8-xin-te-xing/"},{"title":"SpringBoot é›†æˆ æ•°æ®æº","content":"druid ç®€ä»‹ ä»€ä¹ˆæ˜¯Druidï¼Ÿ Druidæ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æ•°æ®æŸ¥è¯¢ç³»ç»Ÿï¼Œä¸»è¦è§£å†³çš„æ˜¯å¯¹äºå¤§é‡çš„åŸºäºæ—¶åºçš„æ•°æ®è¿›è¡ŒèšåˆæŸ¥è¯¢ã€‚æ•°æ®å¯ä»¥å®æ—¶æ‘„å…¥ï¼Œè¿›å…¥åˆ°Druidåç«‹å³å¯æŸ¥ï¼ŒåŒæ—¶æ•°æ®æ˜¯å‡ ä¹æ˜¯ä¸å¯å˜ã€‚é€šå¸¸æ˜¯åŸºäºæ—¶åºçš„äº‹å®äº‹ä»¶ï¼Œäº‹å®å‘ç”Ÿåè¿›å…¥Druidï¼Œå¤–éƒ¨ç³»ç»Ÿå°±å¯ä»¥å¯¹è¯¥äº‹å®è¿›è¡ŒæŸ¥è¯¢ã€‚ Druidé‡‡ç”¨çš„æ¶æ„: shared-nothingæ¶æ„ä¸lambdaæ¶æ„ Druidè®¾è®¡ä¸‰ä¸ªåŸåˆ™: å¿«é€ŸæŸ¥è¯¢ï¼ˆFast Queryï¼‰ : éƒ¨åˆ†æ•°æ®èšåˆï¼ˆPartial Aggregateï¼‰ + å†…å­˜åï¼ˆIn-Memoryï¼‰ + ç´¢å¼•ï¼ˆIndexï¼‰ æ°´å¹³æ‹“å±•èƒ½åŠ›ï¼ˆHorizontal Scalabilityï¼‰:åˆ†å¸ƒå¼æ•°æ®ï¼ˆDistributed dataï¼‰+å¹¶è¡ŒåŒ–æŸ¥è¯¢ï¼ˆParallelizable Queryï¼‰ å®æ—¶åˆ†æï¼ˆRealtime Analyticsï¼‰ï¼šImmutable Past , Append-Only Future æ·»åŠ æ‰€éœ€ä¾èµ– &lt;!-- druid ä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.1.22&lt;/version&gt; &lt;/dependency&gt; &lt;!-- mysqlä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- lombok --&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; é…ç½® application.yml spring: datasource: name: druidDataSource type: com.alibaba.druid.pool.DruidDataSource druid: # 5.7ä¹‹å‰ç‰ˆæœ¬ä½¿ç”¨ com.mysql.jdbc.Driver driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/test?useUnicode=true&amp;zeroDateTimeBehavior=convertToNull&amp;autoReconnect=true&amp;characterEncoding=utf-8 username: root password: root filters: stat,wall,log4j,config max-active: 100 initial-size: 1 max-wait: 60000 min-idle: 1 time-between-eviction-runs-millis: 60000 min-evictable-idle-time-millis: 300000 validation-query: SELECT 1 test-while-idle: true test-on-borrow: false test-on-return: false pool-prepared-statements: true max-open-prepared-statements: 50 max-pool-prepared-statement-per-connection-size: 20 import java.sql.SQLException; import javax.servlet.Filter; import javax.servlet.Servlet; import javax.sql.DataSource; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean; import org.springframework.boot.context.properties.EnableConfigurationProperties; import org.springframework.boot.web.servlet.FilterRegistrationBean; import org.springframework.boot.web.servlet.ServletRegistrationBean; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import com.alibaba.druid.pool.DruidDataSource; import com.alibaba.druid.support.http.StatViewServlet; import com.alibaba.druid.support.http.WebStatFilter; @Configuration @EnableConfigurationProperties({DruidDataSourceProperties.class}) public class DruidConfig { @Autowired private DruidDataSourceProperties properties; @Bean @ConditionalOnMissingBean public DataSource druidDataSource() { DruidDataSource druidDataSource = new DruidDataSource(); druidDataSource.setDriverClassName(properties.getDriverClassName()); druidDataSource.setUrl(properties.getUrl()); druidDataSource.setUsername(properties.getUsername()); druidDataSource.setPassword(properties.getPassword()); druidDataSource.setInitialSize(properties.getInitialSize()); druidDataSource.setMinIdle(properties.getMinIdle()); druidDataSource.setMaxActive(properties.getMaxActive()); druidDataSource.setMaxWait(properties.getMaxWait()); druidDataSource.setTimeBetweenEvictionRunsMillis(properties.getTimeBetweenEvictionRunsMillis()); druidDataSource.setMinEvictableIdleTimeMillis(properties.getMinEvictableIdleTimeMillis()); druidDataSource.setValidationQuery(properties.getValidationQuery()); druidDataSource.setTestWhileIdle(properties.isTestWhileIdle()); druidDataSource.setTestOnBorrow(properties.isTestOnBorrow()); druidDataSource.setTestOnReturn(properties.isTestOnReturn()); druidDataSource.setPoolPreparedStatements(properties.isPoolPreparedStatements()); druidDataSource.setMaxPoolPreparedStatementPerConnectionSize(properties.getMaxPoolPreparedStatementPerConnectionSize()); try { druidDataSource.setFilters(properties.getFilters()); druidDataSource.init(); } catch (SQLException e) { e.printStackTrace(); } return druidDataSource; } /** * æ³¨å†ŒServletä¿¡æ¯ï¼Œ é…ç½®ç›‘æ§è§†å›¾ * @return */ @Bean @ConditionalOnMissingBean public ServletRegistrationBean&lt;Servlet&gt; druidServlet() { ServletRegistrationBean&lt;Servlet&gt; servletRegistrationBean = new ServletRegistrationBean&lt;Servlet&gt;(new StatViewServlet(), &quot;/druid/*&quot;); //ç™½åå•ï¼šå¦‚æœæ˜¯é™å®šæŒ‡å®šçš„å­ç½‘é‡Œçš„æ‰€æœ‰ipéƒ½å¯ä»¥è®¿é—®ï¼Œé‚£å°±æ˜¯ip/å­ç½‘æ©ç æ•°ã€‚ä¾‹å¦‚ 192.168.1.120/24 å°±ç›¸å½“äº192.168.1.* servletRegistrationBean.addInitParameter(&quot;allow&quot;,&quot;192.168.1.195&quot;); //IPé»‘åå• (å­˜åœ¨å…±åŒæ—¶ï¼Œdenyä¼˜å…ˆäºallow) : å¦‚æœæ»¡è¶³denyçš„è¯æç¤º:Sorry, you are not permitted to view this page. servletRegistrationBean.addInitParameter(&quot;deny&quot;,&quot;192.168.1.119&quot;); //ç™»å½•æŸ¥çœ‹ä¿¡æ¯çš„è´¦å·å¯†ç , ç”¨äºç™»å½•Druidç›‘æ§åå° servletRegistrationBean.addInitParameter(&quot;loginUsername&quot;, &quot;admin&quot;); servletRegistrationBean.addInitParameter(&quot;loginPassword&quot;, &quot;admin&quot;); //æ˜¯å¦èƒ½å¤Ÿé‡ç½®æ•°æ®. servletRegistrationBean.addInitParameter(&quot;resetEnable&quot;, &quot;true&quot;); return servletRegistrationBean; } /** * æ³¨å†ŒFilterä¿¡æ¯, ç›‘æ§æ‹¦æˆªå™¨ * @return */ @Bean @ConditionalOnMissingBean public FilterRegistrationBean&lt;Filter&gt; filterRegistrationBean() { FilterRegistrationBean&lt;Filter&gt; filterRegistrationBean = new FilterRegistrationBean&lt;Filter&gt;(); filterRegistrationBean.setFilter(new WebStatFilter()); filterRegistrationBean.addUrlPatterns(&quot;/*&quot;); filterRegistrationBean.addInitParameter(&quot;exclusions&quot;, &quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;); return filterRegistrationBean; } } import org.springframework.boot.context.properties.ConfigurationProperties; @ConfigurationProperties(prefix = &quot;spring.datasource.druid&quot;) @Data public class DruidDataSourceProperties { // jdbc private String driverClassName; private String url; private String username; private String password; // jdbc connection pool private int initialSize; private int minIdle; private int maxActive = 100; private long maxWait; private long timeBetweenEvictionRunsMillis; private long minEvictableIdleTimeMillis; private String validationQuery; private boolean testWhileIdle; private boolean testOnBorrow; private boolean testOnReturn; private boolean poolPreparedStatements; private int maxPoolPreparedStatementPerConnectionSize; // filter private String filters; hikaricp ç®€ä»‹ å®˜æ–¹GitHubåœ°å€ ä»€ä¹ˆæ˜¯hikaricp? HikariCPæ˜¯ç”±æ—¥æœ¬ç¨‹åºå‘˜å¼€æºçš„ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ç»„ä»¶ï¼Œä»£ç éå¸¸è½»é‡ï¼Œå¹¶ä¸”é€Ÿåº¦éå¸¸çš„å¿«ã€‚æ ¹æ®å®˜æ–¹æä¾›çš„æ•°æ®ï¼Œåœ¨i7,å¼€å¯32ä¸ªçº¿ç¨‹32ä¸ªè¿æ¥çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œéšæœºæ•°æ®åº“è¯»å†™æ“ä½œï¼ŒHikariCPçš„é€Ÿåº¦æ˜¯ç°åœ¨å¸¸ç”¨çš„C3P0æ•°æ®åº“è¿æ¥æ± çš„æ•°ç™¾å€ã€‚åœ¨SpringBoot2.0ä¸­ï¼Œå®˜æ–¹ä¹Ÿæ˜¯æ¨èä½¿ç”¨HikariCPã€‚ ä¼˜åŒ– ä¸ºä»€ä¹ˆhikaricpè¿™ä¹ˆå—? å­—èŠ‚ç ç²¾ç®€ ï¼š ä¼˜åŒ–ä»£ç ï¼Œç›´åˆ°ç¼–è¯‘åçš„å­—èŠ‚ç æœ€å°‘ï¼Œè¿™æ ·ï¼ŒCPU ç¼“å­˜å¯ä»¥åŠ è½½æ›´å¤šçš„ç¨‹åºä»£ç  ä¼˜åŒ–ä»£ç†å’Œæ‹¦æˆªå™¨ ï¼š å‡å°‘ä»£ç ï¼Œä¾‹å¦‚ HikariCP çš„ Statement proxy åªæœ‰ 100 è¡Œä»£ç ï¼Œåªæœ‰ BoneCP çš„ååˆ†ä¹‹ä¸€ è‡ªå®šä¹‰æ•°ç»„ç±»å‹ï¼ˆFastStatementListï¼‰ä»£æ›¿ ArrayList ï¼š é¿å…æ¯æ¬¡ get() è°ƒç”¨éƒ½è¦è¿›è¡Œ range checkï¼Œé¿å…è°ƒç”¨ remove() æ—¶çš„ä»å¤´åˆ°å°¾çš„æ‰«æ è‡ªå®šä¹‰é›†åˆç±»å‹ï¼ˆConcurrentBagï¼‰ï¼š æé«˜å¹¶å‘è¯»å†™çš„æ•ˆç‡ å…¶ä»–é’ˆå¯¹ BoneCP ç¼ºé™·çš„ä¼˜åŒ–ï¼š æ¯”å¦‚å¯¹äºè€—æ—¶è¶…è¿‡ä¸€ä¸ª CPU æ—¶é—´ç‰‡çš„æ–¹æ³•è°ƒç”¨çš„ç ”ç©¶ï¼ˆä½†æ²¡è¯´å…·ä½“æ€ä¹ˆä¼˜åŒ–ï¼‰ ä¸druidå¯¹æ¯” åœ¨githubä¸Šæœ‰ç½‘å‹è´´å‡ºäº†é˜¿é‡Œå·´å·´Druidä¸hikariçš„å¯¹æ¯”ï¼Œè®¤ä¸ºhikariåœ¨æ€§èƒ½ä¸Šæ˜¯å®Œå…¨ç§’æ€é˜¿é‡Œå·´å·´çš„Druidè¿æ¥æ± çš„ã€‚å¯¹æ­¤ï¼Œé˜¿é‡Œçš„å·¥ç¨‹å¸ˆä¹Ÿåšäº†ä¸€å®šçš„å›åº”ï¼Œè¯´Druidçš„æ€§èƒ½ç¨å¾®å·®ç‚¹æ˜¯é”æœºåˆ¶çš„ä¸åŒï¼Œå¹¶ä¸”Druidæä¾›äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œä¸¤è€…çš„ä¾§é‡ç‚¹ä¸ä¸€æ ·ã€‚ æ·»åŠ æ‰€éœ€ä¾èµ– å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Spring Boot 2.0æˆ–è€…ä¹‹åçš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä¸éœ€è¦å»å•ç‹¬åœ¨pom.xmlæ–‡ä»¶ä¸­å¼•å…¥HikariCPä¾èµ–ã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹spring-boot-starter-jdbc æˆ–è€… mybatis-spring-boot-starter ä¼šä¾èµ–è¿›æ¥ã€‚ &lt;!-- mysqlä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; é…ç½® application.yml spring: datasource: type: com.zaxxer.hikari.HikariDataSource driver-class-name: com.mysql.cj.jdbc.Driver url: jdbc:mysql://localhost:3306/test?useUnicode=true&amp;zeroDateTimeBehavior=convertToNull&amp;autoReconnect=true&amp;characterEncoding=utf-8 username: root password: root hikari: minimum-idle: 5 idle-timeout: 600000 maximum-pool-size: 10 auto-commit: true pool-name: MyHikariCP max-lifetime: 1800000 connection-timeout: 30000 connection-test-query: SELECT 1 å¦‚ä½•é€‰æ‹© é€‰æ‹©å“ªä¸€æ¬¾å°±è§ä»è§æ™ºäº†ï¼Œä¸è¿‡ä¸¤æ¬¾éƒ½æ˜¯å¼€æºäº§å“ï¼Œé˜¿é‡Œçš„Druidæœ‰ä¸­æ–‡çš„å¼€æºç¤¾åŒºï¼Œäº¤æµèµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼Œå¹¶ä¸”ç»è¿‡é˜¿é‡Œå¤šä¸ªç³»ç»Ÿçš„å®éªŒï¼Œæƒ³å¿…ä¹Ÿæ˜¯éå¸¸çš„ç¨³å®šï¼Œè€ŒHikariæ˜¯SpringBoot2.0é»˜è®¤çš„è¿æ¥æ± ï¼Œå…¨ä¸–ç•Œä½¿ç”¨èŒƒå›´ä¹Ÿéå¸¸å¹¿ï¼Œå¯¹äºå¤§éƒ¨åˆ†ä¸šåŠ¡æ¥è¯´ï¼Œä½¿ç”¨å“ªä¸€æ¬¾éƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œæ¯•ç«Ÿæ€§èƒ½ç“¶é¢ˆä¸€èˆ¬éƒ½ä¸åœ¨è¿æ¥æ± ã€‚å¤§å®¶å¯æ ¹æ®è‡ªå·±çš„å–œå¥½è‡ªç”±é€‰æ‹©ã€‚ ","link":"http://blog.ludangxin.club/post/springboot-ji-cheng-shu-ju-yuan/"},{"title":"SpringBoot é›†æˆ tkMybatis pageHelper","content":"é¡¹ç›®ç»“æ„å›¾ç¤º å¼•å…¥æ‰€éœ€ä¾èµ– &lt;!--æ•°æ®åº“--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--ç»“åˆtk-mybatis mybatisçš„å‡çº§æ’ä»¶--&gt; &lt;dependency&gt; &lt;groupId&gt;tk.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;2.1.5&lt;/version&gt; &lt;/dependency&gt; &lt;!--åˆ†é¡µæ’ä»¶--&gt; &lt;dependency&gt; &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt; &lt;artifactId&gt;pagehelper-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;1.2.13&lt;/version&gt; &lt;/dependency&gt; &lt;!-- lombok --&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; é…ç½® application.yml spring: datasource: # Oracle: oracle.jdbc.OracleDriver driver-class-name: com.mysql.jdbc.Driver url: jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8 username: root password: root type: com.zaxxer.hikari.HikariDataSource hikari: minimum-idle: 5 maximum-pool-size: 5 auto-commit: true idle-timeout: 30000 pool-name: DatebookHikariCP max-lifetime: 1800000 connection-timeout: 30000 connection-test-query: SELECT 1 # Oracle: SELECT 1 FROM DUAL # é…ç½®mybatis mybatis: # æœç´¢æŒ‡å®šåŒ…åˆ«å typeAliasesPackage: com.ldx.project.model # é…ç½®mapperçš„æ‰«æï¼Œæ‰¾åˆ°æ‰€æœ‰çš„mapper.xmlæ˜ å°„æ–‡ä»¶ mapperLocations: classpath*:/mapper/*Mapper.xml # æ‰“å°sqlæ‰“å¼€configuration log-impl configuration: log-impl: org.apache.ibatis.logging.stdout.StdOutImpl # PageHelperåˆ†é¡µæ’ä»¶ pagehelper: # æ–¹è¨€ helperDialect: mysql # åˆ†é¡µåˆç†åŒ– å³:é¡µç &lt;=0 æŸ¥è¯¢ç¬¬ä¸€é¡µï¼Œé¡µç &gt;=æ€»é¡µæ•°æŸ¥è¯¢æœ€åä¸€é¡µ reasonable: true # æ”¯æŒå‚æ•°è¿‡æ»¤ supportMethodsArguments: true params: count=countSql # tk mybatis mapper: # æŒ‡å®šåŸºç±» mappers: - com.ldx.project.util.BaseMapper # &lt;selectKey&gt;ä¸­çš„orderå±æ€§ï¼Œå¯é€‰å€¼ä¸ºBEFOREå’ŒAFTER;ç±»ä¼¼Oracleåºåˆ—æˆ–è€…é€šç”¨çš„ UUID æ—¶ä¸º true before: false # insertSelective å’Œ updateByPrimaryKeySelective ä¸­ï¼Œæ˜¯å¦åˆ¤æ–­å­—ç¬¦ä¸²ç±»å‹ !='' not-empty: false # å–å›ä¸»é”®çš„æ–¹å¼ MySQL :SELECT LAST_INSERT_ID() identity: MYSQL # é©¼å³°è½¬ä¸‹åˆ’çº¿å°å†™å½¢å¼ camelhumpAndLowercase:é©¼å³°è½¬ä¸‹åˆ’çº¿å¤§å†™å½¢å¼ style: camelhumpAndUppercase åˆ›å»ºå®ä½“ç±» import lombok.Data; import javax.persistence.GeneratedValue; import javax.persistence.GenerationType; import javax.persistence.Id; import javax.persistence.Table; /** * @Author: ludangxin * @Date: 2020/5/13 15:25 */ @Data @Table(name=&quot;sys_user&quot;) public class SysUser { // @Idè¡¨ç¤ºè¯¥å­—æ®µå¯¹åº”æ•°æ®åº“è¡¨çš„ä¸»é”®id // @GeneratedValueä¸­strategyè¡¨ç¤ºä½¿ç”¨æ•°æ®åº“è‡ªå¸¦çš„ä¸»é”®ç”Ÿæˆç­–ç•¥. // @GeneratedValueä¸­generatoré…ç½®ä¸º&quot;JDBC&quot;,åœ¨æ•°æ®æ’å…¥å®Œæ¯•ä¹‹å,ä¼šè‡ªåŠ¨å°†ä¸»é”®idå¡«å……åˆ°å®ä½“ç±»ä¸­.ç±»ä¼¼æ™®é€šmapper.xmlä¸­é…ç½®çš„selectKeyæ ‡ç­¾ @Id @GeneratedValue(strategy = GenerationType.IDENTITY,generator = &quot;JDBC&quot;) private Long id; private String username; private String password; } åˆ›å»ºtkMybatisåŸºç±» import tk.mybatis.mapper.common.Mapper; import tk.mybatis.mapper.common.MySqlMapper; /** * mapper åŸºç±» * ç‰¹åˆ«æ³¨æ„ï¼Œè¯¥æ¥å£ä¸èƒ½è¢«æ‰«æåˆ°ï¼Œå¦åˆ™ä¼šå‡ºé”™ */ public interface BaseMapper&lt;T&gt; extends Mapper&lt;T&gt;, MySqlMapper&lt;T&gt; { } åˆ›å»ºmapperç»§æ‰¿BaseMapper import com.ldx.project.model.SysUser; import com.ldx.project.util.BaseMapper; /** * @Author: ludangxin * @Date: 2020/5/13 17:27 */ public interface SysUserMapper extends BaseMapper&lt;SysUser&gt; { } ä¿®æ”¹å¯åŠ¨ç±» import org.springframework.boot.SpringApplication; import org.springframework.boot.autoconfigure.SpringBootApplication; import tk.mybatis.spring.annotation.MapperScan; @MapperScan(basePackages = &quot;com.ldx.project.mapper&quot;) @SpringBootApplication public class SpringbootTkMybatisPageHelper { public static void main(String[] args) { SpringApplication.run(SpringbootTkMybatisPageHelper.class, args); } } åˆ›å»ºæµ‹è¯•ç±» import com.github.pagehelper.PageHelper; import com.github.pagehelper.PageInfo; import com.ldx.project.mapper.SysUserMapper; import com.ldx.project.model.SysUser; import org.junit.jupiter.api.Test; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.test.context.SpringBootTest; import org.springframework.test.annotation.Rollback; import org.springframework.transaction.annotation.Transactional; import tk.mybatis.mapper.entity.Example; import java.util.List; @SpringBootTest(classes = SpringbootTkMybatisPageHelper.class) @Transactional @Rollback public class MybatisTest { /** * æ³¨å…¥æ•°æ®æŸ¥è¯¢æ¥å£ */ @Autowired private SysUserMapper tbUserMapper; /** * æµ‹è¯•æ’å…¥æ•°æ® */ @Test public void testInsert() { // æ„é€ ä¸€æ¡æµ‹è¯•æ•°æ® SysUser sysUser = new SysUser(); sysUser.setUsername(&quot;ludangxin&quot;); sysUser.setPassword(&quot;123456&quot;); // æ’å…¥æ•°æ® tbUserMapper.insert(sysUser); } /** * æµ‹è¯•åˆ é™¤æ•°æ® */ @Test public void testDelete() { // æ„é€ æ¡ä»¶ï¼Œç­‰åŒäº DELETE from tb_user WHERE username = 'ludangxin' Example example = new Example(SysUser.class); example.createCriteria().andEqualTo(&quot;username&quot;, &quot;ludangxin&quot;); // åˆ é™¤æ•°æ® tbUserMapper.deleteByExample(example); } /** * æµ‹è¯•ä¿®æ”¹æ•°æ® */ @Test public void testUpdate() { // æ„é€ æ¡ä»¶ Example example = new Example(SysUser.class); example.createCriteria().andEqualTo(&quot;username&quot;, &quot;ludangxin&quot;); // æ„é€ ä¸€æ¡æµ‹è¯•æ•°æ® SysUser sysUser = new SysUser(); sysUser.setUsername(&quot;ludangxin&quot;); sysUser.setPassword(&quot;123456&quot;); // ä¿®æ”¹æ•°æ® tbUserMapper.updateByExample(sysUser, example); } /** * æµ‹è¯•æŸ¥è¯¢é›†åˆ */ @Test public void testSelect() { List&lt;SysUser&gt; sysUsers = tbUserMapper.selectAll(); for (SysUser user : sysUsers) { System.out.println(user.getUsername()); } } /** * æµ‹è¯•åˆ†é¡µæŸ¥è¯¢ */ @Test public void testPage() { // PageHelper ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦è®¾ç½®é¡µç å’Œæ¯é¡µæ˜¾ç¤ºç¬”æ•°å³å¯ PageHelper.startPage(0, 2); // è®¾ç½®åˆ†é¡µæŸ¥è¯¢æ¡ä»¶ Example example = new Example(SysUser.class); PageInfo&lt;SysUser&gt; pageInfo = new PageInfo&lt;&gt;(tbUserMapper.selectByExample(example)); // è·å–æŸ¥è¯¢ç»“æœ List&lt;SysUser&gt; sysUsers = pageInfo.getList(); for (SysUser sysUser : sysUsers) { System.out.println(sysUser.getUsername()); } } } ","link":"http://blog.ludangxin.club/post/springboot-ji-cheng-tkmybatis-pagehelper/"}]}