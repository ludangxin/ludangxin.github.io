<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<meta name="author" content="é²æ¡£ä¿¡">
<meta name="description" content="Hello World !">
<meta name="keywords" content="é²æ¡£ä¿¡,ludangxin">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="http://blog.ludangxin.club/styles/main.css" />
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
        
            <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                <!--ç‚¹å‡»ç‰¹æ•ˆ-->
                <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/love.min.js"></script>
                
                        <!--CDNæ ·å¼-->
                        <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
                        <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
                        
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="http://blog.ludangxin.club">
                    æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚
                </a>
            </div>
            <div id="tp-weather-widget"></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/">
                        ğŸ é¦–é¡µ
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        ğŸ“šå½’æ¡£
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        ğŸ·ï¸æ ‡ç­¾
                    </a>
                    
                    <a class="menu-item" href="/posts">
                        âœï¸åšå®¢
                    </a>
                    
                    <a class="menu-item" href="/post/about/">
                        ğŸ‘¦å…³äº
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1597935637693" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="http://blog.ludangxin.club">
                            æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1597935637693" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/">
                            ğŸ é¦–é¡µ
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            ğŸ“šå½’æ¡£
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            ğŸ·ï¸æ ‡ç­¾
                        </a>
                        
                        <a class="menu-item" href="/posts">
                            âœï¸åšå®¢
                        </a>
                        
                        <a class="menu-item" href="/post/about/">
                            ğŸ‘¦å…³äº
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>



    <script>
        (function(a, h, g, f, e, d, c, b) {
            b = function() {
                d = h.createElement(g);
                c = h.getElementsByTagName(g)[0];
                d.src = e;
                d.charset = "utf-8";
                d.async = 1;
                c.parentNode.insertBefore(d, c)
            };
            a["SeniverseWeatherWidgetObject"] = f;
            a[f] || (a[f] = function() {
                (a[f].q = a[f].q || []).push(arguments)
            });
            a[f].l = +new Date();
            if (a.attachEvent) {
                a.attachEvent("onload", b)
            } else {
                a.addEventListener("load", b, false)
            }
        }(window, document, "script", "SeniverseWeatherWidget", "//cdn.sencdn.com/widget2/static/js/bundle.js?t=" + parseInt((new Date().getTime() / 100000000).toString(), 10)));
        window.SeniverseWeatherWidget('show', {
            flavor: "slim",
            location: "WWEFQFPJZ7T8",
            geolocation: true,
            language: "auto",
            unit: "c",
            theme: "auto",
            token: "61bcc333-3305-4728-9465-6785274bb0a3",
            hover: "enabled",
            container: "tp-weather-widget"
        })
    </script>
    
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                Spring Security è¯¦è§£ åŠ å¿«é€Ÿä¸Šæ‰‹
                            </h1>
                            
                                <!--en-->
                                <div class="post-meta en">
                                    Author:
                                    <a itemprop="author" rel="author" href="/">
                                        æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚
                                    </a>
                                    <span class="post-time">
                                Date: <a href="#">2020-06-02</a>
                            </span>
                                    <span class="post-readtime">Reading Time:<a
                                    href="#">35.6
                                    mins</a></span>
                                    <span class="post-words">words:<a href="#">8336</a></span>
                                    
                                        <span class="post-category">
                                Category:
                                
                                <a href="http://blog.ludangxin.club/tag/LSBz4Ej4I/">springboot</a>
                                
                            </span>
                                        
                                            Views:
                                            <span data-hk-page="current"> - </span>
                                            
                                </div>
                                
                        </header>
                        
                            <img class="post-feature-image" src="http://blog.ludangxin.club/post-images/spring-security-xiang-jie-ji-kuai-su-shang-shou.jpg" alt="">
                          
                        <div class="post-content">
                            <h1 id="ä»€ä¹ˆæ˜¯è®¤è¯">ä»€ä¹ˆæ˜¯è®¤è¯</h1>
<p>ç”¨æˆ·è®¤è¯å°±æ˜¯åˆ¤æ–­ä¸€ä¸ªç”¨æˆ·çš„èº«ä»½æ˜¯å¦åˆæ³•çš„è¿‡ç¨‹ï¼Œç”¨æˆ·å»è®¿é—®ç³»ç»Ÿèµ„æºæ—¶ç³»ç»Ÿè¦æ±‚éªŒè¯ç”¨æˆ·çš„èº«ä»½ä¿¡ æ¯ï¼Œèº«ä»½åˆæ³•æ–¹å¯ç»§ç»­è®¿é—®ï¼Œä¸åˆæ³•åˆ™æ‹’ç»è®¿é—®ã€‚å¸¸è§çš„ç”¨æˆ·èº«ä»½è®¤è¯æ–¹å¼æœ‰ï¼šç”¨æˆ·åå¯†ç ç™»å½•ï¼ŒäºŒç»´ç ç™»å½•ï¼Œæ‰‹æœºçŸ­ä¿¡ç™»å½•ï¼ŒæŒ‡çº¹è®¤è¯ç­‰æ–¹å¼ã€‚<br>
<strong>ç³»ç»Ÿä¸ºä»€ä¹ˆè¦è®¤è¯ï¼Ÿ</strong><br>
è®¤è¯æ˜¯ä¸ºäº†ä¿æŠ¤ç³»ç»Ÿçš„éšç§æ•°æ®ä¸èµ„æºï¼Œç”¨æˆ·çš„èº«ä»½åˆæ³•æ–¹å¯è®¿é—®è¯¥ç³»ç»Ÿçš„èµ„æºã€‚</p>
<h1 id="ä»€ä¹ˆæ˜¯ä¼šè¯">ä»€ä¹ˆæ˜¯ä¼šè¯</h1>
<p>ç”¨æˆ·è®¤è¯é€šè¿‡åï¼Œä¸ºäº†é¿å…ç”¨æˆ·çš„æ¯æ¬¡æ“ä½œéƒ½è¿›è¡Œè®¤è¯å¯å°†ç”¨æˆ·çš„ä¿¡æ¯ä¿è¯åœ¨ä¼šè¯ä¸­ã€‚ä¼šè¯å°±æ˜¯ç³»ç»Ÿä¸ºäº†ä¿æŒå½“å‰ ç”¨æˆ·çš„ç™»å½•çŠ¶æ€æ‰€æä¾›çš„æœºåˆ¶ï¼Œå¸¸è§çš„æœ‰åŸºäºsessionæ–¹å¼ã€åŸºäºtokenæ–¹å¼ç­‰ã€‚</p>
<h2 id="session-ä¼šè¯">session ä¼šè¯</h2>
<p>ç”¨æˆ·è®¤è¯æˆåŠŸåï¼Œåœ¨æœåŠ¡ç«¯ç”Ÿæˆç”¨æˆ·ç›¸å…³çš„æ•°æ®ä¿å­˜åœ¨session(å½“å‰ä¼šè¯)ä¸­ï¼Œå‘ç»™å®¢æˆ·ç«¯çš„ sesssion_id å­˜æ”¾åˆ° cookie ä¸­ï¼Œè¿™æ ·ç”¨æˆ·å®¢æˆ·ç«¯è¯·æ±‚æ—¶å¸¦ä¸Š session_id å°±å¯ä»¥éªŒè¯æœåŠ¡å™¨ç«¯æ˜¯å¦å­˜åœ¨ session æ•° æ®ï¼Œä»¥æ­¤å®Œæˆç”¨æˆ·çš„åˆæ³•æ ¡éªŒï¼Œå½“ç”¨æˆ·é€€å‡ºç³»ç»Ÿæˆ–sessionè¿‡æœŸé”€æ¯æ—¶,å®¢æˆ·ç«¯çš„session_idä¹Ÿå°±æ— æ•ˆäº†ã€‚<br>
<img src="http://blog.ludangxin.club/post-images/1591110991875.jpg" alt="" loading="lazy"></p>
<h2 id="token-ä¼šè¯">token ä¼šè¯</h2>
<p>ç”¨æˆ·è®¤è¯æˆåŠŸåï¼ŒæœåŠ¡ç«¯ç”Ÿæˆä¸€ä¸ªtokenå‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ”¾åˆ° cookie æˆ– localStorageç­‰å­˜å‚¨ä¸­ï¼Œæ¯æ¬¡è¯·æ±‚æ—¶å¸¦ä¸Š tokenï¼ŒæœåŠ¡ç«¯æ”¶åˆ°tokené€šè¿‡éªŒè¯åå³å¯ç¡®è®¤ç”¨æˆ·èº«ä»½ã€‚<br>
<img src="http://blog.ludangxin.club/post-images/1591111017782.jpg" alt="" loading="lazy"><br>
åŸºäºsessionçš„è®¤è¯æ–¹å¼ç”±Servletè§„èŒƒå®šåˆ¶ï¼ŒæœåŠ¡ç«¯è¦å­˜å‚¨sessionä¿¡æ¯éœ€è¦å ç”¨å†…å­˜èµ„æºï¼Œå®¢æˆ·ç«¯éœ€è¦æ”¯æŒ cookieï¼›åŸºäºtokençš„æ–¹å¼åˆ™ä¸€èˆ¬ä¸éœ€è¦æœåŠ¡ç«¯å­˜å‚¨tokenï¼Œå¹¶ä¸”ä¸é™åˆ¶å®¢æˆ·ç«¯çš„å­˜å‚¨æ–¹å¼ã€‚å¦‚ä»Šç§»åŠ¨äº’è”ç½‘æ—¶ä»£ æ›´å¤šç±»å‹çš„å®¢æˆ·ç«¯éœ€è¦æ¥å…¥ç³»ç»Ÿï¼Œç³»ç»Ÿå¤šæ˜¯é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„æ¶æ„è¿›è¡Œå®ç°ï¼Œæ‰€ä»¥åŸºäºtokençš„æ–¹å¼æ›´é€‚åˆã€‚</p>
<h1 id="ä»€ä¹ˆæ˜¯æˆæƒ">ä»€ä¹ˆæ˜¯æˆæƒ</h1>
<p>æˆæƒæ˜¯ç”¨æˆ·è®¤è¯é€šè¿‡æ ¹æ®ç”¨æˆ·çš„æƒé™æ¥æ§åˆ¶ç”¨æˆ·è®¿é—®èµ„æºçš„è¿‡ç¨‹ï¼Œæ‹¥æœ‰èµ„æºçš„è®¿é—®æƒé™åˆ™æ­£å¸¸è®¿é—®ï¼Œæ²¡æœ‰æƒé™åˆ™æ‹’ç»è®¿é—®ã€‚<br>
<strong>ä¸ºä»€ä¹ˆè¦æˆæƒï¼Ÿ</strong><br>
è®¤è¯æ˜¯ä¸ºäº†ä¿è¯ç”¨æˆ·èº«ä»½çš„åˆæ³•æ€§ï¼Œæˆæƒåˆ™æ˜¯ä¸ºäº†æ›´ç»†ç²’åº¦çš„å¯¹éšç§æ•°æ®è¿›è¡Œåˆ’åˆ†ï¼Œæˆæƒæ˜¯åœ¨è®¤è¯é€šè¿‡åå‘ç”Ÿçš„ï¼Œæ§åˆ¶ä¸åŒçš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ä¸åŒçš„èµ„æºã€‚</p>
<h1 id="springsecurity">SpringSecurity</h1>
<p>Spring Securityæ˜¯ä¸€ä¸ªèƒ½å¤Ÿä¸ºåŸºäºSpringçš„ä¼ä¸šåº”ç”¨ç³»ç»Ÿæä¾›å£°æ˜å¼çš„å®‰å…¨è®¿é—®æ§åˆ¶è§£å†³æ–¹æ¡ˆçš„å®‰å…¨æ¡†æ¶ã€‚ç”±äºå®ƒæ˜¯Springç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€å‘˜ï¼Œå› æ­¤å®ƒä¼´éšç€æ•´ä¸ªSpringç”Ÿæ€ç³»ç»Ÿä¸æ–­ä¿®æ­£ã€å‡çº§ï¼Œåœ¨spring booté¡¹ç›®ä¸­åŠ å…¥spring securityæ›´æ˜¯ååˆ†ç®€å•ï¼Œä½¿ç”¨Spring Security å‡å°‘äº†ä¸ºä¼ä¸šç³»ç»Ÿå®‰å…¨æ§åˆ¶ç¼–å†™å¤§é‡é‡å¤ä»£ç çš„å·¥ä½œã€‚</p>
<h2 id="å¿«é€Ÿä¸Šæ‰‹">å¿«é€Ÿä¸Šæ‰‹</h2>
<h3 id="å¼•å…¥æ‰€éœ€ä¾èµ–">å¼•å…¥æ‰€éœ€ä¾èµ–</h3>
<pre><code class="language-xml">        &lt;!-- spring security ä¾èµ– --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- webæ”¯æŒ --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
</code></pre>
<h3 id="æ·»åŠ spring-security-é…ç½®ç±»">æ·»åŠ spring security é…ç½®ç±»</h3>
<pre><code class="language-java">package com.ldx.springboot.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.password.NoOpPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.provisioning.InMemoryUserDetailsManager;

/**
 * springsecurity é…ç½®ç±»
 * @author ludangxin
 * @Date 2020-06-01
 **/
@Configuration
@EnableGlobalMethodSecurity(securedEnabled = true,prePostEnabled = true)
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

    /**
     * å®šä¹‰ç”¨æˆ·ä¿¡æ¯æœåŠ¡ï¼ˆæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼‰
     */
    @Bean
    @Override
    public UserDetailsService userDetailsService(){
        //åŸºäºå†…å­˜çš„userDetail
        InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager();
        //ç”¨æˆ·zhangsan æ‹¥æœ‰è®¿é—®p1èµ„æºæƒé™
        manager.createUser(User.withUsername(&quot;zhangsan&quot;).password(&quot;123&quot;).authorities(&quot;p1&quot;).build());
        //ç”¨æˆ·lisi æ‹¥æœ‰è®¿é—®p2èµ„æºæƒé™
        manager.createUser(User.withUsername(&quot;lisi&quot;).password(&quot;456&quot;).authorities(&quot;p2&quot;).build());
        return manager;
    }

    /**
     * å¯†ç ç¼–ç å™¨
     */
    @Bean
    public PasswordEncoder passwordEncoder(){
        //æ— åŠ å¯†æœºåˆ¶
        return NoOpPasswordEncoder.getInstance();
    }

    /**
     * å®‰å…¨æ‹¦æˆªæœºåˆ¶ï¼ˆæœ€é‡è¦ï¼‰
     */
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.authorizeRequests()
                .antMatchers(&quot;/r/r1&quot;).hasAuthority(&quot;p1&quot;)
                .antMatchers(&quot;/r/r2&quot;).hasAuthority(&quot;p2&quot;)
                //æ‰€æœ‰çš„è¯·æ±‚å¿…é¡»é€šè¿‡è®¤è¯
                .anyRequest().authenticated()
                .and()
                //å…è®¸è¡¨å•ç™»å½•
                .formLogin()
                //è‡ªå®šä¹‰ç™»å½•æˆåŠŸçš„é¡µé¢åœ°å€
                .successForwardUrl(&quot;/login-success&quot;);
    }
}

</code></pre>
<h3 id="ç¼–å†™æµ‹è¯•æ¥å£">ç¼–å†™æµ‹è¯•æ¥å£</h3>
<pre><code class="language-java">import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class TestController {

    @RequestMapping(value = &quot;/login-success&quot;)
    public String loginSuccess(){
        return &quot; ç™»å½•æˆåŠŸ&quot;;
    }

    /**
     * æµ‹è¯•èµ„æº1
     * @return
     */
    @GetMapping(value = &quot;/r/r1&quot;)
    public String r1(){
        return &quot; è®¿é—®èµ„æº1&quot;;
    }

    /**
     * æµ‹è¯•èµ„æº2
     * @return
     */
    @GetMapping(value = &quot;/r/r2&quot;)
    public String r2(){
        return &quot; è®¿é—®èµ„æº2&quot;;
    }
}
</code></pre>
<h3 id="æµ‹è¯•">æµ‹è¯•</h3>
<ol>
<li>æµ‹è¯•ç™»é™†åŠŸèƒ½,è®¿é—® <code>localhost:8080</code><br>
<img src="http://blog.ludangxin.club/post-images/1591111117908.jpg" alt="" loading="lazy"></li>
<li>è¾“å…¥ è´¦å·:<code>zhangsan</code> å¯†ç : <code>123</code>ç™»é™†æˆåŠŸ<br>
<img src="http://blog.ludangxin.club/post-images/1591111121642.jpg" alt="" loading="lazy"></li>
<li>è®¿é—® <code>/r/r1</code>èµ„æº<br>
<img src="http://blog.ludangxin.club/post-images/1591111124609.jpg" alt="" loading="lazy"></li>
<li>è®¿é—®<code>r/r2</code>èµ„æº, 403æ— æƒé™<br>
<img src="http://blog.ludangxin.club/post-images/1591111127688.jpg" alt="" loading="lazy"></li>
</ol>
<h3 id="å°ç»“">å°ç»“</h3>
<p>é€šè¿‡å¿«é€Ÿä¸Šæ‰‹ï¼Œå’±ä»¬ä½¿ç”¨Spring Securityå®ç°äº†è®¤è¯å’Œæˆæƒï¼ŒSpring Securityæä¾›äº†åŸºäºè´¦å·å’Œå¯†ç çš„è®¤è¯æ–¹å¼ï¼Œé€šè¿‡å®‰å…¨é…ç½®å³å¯å®ç°è¯·æ±‚æ‹¦æˆªï¼ŒæˆæƒåŠŸèƒ½ï¼ŒSpring Securityèƒ½å®Œæˆçš„ä¸ä»…ä»…æ˜¯è¿™äº›ã€‚</p>
<h2 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h2>
<h3 id="ç»“æ„æ€»è§ˆ">ç»“æ„æ€»è§ˆ</h3>
<p>Spring Securityæ‰€è§£å†³çš„é—®é¢˜å°±æ˜¯<strong>å®‰å…¨è®¿é—®æ§åˆ¶</strong>ï¼Œè€Œå®‰å…¨è®¿é—®æ§åˆ¶åŠŸèƒ½å…¶å®å°±æ˜¯å¯¹æ‰€æœ‰è¿›å…¥ç³»ç»Ÿçš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œæ ¡éªŒæ¯ä¸ªè¯·æ±‚æ˜¯å¦èƒ½å¤Ÿè®¿é—®å®ƒæ‰€æœŸæœ›çš„èµ„æºã€‚<br>
å½“åˆå§‹åŒ–Spring Securityæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªåä¸º SpringSecurityFilterChain çš„Servletè¿‡æ»¤å™¨ï¼Œç±»å‹ä¸º org.springframework.security.web.FilterChainProxyï¼Œå®ƒå®ç°äº†javax.servlet.Filterï¼Œå› æ­¤å¤–éƒ¨çš„è¯·æ±‚ä¼šç»è¿‡æ­¤ç±»ï¼Œä¸‹å›¾æ˜¯Spring Securityè¿‡è™‘å™¨é“¾ç»“æ„å›¾ï¼š<br>
<img src="http://blog.ludangxin.club/post-images/1591111142292.jpg" alt="" loading="lazy"><br>
FilterChainProxyæ˜¯ä¸€ä¸ªä»£ç†ï¼ŒçœŸæ­£èµ·ä½œç”¨çš„æ˜¯FilterChainProxyä¸­SecurityFilterChainæ‰€åŒ…å«çš„å„ä¸ªFilterï¼ŒåŒæ—¶è¿™äº›Filterä½œä¸ºBeanè¢«Springç®¡ç†ï¼Œå®ƒä»¬æ˜¯Spring Securityæ ¸å¿ƒï¼Œå„æœ‰å„çš„èŒè´£ï¼Œä½†ä»–ä»¬å¹¶ä¸ç›´æ¥å¤„ç†ç”¨æˆ·çš„<strong>è®¤è¯</strong>ï¼Œä¹Ÿä¸ç›´æ¥å¤„ç†ç”¨æˆ·çš„<strong>æˆæƒ</strong>ï¼Œè€Œæ˜¯æŠŠå®ƒä»¬äº¤ç»™äº†è®¤è¯ç®¡ç†ï¼ˆAuthenticationManagerï¼‰å’Œå†³ç­–ç®¡ç†å™¨ï¼ˆAccessDecisionManagerï¼‰è¿›è¡Œå¤„ç†.<br>
ä¸‹é¢ä»‹ç»è¿‡æ»¤å™¨é“¾ä¸­ä¸»è¦çš„å‡ ä¸ªè¿‡æ»¤å™¨åŠå…¶ä½œç”¨ï¼š<br>
<img src="http://blog.ludangxin.club/post-images/1591111150999.jpg" alt="" loading="lazy"><br>
<strong>SecurityContextPersistenceFilter :</strong><br>
è¿™ä¸ªFilteræ˜¯æ•´ä¸ªæ‹¦æˆªè¿‡ç¨‹çš„å…¥å£å’Œå‡ºå£ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªæ‹¦æˆªå™¨ï¼‰ï¼Œä¼šåœ¨è¯·æ±‚å¼€å§‹æ—¶ä»é…ç½®å¥½çš„ SecurityContextRepository ä¸­è·å– SecurityContextï¼Œç„¶åæŠŠå®ƒè®¾ç½®ç»™SecurityContextHolderã€‚åœ¨è¯·æ±‚å®Œæˆåå°† SecurityContextHolder æŒæœ‰çš„ SecurityContext å†ä¿å­˜åˆ°é…ç½®å¥½çš„ SecurityContextRepositoryï¼ŒåŒæ—¶æ¸…é™¤ securityContextHolder æ‰€æŒæœ‰çš„SecurityContextï¼›<br>
<strong>UsernamePasswordAuthenticationFilter :</strong><br>
ç”¨äºå¤„ç†æ¥è‡ªè¡¨å•æäº¤çš„è®¤è¯ã€‚è¯¥è¡¨å•å¿…é¡»æä¾›å¯¹åº”çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå…¶å†…éƒ¨è¿˜æœ‰ç™»å½•æˆåŠŸæˆ–å¤±è´¥åè¿›è¡Œå¤„ç†çš„ AuthenticationSuccessHandler å’Œ AuthenticationFailureHandlerï¼Œè¿™äº›éƒ½å¯ä»¥æ ¹æ®éœ€æ±‚åšç›¸å…³æ”¹å˜ï¼›<br>
<strong>FilterSecurityInterceptor :</strong><br>
æ˜¯ç”¨äºä¿æŠ¤webèµ„æºçš„ï¼Œä½¿ç”¨AccessDecisionManagerå¯¹å½“å‰ç”¨æˆ·è¿›è¡Œæˆæƒè®¿é—®ï¼›<br>
<strong>ExceptionTranslationFilter :</strong><br>
èƒ½å¤Ÿæ•è·æ¥è‡ª FilterChain æ‰€æœ‰çš„å¼‚å¸¸ï¼Œå¹¶è¿›è¡Œå¤„ç†ã€‚ä½†æ˜¯å®ƒåªä¼šå¤„ç†ä¸¤ç±»å¼‚å¸¸ï¼šAuthenticationException å’Œ AccessDeniedExceptionï¼Œå…¶å®ƒçš„å¼‚å¸¸å®ƒä¼šç»§ç»­æŠ›å‡ºã€‚</p>
<h3 id="è®¤è¯">è®¤è¯</h3>
<h4 id="æµç¨‹">æµç¨‹</h4>
<figure data-type="image" tabindex="1"><img src="http://blog.ludangxin.club/post-images/1591111163947.jpg" alt="" loading="lazy"></figure>
<ol>
<li>ç”¨æˆ·æäº¤ç”¨æˆ·åã€å¯†ç è¢«SecurityFilterChainä¸­çš„ UsernamePasswordAuthenticationFilter è¿‡æ»¤å™¨è·å–åˆ°ï¼Œå°è£…ä¸ºè¯·æ±‚Authenticationï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯UsernamePasswordAuthenticationTokenè¿™ä¸ªå®ç°ç±»ã€‚</li>
<li>ç„¶åè¿‡æ»¤å™¨å°†Authenticationæäº¤è‡³è®¤è¯ç®¡ç†å™¨ï¼ˆAuthenticationManagerï¼‰è¿›è¡Œè®¤è¯</li>
<li>è®¤è¯æˆåŠŸåï¼Œ AuthenticationManager èº«ä»½ç®¡ç†å™¨è¿”å›ä¸€ä¸ªè¢«å¡«å……æ»¡äº†ä¿¡æ¯çš„ï¼ˆåŒ…æ‹¬ä¸Šé¢æåˆ°çš„æƒé™ä¿¡æ¯ï¼Œèº«ä»½ä¿¡æ¯ï¼Œç»†èŠ‚ä¿¡æ¯ï¼Œä½†å¯†ç é€šå¸¸ä¼šè¢«ç§»é™¤ï¼‰ Authentication å®ä¾‹ã€‚</li>
<li>SecurityContextHolder å®‰å…¨ä¸Šä¸‹æ–‡å®¹å™¨å°†ç¬¬3æ­¥å¡«å……äº†ä¿¡æ¯çš„ Authentication ï¼Œé€šè¿‡SecurityContextHolder.getContext().setAuthentication(â€¦)æ–¹æ³•ï¼Œè®¾ç½®åˆ°å…¶ä¸­ã€‚å¯ä»¥çœ‹å‡ºAuthenticationManageræ¥å£ï¼ˆè®¤è¯ç®¡ç†å™¨ï¼‰æ˜¯è®¤è¯ç›¸å…³çš„æ ¸å¿ƒæ¥å£ï¼Œä¹Ÿæ˜¯å‘èµ·è®¤è¯çš„å‡ºå‘ç‚¹ï¼Œå®ƒ çš„å®ç°ç±»ä¸ºProviderManagerã€‚è€ŒSpring Securityæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼Œå› æ­¤ProviderManagerç»´æŠ¤ç€ä¸€ä¸ª List<AuthenticationProvider> åˆ—è¡¨ï¼Œå­˜æ”¾å¤šç§è®¤è¯æ–¹å¼ï¼Œæœ€ç»ˆå®é™…çš„è®¤è¯å·¥ä½œæ˜¯ç”± AuthenticationProviderå®Œæˆçš„ã€‚å’±ä»¬çŸ¥é“webè¡¨å•çš„å¯¹åº”çš„AuthenticationProviderå®ç°ç±»ä¸º DaoAuthenticationProviderï¼Œå®ƒçš„å†…éƒ¨åˆç»´æŠ¤ç€ä¸€ä¸ªUserDetailsServiceè´Ÿè´£UserDetailsçš„è·å–ã€‚æœ€ç»ˆAuthenticationProviderå°†UserDetailså¡«å……è‡³Authenticationã€‚</li>
</ol>
<h4 id="authenticationprovider">AuthenticationProvider</h4>
<p>é€šè¿‡å‰é¢çš„<strong>Spring Securityè®¤è¯æµç¨‹</strong>æˆ‘ä»¬å¾—çŸ¥ï¼Œè®¤è¯ç®¡ç†å™¨ï¼ˆAuthenticationManagerï¼‰å§”æ‰˜AuthenticationProviderå®Œæˆè®¤è¯å·¥ä½œã€‚<br>
AuthenticationProvideræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public interface AuthenticationProvider { 
    Authentication authenticate(Authentication authentication) throws AuthenticationException; 
    boolean supports(Class&lt;?&gt; var1); 
}
</code></pre>
<p><strong>authenticate</strong>()æ–¹æ³•å®šä¹‰äº†<strong>è®¤è¯çš„å®ç°è¿‡ç¨‹</strong>ï¼Œå®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªAuthenticationï¼Œé‡Œé¢åŒ…å«äº†ç™»å½•ç”¨æˆ·æ‰€æäº¤çš„ç”¨æˆ·ã€å¯†ç ç­‰ã€‚è€Œè¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªAuthenticationï¼Œè¿™ä¸ªAuthenticationåˆ™æ˜¯åœ¨è®¤è¯æˆåŠŸåï¼Œå°†ç”¨æˆ·çš„æƒé™åŠå…¶ä»–ä¿¡æ¯é‡æ–°ç»„è£…åç”Ÿæˆã€‚<br>
Spring Securityä¸­ç»´æŠ¤ç€ä¸€ä¸ª List<AuthenticationProvider> åˆ—è¡¨ï¼Œå­˜æ”¾å¤šç§è®¤è¯æ–¹å¼ï¼Œä¸åŒçš„è®¤è¯æ–¹å¼ä½¿ç”¨ä¸åŒçš„AuthenticationProviderã€‚å¦‚ä½¿ç”¨ç”¨æˆ·åå¯†ç ç™»å½•æ—¶ï¼Œä½¿ç”¨AuthenticationProvider1ï¼ŒçŸ­ä¿¡ç™»å½•æ—¶ä½¿ç”¨AuthenticationProvider2ç­‰ç­‰è¿™æ ·çš„ä¾‹å­å¾ˆå¤šã€‚<br>
æ¯ä¸ªAuthenticationProvideréœ€è¦å®ç°<strong>supports()<strong>æ–¹æ³•æ¥è¡¨æ˜è‡ªå·±æ”¯æŒçš„è®¤è¯æ–¹å¼ï¼Œå¦‚æˆ‘ä»¬ä½¿ç”¨è¡¨å•æ–¹å¼è®¤è¯ï¼Œåœ¨æäº¤è¯·æ±‚æ—¶Spring Securityä¼šç”ŸæˆUsernamePasswordAuthenticationTokenï¼Œå®ƒæ˜¯ä¸€ä¸ªAuthenticationï¼Œé‡Œé¢å°è£…ç€ç”¨æˆ·æäº¤çš„ç”¨æˆ·åã€å¯†ç ä¿¡æ¯ã€‚è€Œå¯¹åº”çš„ï¼Œå“ªä¸ªAuthenticationProvideræ¥å¤„ç†å®ƒï¼Ÿ<br>
æˆ‘ä»¬åœ¨</strong>DaoAuthenticationProvider</strong>çš„åŸºç±»AbstractUserDetailsAuthenticationProviderå‘ç°ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-java">public boolean supports(Class&lt;?&gt; authentication) { 
    return UsernamePasswordAuthenticationToken.class.isAssignableFrom(authentication);
}
</code></pre>
<p><strong>ä¹Ÿå°±æ˜¯è¯´å½“webè¡¨å•æäº¤ç”¨æˆ·åå¯†ç æ—¶ï¼ŒSpring Securityç”±DaoAuthenticationProviderå¤„ç†ã€‚</strong><br>
æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<strong>Authentication</strong>(è®¤è¯ä¿¡æ¯)çš„ç»“æ„ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæˆ‘ä»¬ä¹‹å‰æåˆ°çš„<br>
UsernamePasswordAuthenticationTokenå°±æ˜¯å®ƒçš„å®ç°ä¹‹ä¸€ï¼š</p>
<pre><code class="language-java">public interface Authentication extends Principal, Serializable { 
    Collection&lt;? extends GrantedAuthority&gt; getAuthorities(); 
    Object getCredentials(); 
    Object getDetails(); 
    Object getPrincipal();
    boolean isAuthenticated(); 
    void setAuthenticated(boolean var1) throws IllegalArgumentException; 
}
</code></pre>
<ol>
<li>Authenticationæ˜¯spring securityåŒ…ä¸­çš„æ¥å£ï¼Œç›´æ¥ç»§æ‰¿è‡ªPrincipalç±»ï¼Œè€ŒPrincipalæ˜¯ä½äº java.securityåŒ…ä¸­çš„ã€‚å®ƒæ˜¯è¡¨ç¤ºç€ä¸€ä¸ªæŠ½è±¡ä¸»ä½“èº«ä»½ï¼Œä»»ä½•ä¸»ä½“éƒ½æœ‰ä¸€ä¸ªåç§°ï¼Œå› æ­¤åŒ…å«ä¸€ä¸ªgetName()æ–¹æ³•ã€‚</li>
<li>getAuthorities()ï¼Œæƒé™ä¿¡æ¯åˆ—è¡¨ï¼Œé»˜è®¤æ˜¯GrantedAuthorityæ¥å£çš„ä¸€äº›å®ç°ç±»ï¼Œé€šå¸¸æ˜¯ä»£è¡¨æƒé™ä¿¡æ¯çš„ä¸€ç³»åˆ—å­—ç¬¦ä¸²ã€‚</li>
<li>getCredentials()ï¼Œå‡­è¯ä¿¡æ¯ï¼Œç”¨æˆ·è¾“å…¥çš„å¯†ç å­—ç¬¦ä¸²ï¼Œåœ¨è®¤è¯è¿‡åé€šå¸¸ä¼šè¢«ç§»é™¤ï¼Œç”¨äºä¿éšœå®‰å…¨ã€‚</li>
<li>getDetails()ï¼Œç»†èŠ‚ä¿¡æ¯ï¼Œwebåº”ç”¨ä¸­çš„å®ç°æ¥å£é€šå¸¸ä¸º WebAuthenticationDetailsï¼Œå®ƒè®°å½•äº†è®¿é—®è€…çš„ipåœ°å€å’ŒsessionIdçš„å€¼ã€‚</li>
<li><strong>getPrincipal()</strong>ï¼Œèº«ä»½ä¿¡æ¯ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿”å›çš„æ˜¯UserDetailsæ¥å£çš„å®ç°ç±»ï¼ŒUserDetailsä»£è¡¨ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œé‚£ä»Authenticationä¸­å–å‡ºæ¥çš„UserDetailså°±æ˜¯å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼Œå®ƒä¹Ÿæ˜¯æ¡†æ¶ä¸­çš„å¸¸ç”¨æ¥å£ä¹‹ä¸€ã€‚</li>
</ol>
<h4 id="userdetailsservice">UserDetailsService</h4>
<ol>
<li>è®¤è¯†UserDetailsService<br>
ç°åœ¨å’±ä»¬ç°åœ¨çŸ¥é“DaoAuthenticationProviderå¤„ç†äº†webè¡¨å•çš„è®¤è¯é€»è¾‘ï¼Œè®¤è¯æˆåŠŸåæ—¢å¾—åˆ°ä¸€ä¸ª Authentication(UsernamePasswordAuthenticationTokenå®ç°)ï¼Œé‡Œé¢åŒ…å«äº†èº«ä»½ä¿¡æ¯ï¼ˆPrincipalï¼‰ã€‚è¿™ä¸ªèº«ä»½ä¿¡æ¯å°±æ˜¯ä¸€ä¸ª Object ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å®ƒå¯ä»¥è¢«å¼ºè½¬ä¸ºUserDetailså¯¹è±¡ã€‚ DaoAuthenticationProviderä¸­åŒ…å«äº†ä¸€ä¸ªUserDetailsServiceå®ä¾‹ï¼Œå®ƒè´Ÿè´£æ ¹æ®ç”¨æˆ·åæå–ç”¨æˆ·ä¿¡æ¯UserDetails(åŒ…å«å¯†ç )ï¼Œè€ŒåDaoAuthenticationProviderä¼šå»å¯¹æ¯”UserDetailsServiceæå–çš„ç”¨æˆ·å¯†ç ä¸ç”¨æˆ·æäº¤çš„å¯†ç æ˜¯å¦åŒ¹é…ä½œä¸ºè®¤è¯æˆåŠŸçš„å…³é”®ä¾æ®ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å°†è‡ªå®šä¹‰çš„ UserDetailsService å…¬å¼€ä¸ºspring beanæ¥å®šä¹‰è‡ªå®šä¹‰èº«ä»½éªŒè¯ã€‚</li>
</ol>
<pre><code class="language-java">public interface UserDetailsService { 
    UserDetails loadUserByUsername(String username) throws UsernameNotFoundException; 
}
</code></pre>
<p>å¾ˆå¤šäººæŠŠDaoAuthenticationProviderå’ŒUserDetailsServiceçš„èŒè´£ææ··æ·†ï¼Œå…¶å®UserDetailsServiceåªè´Ÿè´£ä»ç‰¹å®šçš„åœ°æ–¹ï¼ˆé€šå¸¸æ˜¯æ•°æ®åº“ï¼‰åŠ è½½ç”¨æˆ·ä¿¡æ¯ï¼Œä»…æ­¤è€Œå·²ã€‚è€ŒDaoAuthenticationProviderçš„èŒè´£æ›´å¤§ï¼Œå®ƒå®Œæˆå®Œæ•´çš„è®¤è¯æµç¨‹ï¼ŒåŒæ—¶ä¼šæŠŠUserDetailså¡«å……è‡³Authenticationã€‚ä¸Šé¢ä¸€ç›´æåˆ°UserDetailsæ˜¯ç”¨æˆ·ä¿¡æ¯ï¼Œå’±ä»¬çœ‹ä¸€ä¸‹å®ƒçš„çœŸé¢ç›®ï¼š</p>
<pre><code class="language-java">public interface UserDetails extends Serializable { 
    Collection&lt;? extends GrantedAuthority&gt; getAuthorities(); 
    String getPassword(); 
    String getUsername();
    boolean isAccountNonExpired(); 
    boolean isAccountNonLocked(); 
    boolean isCredentialsNonExpired();
    boolean isEnabled(); 
}
</code></pre>
<p>å®ƒå’ŒAuthenticationæ¥å£å¾ˆç±»ä¼¼ï¼Œæ¯”å¦‚å®ƒä»¬éƒ½æ‹¥æœ‰usernameï¼Œauthoritiesã€‚Authenticationçš„getCredentials()ä¸UserDetailsä¸­çš„getPassword()éœ€è¦è¢«åŒºåˆ†å¯¹å¾…ï¼Œå‰è€…æ˜¯ç”¨æˆ·æäº¤çš„å¯†ç å‡­è¯ï¼Œåè€…æ˜¯ç”¨æˆ·å®é™…å­˜å‚¨çš„å¯†ç ï¼Œè®¤è¯å…¶å®å°±æ˜¯å¯¹è¿™ä¸¤è€…çš„æ¯”å¯¹ã€‚Authenticationä¸­çš„getAuthorities()å®é™…æ˜¯ç”±UserDetailsçš„getAuthorities()ä¼ é€’è€Œå½¢æˆçš„ã€‚è¿˜è®°å¾—Authenticationæ¥å£ä¸­çš„getDetails()æ–¹æ³•å—ï¼Ÿå…¶ä¸­çš„UserDetailsç”¨æˆ·è¯¦ç»†ä¿¡æ¯ä¾¿æ˜¯ç»è¿‡äº†AuthenticationProviderè®¤è¯ä¹‹åè¢«å¡«å……çš„ã€‚ é€šè¿‡å®ç°UserDetailsServiceå’ŒUserDetailsï¼Œæˆ‘ä»¬å¯ä»¥å®Œæˆå¯¹ç”¨æˆ·ä¿¡æ¯è·å–æ–¹å¼ä»¥åŠç”¨æˆ·ä¿¡æ¯å­—æ®µçš„æ‰©å±•ã€‚<br>
Spring Securityæä¾›çš„InMemoryUserDetailsManager(å†…å­˜è®¤è¯)ï¼ŒJdbcUserDetailsManager(jdbcè®¤è¯)å°±æ˜¯UserDetailsServiceçš„å®ç°ç±»ï¼Œä¸»è¦åŒºåˆ«æ— éå°±æ˜¯ä»å†…å­˜è¿˜æ˜¯ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·ã€‚<br>
2. è‡ªå®šä¹‰UserDetailsService</p>
<pre><code class="language-java">@Service 
public class SpringDataUserDetailsService implements UserDetailsService { 
    @Override 
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { 
        //ç™»å½•è´¦å· 
        System.out.println(&quot;username=&quot;+username); 
        //æ ¹æ®è´¦å·å»æ•°æ®åº“æŸ¥è¯¢... 
        //è¿™é‡Œæš‚æ—¶ä½¿ç”¨é™æ€æ•°æ® 
        UserDetails userDetails = User.withUsername(username).password(&quot;123&quot;).authorities(&quot;p1&quot;).build(); return userDetails; 
    } 
}
</code></pre>
<h4 id="passwordencoder">PasswordEncoder</h4>
<ol>
<li>è®¤è¯†PasswordEncoder<br>
DaoAuthenticationProviderè®¤è¯å¤„ç†å™¨é€šè¿‡UserDetailsServiceè·å–åˆ°UserDetailsåï¼Œå®ƒæ˜¯å¦‚ä½•ä¸è¯·æ±‚Authenticationä¸­çš„å¯†ç åšå¯¹æ¯”å‘¢ï¼Ÿ<br>
åœ¨è¿™é‡ŒSpring Securityä¸ºäº†é€‚åº”å¤šç§å¤šæ ·çš„åŠ å¯†ç±»å‹ï¼Œåˆåšäº†æŠ½è±¡ï¼ŒDaoAuthenticationProvideré€šè¿‡PasswordEncoderæ¥å£çš„matchesæ–¹æ³•è¿›è¡Œå¯†ç çš„å¯¹æ¯”ï¼Œè€Œå…·ä½“çš„å¯†ç å¯¹æ¯”ç»†èŠ‚å–å†³äºå®ç°ï¼š</li>
</ol>
<pre><code class="language-java">public interface PasswordEncoder { 
    String encode(CharSequence var1);
    boolean matches(CharSequence var1, String var2); 
    default boolean upgradeEncoding(String encodedPassword) { 
        return false; 
    } 
}
</code></pre>
<p>è€ŒSpring Securityæä¾›å¾ˆå¤šå†…ç½®çš„PasswordEncoderï¼Œèƒ½å¤Ÿå¼€ç®±å³ç”¨ï¼Œä½¿ç”¨æŸç§PasswordEncoderåªéœ€è¦è¿›è¡Œå¦‚ä¸‹å£°æ˜å³å¯ï¼Œå¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">@Bean 
public PasswordEncoder passwordEncoder() { 
    //NoOpPasswordEncoderé‡‡ç”¨å­—ç¬¦ä¸²åŒ¹é…æ–¹æ³•ï¼Œä¸å¯¹å¯†ç è¿›è¡ŒåŠ å¯†æ¯”è¾ƒå¤„ç†
    return NoOpPasswordEncoder.getInstance(); 
}
</code></pre>
<ol start="2">
<li>å¯†ç æ¯”è¾ƒæµç¨‹å¦‚ä¸‹
<ol>
<li>ç”¨æˆ·è¾“å…¥å¯†ç ï¼ˆæ˜æ–‡ ï¼‰</li>
<li>DaoAuthenticationProviderè·å–UserDetailsï¼ˆå…¶ä¸­å­˜å‚¨äº†ç”¨æˆ·çš„æ­£ç¡®å¯†ç ï¼‰</li>
<li>DaoAuthenticationProviderä½¿ç”¨PasswordEncoderå¯¹è¾“å…¥çš„å¯†ç å’Œæ­£ç¡®çš„å¯†ç è¿›è¡Œæ ¡éªŒï¼Œå¯†ç ä¸€è‡´åˆ™æ ¡éªŒé€šè¿‡ï¼Œå¦åˆ™æ ¡éªŒå¤±è´¥ã€‚<br>
NoOpPasswordEncoderçš„æ ¡éªŒè§„åˆ™æ‹¿ è¾“å…¥çš„å¯†ç å’ŒUserDetailsä¸­çš„æ­£ç¡®å¯†ç è¿›è¡Œå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œå­—ç¬¦ä¸²å†…å®¹ä¸€è‡´åˆ™æ ¡éªŒé€šè¿‡ï¼Œå¦åˆ™ æ ¡éªŒå¤±è´¥ã€‚<br>
å®é™…é¡¹ç›®ä¸­æ¨èä½¿ç”¨BCryptPasswordEncoder, Pbkdf2PasswordEncoder, SCryptPasswordEncoderç­‰ï¼Œæ„Ÿå…´è¶£çš„å¤§å®¶å¯ä»¥çœ‹çœ‹è¿™äº›PasswordEncoderçš„å…·ä½“å®ç°ã€‚</li>
</ol>
</li>
<li>ä½¿ç”¨BCryptPasswordEncoder
<ol>
<li>é…ç½®BCryptPasswordEncoder<br>
åœ¨å®‰å…¨é…ç½®ç±»ä¸­å®šä¹‰ï¼š</li>
</ol>
</li>
</ol>
<pre><code class="language-java">@Bean 
public PasswordEncoder passwordEncoder() { 
    return new BCryptPasswordEncoder(); 
}
</code></pre>
<p>æµ‹è¯•å‘ç°è®¤è¯å¤±è´¥ï¼Œæç¤ºï¼š<code>Encoded password does not look like BCrypt</code>ã€‚<br>
åŸå› ï¼š<br>
ç”±äºUserDetailsä¸­å­˜å‚¨çš„æ˜¯åŸå§‹å¯†ç ï¼ˆæ¯”å¦‚ï¼š123ï¼‰ï¼Œå®ƒä¸æ˜¯BCryptæ ¼å¼ã€‚è·Ÿè¸ª DaoAuthenticationProviderç¬¬33è¡Œä»£ç æŸ¥çœ‹ userDetailsä¸­çš„å†…å®¹ ï¼Œè·Ÿè¸ªç¬¬38è¡Œä»£ç æŸ¥çœ‹PasswordEncoderçš„ç±»å‹ã€‚<br>
â€‹	2. æµ‹è¯•BCrypt<br>
é€šè¿‡ä¸‹è¾¹çš„ä»£ç æµ‹è¯•BCryptåŠ å¯†åŠæ ¡éªŒçš„æ–¹æ³•<br>
ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre><code class="language-java">@RunWith(SpringRunner.class) 
public class TestBCrypt {
    @Test
    public void test1(){ 
        //å¯¹åŸå§‹å¯†ç åŠ å¯† 
        String hashpw = BCrypt.hashpw(&quot;123&quot;,BCrypt.gensalt()); 
        System.out.println(hashpw);
        //æ ¡éªŒåŸå§‹å¯†ç å’ŒBCryptå¯†ç æ˜¯å¦ä¸€è‡´ 
        boolean checkpw = BCrypt.checkpw(&quot;123&quot;, &quot;$2a$10$NlBC84MVb7F95EXYTXwLneXgCca6/GipyWR5NHm8K0203bSQMLpvm&quot;); 
        System.out.println(checkpw); 
    } 
}
</code></pre>
<h3 id="æˆæƒ">æˆæƒ</h3>
<h4 id="æµç¨‹-2">æµç¨‹</h4>
<p>é€šè¿‡<strong>å¿«é€Ÿä¸Šæ‰‹</strong>æˆ‘ä»¬çŸ¥é“ï¼ŒSpring Securityå¯ä»¥é€šè¿‡ http.authorizeRequests() å¯¹webè¯·æ±‚è¿›è¡Œæˆæƒä¿æŠ¤ã€‚Spring Securityä½¿ç”¨æ ‡å‡†Filterå»ºç«‹äº†å¯¹webè¯·æ±‚çš„æ‹¦æˆªï¼Œæœ€ç»ˆå®ç°å¯¹èµ„æºçš„æˆæƒè®¿é—®ã€‚<br>
Spring Securityçš„æˆæƒæµç¨‹å¦‚ä¸‹ï¼š<br>
<img src="http://blog.ludangxin.club/post-images/1591111185336.jpg" alt="" loading="lazy"></p>
<ol>
<li><strong>æ‹¦æˆªè¯·æ±‚</strong>ï¼Œå·²è®¤è¯ç”¨æˆ·è®¿é—®å—ä¿æŠ¤çš„webèµ„æºå°†è¢«SecurityFilterChainä¸­çš„ FilterSecurityInterceptor çš„å­ç±»æ‹¦æˆªã€‚</li>
<li><strong>è·å–èµ„æºè®¿é—®ç­–ç•¥</strong>ï¼ŒFilterSecurityInterceptorä¼šä» SecurityMetadataSource çš„å­ç±» DefaultFilterInvocationSecurityMetadataSource è·å–è¦è®¿é—®å½“å‰èµ„æºæ‰€éœ€è¦çš„æƒé™Collection<ConfigAttribute> ã€‚ SecurityMetadataSourceå…¶å®å°±æ˜¯è¯»å–è®¿é—®ç­–ç•¥çš„æŠ½è±¡ï¼Œè€Œè¯»å–çš„å†…å®¹ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬é…ç½®çš„è®¿é—®è§„åˆ™ï¼Œ è¯» å–è®¿é—®ç­–ç•¥å¦‚ï¼š</li>
</ol>
<pre><code class="language-java">http.authorizeRequests() 
    .antMatchers(&quot;/r/r1&quot;).hasAuthority(&quot;p1&quot;) 
    .antMatchers(&quot;/r/r2&quot;).hasAuthority(&quot;p2&quot;) ...
</code></pre>
<ol start="3">
<li>æœ€åï¼ŒFilterSecurityInterceptorä¼šè°ƒç”¨ AccessDecisionManager è¿›è¡Œæˆæƒå†³ç­–ï¼Œè‹¥å†³ç­–é€šè¿‡ï¼Œåˆ™å…è®¸è®¿é—®èµ„æºï¼Œå¦åˆ™å°†ç¦æ­¢è®¿é—®ã€‚<br>
AccessDecisionManagerï¼ˆè®¿é—®å†³ç­–ç®¡ç†å™¨ï¼‰çš„æ ¸å¿ƒæ¥å£å¦‚ä¸‹:</li>
</ol>
<pre><code class="language-java">public interface AccessDecisionManager { 
    /** * é€šè¿‡ä¼ é€’çš„å‚æ•°æ¥å†³å®šç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®å¯¹åº”å—ä¿æŠ¤èµ„æºçš„æƒé™ */
    void decide(Authentication authentication , Object object, Collection&lt;ConfigAttribute&gt; configAttributes ) throws AccessDeniedException, InsufficientAuthenticationException;
    //ç•¥.. 
}
</code></pre>
<p>è¿™é‡Œç€é‡è¯´æ˜ä¸€ä¸‹decideçš„å‚æ•°ï¼š<br>
authenticationï¼šè¦è®¿é—®èµ„æºçš„è®¿é—®è€…çš„èº«ä»½<br>
objectï¼šè¦è®¿é—®çš„å—ä¿æŠ¤èµ„æºï¼Œwebè¯·æ±‚å¯¹åº”FilterInvocation<br>
confifigAttributesï¼šæ˜¯å—ä¿æŠ¤èµ„æºçš„è®¿é—®ç­–ç•¥ï¼Œé€šè¿‡SecurityMetadataSourceè·å–ã€‚<br>
<strong>decideæ¥å£å°±æ˜¯ç”¨æ¥é‰´å®šå½“å‰ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®å¯¹åº”å—ä¿æŠ¤èµ„æºçš„æƒé™ã€‚</strong></p>
<h4 id="æˆæƒå†³ç­–">æˆæƒå†³ç­–</h4>
<p>AccessDecisionManageré‡‡ç”¨<strong>æŠ•ç¥¨</strong>çš„æ–¹å¼æ¥ç¡®å®šæ˜¯å¦èƒ½å¤Ÿè®¿é—®å—ä¿æŠ¤èµ„æºã€‚<br>
AccessDecisionManagerä¸­åŒ…å«çš„ä¸€ç³»åˆ—AccessDecisionVoterå°†ä¼šè¢«ç”¨æ¥å¯¹Authenticationæ˜¯å¦æœ‰æƒè®¿é—®å—ä¿æŠ¤å¯¹è±¡è¿›è¡ŒæŠ•ç¥¨ï¼ŒAccessDecisionManageræ ¹æ®æŠ•ç¥¨ç»“æœï¼Œåšå‡ºæœ€ç»ˆå†³ç­–ã€‚<br>
AccessDecisionVoteræ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶ä¸­å®šä¹‰æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼Œå…·ä½“ç»“æ„å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<pre><code class="language-java">public interface AccessDecisionVoter&lt;S&gt; { 
    int ACCESS_GRANTED = 1; 
    int ACCESS_ABSTAIN = 0; 
    int ACCESS_DENIED = â€1; 
    boolean supports(ConfigAttribute var1); 
    boolean supports(Class&lt;?&gt; var1); 
    int vote(Authentication var1, S var2, Collection&lt;ConfigAttribute&gt; var3); 
}
</code></pre>
<p>vote()æ–¹æ³•çš„è¿”å›ç»“æœä¼šæ˜¯AccessDecisionVoterä¸­å®šä¹‰çš„ä¸‰ä¸ªå¸¸é‡ä¹‹ä¸€ã€‚ACCESS_GRANTEDè¡¨ç¤ºåŒæ„ï¼ŒACCESS_DENIEDè¡¨ç¤ºæ‹’ç»ï¼ŒACCESS_ABSTAINè¡¨ç¤ºå¼ƒæƒã€‚å¦‚æœä¸€ä¸ªAccessDecisionVoterä¸èƒ½åˆ¤å®šå½“å‰Authenticationæ˜¯å¦æ‹¥æœ‰è®¿é—®å¯¹åº”å—ä¿æŠ¤å¯¹è±¡çš„æƒé™ï¼Œåˆ™å…¶vote()æ–¹æ³•çš„è¿”å›å€¼åº”å½“ä¸ºå¼ƒæƒACCESS_ABSTAINã€‚<br>
Spring Securityå†…ç½®äº†ä¸‰ä¸ªåŸºäºæŠ•ç¥¨çš„AccessDecisionManagerå®ç°ç±»å¦‚ä¸‹ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯<br>
<strong>AffirmativeBased</strong>ã€<strong>ConsensusBased</strong>å’Œ<strong>UnanimousBased</strong>ï¼Œ<strong>Spring securityé»˜è®¤ä½¿ç”¨çš„æ˜¯AffirmativeBasedã€‚</strong></p>
<p><strong>AffirmativeBased</strong>ï¼š</p>
<ol>
<li>åªè¦æœ‰AccessDecisionVoterçš„æŠ•ç¥¨ä¸ºACCESS_GRANTEDåˆ™åŒæ„ç”¨æˆ·è¿›è¡Œè®¿é—®ï¼›</li>
<li>å¦‚æœå…¨éƒ¨å¼ƒæƒä¹Ÿè¡¨ç¤ºé€šè¿‡ï¼›</li>
<li>å¦‚æœæ²¡æœ‰ä¸€ä¸ªäººæŠ•èµæˆç¥¨ï¼Œä½†æ˜¯æœ‰äººæŠ•åå¯¹ç¥¨ï¼Œåˆ™å°†æŠ›å‡ºAccessDeniedExceptionã€‚</li>
</ol>
<p><strong>ConsensusBased</strong>ï¼š</p>
<ol>
<li>å¦‚æœèµæˆç¥¨å¤šäºåå¯¹ç¥¨åˆ™è¡¨ç¤ºé€šè¿‡ã€‚</li>
<li>åè¿‡æ¥ï¼Œå¦‚æœåå¯¹ç¥¨å¤šäºèµæˆç¥¨åˆ™å°†æŠ›å‡ºAccessDeniedExceptionã€‚</li>
<li>å¦‚æœèµæˆç¥¨ä¸åå¯¹ç¥¨ç›¸åŒä¸”ä¸ç­‰äº0ï¼Œå¹¶ä¸”å±æ€§allowIfEqualGrantedDeniedDecisionsçš„å€¼ä¸ºtrueï¼Œåˆ™è¡¨ç¤ºé€šè¿‡ï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸AccessDeniedExceptionã€‚å‚æ•°allowIfEqualGrantedDeniedDecisionsçš„å€¼é»˜è®¤ä¸ºtrueã€‚</li>
<li>å¦‚æœæ‰€æœ‰çš„AccessDecisionVoteréƒ½å¼ƒæƒäº†ï¼Œåˆ™å°†è§†å‚æ•°allowIfAllAbstainDecisionsçš„å€¼è€Œå®šï¼Œå¦‚æœè¯¥å€¼ä¸ºtrueåˆ™è¡¨ç¤ºé€šè¿‡ï¼Œå¦åˆ™å°†æŠ›å‡ºå¼‚å¸¸AccessDeniedExceptionã€‚å‚æ•°allowIfAllAbstainDecisionsçš„å€¼é»˜è®¤ä¸ºfalseã€‚</li>
</ol>
<p><strong>UnanimousBased</strong>:<br>
UnanimousBasedä¸å¦å¤–ä¸¤ç§å®ç°æœ‰ç‚¹ä¸ä¸€æ ·ï¼Œå¦å¤–ä¸¤ç§ä¼šä¸€æ¬¡æ€§æŠŠå—ä¿æŠ¤å¯¹è±¡çš„é…ç½®å±æ€§å…¨éƒ¨ä¼ é€’ç»™AccessDecisionVoterè¿›è¡ŒæŠ•ç¥¨ï¼Œè€ŒUnanimousBasedä¼šä¸€æ¬¡åªä¼ é€’ä¸€ä¸ªConfifigAttributeç»™AccessDecisionVoterè¿›è¡ŒæŠ•ç¥¨ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€å¦‚æœæˆ‘ä»¬çš„AccessDecisionVoterçš„é€»è¾‘æ˜¯åªè¦ä¼ é€’è¿›æ¥çš„ ConfifigAttributeä¸­æœ‰ä¸€ä¸ªèƒ½å¤ŸåŒ¹é…åˆ™æŠ•èµæˆç¥¨ï¼Œä½†æ˜¯æ”¾åˆ°UnanimousBasedä¸­å…¶æŠ•ç¥¨ç»“æœå°±ä¸ä¸€å®šæ˜¯èµæˆäº†ã€‚</p>
<ol>
<li>å¦‚æœå—ä¿æŠ¤å¯¹è±¡é…ç½®çš„æŸä¸€ä¸ªConfifigAttributeè¢«ä»»æ„çš„AccessDecisionVoteråå¯¹äº†ï¼Œåˆ™å°†æŠ›å‡ºAccessDeniedExceptionã€‚</li>
<li>å¦‚æœæ²¡æœ‰åå¯¹ç¥¨ï¼Œä½†æ˜¯æœ‰èµæˆç¥¨ï¼Œåˆ™è¡¨ç¤ºé€šè¿‡ã€‚</li>
<li>å¦‚æœå…¨éƒ¨å¼ƒæƒäº†ï¼Œåˆ™å°†è§†å‚æ•°allowIfAllAbstainDecisionsçš„å€¼è€Œå®šï¼Œtrueåˆ™é€šè¿‡ï¼Œfalseåˆ™æŠ›å‡º AccessDeniedExceptionã€‚<br>
Spring Securityä¹Ÿå†…ç½®ä¸€äº›æŠ•ç¥¨è€…å®ç°ç±»å¦‚<strong>RoleVoter</strong>ã€<strong>AuthenticatedVoter</strong>å’Œ<strong>WebExpressionVoter</strong>ç­‰ã€‚</li>
</ol>
<h2 id="è‡ªå®šä¹‰è®¤è¯">è‡ªå®šä¹‰è®¤è¯</h2>
<h3 id="åˆ›å»ºæ•°æ®åº“è¡¨">åˆ›å»ºæ•°æ®åº“è¡¨</h3>
<pre><code class="language-sql">CREATE DATABASE `test` CHARACTER SET 'utf8' COLLATE 'utf8_general_ci';
CREATE TABLE `t_user` ( 
    `id` bigint(20) NOT NULL COMMENT 'ç”¨æˆ·id', 
    `username` varchar(64) NOT NULL, 
    `password` varchar(64) NOT NULL, 
    `fullname` varchar(255) NOT NULL COMMENT 'ç”¨æˆ·å§“å', 
    `mobile` varchar(11) DEFAULT NULL COMMENT 'æ‰‹æœºå·', 
    PRIMARY KEY (`id`) USING BTREE 
) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC
</code></pre>
<h3 id="æ·»åŠ æ‰€éœ€ä¾èµ–">æ·»åŠ æ‰€éœ€ä¾èµ–</h3>
<pre><code class="language-xml">        &lt;!-- spring security ä¾èµ– --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- webæ”¯æŒ --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- mysqlä¾èµ– --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;version&gt;5.1.47&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- mybatis --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.1.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- lombok å·¥å…·--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;!-- å•å…ƒæµ‹è¯• --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt;
                    &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
</code></pre>
<h3 id="é…ç½®applicationyml">é…ç½®application.yml</h3>
<pre><code class="language-yaml">spring:
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/test?useUnicode=true&amp;zeroDateTimeBehavior=convertToNull&amp;autoReconnect=true&amp;characterEncoding=utf-8
    username: root
    password: root
    hikari:
      minimum-idle: 5
      idle-timeout: 600000
      maximum-pool-size: 10
      auto-commit: true
      pool-name: MyHikariCP
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1
</code></pre>
<h3 id="ä¿®æ”¹springboot-å¯åŠ¨ç±»">ä¿®æ”¹springboot å¯åŠ¨ç±»</h3>
<pre><code class="language-java">import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
@MapperScan(basePackages = &quot;com.ldx.springboot.dao&quot;)
public class SpringbootSpringSecurityApplication {

    public static void main(String[] args) {
        SpringApplication.run(SpringbootSpringSecurityApplication.class, args);
    }
}
</code></pre>
<h3 id="åˆ›å»ºsecurityconfig">åˆ›å»ºsecurityConfig</h3>
<pre><code class="language-java">/**
 * springsecurity é…ç½®ç±»
 * @author ludangxin
 * @Date 2020-06-01
 **/
@Configuration
@EnableGlobalMethodSecurity(securedEnabled = true,prePostEnabled = true)
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

    /**
     * å¯†ç ç¼–ç å™¨
     */
    @Bean public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    /**
     * å®‰å…¨æ‹¦æˆªæœºåˆ¶ï¼ˆæœ€é‡è¦ï¼‰
     */
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.
                //å±è”½CSRFæ§åˆ¶ï¼Œå³spring securityä¸å†é™åˆ¶CSRF
                csrf().disable().
                authorizeRequests()
                .antMatchers(&quot;/r/r1&quot;).hasAuthority(&quot;p1&quot;)
                .antMatchers(&quot;/r/r2&quot;).hasAuthority(&quot;p2&quot;)
                //æ‰€æœ‰çš„è¯·æ±‚å¿…é¡»é€šè¿‡è®¤è¯
                .anyRequest().authenticated()
                .and()
                //å…è®¸è¡¨å•ç™»å½•
                .formLogin()
                //è‡ªå®šä¹‰ç™»å½•æˆåŠŸçš„é¡µé¢åœ°å€
                .successForwardUrl(&quot;/login-success&quot;);
    }
}
</code></pre>
<h3 id="åˆ›å»ºmodel">åˆ›å»ºmodel</h3>
<pre><code class="language-java">import lombok.Data;

@Data
public class UserDto {

    private String id;

    private String username;

    private String password;

    private String fullname;

    private String mobile;
}
</code></pre>
<h3 id="åˆ›å»ºcontroller">åˆ›å»ºcontroller</h3>
<pre><code class="language-java">import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class LoginController {

    /**
     *  ç”¨æˆ·ç™»å½•æˆåŠŸ
    */
    @RequestMapping(value = &quot;/login-success&quot;)
    public String loginSuccess() {
        String username = getUsername();
        return username + &quot; ç™»å½•æˆåŠŸ&quot;;
    }

    /**
     *  è·å–å½“å‰ç™»å½•ç”¨æˆ·å
     */
    private String getUsername() {
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        if (!authentication.isAuthenticated()) {
            return null;
        }
        Object principal = authentication.getPrincipal();
        String username = null;
        if (principal instanceof org.springframework.security.core.userdetails.UserDetails) {
            username = ((org.springframework.security.core.userdetails.UserDetails) principal).getUsername();
        } else {
            username = principal.toString();
        }
        return username;
    }

    /**
     * æµ‹è¯•èµ„æº1
     */
    @GetMapping(value = &quot;/r/r1&quot;)
    public String r1() {
        String username = getUsername();
        return username + &quot; è®¿é—®èµ„æº1&quot;;
    }

    /**
     * æµ‹è¯•èµ„æº2
     */
    @GetMapping(value = &quot;/r/r2&quot;)
    public String r2() {
        String username = getUsername();
        return username + &quot; è®¿é—®èµ„æº2&quot;;
    }
}
</code></pre>
<h3 id="åˆ›å»ºuserdetailsservice">åˆ›å»ºuserdetailsService</h3>
<pre><code class="language-java">import com.ldx.springboot.dao.UserMapper;
import com.ldx.springboot.model.UserDto;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;

@Service
public class SpringDataUserDetailsService implements UserDetailsService {

    @Autowired
    UserMapper userMapper;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        //ç™»å½•è´¦å·
        System.out.println(&quot;username=&quot; + username);
        //æ ¹æ®è´¦å·å»æ•°æ®åº“æŸ¥è¯¢...
        UserDto user = userMapper.getUserByUsername(username);
        if (user == null) {
            return null;
        }
        //è¿™é‡Œæš‚æ—¶ä½¿ç”¨é™æ€æ•°æ®
        UserDetails userDetails = User.withUsername(user.getFullname()).password(user.getPassword()).authorities(&quot;p1&quot;).build();
        return userDetails;
    }
}
</code></pre>
<h3 id="åˆ›å»ºmapper">åˆ›å»ºmapper</h3>
<pre><code class="language-java">import com.ldx.springboot.model.UserDto;
import org.apache.ibatis.annotations.Select;

public interface UserMapper {

    @Select(&quot;select id,username,password,fullname from t_user where username = #{username}&quot;)
    UserDto getUserByUsername(String username);
}
</code></pre>
<h3 id="åˆ›å»ºbcryptå¯†ç æµ‹è¯•ç±»">åˆ›å»ºBCryptå¯†ç æµ‹è¯•ç±»</h3>
<pre><code class="language-java">import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.security.crypto.bcrypt.BCrypt;
import org.springframework.test.context.junit4.SpringRunner;

@RunWith(SpringRunner.class)
public class TestBCrypt {

    @Test
    public void test1(){ 
        //å¯¹åŸå§‹å¯†ç åŠ å¯† 
        String hashpw = BCrypt.hashpw(&quot;123&quot;,BCrypt.gensalt());
        System.out.println(hashpw);
        //æ ¡éªŒåŸå§‹å¯†ç å’ŒBCryptå¯†ç æ˜¯å¦ä¸€è‡´ 
        boolean checkpw = BCrypt.checkpw(&quot;123&quot;, &quot;$2a$10$NlBC84MVb7F95EXYTXwLneXgCca6/GipyWR5NHm8K0203bSQMLpvm&quot;); 
        System.out.println(checkpw); 
    } 
}
</code></pre>
<h3 id="æµ‹è¯•ç»“æœ">æµ‹è¯•ç»“æœ</h3>
<ol>
<li>ä½¿ç”¨BCryptå¯†ç æµ‹è¯•ç±»ç”ŸæˆæŒ‡å®šå¯†ç ä¸”å°†ç”¨æˆ·ä¿¡æ¯å†™å…¥æ•°æ®åº“ç”¨æˆ·è¡¨</li>
<li>å¯åŠ¨é¡¹ç›®è®¿é—®<code>localhost:8080</code></li>
<li>è¾“å…¥ç”¨æˆ·åå¯†ç è¿›è¡Œæµ‹è¯•</li>
<li>æš‚æ—¶ä½¿ç”¨é™æ€æƒé™æ•°æ®,æµ‹è¯•<code>r/r1</code>: æ­£å¸¸,<code>r/r2</code>:æ— æƒé™</li>
</ol>
<h2 id="ä¼šè¯">ä¼šè¯</h2>
<p>ç”¨æˆ·è®¤è¯é€šè¿‡åï¼Œä¸ºäº†é¿å…ç”¨æˆ·çš„æ¯æ¬¡æ“ä½œéƒ½è¿›è¡Œè®¤è¯å¯å°†ç”¨æˆ·çš„ä¿¡æ¯ä¿å­˜åœ¨ä¼šè¯ä¸­ã€‚spring securityæä¾›ä¼šè¯ç®¡ç†ï¼Œè®¤è¯é€šè¿‡åå°†èº«ä»½ä¿¡æ¯æ”¾å…¥SecurityContextHolderä¸Šä¸‹æ–‡ï¼ŒSecurityContextä¸å½“å‰çº¿ç¨‹è¿›è¡Œç»‘å®šï¼Œæ–¹ä¾¿è·å–ç”¨æˆ·èº«ä»½ã€‚</p>
<h3 id="è·å–å½“å‰ç”¨æˆ·å">è·å–å½“å‰ç”¨æˆ·å</h3>
<pre><code class="language-java">/**
     *  è·å–å½“å‰ç™»å½•ç”¨æˆ·å
     */
    private String getUsername() {
        Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
        if (!authentication.isAuthenticated()) {
            return null;
        }
        Object principal = authentication.getPrincipal();
        String username = null;
        if (principal instanceof org.springframework.security.core.userdetails.UserDetails) {
            username = ((org.springframework.security.core.userdetails.UserDetails) principal).getUsername();
        } else {
            username = principal.toString();
        }
        return username;
    }
</code></pre>
<h3 id="ä¼šè¯æ§åˆ¶">ä¼šè¯æ§åˆ¶</h3>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹é€‰é¡¹å‡†ç¡®æ§åˆ¶ä¼šè¯ä½•æ—¶åˆ›å»ºä»¥åŠSpring Securityå¦‚ä½•ä¸ä¹‹äº¤äº’ï¼š</p>
<table>
<thead>
<tr>
<th>æœºåˆ¶</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>always</td>
<td>å¦‚æœæ²¡æœ‰sessionå­˜åœ¨å°±åˆ›å»ºä¸€ä¸ª</td>
</tr>
<tr>
<td>ifRequired</td>
<td>å¦‚æœéœ€è¦å°±åˆ›å»ºä¸€ä¸ªSessionï¼ˆé»˜è®¤ï¼‰ç™»å½•æ—¶</td>
</tr>
<tr>
<td>never</td>
<td>SpringSecurity å°†ä¸ä¼šåˆ›å»ºSessionï¼Œä½†æ˜¯å¦‚æœåº”ç”¨ä¸­å…¶ä»–åœ°æ–¹åˆ›å»ºäº†Sessionï¼Œé‚£ä¹ˆSpringSecurityå°†ä¼šä½¿ç”¨å®ƒã€‚</td>
</tr>
<tr>
<td>stateles</td>
<td>SpringSecurityå°†ç»å¯¹ä¸ä¼šåˆ›å»ºSessionï¼Œä¹Ÿä¸ä½¿ç”¨Session</td>
</tr>
</tbody>
</table>
<p>é€šè¿‡ä»¥ä¸‹é…ç½®æ–¹å¼å¯¹è¯¥é€‰é¡¹è¿›è¡Œé…ç½®ï¼š</p>
<pre><code class="language-java">@Override 
protected void configure(HttpSecurity http) throws Exception { 
    http.sessionManagement() .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED) 
}
</code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Securityä¼šä¸ºæ¯ä¸ªç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¼šæ–°å»ºä¸€ä¸ªSessionï¼Œå°±æ˜¯<strong>ifRequired</strong> ã€‚<br>
è‹¥é€‰ç”¨<strong>never</strong>ï¼Œåˆ™æŒ‡ç¤ºSpring Securityå¯¹ç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¸åˆ›å»ºSessionäº†ï¼Œä½†è‹¥ä½ çš„åº”ç”¨ç¨‹åºåœ¨æŸåœ°æ–¹æ–°å»ºäº†sessionï¼Œé‚£ä¹ˆSpring Securityä¼šç”¨å®ƒçš„ã€‚<br>
è‹¥ä½¿ç”¨<strong>stateless</strong>ï¼Œåˆ™è¯´æ˜Spring Securityå¯¹ç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¸ä¼šåˆ›å»ºSessionäº†ï¼Œä½ çš„åº”ç”¨ç¨‹åºä¹Ÿä¸ä¼šå…è®¸æ–°å»ºsessionã€‚å¹¶ä¸”å®ƒä¼šæš—ç¤ºä¸ä½¿ç”¨cookieï¼Œæ‰€ä»¥æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦é‡æ–°è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¿™ç§æ— çŠ¶æ€æ¶æ„é€‚ç”¨äºREST APIåŠå…¶æ— çŠ¶æ€è®¤è¯æœºåˆ¶ã€‚</p>
<h3 id="ä¼šè¯è¶…æ—¶">ä¼šè¯è¶…æ—¶</h3>
<p>å¯ä»¥å†sevletå®¹å™¨ä¸­è®¾ç½®Sessionçš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚ä¸‹è®¾ç½®Sessionæœ‰æ•ˆæœŸä¸º3600sï¼›<br>
springbooté…ç½®:</p>
<pre><code class="language-properties">server.servlet.session.timeout=3600s
</code></pre>
<p>sessionè¶…æ—¶ä¹‹åï¼Œå¯ä»¥é€šè¿‡Spring Security è®¾ç½®è·³è½¬çš„è·¯å¾„ã€‚</p>
<pre><code class="language-java">http.sessionManagement() 
    .expiredUrl(&quot;/loginâ€view?error=EXPIRED_SESSION&quot;) 
    .invalidSessionUrl(&quot;/loginâ€view?error=INVALID_SESSION&quot;);
</code></pre>
<p>expiredæŒ‡sessionè¿‡æœŸï¼ŒinvalidSessionæŒ‡ä¼ å…¥çš„sessionidæ— æ•ˆã€‚</p>
<h3 id="å®‰å…¨ä¼šè¯cookie">å®‰å…¨ä¼šè¯cookie</h3>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨httpOnlyå’Œsecureæ ‡ç­¾æ¥ä¿æŠ¤æˆ‘ä»¬çš„ä¼šè¯cookieï¼š<br>
<strong>httpOnly</strong>ï¼šå¦‚æœä¸ºtrueï¼Œé‚£ä¹ˆæµè§ˆå™¨è„šæœ¬å°†æ— æ³•è®¿é—®cookie<br>
<strong>secure</strong>ï¼šå¦‚æœä¸ºtrueï¼Œåˆ™cookieå°†ä»…é€šè¿‡HTTPSè¿æ¥å‘é€<br>
spring boot é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="language-properties">server.servlet.session.cookie.httpâ€only=true 
server.servlet.session.cookie.secure=true
</code></pre>
<h2 id="é€€å‡º">é€€å‡º</h2>
<p>Spring securityé»˜è®¤å®ç°äº†logouté€€å‡ºï¼Œè®¿é—®<code>/logout</code>å®ç°é€€å‡ºæ“ä½œã€‚<br>
è¿™é‡Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰é€€å‡ºæˆåŠŸçš„é¡µé¢ï¼š<br>
åœ¨WebSecurityConfifigçš„protected void confifigure(HttpSecurity http)ä¸­é…ç½®ï¼š</p>
<pre><code class="language-java">.and() 
    .logout() 
    .logoutUrl(&quot;/logout&quot;) 
    .logoutSuccessUrl(&quot;/loginâ€view?logout&quot;);
</code></pre>
<p>å½“é€€å‡ºæ“ä½œå‡ºå‘æ—¶ï¼Œå°†å‘ç”Ÿï¼š</p>
<ul>
<li>ä½¿HTTP Session æ— æ•ˆ</li>
<li>æ¸…é™¤ SecurityContextHolder</li>
<li>è·³è½¬åˆ° /login-view?logout<br>
ä½†æ˜¯ï¼Œç±»ä¼¼äºé…ç½®ç™»å½•åŠŸèƒ½ï¼Œå’±ä»¬å¯ä»¥è¿›ä¸€æ­¥è‡ªå®šä¹‰é€€å‡ºåŠŸèƒ½ï¼š</li>
</ul>
<pre><code class="language-java">@Override protected void configure(HttpSecurity http) throws Exception { 
    http 
        .authorizeRequests() //... 
        .and() 
        .logout() (1) 
        .logoutUrl(&quot;/logout&quot;) (2) 
        .logoutSuccessUrl(&quot;/loginâ€view?logout&quot;) (3) 
        .logoutSuccessHandler(logoutSuccessHandler) (4) 
        .addLogoutHandler(logoutHandler) (5) 
        .invalidateHttpSession(true); (6) }
</code></pre>
<p>ï¼ˆ1ï¼‰æä¾›ç³»ç»Ÿé€€å‡ºæ”¯æŒï¼Œä½¿ç”¨ WebSecurityConfigurerAdapter ä¼šè‡ªåŠ¨è¢«åº”ç”¨<br>
ï¼ˆ2ï¼‰è®¾ç½®è§¦å‘é€€å‡ºæ“ä½œçš„URL (é»˜è®¤æ˜¯ /logout ).<br>
ï¼ˆ3ï¼‰é€€å‡ºä¹‹åè·³è½¬çš„URLã€‚é»˜è®¤æ˜¯ /login?logout ã€‚<br>
ï¼ˆ4ï¼‰å®šåˆ¶çš„ LogoutSuccessHandler ï¼Œç”¨äºå®ç°ç”¨æˆ·é€€å‡ºæˆåŠŸæ—¶çš„å¤„ç†ã€‚å¦‚æœæŒ‡å®šäº†è¿™ä¸ªé€‰é¡¹é‚£ä¹ˆlogoutSuccessUrl() çš„è®¾ç½®ä¼šè¢«å¿½ç•¥ã€‚<br>
ï¼ˆ5ï¼‰æ·»åŠ ä¸€ä¸ª LogoutHandler ï¼Œç”¨äºå®ç°ç”¨æˆ·é€€å‡ºæ—¶çš„æ¸…ç†å·¥ä½œ.é»˜è®¤ SecurityContextLogoutHandler ä¼šè¢«æ·»åŠ ä¸ºæœ€åä¸€ä¸ª LogoutHandler ã€‚<br>
ï¼ˆ6ï¼‰æŒ‡å®šæ˜¯å¦åœ¨é€€å‡ºæ—¶è®© HttpSession æ— æ•ˆã€‚ é»˜è®¤è®¾ç½®ä¸º <strong>true</strong>ã€‚<br>
<strong>æ³¨æ„ï¼šå¦‚æœè®©logoutåœ¨GETè¯·æ±‚ä¸‹ç”Ÿæ•ˆï¼Œå¿…é¡»å…³é—­é˜²æ­¢CSRFæ”»å‡»csrf().disable()ã€‚å¦‚æœå¼€å¯äº†CSRFï¼Œå¿…é¡»ä½¿ç”¨postæ–¹å¼è¯·æ±‚/logout</strong><br>
<strong>logoutHandlerï¼š</strong><br>
ä¸€èˆ¬æ¥è¯´ï¼Œ LogoutHandler çš„å®ç°ç±»è¢«ç”¨æ¥æ‰§è¡Œå¿…è¦çš„æ¸…ç†ï¼Œå› è€Œä»–ä»¬ä¸åº”è¯¥æŠ›å‡ºå¼‚å¸¸ã€‚<br>
ä¸‹é¢æ˜¯Spring Securityæä¾›çš„ä¸€äº›å®ç°ï¼š</p>
<ol>
<li>PersistentTokenBasedRememberMeServices åŸºäºæŒä¹…åŒ–tokençš„<strong>RememberMe</strong>åŠŸèƒ½çš„ç›¸å…³æ¸…ç†</li>
<li>TokenBasedRememberMeService åŸºäºtokençš„<strong>RememberMe</strong>åŠŸèƒ½çš„ç›¸å…³æ¸…ç†</li>
<li>CookieClearingLogoutHandler é€€å‡ºæ—¶Cookieçš„ç›¸å…³æ¸…ç†</li>
<li>CsrfLogoutHandler è´Ÿè´£åœ¨é€€å‡ºæ—¶ç§»é™¤csrfToken</li>
<li>SecurityContextLogoutHandler é€€å‡ºæ—¶SecurityContextçš„ç›¸å…³æ¸…ç†<br>
é“¾å¼APIæä¾›äº†è°ƒç”¨ç›¸åº”çš„ LogoutHandler å®ç°çš„å¿«æ·æ–¹å¼ï¼Œæ¯”å¦‚deleteCookies()ã€‚</li>
</ol>
<h2 id="è‡ªå®šä¹‰æˆæƒ">è‡ªå®šä¹‰æˆæƒ</h2>
<p>æˆæƒçš„æ–¹å¼åŒ…æ‹¬ webæˆæƒå’Œæ–¹æ³•æˆæƒï¼Œwebæˆæƒæ˜¯é€šè¿‡ urlæ‹¦æˆªè¿›è¡Œæˆæƒï¼Œæ–¹æ³•æˆæƒæ˜¯é€šè¿‡ æ–¹æ³•æ‹¦æˆªè¿›è¡Œæˆæƒã€‚ä»–ä»¬éƒ½ä¼šè°ƒç”¨accessDecisionManagerè¿›è¡Œæˆæƒå†³ç­–ï¼Œè‹¥ä¸ºwebæˆæƒåˆ™æ‹¦æˆªå™¨ä¸ºFilterSecurityInterceptorï¼›è‹¥ä¸ºæ–¹æ³•æˆæƒåˆ™æ‹¦æˆªå™¨ä¸ºMethodSecurityInterceptorã€‚å¦‚æœåŒæ—¶é€šè¿‡webæˆæƒå’Œæ–¹æ³•æˆæƒåˆ™å…ˆæ‰§è¡Œwebæˆæƒï¼Œå†æ‰§è¡Œæ–¹æ³•æˆæƒï¼Œæœ€åå†³ç­–é€šè¿‡ï¼Œåˆ™å…è®¸è®¿é—®èµ„æºï¼Œå¦åˆ™å°†ç¦æ­¢è®¿é—®ã€‚</p>
<h3 id="åˆ›å»ºæ•°æ®åº“è¡¨-2">åˆ›å»ºæ•°æ®åº“è¡¨</h3>
<pre><code class="language-sql"># è§’è‰²è¡¨
CREATE TABLE `t_role` ( 
    `id` varchar(32) NOT NULL, 
    `role_name` varchar(255) DEFAULT NULL,
    `description` varchar(255) DEFAULT NULL, 
    `create_time` datetime DEFAULT NULL,
    `update_time` datetime DEFAULT NULL, 
    `status` char(1) NOT NULL, PRIMARY KEY (`id`), 
    UNIQUE KEY `unique_role_name` (`role_name`) 
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
    insert into 
    `t_role`
    (`id`,`role_name`,`description`,`create_time`,`update_time`,`status`)
    values 
    ('1','ç®¡ç†å‘˜',NULL,NULL,NULL,'');
# ç”¨æˆ·è§’è‰²å…³ç³»è¡¨
CREATE TABLE `t_user_role` (
    `user_id` varchar(32) NOT NULL,
    `role_id` varchar(32) NOT NULL, 
    `create_time` datetime DEFAULT NULL,
    `creator` varchar(255) DEFAULT NULL, 
    PRIMARY KEY (`user_id`,`role_id`) 
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
    insert into 
    `t_user_role`
    (`user_id`,`role_id`,`create_time`,`creator`)
    values 
    ('1','1',NULL,NULL);
# æƒé™è¡¨
CREATE TABLE `t_permission`( 
    `id` varchar(32) NOT NULL, 
    `code` varchar(32) NOT NULL COMMENT 'æƒé™æ ‡è¯†ç¬¦', 
    `description` varchar(64) DEFAULT NULL COMMENT 'æè¿°', 
    `url` varchar(128) DEFAULT NULL COMMENT 'è¯·æ±‚åœ°å€', PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
    insert into 
    `t_permission`
    (`id`,`code`,`description`,`url`)
    values 
    ('1','p1','æµ‹è¯•èµ„æº 1','/r/r1'),('2','p3','æµ‹è¯•èµ„æº2','/r/r2');
# è§’è‰²æƒé™å…³ç³»è¡¨
CREATE TABLE `t_role_permission` ( 
    `role_id` varchar(32) NOT NULL,
    `permission_id` varchar(32) NOT NULL, 
    PRIMARY KEY (`role_id`,`permission_id`) 
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
    insert into 
    `t_role_permission`
    (`role_id`,`permission_id`)
    values 
    ('1','1'),('1','2');
</code></pre>
<h3 id="åˆ›å»ºmodel-2">åˆ›å»ºmodel</h3>
<pre><code class="language-java">import lombok.Data;

@Data
public class PermissionDto {

    private String id;

    private String code;

    private String description;

    private String url;
}
</code></pre>
<h3 id="ä¿®æ”¹userdatailsservice">ä¿®æ”¹userdatailsService</h3>
<pre><code class="language-java">import com.ldx.springboot.dao.PermissionMapper;
import com.ldx.springboot.dao.UserMapper;
import com.ldx.springboot.model.PermissionDto;
import com.ldx.springboot.model.UserDto;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;
import java.util.List;
import java.util.stream.Collectors;

@Service
public class SpringDataUserDetailsService implements UserDetailsService {

    @Autowired
    UserMapper userMapper;

    @Autowired
    PermissionMapper permissionMapper;

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        //ç™»å½•è´¦å·
        System.out.println(&quot;username=&quot; + username);
        //æ ¹æ®è´¦å·å»æ•°æ®åº“æŸ¥è¯¢...
        UserDto user = userMapper.getUserByUsername(username);
        if (user == null) {
            return null;
        }
        //æŸ¥è¯¢ç”¨æˆ·æƒé™
        List&lt;PermissionDto&gt; permissions = permissionMapper.findPermissionsByUserId(user.getId());
        List&lt;String&gt; permissionCodes = permissions.stream().map(PermissionDto::getCode).collect(Collectors.toList());
        String[] permissionCodeArr = permissionCodes.toArray(new String[permissionCodes.size()]);
        //åˆ›å»ºuserDetails
        UserDetails userDetails = User.withUsername(user.getFullname()).password(user.getPassword()).authorities(permissionCodeArr).build();
        return userDetails;
    }
}
</code></pre>
<h3 id="åˆ›å»ºmapper-2">åˆ›å»ºmapper</h3>
<pre><code class="language-java">import com.ldx.springboot.model.PermissionDto;
import org.apache.ibatis.annotations.Select;

import java.util.List;

public interface PermissionMapper {

    @Select(&quot;SELECT * FROM t_permission WHERE id &quot; +
            &quot;IN(SELECT permission_id FROM t_role_permission WHERE role_id &quot; +
            &quot;IN(SELECT role_id FROM t_user_role WHERE user_id = #{id}))&quot;)
    List&lt;PermissionDto&gt; findPermissionsByUserId(String id);
}
</code></pre>
<h3 id="æµ‹è¯•-2">æµ‹è¯•</h3>
<ol>
<li>å¯åŠ¨é¡¹ç›®è®¿é—®<code>localhost:8080</code></li>
<li>ç™»é™†ç”¨æˆ·</li>
<li>æµ‹è¯•è®¿é—®<code>r/r1</code>,<code>r/r2</code> èµ„æº</li>
</ol>
<h2 id="webæˆæƒ">webæˆæƒ</h2>
<p>åœ¨ä¸Šé¢ä¾‹å­ä¸­æˆ‘ä»¬å®Œæˆäº†è®¤è¯æ‹¦æˆªï¼Œå¹¶å¯¹/r/**ä¸‹çš„æŸäº›èµ„æºè¿›è¡Œç®€å•çš„æˆæƒä¿æŠ¤ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è¿›è¡Œçµæ´»çš„æˆæƒæ§åˆ¶è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé€šè¿‡ç»™ http.authorizeRequests() æ·»åŠ å¤šä¸ªå­èŠ‚ç‚¹æ¥å®šåˆ¶éœ€æ±‚åˆ°æˆ‘ä»¬çš„URLï¼Œå¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-java">@Override protected void configure(HttpSecurity http) throws Exception { 
    http 
        .authorizeRequests() (1) 
        .antMatchers(&quot;/r/r1&quot;)
        .hasAuthority(&quot;p1&quot;) (2) 
        .antMatchers(&quot;/r/r2&quot;)
        .hasAuthority(&quot;p2&quot;) (3) 
        .antMatchers(&quot;/r/r3&quot;)
        .access(&quot;hasAuthority('p1') and hasAuthority('p2')&quot;) (4) 
        .antMatchers(&quot;/r/**&quot;)
        .authenticated() (5) 
        .anyRequest().permitAll() (6) 
        .and() .formLogin() 
        // ... 
}
</code></pre>
<p>ï¼ˆ1ï¼‰ http.authorizeRequests() æ–¹æ³•æœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼Œæ¯ä¸ªmacheræŒ‰ç…§ä»–ä»¬çš„å£°æ˜é¡ºåºæ‰§è¡Œã€‚</p>
<p>ï¼ˆ2ï¼‰æŒ‡å®š&quot;/r/r1&quot;URLï¼Œæ‹¥æœ‰p1æƒé™èƒ½å¤Ÿè®¿é—®</p>
<p>ï¼ˆ3ï¼‰æŒ‡å®š&quot;/r/r2&quot;URLï¼Œæ‹¥æœ‰p2æƒé™èƒ½å¤Ÿè®¿é—®</p>
<p>ï¼ˆ4ï¼‰æŒ‡å®šäº†&quot;/r/r3&quot;URLï¼ŒåŒæ—¶æ‹¥æœ‰p1å’Œp2æƒé™æ‰èƒ½å¤Ÿè®¿é—®</p>
<p>ï¼ˆ5ï¼‰æŒ‡å®šäº†é™¤äº†r1ã€r2ã€r3ä¹‹å¤–&quot;/r/**&quot;èµ„æºï¼ŒåŒæ—¶é€šè¿‡èº«ä»½è®¤è¯å°±èƒ½å¤Ÿè®¿é—®ï¼Œè¿™é‡Œä½¿ç”¨SpELï¼ˆSpring Expression Languageï¼‰è¡¨è¾¾å¼ã€‚ã€‚</p>
<p>ï¼ˆ6ï¼‰å‰©ä½™çš„å°šæœªåŒ¹é…çš„èµ„æºï¼Œä¸åšä¿æŠ¤ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<p><strong>è§„åˆ™çš„é¡ºåºæ˜¯é‡è¦çš„,æ›´å…·ä½“çš„è§„åˆ™åº”è¯¥å…ˆå†™</strong>.ç°åœ¨ä»¥/ adminå¼€å§‹çš„æ‰€æœ‰å†…å®¹éƒ½éœ€è¦å…·æœ‰ADMINè§’è‰²çš„èº«ä»½éªŒè¯ç”¨</p>
<p>æˆ·,å³ä½¿æ˜¯/ admin / loginè·¯å¾„(å› ä¸º/ admin / loginå·²ç»è¢«/ admin / **è§„åˆ™åŒ¹é…,å› æ­¤ç¬¬äºŒä¸ªè§„åˆ™è¢«å¿½ç•¥).</p>
<pre><code class="language-java">.antMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;) 
.antMatchers(&quot;/admin/login&quot;).permitAll()
</code></pre>
<p>å› æ­¤,ç™»å½•é¡µé¢çš„è§„åˆ™åº”è¯¥åœ¨/ admin / **è§„åˆ™ä¹‹å‰.ä¾‹å¦‚.</p>
<pre><code class="language-java">.antMatchers(&quot;/admin/login&quot;).permitAll() 
.antMatchers(&quot;/admin/**&quot;).hasRole(&quot;ADMIN&quot;)
</code></pre>
<p>ä¿æŠ¤URLå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>authenticated()</strong></td>
<td>ä¿æŠ¤URLï¼Œéœ€è¦ç”¨æˆ·ç™»å½•</td>
</tr>
<tr>
<td><strong>permitAll()</strong></td>
<td>æŒ‡å®šURLæ— éœ€ä¿æŠ¤ï¼Œä¸€èˆ¬åº”ç”¨ä¸é™æ€èµ„æºæ–‡ä»¶</td>
</tr>
<tr>
<td><strong>hasRole(String role)</strong></td>
<td>é™åˆ¶å•ä¸ªè§’è‰²è®¿é—®ï¼Œè§’è‰²å°†è¢«å¢åŠ  â€œROLE_â€ .æ‰€ä»¥â€ADMINâ€ å°†å’Œ â€œROLE_ADMINâ€è¿›è¡Œæ¯”è¾ƒ.</td>
</tr>
<tr>
<td><strong>hasAuthority(String authority)</strong></td>
<td>é™åˆ¶å•ä¸ªæƒé™è®¿é—®</td>
</tr>
<tr>
<td><strong>hasAnyRole(Stringâ€¦ roles)</strong></td>
<td>å…è®¸å¤šä¸ªè§’è‰²è®¿é—®.</td>
</tr>
<tr>
<td><strong>hasAnyAuthority(Stringâ€¦ authorities)</strong></td>
<td>å…è®¸å¤šä¸ªæƒé™è®¿é—®.</td>
</tr>
<tr>
<td><strong>access(String attribute)</strong></td>
<td>è¯¥æ–¹æ³•ä½¿ç”¨ SpELè¡¨è¾¾å¼, æ‰€ä»¥å¯ä»¥åˆ›å»ºå¤æ‚çš„é™åˆ¶.</td>
</tr>
<tr>
<td><strong>hasIpAddress(String ipaddressExpression)</strong></td>
<td>é™åˆ¶IPåœ°å€æˆ–å­ç½‘</td>
</tr>
</tbody>
</table>
<h2 id="æ–¹æ³•æˆæƒ">æ–¹æ³•æˆæƒ</h2>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æŒæ¡äº†ä½¿ç”¨å¦‚ä½•ä½¿ç”¨ http.authorizeRequests() å¯¹webèµ„æºè¿›è¡Œæˆæƒä¿æŠ¤ï¼Œä»Spring Security2.0ç‰ˆ æœ¬å¼€å§‹ï¼Œå®ƒæ”¯æŒæœåŠ¡å±‚æ–¹æ³•çš„å®‰å…¨æ€§çš„æ”¯æŒã€‚æœ¬èŠ‚å­¦ä¹ @PreAuthorize,@PostAuthorize, @Securedä¸‰ç±»æ³¨è§£ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½• @Configuration å®ä¾‹ä¸Šä½¿ç”¨ @EnableGlobalMethodSecurity æ³¨é‡Šæ¥å¯ç”¨åŸºäºæ³¨è§£çš„å®‰å…¨æ€§ã€‚ä»¥ä¸‹å†…å®¹å°†å¯ç”¨Spring Securityçš„ @Secured æ³¨é‡Šã€‚</p>
<pre><code class="language-java">@EnableGlobalMethodSecurity(securedEnabled = true) 
public class MethodSecurityConfig {
    // ...
}
</code></pre>
<p>ç„¶åå‘æ–¹æ³•ï¼ˆåœ¨ç±»æˆ–æ¥å£ä¸Šï¼‰æ·»åŠ æ³¨è§£å°±ä¼šé™åˆ¶å¯¹è¯¥æ–¹æ³•çš„è®¿é—®ã€‚ Spring Securityçš„åŸç”Ÿæ³¨é‡Šæ”¯æŒä¸ºè¯¥æ–¹æ³•å®šä¹‰äº†ä¸€ç»„å±æ€§ã€‚ è¿™äº›å°†è¢«ä¼ é€’ç»™AccessDecisionManagerä»¥ä¾›å®ƒä½œå‡ºå®é™…çš„å†³å®šï¼š</p>
<pre><code class="language-java">public interface BankService { 
    @Secured(&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;) 
    public Account readAccount(Long id); 
    @Secured(&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;) 
    public Account[] findAccounts();
    @Secured(&quot;ROLE_TELLER&quot;) 
    public Account post(Account account, double amount); 
}
</code></pre>
<p>ä»¥ä¸Šé…ç½®æ ‡æ˜readAccountã€findAccountsæ–¹æ³•å¯åŒ¿åè®¿é—®ï¼Œåº•å±‚ä½¿ç”¨WebExpressionVoteræŠ•ç¥¨å™¨ï¼Œå¯ä» AffirmativeBasedç¬¬23è¡Œä»£ç è·Ÿè¸ªã€‚ã€‚</p>
<p>postæ–¹æ³•éœ€è¦æœ‰TELLERè§’è‰²æ‰èƒ½è®¿é—®ï¼Œåº•å±‚ä½¿ç”¨RoleVoteræŠ•ç¥¨å™¨ã€‚</p>
<p>ä½¿ç”¨å¦‚ä¸‹ä»£ç å¯å¯ç”¨prePostæ³¨è§£çš„æ”¯æŒ</p>
<pre><code class="language-java">@EnableGlobalMethodSecurity(prePostEnabled = true)
public class MethodSecurityConfig { 
    // ... 
}
</code></pre>
<p>ç›¸åº”Javaä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-java">public interface BankService { 
    @PreAuthorize(&quot;isAnonymous()&quot;) 
    public Account readAccount(Long id);
    @PreAuthorize(&quot;isAnonymous()&quot;)
    public Account[] findAccounts(); 
    @PreAuthorize(&quot;hasAuthority('p_transfer') and hasAuthority('p_read_account')&quot;) 
    public Account post(Account account, double amount); 
}
</code></pre>
<p>ä»¥ä¸Šé…ç½®æ ‡æ˜readAccountã€findAccountsæ–¹æ³•å¯åŒ¿åè®¿é—®ï¼Œpostæ–¹æ³•éœ€è¦åŒæ—¶æ‹¥æœ‰p_transferå’Œp_read_account æƒé™æ‰èƒ½è®¿é—®ï¼Œåº•å±‚ä½¿ç”¨WebExpressionVoteræŠ•ç¥¨å™¨ï¼Œå¯ä»AffirmativeBasedç¬¬23è¡Œä»£ç è·Ÿè¸ªã€‚</p>

                        </div>
                        
                            <div class="post-toc">
                                <ul class="markdownIt-TOC">
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%AE%A4%E8%AF%81">ä»€ä¹ˆæ˜¯è®¤è¯</a></li>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E4%BC%9A%E8%AF%9D">ä»€ä¹ˆæ˜¯ä¼šè¯</a>
<ul>
<li><a href="#session-%E4%BC%9A%E8%AF%9D">session ä¼šè¯</a></li>
<li><a href="#token-%E4%BC%9A%E8%AF%9D">token ä¼šè¯</a></li>
</ul>
</li>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%8E%88%E6%9D%83">ä»€ä¹ˆæ˜¯æˆæƒ</a></li>
<li><a href="#springsecurity">SpringSecurity</a>
<ul>
<li><a href="#%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B">å¿«é€Ÿä¸Šæ‰‹</a>
<ul>
<li><a href="#%E5%BC%95%E5%85%A5%E6%89%80%E9%9C%80%E4%BE%9D%E8%B5%96">å¼•å…¥æ‰€éœ€ä¾èµ–</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0spring-security-%E9%85%8D%E7%BD%AE%E7%B1%BB">æ·»åŠ spring security é…ç½®ç±»</a></li>
<li><a href="#%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3">ç¼–å†™æµ‹è¯•æ¥å£</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95">æµ‹è¯•</a></li>
<li><a href="#%E5%B0%8F%E7%BB%93">å°ç»“</a></li>
</ul>
</li>
<li><a href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">å·¥ä½œåŸç†</a>
<ul>
<li><a href="#%E7%BB%93%E6%9E%84%E6%80%BB%E8%A7%88">ç»“æ„æ€»è§ˆ</a></li>
<li><a href="#%E8%AE%A4%E8%AF%81">è®¤è¯</a>
<ul>
<li><a href="#%E6%B5%81%E7%A8%8B">æµç¨‹</a></li>
<li><a href="#authenticationprovider">AuthenticationProvider</a></li>
<li><a href="#userdetailsservice">UserDetailsService</a></li>
<li><a href="#passwordencoder">PasswordEncoder</a></li>
</ul>
</li>
<li><a href="#%E6%8E%88%E6%9D%83">æˆæƒ</a>
<ul>
<li><a href="#%E6%B5%81%E7%A8%8B-2">æµç¨‹</a></li>
<li><a href="#%E6%8E%88%E6%9D%83%E5%86%B3%E7%AD%96">æˆæƒå†³ç­–</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%A4%E8%AF%81">è‡ªå®šä¹‰è®¤è¯</a>
<ul>
<li><a href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8">åˆ›å»ºæ•°æ®åº“è¡¨</a></li>
<li><a href="#%E6%B7%BB%E5%8A%A0%E6%89%80%E9%9C%80%E4%BE%9D%E8%B5%96">æ·»åŠ æ‰€éœ€ä¾èµ–</a></li>
<li><a href="#%E9%85%8D%E7%BD%AEapplicationyml">é…ç½®application.yml</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9springboot-%E5%90%AF%E5%8A%A8%E7%B1%BB">ä¿®æ”¹springboot å¯åŠ¨ç±»</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAsecurityconfig">åˆ›å»ºsecurityConfig</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAmodel">åˆ›å»ºmodel</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAcontroller">åˆ›å»ºcontroller</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAuserdetailsservice">åˆ›å»ºuserdetailsService</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAmapper">åˆ›å»ºmapper</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAbcrypt%E5%AF%86%E7%A0%81%E6%B5%8B%E8%AF%95%E7%B1%BB">åˆ›å»ºBCryptå¯†ç æµ‹è¯•ç±»</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C">æµ‹è¯•ç»“æœ</a></li>
</ul>
</li>
<li><a href="#%E4%BC%9A%E8%AF%9D">ä¼šè¯</a>
<ul>
<li><a href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E7%94%A8%E6%88%B7%E5%90%8D">è·å–å½“å‰ç”¨æˆ·å</a></li>
<li><a href="#%E4%BC%9A%E8%AF%9D%E6%8E%A7%E5%88%B6">ä¼šè¯æ§åˆ¶</a></li>
<li><a href="#%E4%BC%9A%E8%AF%9D%E8%B6%85%E6%97%B6">ä¼šè¯è¶…æ—¶</a></li>
<li><a href="#%E5%AE%89%E5%85%A8%E4%BC%9A%E8%AF%9Dcookie">å®‰å…¨ä¼šè¯cookie</a></li>
</ul>
</li>
<li><a href="#%E9%80%80%E5%87%BA">é€€å‡º</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%88%E6%9D%83">è‡ªå®šä¹‰æˆæƒ</a>
<ul>
<li><a href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8-2">åˆ›å»ºæ•°æ®åº“è¡¨</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAmodel-2">åˆ›å»ºmodel</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9userdatailsservice">ä¿®æ”¹userdatailsService</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAmapper-2">åˆ›å»ºmapper</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95-2">æµ‹è¯•</a></li>
</ul>
</li>
<li><a href="#web%E6%8E%88%E6%9D%83">webæˆæƒ</a></li>
<li><a href="#%E6%96%B9%E6%B3%95%E6%8E%88%E6%9D%83">æ–¹æ³•æˆæƒ</a></li>
</ul>
</li>
</ul>

                            </div>
                            
                                
                                    
                                        <!--en-->
                                        <section class="post-copyright en">
                                            <p class="copyright-item">
                                                <span>Author:</span>
                                                <span>æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚</span>
                                            </p>

                                            <p class="copyright-item">
                                                <span>Permalink:</span>
                                                <span><a href="http://blog.ludangxin.club/post/spring-security-xiang-jie-ji-kuai-su-shang-shou/">http://blog.ludangxin.club/post/spring-security-xiang-jie-ji-kuai-su-shang-shou/</a></span>
                                            </p>

                                            <p class="copyright-item">
                                                <span>License:</span>
                                                <span>MIT License</span>
                                            </p>
                                        </section>
                                        
                                                
                                                    
                                                        <!-- Share-->
                                                        <span style="margin-right:15px">
                                                    <i class="post-share"></i>
                                                    <span>Share:</span>
                                                        <a title="QR Code" target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://blog.ludangxin.club/post/spring-security-xiang-jie-ji-kuai-su-shang-shou/"><i class="fa fa-qrcode"></i></a>
                                                        <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.ludangxin.club/post/spring-security-xiang-jie-ji-kuai-su-shang-shou/&sharesource=qzone&title=Spring Security è¯¦è§£ åŠ å¿«é€Ÿä¸Šæ‰‹&pics=http://blog.ludangxin.club/images/avatar.png?v=1597935637693&summary="><i class="fa fa-qq"></i></a>
                                                        <a title="Weibo" target="_blank" href="https://service.weibo.com/share/share.php?url=http://blog.ludangxin.club/post/spring-security-xiang-jie-ji-kuai-su-shang-shou/&sharesource=weibo&title=Spring Security è¯¦è§£ åŠ å¿«é€Ÿä¸Šæ‰‹ + " - " + &pic="http://blog.ludangxin.club/images/avatar.png?v=1597935637693 "><i class="fa fa-weibo "></i></a>
                                                        
                                                                </span>
                                                                <!--en-->
                                                                <section class="post-tags en ">
                                                                    <div>
                                                                        <span>Tag(s):</span>
                                                                        <span class="tag ">
                        
                        
                        <a href="http://blog.ludangxin.club/tag/LSBz4Ej4I/">#
                                                springboot
                                                    </a>
                                                    
                                                        
                                                            </span>
                                                                    </div>
                                                                    <div>
                                                                        <a href="javascript:window.history.back();">back</a>
                                                                        <span>&dot;</span>
                                                                        <a href="#">home</a>
                                                                    </div>
                                                                </section>
                                                                
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                        <a class="prev" rel="prev" href="http://blog.ludangxin.club/post/oauth20/">
                                                                                            OAuth2.0
                                                                                        </a>
                                                                                        
                                                                                            
                                                                                                <a class="next" rel="next" href="http://blog.ludangxin.club/post/chu-shi-dubbo/">
                                                                                                    åˆè¯† Dubbo
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                
                                            
                                                <script type="application/javascript" src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
<div id="vlaine-comment"></div>
<script type="application/javascript">
    new Valine({
        el: '#vlaine-comment',
        appId: '6v8KE1xPEnnI3VycbaTHPQvD-gzGzoHsz',
        appKey: 'tCAPkuAx3JWn7YrPKlEpyaMH',
        pageSize: 10,
        avatar: 'mp',
        placeholder: 'æ¥éƒ½æ¥äº†ï¼Œä¸å¦¨è¯„è®ºä¸€ä¸‹',
        visitor: true,
        highlight: false,
        recordIP: true,
    })
</script>
                                                    
            </div>
    </div>
    </div>
    </div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                    <div class="Like">
                        <div class="tip" data-tooltip="Do you like it?">
                            <a href="https://github.com/ITJoker233/Gridea-theme-Chic" target="_blank" title=""><svg class="icon"
                        aria-hidden="true">
                        <use xlink:href="#like"></use>
                    </svg><b class="like_text" id="star"></b></a>
                        </div>
                    </div>
                    
                        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
                            
                                <b id="hitokoto"></b><br>
                                
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚ &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://coding.net" target="_blank">
                                                Coding.net
                                            </a>
            </div>
            <div id="update" style="display:none;">
                on
            </div>
            
                <div id="version" style="display:none;">
                    1.7.4
                </div>
                
                    <script>
                        var port = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + port + '</div>')
                    </script>
        </footer>
        
            <script src='https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js'></script>
            
                <script>
                    
                    
                    loadlive2d();
                    
                    
                    hitokoto();
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    CheckVersion();
                    
                    var newDate = new Date();
                    newDate.setTime(1597935637693);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
        </div>
</body>
<script>
    scroll();
</script>

</html>