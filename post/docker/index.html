<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<meta name="author" content="é²æ¡£ä¿¡">
<meta name="description" content="Hello World !">
<meta name="keywords" content="é²æ¡£ä¿¡,ludangxin">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="http://blog.ludangxin.club/styles/main.css" />
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
        
            <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                <!--ç‚¹å‡»ç‰¹æ•ˆ-->
                <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/love.min.js"></script>
                
                        <!--CDNæ ·å¼-->
                        <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
                        <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
                        
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="http://blog.ludangxin.club">
                    æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚
                </a>
            </div>
            <div id="tp-weather-widget"></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/">
                        ğŸ é¦–é¡µ
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        ğŸ“šå½’æ¡£
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        ğŸ·ï¸æ ‡ç­¾
                    </a>
                    
                    <a class="menu-item" href="/posts">
                        âœï¸åšå®¢
                    </a>
                    
                    <a class="menu-item" href="/post/about/">
                        ğŸ‘¦å…³äº
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1598170590593" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="http://blog.ludangxin.club">
                            æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1598170590593" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/">
                            ğŸ é¦–é¡µ
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            ğŸ“šå½’æ¡£
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            ğŸ·ï¸æ ‡ç­¾
                        </a>
                        
                        <a class="menu-item" href="/posts">
                            âœï¸åšå®¢
                        </a>
                        
                        <a class="menu-item" href="/post/about/">
                            ğŸ‘¦å…³äº
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>



    <script>
        (function(a, h, g, f, e, d, c, b) {
            b = function() {
                d = h.createElement(g);
                c = h.getElementsByTagName(g)[0];
                d.src = e;
                d.charset = "utf-8";
                d.async = 1;
                c.parentNode.insertBefore(d, c)
            };
            a["SeniverseWeatherWidgetObject"] = f;
            a[f] || (a[f] = function() {
                (a[f].q = a[f].q || []).push(arguments)
            });
            a[f].l = +new Date();
            if (a.attachEvent) {
                a.attachEvent("onload", b)
            } else {
                a.addEventListener("load", b, false)
            }
        }(window, document, "script", "SeniverseWeatherWidget", "//cdn.sencdn.com/widget2/static/js/bundle.js?t=" + parseInt((new Date().getTime() / 100000000).toString(), 10)));
        window.SeniverseWeatherWidget('show', {
            flavor: "slim",
            location: "WWEFQFPJZ7T8",
            geolocation: true,
            language: "auto",
            unit: "c",
            theme: "auto",
            token: "61bcc333-3305-4728-9465-6785274bb0a3",
            hover: "enabled",
            container: "tp-weather-widget"
        })
    </script>
    
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                Docker
                            </h1>
                            
                                <!--en-->
                                <div class="post-meta en">
                                    Author:
                                    <a itemprop="author" rel="author" href="/">
                                        æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚
                                    </a>
                                    <span class="post-time">
                                Date: <a href="#">2020-05-16</a>
                            </span>
                                    <span class="post-readtime">Reading Time:<a
                                    href="#">85.4
                                    mins</a></span>
                                    <span class="post-words">words:<a href="#">20730</a></span>
                                    
                                        <span class="post-category">
                                Category:
                                
                                <a href="http://blog.ludangxin.club/tag/OMiYgbyBS/">å®¹å™¨æŠ€æœ¯</a>
                                
                            </span>
                                        
                                            Views:
                                            <span data-hk-page="current"> - </span>
                                            
                                </div>
                                
                        </header>
                        
                            <img class="post-feature-image" src="http://blog.ludangxin.club/post-images/docker.jpg" alt="">
                          
                        <div class="post-content">
                            <h1 id="ä¸ºä»€ä¹ˆéœ€è¦-docker">ä¸ºä»€ä¹ˆéœ€è¦ docker</h1>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<p>ä½œä¸ºä¸€ç§æ–°å…´çš„è™šæ‹ŸåŒ–æ–¹å¼ï¼ŒDocker è·Ÿä¼ ç»Ÿçš„è™šæ‹ŸåŒ–æ–¹å¼ç›¸æ¯”å…·æœ‰ä¼—å¤šçš„ä¼˜åŠ¿ã€‚</p>
<h2 id="æ›´é«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº">æ›´é«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº</h2>
<p>ç”±äºå®¹å™¨ä¸éœ€è¦è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿä»¥åŠè¿è¡Œå®Œæ•´æ“ä½œç³»ç»Ÿç­‰é¢å¤–å¼€é”€ï¼ŒDocker å¯¹ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡æ›´é«˜ã€‚æ— è®ºæ˜¯åº”ç”¨æ‰§è¡Œé€Ÿåº¦ã€å†…å­˜æŸè€—æˆ–è€…æ–‡ä»¶å­˜å‚¨é€Ÿåº¦ï¼Œéƒ½è¦æ¯”ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ›´é«˜æ•ˆã€‚å› æ­¤ï¼Œç›¸æ¯”è™šæ‹ŸæœºæŠ€æœ¯ï¼Œä¸€ä¸ªç›¸åŒé…ç½®çš„ä¸»æœºï¼Œå¾€å¾€å¯ä»¥è¿è¡Œæ›´å¤šæ•°é‡çš„åº”ç”¨ã€‚</p>
<h2 id="æ›´å¿«é€Ÿçš„å¯åŠ¨æ—¶é—´">æ›´å¿«é€Ÿçš„å¯åŠ¨æ—¶é—´</h2>
<p>ä¼ ç»Ÿçš„è™šæ‹ŸæœºæŠ€æœ¯å¯åŠ¨åº”ç”¨æœåŠ¡å¾€å¾€éœ€è¦æ•°åˆ†é’Ÿï¼Œè€Œ Docker å®¹å™¨åº”ç”¨ï¼Œç”±äºç›´æ¥è¿è¡Œäºå®¿ä¸»å†…æ ¸ï¼Œæ— éœ€å¯åŠ¨å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œå› æ­¤å¯ä»¥åšåˆ°ç§’çº§ã€ç”šè‡³æ¯«ç§’çº§çš„å¯åŠ¨æ—¶é—´ã€‚å¤§å¤§çš„èŠ‚çº¦äº†å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²çš„æ—¶é—´ã€‚</p>
<h2 id="ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ">ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ</h2>
<p>å¼€å‘è¿‡ç¨‹ä¸­ä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯ç¯å¢ƒä¸€è‡´æ€§é—®é¢˜ã€‚ç”±äºå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒä¸ä¸€è‡´ï¼Œå¯¼è‡´æœ‰äº› bug å¹¶æœªåœ¨å¼€å‘è¿‡ç¨‹ä¸­è¢«å‘ç°ã€‚è€Œ Docker çš„é•œåƒæä¾›äº†é™¤å†…æ ¸å¤–å®Œæ•´çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œç¡®ä¿äº†åº”ç”¨è¿è¡Œç¯å¢ƒä¸€è‡´æ€§ï¼Œä»è€Œä¸ä¼šå†å‡ºç° <strong>ã€Œè¿™æ®µä»£ç åœ¨æˆ‘æœºå™¨ä¸Šæ²¡é—®é¢˜å•Šã€</strong> è¿™ç±»é—®é¢˜ã€‚</p>
<h2 id="æŒç»­äº¤ä»˜å’Œéƒ¨ç½²">æŒç»­äº¤ä»˜å’Œéƒ¨ç½²</h2>
<p>å¯¹å¼€å‘å’Œè¿ç»´(DevOps)äººå‘˜æ¥è¯´ï¼Œæœ€å¸Œæœ›çš„å°±æ˜¯ä¸€æ¬¡åˆ›å»ºæˆ–é…ç½®ï¼Œå¯ä»¥åœ¨ä»»æ„åœ°æ–¹æ­£å¸¸è¿è¡Œã€‚</p>
<p>ä½¿ç”¨ Docker å¯ä»¥é€šè¿‡å®šåˆ¶åº”ç”¨é•œåƒæ¥å®ç°æŒç»­é›†æˆã€æŒç»­äº¤ä»˜ã€éƒ¨ç½²ã€‚å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡ <code>Dockerfile</code> æ¥è¿›è¡Œé•œåƒæ„å»ºï¼Œå¹¶ç»“åˆæŒç»­é›†æˆ(Continuous Integration)ç³»ç»Ÿè¿›è¡Œé›†æˆæµ‹è¯•ï¼Œè€Œè¿ç»´äººå‘˜åˆ™å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¿«é€Ÿéƒ¨ç½²è¯¥é•œåƒï¼Œç”šè‡³ç»“åˆ æŒç»­éƒ¨ç½²(Continuous Delivery/Deployment) ç³»ç»Ÿè¿›è¡Œè‡ªåŠ¨éƒ¨ç½²ã€‚</p>
<p>è€Œä¸”ä½¿ç”¨ <code>Dockerfile</code> ä½¿é•œåƒæ„å»ºé€æ˜åŒ–ï¼Œä¸ä»…ä»…å¼€å‘å›¢é˜Ÿå¯ä»¥ç†è§£åº”ç”¨è¿è¡Œç¯å¢ƒï¼Œä¹Ÿæ–¹ä¾¿è¿ç»´å›¢é˜Ÿç†è§£åº”ç”¨è¿è¡Œæ‰€éœ€æ¡ä»¶ï¼Œå¸®åŠ©æ›´å¥½çš„ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²è¯¥é•œåƒã€‚</p>
<h2 id="æ›´è½»æ¾çš„è¿ç§»">æ›´è½»æ¾çš„è¿ç§»</h2>
<p>ç”±äº Docker ç¡®ä¿äº†æ‰§è¡Œç¯å¢ƒçš„ä¸€è‡´æ€§ï¼Œä½¿å¾—åº”ç”¨çš„è¿ç§»æ›´åŠ å®¹æ˜“ã€‚Docker å¯ä»¥åœ¨å¾ˆå¤šå¹³å°ä¸Šè¿è¡Œï¼Œæ— è®ºæ˜¯ç‰©ç†æœºã€è™šæ‹Ÿæœºã€å…¬æœ‰äº‘ã€ç§æœ‰äº‘ï¼Œç”šè‡³æ˜¯ç¬”è®°æœ¬ï¼Œå…¶è¿è¡Œç»“æœæ˜¯ä¸€è‡´çš„ã€‚å› æ­¤ç”¨æˆ·å¯ä»¥å¾ˆè½»æ˜“çš„å°†åœ¨ä¸€ä¸ªå¹³å°ä¸Šè¿è¡Œçš„åº”ç”¨ï¼Œè¿ç§»åˆ°å¦ä¸€ä¸ªå¹³å°ä¸Šï¼Œè€Œä¸ç”¨æ‹…å¿ƒè¿è¡Œç¯å¢ƒçš„å˜åŒ–å¯¼è‡´åº”ç”¨æ— æ³•æ­£å¸¸è¿è¡Œçš„æƒ…å†µã€‚</p>
<h2 id="æ›´è½»æ¾çš„ç»´æŠ¤å’Œæ‰©å±•">æ›´è½»æ¾çš„ç»´æŠ¤å’Œæ‰©å±•</h2>
<p>Docker ä½¿ç”¨çš„åˆ†å±‚å­˜å‚¨ä»¥åŠé•œåƒçš„æŠ€æœ¯ï¼Œä½¿å¾—åº”ç”¨é‡å¤éƒ¨åˆ†çš„å¤ç”¨æ›´ä¸ºå®¹æ˜“ï¼Œä¹Ÿä½¿å¾—åº”ç”¨çš„ç»´æŠ¤æ›´æ–°æ›´åŠ ç®€å•ï¼ŒåŸºäºåŸºç¡€é•œåƒè¿›ä¸€æ­¥æ‰©å±•é•œåƒä¹Ÿå˜å¾—éå¸¸ç®€å•ã€‚æ­¤å¤–ï¼ŒDocker å›¢é˜ŸåŒå„ä¸ªå¼€æºé¡¹ç›®å›¢é˜Ÿä¸€èµ·ç»´æŠ¤äº†ä¸€å¤§æ‰¹é«˜è´¨é‡çš„å®˜æ–¹é•œåƒï¼Œæ—¢å¯ä»¥ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Œåˆå¯ä»¥ä½œä¸ºåŸºç¡€è¿›ä¸€æ­¥å®šåˆ¶ï¼Œå¤§å¤§çš„é™ä½äº†åº”ç”¨æœåŠ¡çš„é•œåƒåˆ¶ä½œæˆæœ¬ã€‚</p>
<h2 id="å¯¹æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ€»ç»“">å¯¹æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ€»ç»“</h2>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>å®¹å™¨</th>
<th>è™šæ‹Ÿæœº</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¯åŠ¨</td>
<td>ç§’çº§</td>
<td>åˆ†é’Ÿçº§</td>
</tr>
<tr>
<td>ç¡¬ç›˜ä½¿ç”¨</td>
<td>ä¸€èˆ¬ä¸º <code>MB</code></td>
<td>ä¸€èˆ¬ä¸º <code>GB</code></td>
</tr>
<tr>
<td>æ€§èƒ½</td>
<td>æ¥è¿‘åŸç”Ÿ</td>
<td>å¼±äº</td>
</tr>
<tr>
<td>ç³»ç»Ÿæ”¯æŒé‡</td>
<td>å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨</td>
<td>ä¸€èˆ¬å‡ åä¸ª</td>
</tr>
</tbody>
</table>
<h1 id="å®‰è£…docker">å®‰è£…docker</h1>
<h2 id="ubuntu">Ubuntu</h2>
<ul>
<li><code>apt-get remove docker docker-engine docker.io containerd runc</code> : å¸è½½æ—§ç‰ˆæœ¬docker</li>
<li><code>apt-get update</code>: æ›´æ–°æ•°æ®æº</li>
<li><code>apt-get -y install apt-transport-https ca-certificates curl software-properties-common</code>: å®‰è£…æ‰€éœ€ä¾èµ–</li>
<li><code>curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</code>:å®‰è£…GPGè¯ä¹¦(é˜²æ­¢ä¸‹è½½æ—¶è¢«äººç¯¡æ”¹)</li>
<li><code>add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;</code> : æ–°å¢æ•°æ®æº<code>lsb_release -cs</code>ä¸ºç³»ç»Ÿå˜é‡,å³å½“å‰ç³»ç»Ÿçš„codeName</li>
<li><code>apt-get update &amp;&amp; apt-get install -y docker-ce</code>: æ›´æ–°å¹¶å®‰è£…docker CE</li>
<li><code>docker version</code>:éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</li>
</ul>
<h3 id="å…¶å®ƒå®‰è£…æ–¹æ³•">å…¶å®ƒå®‰è£…æ–¹æ³•</h3>
<ul>
<li>å®‰è£…å‘½ä»¤</li>
</ul>
<pre><code>sudo apt install docker.io
</code></pre>
<ul>
<li>è§£å†³æ™®é€šç”¨æˆ·ä¸èƒ½ç›´æ¥ä½¿ç”¨ docker å‘½ä»¤</li>
</ul>
<pre><code class="language-bash">docker ps
Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.39/containers/json: dial unix /var/run/docker.sock: connect: permission denied
# åˆ›å»º docker ç”¨æˆ·ç»„
sudo groupadd docker
# æ·»åŠ å½“å‰ç”¨æˆ·åˆ° docker ç»„
sudo usermod -aG docker $USER
# é‡å¯ docker
sudo systemctl restart docker
newgrp - docker
# é‡å¯ç³»ç»Ÿ
sudo reboo
</code></pre>
<h1 id="é…ç½®dockeré•œåƒåŠ é€Ÿå™¨">é…ç½®dockeré•œåƒåŠ é€Ÿå™¨</h1>
<h2 id="é˜¿é‡Œäº‘åŠ é€Ÿå™¨æ¨è">é˜¿é‡Œäº‘åŠ é€Ÿå™¨(æ¨è)</h2>
<p><a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" title="é˜¿é‡Œäº‘dockeré•œåƒæœåŠ¡">é˜¿é‡Œäº‘dockeré•œåƒæœåŠ¡</a></p>
<h2 id="é…ç½®åŠ é€Ÿå™¨">é…ç½®åŠ é€Ÿå™¨</h2>
<p>ä¸€é…ç½®é˜¿é‡Œäº‘åŠ é€Ÿå™¨ä¸ºä¾‹,é¦–å…ˆç™»é™†é˜¿é‡Œäº‘,æœç´¢  <strong>å®¹å™¨é•œåƒæœåŠ¡</strong></p>
<figure data-type="image" tabindex="1"><img src="https://i.loli.net/2020/04/05/o7K5R6m4txCkyc8.png" alt="image.png" loading="lazy"></figure>
<p>æ‰¾åˆ°ä¸“å±åŠ é€Ÿå™¨</p>
<figure data-type="image" tabindex="2"><img src="https://i.loli.net/2020/04/05/MsQvd5w6AZPoXNy.png" alt="image.png" loading="lazy"></figure>
<p>é€šè¿‡ä¿®æ”¹daemoné…ç½®æ–‡ä»¶<code>etc/docker/daemon.json</code>æ¥ä½¿ç”¨åŠ é€Ÿå™¨</p>
<pre><code class="language-bash">sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
  &quot;registry-mirrors&quot;: [&quot;https://rwlvh3oh.mirror.aliyuncs.com&quot;]
}
EOF
# é‡å¯docker
sudo systemctl daemon-reload
sudo systemctl restart docker
</code></pre>
<h2 id="éªŒè¯é…ç½®æ˜¯å¦æˆåŠŸ">éªŒè¯é…ç½®æ˜¯å¦æˆåŠŸ</h2>
<pre><code class="language-bash">docker info

# è¾“å‡ºå†…å®¹å¦‚ä¸‹  æŸ¥çœ‹ Registry Mirrors
Client:
 Debug Mode: false

Server:
 Containers: 0
  Running: 0
  Paused: 0
  Stopped: 0
 Images: 0
 Server Version: 19.03.8
 Storage Driver: overlay2
  Backing Filesystem: &lt;unknown&gt;
  Supports d_type: true
  Native Overlay Diff: true
 Logging Driver: json-file
 Cgroup Driver: cgroupfs
 Plugins:
  Volume: local
  Network: bridge host ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file local logentries splunk syslog
 Swarm: inactive
 Runtimes: runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: 7ad184331fa3e55e52b890ea95e65ba581ae3429
 runc version: dc9208a3303feef5b3839f4323d9beb36df0a9dd
 init version: fec3683
 Security Options:
  apparmor
  seccomp
   Profile: default
 Kernel Version: 4.15.0-91-generic
 Operating System: Ubuntu 18.04.4 LTS
 OSType: linux
 Architecture: x86_64
 CPUs: 2
 Total Memory: 1.924GiB
 Name: ubuntu
 ID: ZGXE:UIHK:ZE57:G66R:37US:RT7C:CPHN:IS7Y:AAIG:POEL:UOHA:DBQ3
 Docker Root Dir: /var/lib/docker
 Debug Mode: false
 Registry: https://index.docker.io/v1/
 Labels:
 Experimental: false
 Insecure Registries:
  127.0.0.0/8
 Registry Mirrors:
  https://rwlvh3oh.mirror.aliyuncs.com/
 Live Restore Enabled: false
</code></pre>
<h1 id="docker-æ¦‚è¿°">docker æ¦‚è¿°</h1>
<h2 id="docker-å¼•æ“">Docker å¼•æ“</h2>
<p>Docker å¼•æ“æ˜¯ä¸€ä¸ªåŒ…å«ä»¥ä¸‹ä¸»è¦ç»„ä»¶çš„å®¢æˆ·ç«¯æœåŠ¡å™¨åº”ç”¨ç¨‹åºã€‚</p>
<ul>
<li>ä¸€ç§æœåŠ¡å™¨ï¼Œå®ƒæ˜¯ä¸€ç§ç§°ä¸ºå®ˆæŠ¤è¿›ç¨‹å¹¶ä¸”é•¿æ—¶é—´è¿è¡Œçš„ç¨‹åºã€‚</li>
<li>REST API ç”¨äºæŒ‡å®šç¨‹åºå¯ä»¥ç”¨æ¥ä¸å®ˆæŠ¤è¿›ç¨‹é€šä¿¡çš„æ¥å£ï¼Œå¹¶æŒ‡ç¤ºå®ƒåšä»€ä¹ˆã€‚</li>
<li>ä¸€ä¸ªæœ‰å‘½ä»¤è¡Œç•Œé¢ (CLI) å·¥å…·çš„å®¢æˆ·ç«¯ã€‚</li>
</ul>
<h2 id="docker-æ¶æ„">Docker æ¶æ„</h2>
<ul>
<li>Docker ä½¿ç”¨å®¢æˆ·ç«¯ - æœåŠ¡å™¨ (C/S) æ¶æ„æ¨¡å¼ï¼Œä½¿ç”¨è¿œç¨‹ API æ¥ç®¡ç†å’Œåˆ›å»º Docker å®¹å™¨ã€‚</li>
<li>Docker å®¹å™¨é€šè¿‡ Docker é•œåƒæ¥åˆ›å»ºã€‚</li>
<li>å®¹å™¨ä¸é•œåƒçš„å…³ç³»ç±»ä¼¼äºé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„å¯¹è±¡ä¸ç±»ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th>Docker</th>
<th>é¢å‘å¯¹è±¡</th>
</tr>
</thead>
<tbody>
<tr>
<td>å®¹å™¨</td>
<td>å¯¹è±¡</td>
</tr>
<tr>
<td>é•œåƒ</td>
<td>ç±»</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>æ ‡é¢˜</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>é•œåƒ(Images)</td>
<td>Docker é•œåƒæ˜¯ç”¨äºåˆ›å»º Docker å®¹å™¨çš„æ¨¡æ¿ã€‚</td>
</tr>
<tr>
<td>å®¹å™¨(Container)</td>
<td>å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ã€‚</td>
</tr>
<tr>
<td>å®¢æˆ·ç«¯(Client)</td>
<td>Docker å®¢æˆ·ç«¯é€šè¿‡å‘½ä»¤è¡Œæˆ–è€…å…¶ä»–å·¥å…·ä½¿ç”¨ Docker API https://docs.docker.com/reference/api/docker_remote_api ä¸ Docker çš„å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ã€‚</td>
</tr>
<tr>
<td>ä¸»æœº(Host)</td>
<td>ä¸€ä¸ªç‰©ç†æˆ–è€…è™šæ‹Ÿçš„æœºå™¨ç”¨äºæ‰§è¡Œ Docker å®ˆæŠ¤è¿›ç¨‹å’Œå®¹å™¨ã€‚</td>
</tr>
<tr>
<td>ä»“åº“(Registry)</td>
<td>Docker ä»“åº“ç”¨æ¥ä¿å­˜é•œåƒï¼Œå¯ä»¥ç†è§£ä¸ºä»£ç æ§åˆ¶ä¸­çš„ä»£ç ä»“åº“ã€‚Docker Hubhttps://hub.docker.comæä¾›äº†åºå¤§çš„é•œåƒé›†åˆä¾›ä½¿ç”¨ã€‚</td>
</tr>
<tr>
<td>Docker Machine</td>
<td>Docker Machineæ˜¯ä¸€ä¸ªç®€åŒ–Dockerå®‰è£…çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå³å¯åœ¨ç›¸åº”çš„å¹³å°ä¸Šå®‰è£…Dockerï¼Œæ¯”å¦‚VirtualBoxã€ Digital Oceanã€Microsoft Azureã€‚</td>
</tr>
</tbody>
</table>
<h1 id="æ“ä½œé•œåƒ">æ“ä½œé•œåƒ</h1>
<h2 id="è·å–é•œåƒ">è·å–é•œåƒ</h2>
<p>ä¹‹å‰æåˆ°è¿‡ï¼ŒDocker Hubä¸Šæœ‰å¤§é‡çš„é«˜è´¨é‡çš„é•œåƒå¯ä»¥ç”¨ï¼Œè¿™é‡Œæˆ‘ä»¬å°±è¯´ä¸€ä¸‹æ€ä¹ˆè·å–è¿™äº›é•œåƒã€‚</p>
<p>ä» Docker é•œåƒä»“åº“è·å–é•œåƒçš„å‘½ä»¤æ˜¯ <code>docker pull</code>ã€‚å…¶å‘½ä»¤æ ¼å¼ä¸ºï¼š</p>
<pre><code>docker pull [é€‰é¡¹] [Docker Registry åœ°å€[:ç«¯å£å·]/]ä»“åº“å[:æ ‡ç­¾]
</code></pre>
<p>å…·ä½“çš„é€‰é¡¹å¯ä»¥é€šè¿‡ <code>docker pull --help</code> å‘½ä»¤çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬è¯´ä¸€ä¸‹é•œåƒåç§°çš„æ ¼å¼ã€‚</p>
<ul>
<li><strong>é•œåƒä»“åº“åœ°å€ï¼š</strong> åœ°å€çš„æ ¼å¼ä¸€èˆ¬æ˜¯ <code>&lt;åŸŸå/IP&gt;[:ç«¯å£å·]</code>ã€‚é»˜è®¤åœ°å€æ˜¯ Docker Hubã€‚</li>
<li><strong>ä»“åº“åï¼š</strong> å¦‚ä¹‹å‰æ‰€è¯´ï¼Œè¿™é‡Œçš„ä»“åº“åæ˜¯ä¸¤æ®µå¼åç§°ï¼Œå³ <code>&lt;ç”¨æˆ·å&gt;/&lt;è½¯ä»¶å&gt;</code>ã€‚å¯¹äº Docker Hubï¼Œå¦‚æœä¸ç»™å‡ºç”¨æˆ·åï¼Œåˆ™é»˜è®¤ä¸º <code>library</code>ï¼Œä¹Ÿå°±æ˜¯å®˜æ–¹é•œåƒã€‚</li>
</ul>
<pre><code class="language-bash">docker pull nginx
# è¾“å‡ºå¦‚ä¸‹
Using default tag: latest
latest: Pulling from library/nginx
fc7181108d40: Pull complete 
c4277fc40ec2: Pull complete 
780053e98559: Pull complete 
Digest: sha256:bdbf36b7f1f77ffe7bd2a32e59235dff6ecf131e3b6b5b96061c652f30685f3a
Status: Downloaded newer image for nginx:latest
</code></pre>
<h2 id="åˆ—å‡ºé•œåƒ">åˆ—å‡ºé•œåƒ</h2>
<p>è¦æƒ³åˆ—å‡ºå·²ç»ä¸‹è½½ä¸‹æ¥çš„é•œåƒï¼Œå¯ä»¥ä½¿ç”¨ <code>docker image ls</code> å‘½ä»¤ã€‚</p>
<pre><code class="language-bash">docker image ls
# è¾“å‡ºå¦‚ä¸‹
REPOSITORY           TAG             IMAGE ID            CREATED     SIZE
redis              latest           5f515359c7f8        5 days ago   183 MB
nginx              latest           05a60462f8ba        5 days ago   181 MB
mongo               3.2             fe9198c04d62        5 days ago   342 MB
&lt;none&gt;             &lt;none&gt;           00285df0df87        5 days ago   342 MB
ubuntu             16.04            f753707788c5        4 weeks ago  127 MB
ubuntu             latest           f753707788c5        4 weeks ago  127 MB
ubuntu             14.04            1e0c3dd64ccd        4 weeks ago  188 MB
</code></pre>
<p>åˆ—è¡¨åŒ…å«äº† <code>ä»“åº“å</code>ã€<code>æ ‡ç­¾</code>ã€<code>é•œåƒ ID</code>ã€<code>åˆ›å»ºæ—¶é—´</code> ä»¥åŠ <code>æ‰€å ç”¨çš„ç©ºé—´</code>ã€‚</p>
<p>å…¶ä¸­ä»“åº“åã€æ ‡ç­¾åœ¨ä¹‹å‰çš„åŸºç¡€æ¦‚å¿µç« èŠ‚å·²ç»ä»‹ç»è¿‡äº†ã€‚<strong>é•œåƒ ID</strong> åˆ™æ˜¯é•œåƒçš„å”¯ä¸€æ ‡è¯†ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥å¯¹åº”å¤šä¸ª<strong>æ ‡ç­¾</strong>ã€‚å› æ­¤ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>ubuntu:16.04</code> å’Œ <code>ubuntu:latest</code> æ‹¥æœ‰ç›¸åŒçš„ IDï¼Œå› ä¸ºå®ƒä»¬å¯¹åº”çš„æ˜¯åŒä¸€ä¸ªé•œåƒã€‚</p>
<h2 id="é•œåƒä½“ç§¯">é•œåƒä½“ç§¯</h2>
<p>å¦‚æœä»”ç»†è§‚å¯Ÿï¼Œä¼šæ³¨æ„åˆ°ï¼Œè¿™é‡Œæ ‡è¯†çš„æ‰€å ç”¨ç©ºé—´å’Œåœ¨ Docker Hub ä¸Šçœ‹åˆ°çš„é•œåƒå¤§å°ä¸åŒã€‚æ¯”å¦‚ï¼Œ<code>ubuntu:16.04</code> é•œåƒå¤§å°ï¼Œåœ¨è¿™é‡Œæ˜¯ <code>127 MB</code>ï¼Œä½†æ˜¯åœ¨ Docker Hub æ˜¾ç¤ºçš„å´æ˜¯ <code>50 MB</code>ã€‚è¿™æ˜¯å› ä¸º Docker Hub ä¸­æ˜¾ç¤ºçš„ä½“ç§¯æ˜¯å‹ç¼©åçš„ä½“ç§¯ã€‚åœ¨é•œåƒä¸‹è½½å’Œä¸Šä¼ è¿‡ç¨‹ä¸­é•œåƒæ˜¯ä¿æŒç€å‹ç¼©çŠ¶æ€çš„ï¼Œå› æ­¤ Docker Hub æ‰€æ˜¾ç¤ºçš„å¤§å°æ˜¯ç½‘ç»œä¼ è¾“ä¸­æ›´å…³å¿ƒçš„æµé‡å¤§å°ã€‚è€Œ <code>docker image ls</code> æ˜¾ç¤ºçš„æ˜¯é•œåƒä¸‹è½½åˆ°æœ¬åœ°åï¼Œå±•å¼€çš„å¤§å°ï¼Œå‡†ç¡®è¯´ï¼Œæ˜¯å±•å¼€åçš„å„å±‚æ‰€å ç©ºé—´çš„æ€»å’Œï¼Œå› ä¸ºé•œåƒåˆ°æœ¬åœ°åï¼ŒæŸ¥çœ‹ç©ºé—´çš„æ—¶å€™ï¼Œæ›´å…³å¿ƒçš„æ˜¯æœ¬åœ°ç£ç›˜ç©ºé—´å ç”¨çš„å¤§å°ã€‚</p>
<p>å¦å¤–ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯ï¼Œ<code>docker image ls</code> åˆ—è¡¨ä¸­çš„é•œåƒä½“ç§¯æ€»å’Œå¹¶éæ˜¯æ‰€æœ‰é•œåƒå®é™…ç¡¬ç›˜æ¶ˆè€—ã€‚ç”±äº Docker é•œåƒæ˜¯å¤šå±‚å­˜å‚¨ç»“æ„ï¼Œå¹¶ä¸”å¯ä»¥ç»§æ‰¿ã€å¤ç”¨ï¼Œå› æ­¤ä¸åŒé•œåƒå¯èƒ½ä¼šå› ä¸ºä½¿ç”¨ç›¸åŒçš„åŸºç¡€é•œåƒï¼Œä»è€Œæ‹¥æœ‰å…±åŒçš„å±‚ã€‚ç”±äº Docker ä½¿ç”¨ Union FSï¼Œç›¸åŒçš„å±‚åªéœ€è¦ä¿å­˜ä¸€ä»½å³å¯ï¼Œå› æ­¤å®é™…é•œåƒç¡¬ç›˜å ç”¨ç©ºé—´å¾ˆå¯èƒ½è¦æ¯”è¿™ä¸ªåˆ—è¡¨é•œåƒå¤§å°çš„æ€»å’Œè¦å°çš„å¤šã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¥ä¾¿æ·çš„æŸ¥çœ‹é•œåƒã€å®¹å™¨ã€æ•°æ®å·æ‰€å ç”¨çš„ç©ºé—´ã€‚</p>
<pre><code class="language-bash">docker system df
# è¾“å‡ºå¦‚ä¸‹
TYPE                TOTAL        ACTIVE        SIZE            RECLAIMABLE
Images              24             0          1.992GB         1.992GB (100%)
Containers          1              0          62.82MB         62.82MB (100%)
Local Volumes       9              0          652.2MB         652.2MB (100%)
Build Cache         							 0B                  0B
</code></pre>
<h2 id="è™šæ‚¬é•œåƒ">è™šæ‚¬é•œåƒ</h2>
<p>ä¸Šé¢çš„é•œåƒåˆ—è¡¨ä¸­ï¼Œè¿˜å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç‰¹æ®Šçš„é•œåƒï¼Œè¿™ä¸ªé•œåƒæ—¢æ²¡æœ‰ä»“åº“åï¼Œä¹Ÿæ²¡æœ‰æ ‡ç­¾ï¼Œå‡ä¸º <code>&lt;none&gt;</code></p>
<pre><code class="language-bash">&lt;none&gt;         &lt;none&gt;         00285df0df87        5 days ago          342 MB
</code></pre>
<p>è¿™ä¸ªé•œåƒåŸæœ¬æ˜¯æœ‰é•œåƒåå’Œæ ‡ç­¾çš„ï¼ŒåŸæ¥ä¸º <code>mongo:3.2</code>ï¼Œéšç€å®˜æ–¹é•œåƒç»´æŠ¤ï¼Œå‘å¸ƒäº†æ–°ç‰ˆæœ¬åï¼Œé‡æ–° <code>docker pull mongo:3.2</code> æ—¶ï¼Œ<code>mongo:3.2</code> è¿™ä¸ªé•œåƒåè¢«è½¬ç§»åˆ°äº†æ–°ä¸‹è½½çš„é•œåƒèº«ä¸Šï¼Œè€Œæ—§çš„é•œåƒä¸Šçš„è¿™ä¸ªåç§°åˆ™è¢«å–æ¶ˆï¼Œä»è€Œæˆä¸ºäº† <code>&lt;none&gt;</code>ã€‚é™¤äº† <code>docker pull</code> å¯èƒ½å¯¼è‡´è¿™ç§æƒ…å†µï¼Œ<code>docker build</code> ä¹ŸåŒæ ·å¯ä»¥å¯¼è‡´è¿™ç§ç°è±¡ã€‚ç”±äºæ–°æ—§é•œåƒåŒåï¼Œæ—§é•œåƒåç§°è¢«å–æ¶ˆï¼Œä»è€Œå‡ºç°ä»“åº“åã€æ ‡ç­¾å‡ä¸º <code>&lt;none&gt;</code> çš„é•œåƒã€‚è¿™ç±»æ— æ ‡ç­¾é•œåƒä¹Ÿè¢«ç§°ä¸º <strong>è™šæ‚¬é•œåƒ(dangling image)</strong> ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ä¸“é—¨æ˜¾ç¤ºè¿™ç±»é•œåƒï¼š</p>
<pre><code class="language-bahs">docker image ls -f dangling=true
# è¾“å‡ºå¦‚ä¸‹
REPOSITORY     TAG         IMAGE ID       CREATED        SIZE
&lt;none&gt;        &lt;none&gt;     00285df0df87    5 days ago     342 MB
</code></pre>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œè™šæ‚¬é•œåƒå·²ç»å¤±å»äº†å­˜åœ¨çš„ä»·å€¼ï¼Œæ˜¯å¯ä»¥éšæ„åˆ é™¤çš„ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ é™¤ã€‚</p>
<pre><code>docker image prune
</code></pre>
<h2 id="ä¸­é—´å±‚é•œåƒ">ä¸­é—´å±‚é•œåƒ</h2>
<p>ä¸ºäº†åŠ é€Ÿé•œåƒæ„å»ºã€é‡å¤åˆ©ç”¨èµ„æºï¼ŒDocker ä¼šåˆ©ç”¨ <strong>ä¸­é—´å±‚é•œåƒ</strong>ã€‚æ‰€ä»¥åœ¨ä½¿ç”¨ä¸€æ®µæ—¶é—´åï¼Œå¯èƒ½ä¼šçœ‹åˆ°ä¸€äº›ä¾èµ–çš„ä¸­é—´å±‚é•œåƒã€‚é»˜è®¤çš„ <code>docker image ls</code> åˆ—è¡¨ä¸­åªä¼šæ˜¾ç¤ºé¡¶å±‚é•œåƒï¼Œå¦‚æœå¸Œæœ›æ˜¾ç¤ºåŒ…æ‹¬ä¸­é—´å±‚é•œåƒåœ¨å†…çš„æ‰€æœ‰é•œåƒçš„è¯ï¼Œéœ€è¦åŠ  <code>-a</code> å‚æ•°ã€‚</p>
<pre><code>docker image ls -a
</code></pre>
<p>è¿™æ ·ä¼šçœ‹åˆ°å¾ˆå¤šæ— æ ‡ç­¾çš„é•œåƒï¼Œä¸ä¹‹å‰çš„è™šæ‚¬é•œåƒä¸åŒï¼Œè¿™äº›æ— æ ‡ç­¾çš„é•œåƒå¾ˆå¤šéƒ½æ˜¯ä¸­é—´å±‚é•œåƒï¼Œæ˜¯å…¶å®ƒé•œåƒæ‰€ä¾èµ–çš„é•œåƒã€‚è¿™äº›æ— æ ‡ç­¾é•œåƒä¸åº”è¯¥åˆ é™¤ï¼Œå¦åˆ™ä¼šå¯¼è‡´ä¸Šå±‚é•œåƒå› ä¸ºä¾èµ–ä¸¢å¤±è€Œå‡ºé”™ã€‚å®é™…ä¸Šï¼Œè¿™äº›é•œåƒä¹Ÿæ²¡å¿…è¦åˆ é™¤ï¼Œå› ä¸ºä¹‹å‰è¯´è¿‡ï¼Œç›¸åŒçš„å±‚åªä¼šå­˜ä¸€éï¼Œè€Œè¿™äº›é•œåƒæ˜¯åˆ«çš„é•œåƒçš„ä¾èµ–ï¼Œå› æ­¤å¹¶ä¸ä¼šå› ä¸ºå®ƒä»¬è¢«åˆ—å‡ºæ¥è€Œå¤šå­˜äº†ä¸€ä»½ï¼Œæ— è®ºå¦‚ä½•ä½ ä¹Ÿä¼šéœ€è¦å®ƒä»¬ã€‚åªè¦åˆ é™¤é‚£äº›ä¾èµ–å®ƒä»¬çš„é•œåƒåï¼Œè¿™äº›ä¾èµ–çš„ä¸­é—´å±‚é•œåƒä¹Ÿä¼šè¢«è¿å¸¦åˆ é™¤ã€‚</p>
<h2 id="åˆ é™¤é•œåƒ">åˆ é™¤é•œåƒ</h2>
<p>å¦‚æœè¦åˆ é™¤æœ¬åœ°çš„é•œåƒï¼Œå¯ä»¥ä½¿ç”¨ <code>docker image rm</code> å‘½ä»¤ï¼Œå…¶æ ¼å¼ä¸ºï¼š</p>
<pre><code>docker image rm [é€‰é¡¹] &lt;é•œåƒ1&gt; [&lt;é•œåƒ2&gt; ...]
</code></pre>
<h3 id="ç”¨-id-é•œåƒå-æ‘˜è¦åˆ é™¤é•œåƒ">ç”¨ IDã€é•œåƒåã€æ‘˜è¦åˆ é™¤é•œåƒ</h3>
<p>å…¶ä¸­ï¼Œ<code>&lt;é•œåƒ&gt;</code> å¯ä»¥æ˜¯ <code>é•œåƒçŸ­ ID</code>ã€<code>é•œåƒé•¿ ID</code>ã€<code>é•œåƒå</code> æˆ–è€… <code>é•œåƒæ‘˜è¦</code>ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬æœ‰è¿™ä¹ˆä¸€äº›é•œåƒï¼š</p>
<pre><code class="language-bash">docker image ls
# è¾“å‡ºå¦‚ä¸‹
REPOSITORY           TAG        IMAGE ID        CREATED         SIZE
centos              latest     0584b3d2cf6d   3 weeks ago      196.5 MB
redis               alpine     501ad78535f0   3 weeks ago      21.03 MB
docker              latest     cf693ec9b5c7   3 weeks ago      105.1 MB
nginx               latest     e43d811ce2f4   5 weeks ago      181.5 MB
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥ç”¨é•œåƒçš„å®Œæ•´ IDï¼Œä¹Ÿç§°ä¸º <strong>é•¿ ID</strong>ï¼Œæ¥åˆ é™¤é•œåƒã€‚ä½¿ç”¨è„šæœ¬çš„æ—¶å€™å¯èƒ½ä¼šç”¨é•¿ IDï¼Œä½†æ˜¯äººå·¥è¾“å…¥å°±å¤ªç´¯äº†ï¼Œæ‰€ä»¥æ›´å¤šçš„æ—¶å€™æ˜¯ç”¨ <strong>çŸ­ ID</strong> æ¥åˆ é™¤é•œåƒã€‚<code>docker image ls</code> é»˜è®¤åˆ—å‡ºçš„å°±å·²ç»æ˜¯çŸ­ ID äº†ï¼Œä¸€èˆ¬å–å‰ 3 ä¸ªå­—ç¬¦ä»¥ä¸Šï¼Œåªè¦è¶³å¤ŸåŒºåˆ†äºåˆ«çš„é•œåƒå°±å¯ä»¥äº†ã€‚</p>
<p>æ¯”å¦‚è¿™é‡Œï¼Œå¦‚æœæˆ‘ä»¬è¦åˆ é™¤ <code>redis:alpine</code> é•œåƒï¼Œå¯ä»¥æ‰§è¡Œï¼š</p>
<pre><code>docker image rm 501
# è¾“å‡ºå¦‚ä¸‹
Untagged: redis:alpine
Untagged:redis@sha256:f1ed3708f538b537eb9c2a7dd50dc90a706f7debd7e1196c9264edeea521a86dDeleted:sha256:501ad78535f015d88872e13fa87a828425117e3d28075d0c117932b05bf189b7
Deleted:sha256:96167737e29ca8e9d74982ef2a0dda76ed7b430da55e321c071f0dbff8c2899b
Deleted:sha256:32770d1dcf835f192cafd6b9263b7b597a1778a403a109e2cc2ee866f74adf23
Deleted:sha256:127227698ad74a5846ff5153475e03439d96d4b1c7f2a449c7a826ef74a2d2fa
Deleted:sha256:1333ecc582459bac54e1437335c0816bc17634e131ea0cc48daa27d32c75eab3
Deleted: sha256:4fc455b921edf9c4aea207c51ab39b10b06540c8b4825ba57b3feed1668fa7c7
</code></pre>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨<code>é•œåƒå</code>ï¼Œä¹Ÿå°±æ˜¯ <code>&lt;ä»“åº“å&gt;:&lt;æ ‡ç­¾&gt;</code>ï¼Œæ¥åˆ é™¤é•œåƒã€‚</p>
<pre><code>docker image rm centos
# è¾“å‡ºå¦‚ä¸‹
Untagged: centos:latest
Untagged:centos@sha256:b2f9d1c0ff5f87a4743104d099a3d561002ac500db1b9bfa02a783a46e0d366c
Deleted:sha256:0584b3d2cf6d235ee310cf14b54667d889887b838d3f3d3033acd70fc3c48b8a
Deleted: sha256:97ca462ad9eeae25941546209454496e1d66749d53dfa2ee32bf1faabd239d38
</code></pre>
<p>å½“ç„¶ï¼Œæ›´ç²¾ç¡®çš„æ˜¯ä½¿ç”¨ <code>é•œåƒæ‘˜è¦</code> åˆ é™¤é•œåƒã€‚</p>
<pre><code class="language-bash">docker image ls --digests
# è¾“å‡ºå¦‚ä¸‹
REPOSITORY   TAG      DIGEST      IMAGE ID            CREATED             SIZE
node         slim    sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228   6e0c4c8e3913        3 weeks ago         214 MB
docker image rm node@sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228
# è¾“å‡ºå¦‚ä¸‹
Untagged: node@sha256:b4f0e0bdeb578043c1ea6862f0d40cc4afe32a4a582f3be235a3b164422be228
</code></pre>
<h3 id="ç”¨-docker-image-ls-å‘½ä»¤æ¥é…åˆ">ç”¨ docker image ls å‘½ä»¤æ¥é…åˆ</h3>
<p>åƒå…¶å®ƒå¯ä»¥æ‰¿æ¥å¤šä¸ªå®ä½“çš„å‘½ä»¤ä¸€æ ·ï¼Œå¯ä»¥ä½¿ç”¨ <code>docker image ls -q</code> æ¥é…åˆä½¿ç”¨ <code>docker image rm</code>ï¼Œè¿™æ ·å¯ä»¥æˆæ‰¹çš„åˆ é™¤å¸Œæœ›åˆ é™¤çš„é•œåƒã€‚æˆ‘ä»¬åœ¨â€œé•œåƒåˆ—è¡¨â€ç« èŠ‚ä»‹ç»è¿‡å¾ˆå¤šè¿‡æ»¤é•œåƒåˆ—è¡¨çš„æ–¹å¼éƒ½å¯ä»¥æ‹¿è¿‡æ¥ä½¿ç”¨ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬éœ€è¦åˆ é™¤æ‰€æœ‰ä»“åº“åä¸º <code>redis</code> çš„é•œåƒï¼š</p>
<pre><code>docker image rm $(docker image ls -q redis)
</code></pre>
<p>æˆ–è€…åˆ é™¤æ‰€æœ‰åœ¨ <code>mongo:3.2</code> ä¹‹å‰çš„é•œåƒï¼š</p>
<pre><code>docker image rm $(docker image ls -q -f before=mongo:3.2)
</code></pre>
<p>å……åˆ†åˆ©ç”¨ä½ çš„æƒ³è±¡åŠ›å’Œ Linux å‘½ä»¤è¡Œçš„å¼ºå¤§ï¼Œä½ å¯ä»¥å®Œæˆå¾ˆå¤šéå¸¸èµçš„åŠŸèƒ½ã€‚</p>
<h2 id="æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯»</h2>
<h3 id="åˆ—å‡ºéƒ¨åˆ†é•œåƒ">åˆ—å‡ºéƒ¨åˆ†é•œåƒ</h3>
<p>ä¸åŠ ä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹ï¼Œ<code>docker image ls</code> ä¼šåˆ—å‡ºæ‰€æœ‰é¡¶çº§é•œåƒï¼Œä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬åªå¸Œæœ›åˆ—å‡ºéƒ¨åˆ†é•œåƒã€‚<code>docker image ls</code> æœ‰å¥½å‡ ä¸ªå‚æ•°å¯ä»¥å¸®åŠ©åšåˆ°è¿™ä¸ªäº‹æƒ…ã€‚</p>
<p>æ ¹æ®ä»“åº“ååˆ—å‡ºé•œåƒ</p>
<pre><code class="language-bash">docker image ls ubuntu
# è¾“å‡ºå¦‚ä¸‹
REPOSITORY       TAG       IMAGE ID            CREATED             SIZE
ubuntu      	16.04     f753707788c5        4 weeks ago         127 MB
ubuntu          latest    f753707788c5        4 weeks ago         127 MB
ubuntu          14.04     1e0c3dd64ccd        4 weeks ago         188 MB
</code></pre>
<p>åˆ—å‡ºç‰¹å®šçš„æŸä¸ªé•œåƒï¼Œä¹Ÿå°±æ˜¯è¯´æŒ‡å®šä»“åº“åå’Œæ ‡ç­¾</p>
<pre><code class="language-bash">docker image ls ubuntu:16.04
# è¾“å‡ºå¦‚ä¸‹
REPOSITORY      TAG       IMAGE ID       CREATED          SIZE
ubuntu         16.04     f753707788c5   4 weeks ago      127 MB
</code></pre>
<p>é™¤æ­¤ä»¥å¤–ï¼Œ<code>docker image ls</code> è¿˜æ”¯æŒå¼ºå¤§çš„è¿‡æ»¤å™¨å‚æ•° <code>--filter</code>ï¼Œæˆ–è€…ç®€å†™ <code>-f</code>ã€‚ä¹‹å‰æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä½¿ç”¨è¿‡æ»¤å™¨æ¥åˆ—å‡ºè™šæ‚¬é•œåƒçš„ç”¨æ³•ï¼Œå®ƒè¿˜æœ‰æ›´å¤šçš„ç”¨æ³•ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›çœ‹åˆ°åœ¨ <code>mongo:3.2</code> ä¹‹åå»ºç«‹çš„é•œåƒï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<pre><code class="language-bash">docker image ls -f since=mongo:3.2
# è¾“å‡ºå¦‚ä¸‹
REPOSITORY     TAG      IMAGE ID        CREATED             SIZE
redis         latest   5f515359c7f8    5 days ago          183 MB
nginx         latest   05a60462f8ba    5 days ago          181 MB
</code></pre>
<p>æƒ³æŸ¥çœ‹æŸä¸ªä½ç½®ä¹‹å‰çš„é•œåƒä¹Ÿå¯ä»¥ï¼Œåªéœ€è¦æŠŠ <code>since</code> æ¢æˆ <code>before</code> å³å¯ã€‚</p>
<p>æ­¤å¤–ï¼Œå¦‚æœé•œåƒæ„å»ºæ—¶ï¼Œå®šä¹‰äº† <code>LABEL</code>ï¼Œè¿˜å¯ä»¥é€šè¿‡ <code>LABEL</code> æ¥è¿‡æ»¤ã€‚</p>
<pre><code>docker image ls -f label=com.example.version=0.1
</code></pre>
<h3 id="ä»¥ç‰¹å®šæ ¼å¼æ˜¾ç¤º">ä»¥ç‰¹å®šæ ¼å¼æ˜¾ç¤º</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>docker image ls</code> ä¼šè¾“å‡ºä¸€ä¸ªå®Œæ•´çš„è¡¨æ ¼ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶éæ‰€æœ‰æ—¶å€™éƒ½ä¼šéœ€è¦è¿™äº›å†…å®¹ã€‚æ¯”å¦‚ï¼Œåˆšæ‰åˆ é™¤è™šæ‚¬é•œåƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨ <code>docker image ls</code> æŠŠæ‰€æœ‰çš„è™šæ‚¬é•œåƒçš„ ID åˆ—å‡ºæ¥ï¼Œç„¶åæ‰å¯ä»¥äº¤ç»™ <code>docker image rm</code> å‘½ä»¤ä½œä¸ºå‚æ•°æ¥åˆ é™¤æŒ‡å®šçš„è¿™äº›é•œåƒï¼Œè¿™ä¸ªæ—¶å€™å°±ç”¨åˆ°äº† <code>-q</code> å‚æ•°ã€‚</p>
<pre><code class="language-bash">docker image ls -q
# è¾“å‡ºå¦‚ä¸‹
5f515359c7f8
05a60462f8ba
fe9198c04d62
00285df0df87
f753707788c5
f753707788c5
1e0c3dd64ccd
</code></pre>
<p><code>--filter</code> é…åˆ <code>-q</code> äº§ç”Ÿå‡ºæŒ‡å®šèŒƒå›´çš„ ID åˆ—è¡¨ï¼Œç„¶åé€ç»™å¦ä¸€ä¸ª <code>docker</code> å‘½ä»¤ä½œä¸ºå‚æ•°ï¼Œä»è€Œé’ˆå¯¹è¿™ç»„å®ä½“æˆæ‰¹çš„è¿›è¡ŒæŸç§æ“ä½œçš„åšæ³•åœ¨ Docker å‘½ä»¤è¡Œä½¿ç”¨è¿‡ç¨‹ä¸­éå¸¸å¸¸è§ï¼Œä¸ä»…ä»…æ˜¯é•œåƒï¼Œå°†æ¥æˆ‘ä»¬ä¼šåœ¨å„ä¸ªå‘½ä»¤ä¸­çœ‹åˆ°è¿™ç±»æ­é…ä»¥å®Œæˆå¾ˆå¼ºå¤§çš„åŠŸèƒ½ã€‚å› æ­¤æ¯æ¬¡åœ¨æ–‡æ¡£çœ‹åˆ°è¿‡æ»¤å™¨åï¼Œå¯ä»¥å¤šæ³¨æ„ä¸€ä¸‹å®ƒä»¬çš„ç”¨æ³•ã€‚</p>
<p>å¦å¤–ä¸€äº›æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½åªæ˜¯å¯¹è¡¨æ ¼çš„ç»“æ„ä¸æ»¡æ„ï¼Œå¸Œæœ›è‡ªå·±ç»„ç»‡åˆ—ï¼›æˆ–è€…ä¸å¸Œæœ›æœ‰æ ‡é¢˜ï¼Œè¿™æ ·æ–¹ä¾¿å…¶å®ƒç¨‹åºè§£æç»“æœç­‰ï¼Œè¿™å°±ç”¨åˆ°äº† Go çš„æ¨¡æ¿è¯­æ³•ã€‚</p>
<p>æ¯”å¦‚ï¼Œä¸‹é¢çš„å‘½ä»¤ä¼šç›´æ¥åˆ—å‡ºé•œåƒç»“æœï¼Œå¹¶ä¸”åªåŒ…å«é•œåƒ ID å’Œä»“åº“åï¼š</p>
<pre><code class="language-bash">docker image ls --format &quot;{{.ID}}: {{.Repository}}&quot;
# è¾“å‡ºå¦‚ä¸‹
5f515359c7f8: redis
05a60462f8ba: nginx
fe9198c04d62: mongo
00285df0df87: &lt;none&gt;
f753707788c5: ubuntu
f753707788c5: ubuntu
1e0c3dd64ccd: ubuntu
</code></pre>
<p>æˆ–è€…æ‰“ç®—ä»¥è¡¨æ ¼ç­‰è·æ˜¾ç¤ºï¼Œå¹¶ä¸”æœ‰æ ‡é¢˜è¡Œï¼Œå’Œé»˜è®¤ä¸€æ ·ï¼Œä¸è¿‡è‡ªå·±å®šä¹‰åˆ—ï¼š</p>
<pre><code class="language-bash">docker image ls --format &quot;table {{.ID}}\t{{.Repository}}\t{{.Tag}}&quot;
# è¾“å‡ºå¦‚ä¸‹
IMAGE ID      	REPOSITORY      TAG
5f515359c7f8     redis         latest
05a60462f8ba     nginx         latest
fe9198c04d62     mongo         3.2
00285df0df87     &lt;none&gt;        &lt;none&gt;
f753707788c5     ubuntu        16.04
f753707788c5     ubuntu        latest
1e0c3dd64ccd     ubuntu        14.04
</code></pre>
<h1 id="æ“ä½œå®¹å™¨">æ“ä½œå®¹å™¨</h1>
<h2 id="å¯åŠ¨å®¹å™¨">å¯åŠ¨å®¹å™¨</h2>
<p>æ‰€éœ€è¦çš„å‘½ä»¤ä¸»è¦ä¸º <code>docker run</code>ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„å‘½ä»¤è¾“å‡ºä¸€ä¸ª â€œHello Worldâ€ï¼Œä¹‹åç»ˆæ­¢å®¹å™¨ã€‚</p>
<pre><code class="language-bash">docker run ubuntu:16.04 /bin/echo 'Hello world'
Hello world
</code></pre>
<pre><code class="language-bash">docker run -p 8080:8080 --name myTomcat -d tomcat
# å¯åŠ¨ä¸€ä¸ªtomcat(é•œåƒåå­—) å®¿ä¸»æœºç«¯å£ä¸º8080 å®¹å™¨ç«¯å£8080 èµ·åä¸ºmyTomcat
8dd9addeee5960d6818a3744d897a3b2200815f954f0dc0e6f63e647bc1574ea
</code></pre>
<p>å½“åˆ©ç”¨ <code>docker run</code> æ¥åˆ›å»ºå®¹å™¨æ—¶ï¼ŒDocker åœ¨åå°è¿è¡Œçš„æ ‡å‡†æ“ä½œåŒ…æ‹¬ï¼š</p>
<ul>
<li>æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é•œåƒï¼Œä¸å­˜åœ¨å°±ä»å…¬æœ‰ä»“åº“ä¸‹è½½</li>
<li>åˆ©ç”¨é•œåƒåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨</li>
<li>åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå±‚å¤–é¢æŒ‚è½½ä¸€å±‚å¯è¯»å†™å±‚</li>
<li>ä»å®¿ä¸»ä¸»æœºé…ç½®çš„ç½‘æ¡¥æ¥å£ä¸­æ¡¥æ¥ä¸€ä¸ªè™šæ‹Ÿæ¥å£åˆ°å®¹å™¨ä¸­å»</li>
<li>ä»åœ°å€æ± é…ç½®ä¸€ä¸ª ip åœ°å€ç»™å®¹å™¨</li>
<li>æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åº</li>
<li>æ‰§è¡Œå®Œæ¯•åå®¹å™¨è¢«ç»ˆæ­¢</li>
</ul>
<h2 id="ç»ˆæ­¢å®¹å™¨">ç»ˆæ­¢å®¹å™¨</h2>
<p>å¯ä»¥ä½¿ç”¨ <code>docker container stop [container ID or NAMES]</code> æ¥ç»ˆæ­¢ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ã€‚æ­¤å¤–ï¼Œå½“ Docker å®¹å™¨ä¸­æŒ‡å®šçš„åº”ç”¨ç»ˆç»“æ—¶ï¼Œå®¹å™¨ä¹Ÿè‡ªåŠ¨ç»ˆæ­¢ã€‚</p>
<p>ä¾‹å¦‚å¯¹äºåªå¯åŠ¨äº†ä¸€ä¸ªç»ˆç«¯çš„å®¹å™¨ï¼Œç”¨æˆ·é€šè¿‡ <code>exit</code> å‘½ä»¤æˆ– <code>ctrl + d</code> æ¥é€€å‡ºç»ˆç«¯æ—¶ï¼Œæ‰€åˆ›å»ºçš„å®¹å™¨ç«‹åˆ»ç»ˆæ­¢ã€‚ç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨å¯ä»¥ç”¨ <code>docker container ls -a</code> å‘½ä»¤çœ‹åˆ°ã€‚ä¾‹å¦‚</p>
<pre><code class="language-bash">docker container ls -a
# è¾“å‡ºå¦‚ä¸‹
CONTAINER ID  IMAGE         COMMAND    CREATED       STATUS     PORTS  NAMES
ba267838cc1b ubuntu:14.04 &quot;/bin/bash&quot; 30 minutes ago Exited (0) About a minute ago                       trusting_newton
98e5efa7d997 training/webapp:latest  &quot;python app.py&quot;   About an hour ago   Exited (0) 34 minutes ago    backstabbing_pike
</code></pre>
<h2 id="å¯åŠ¨å·²ç»ˆæ­¢å®¹å™¨">å¯åŠ¨å·²ç»ˆæ­¢å®¹å™¨</h2>
<p>å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡ <code>docker container start</code> å‘½ä»¤æ¥é‡æ–°å¯åŠ¨ã€‚æ­¤å¤–ï¼Œ<code>docker container restart</code> å‘½ä»¤ä¼šå°†ä¸€ä¸ªè¿è¡Œæ€çš„å®¹å™¨ç»ˆæ­¢ï¼Œç„¶åå†é‡æ–°å¯åŠ¨å®ƒã€‚</p>
<pre><code class="language-bash">docker container start [container ID or NAMES]
</code></pre>
<h2 id="å®ˆæŠ¤æ€è¿è¡Œ">å®ˆæŠ¤æ€è¿è¡Œ</h2>
<p>æ›´å¤šçš„æ—¶å€™ï¼Œéœ€è¦è®© Docker åœ¨åå°è¿è¡Œè€Œä¸æ˜¯ç›´æ¥æŠŠæ‰§è¡Œå‘½ä»¤çš„ç»“æœè¾“å‡ºåœ¨å½“å‰å®¿ä¸»æœºä¸‹ã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ  <code>-d</code> å‚æ•°æ¥å®ç°ã€‚å¦‚æœä¸ä½¿ç”¨ <code>-d</code> å‚æ•°è¿è¡Œå®¹å™¨ã€‚</p>
<pre><code class="language-bash">docker run ubuntu:16.04 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;
# è¾“å‡ºå¦‚ä¸‹
hello world
hello world
hello world
hello world
</code></pre>
<p>å®¹å™¨ä¼šæŠŠè¾“å‡ºçš„ç»“æœ (STDOUT) æ‰“å°åˆ°å®¿ä¸»æœºä¸Šé¢ï¼Œå¦‚æœä½¿ç”¨äº† <code>-d</code> å‚æ•°è¿è¡Œå®¹å™¨ã€‚</p>
<pre><code class="language-bash">docker run -d ubuntu:17.10 /bin/sh -c &quot;while true; do echo hello world; sleep 1; done&quot;
# è¾“å‡ºå¦‚ä¸‹
77b2dc01fe0f3f1265df143181e7b9af5e05279a884f4776ee75350ea9d8017a
</code></pre>
<p>æ­¤æ—¶å®¹å™¨ä¼šåœ¨åå°è¿è¡Œå¹¶ä¸ä¼šæŠŠè¾“å‡ºçš„ç»“æœ (STDOUT) æ‰“å°åˆ°å®¿ä¸»æœºä¸Šé¢(è¾“å‡ºç»“æœå¯ä»¥ç”¨ <code>docker logs</code> æŸ¥çœ‹)ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> å®¹å™¨æ˜¯å¦ä¼šé•¿ä¹…è¿è¡Œï¼Œæ˜¯å’Œ <code>docker run</code> æŒ‡å®šçš„å‘½ä»¤æœ‰å…³ï¼Œå’Œ <code>-d</code> å‚æ•°æ— å…³ã€‚</p>
</blockquote>
<h2 id="å®¹å™¨æ—¥å¿—">å®¹å™¨æ—¥å¿—</h2>
<p>è¦è·å–å®¹å™¨çš„è¾“å‡ºä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ <code>docker container logs</code> å‘½ä»¤ã€‚</p>
<pre><code class="language-bash">docker container logs [container ID or NAMES]
# è¾“å‡ºå¦‚ä¸‹
hello world
hello world
hello world
</code></pre>
<h2 id="è¿›å…¥å®¹å™¨">è¿›å…¥å®¹å™¨</h2>
<p>åœ¨ä½¿ç”¨ <code>-d</code> å‚æ•°æ—¶ï¼Œå®¹å™¨å¯åŠ¨åä¼šè¿›å…¥åå°ã€‚æŸäº›æ—¶å€™éœ€è¦è¿›å…¥å®¹å™¨è¿›è¡Œæ“ä½œï¼Œ<code>docker exec</code> å‘½ä»¤èƒ½è®©æˆ‘ä»¬ä»¥äº¤äº’çš„æ–¹å¼è¿›å…¥å®¹å™¨ã€‚</p>
<p><code>docker exec</code> åè¾¹å¯ä»¥è·Ÿå¤šä¸ªå‚æ•°ï¼Œè¿™é‡Œä¸»è¦è¯´æ˜ <code>-i</code> <code>-t</code> å‚æ•°ã€‚åªç”¨ <code>-i</code> å‚æ•°æ—¶ï¼Œç”±äºæ²¡æœ‰åˆ†é…ä¼ªç»ˆç«¯ï¼Œç•Œé¢æ²¡æœ‰æˆ‘ä»¬ç†Ÿæ‚‰çš„ Linux å‘½ä»¤æç¤ºç¬¦ï¼Œä½†å‘½ä»¤æ‰§è¡Œç»“æœä»ç„¶å¯ä»¥è¿”å›ã€‚å½“ <code>-i</code> <code>-t</code> å‚æ•°ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œåˆ™å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç†Ÿæ‚‰çš„ Linux å‘½ä»¤æç¤ºç¬¦ã€‚</p>
<pre><code class="language-bash">docker exec -it 69d1 bash
root@69d137adef7a:/#
</code></pre>
<p>å¦‚æœä»è¿™ä¸ª stdin ä¸­ exitï¼Œä¸ä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢ã€‚æ›´å¤šå‚æ•°è¯´æ˜è¯·ä½¿ç”¨ <code>docker exec --help</code> æŸ¥çœ‹ã€‚</p>
<h2 id="åˆ é™¤å®¹å™¨">åˆ é™¤å®¹å™¨</h2>
<p>å¯ä»¥ä½¿ç”¨ <code>docker container rm</code> æ¥åˆ é™¤ä¸€ä¸ªå¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚ä¾‹å¦‚</p>
<pre><code class="language-bash">docker container rm trusting_newton
trusting_newton
</code></pre>
<p>å¦‚æœè¦åˆ é™¤ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ï¼Œå¯ä»¥æ·»åŠ  <code>-f</code> å‚æ•°ã€‚Docker ä¼šå‘é€ <code>SIGKILL</code> ä¿¡å·ç»™å®¹å™¨ã€‚</p>
<p><code>docker rm -f unruffled_jang</code>:<code>unruffled_jang</code>ä¸ºå®¹å™¨å,ä¹Ÿå¯ä»¥æ ¹æ®å®¹å™¨idåˆ é™¤</p>
<h2 id="æ¸…ç†æ‰€æœ‰å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨">æ¸…ç†æ‰€æœ‰å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨</h2>
<p>ç”¨ <code>docker container ls -a</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å·²ç»åˆ›å»ºçš„åŒ…æ‹¬ç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ï¼Œå¦‚æœæ•°é‡å¤ªå¤šè¦ä¸€ä¸ªä¸ªåˆ é™¤å¯èƒ½ä¼šå¾ˆéº»çƒ¦ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æ¸…ç†æ‰æ‰€æœ‰å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚</p>
<pre><code>docker container prune
</code></pre>
<h1 id="dockerfileå®šåˆ¶é•œåƒ">dockerfileå®šåˆ¶é•œåƒ</h1>
<h2 id="æ¦‚è¿°-2">æ¦‚è¿°</h2>
<p>Dockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶å†…åŒ…å«äº†ä¸€æ¡æ¡çš„ <strong>æŒ‡ä»¤(Instruction)</strong>ï¼Œæ¯ä¸€æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚ï¼Œå› æ­¤æ¯ä¸€æ¡æŒ‡ä»¤çš„å†…å®¹ï¼Œå°±æ˜¯æè¿°è¯¥å±‚åº”å½“å¦‚ä½•æ„å»ºã€‚</p>
<p>ä»¥ä¹‹å‰çš„ Nginx é•œåƒä¸ºä¾‹ï¼Œè¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨ Dockerfile æ¥å®šåˆ¶ã€‚åœ¨ä¸€ä¸ªç©ºç™½ç›®å½•ä¸­ï¼Œå»ºç«‹ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶å‘½åä¸º <code>Dockerfile</code></p>
<pre><code class="language-bash">mkdir mynginx
cd mynginx
touch Dockerfile
</code></pre>
<p>å…¶å†…å®¹ä¸ºï¼š</p>
<pre><code class="language-bash">FROM nginx
RUN echo '&lt;h1&gt;Hello, Docker!&lt;/h1&gt;' &gt; /usr/share/nginx/html/index.html
</code></pre>
<p>è¿™ä¸ª Dockerfile å¾ˆç®€å•ï¼Œä¸€å…±å°±ä¸¤è¡Œã€‚æ¶‰åŠåˆ°äº†ä¸¤æ¡æŒ‡ä»¤ï¼Œ<code>FROM</code> å’Œ <code>RUN</code>ã€‚</p>
<h2 id="from-æŒ‡å®šåŸºç¡€é•œåƒ">FROM æŒ‡å®šåŸºç¡€é•œåƒ</h2>
<p>æ‰€è°“å®šåˆ¶é•œåƒï¼Œé‚£ä¸€å®šæ˜¯ä»¥ä¸€ä¸ªé•œåƒä¸ºåŸºç¡€ï¼Œåœ¨å…¶ä¸Šè¿›è¡Œå®šåˆ¶ã€‚å°±åƒæˆ‘ä»¬ä¹‹å‰è¿è¡Œäº†ä¸€ä¸ª Nginx é•œåƒçš„å®¹å™¨ï¼Œå†è¿›è¡Œä¿®æ”¹ä¸€æ ·ï¼ŒåŸºç¡€é•œåƒæ˜¯å¿…é¡»æŒ‡å®šçš„ã€‚è€Œ <code>FROM</code> å°±æ˜¯æŒ‡å®š <strong>åŸºç¡€é•œåƒ</strong>ï¼Œå› æ­¤ä¸€ä¸ª <code>Dockerfile</code> ä¸­ <code>FROM</code> æ˜¯å¿…å¤‡çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤ã€‚</p>
<p>é™¤äº†é€‰æ‹©ç°æœ‰é•œåƒä¸ºåŸºç¡€é•œåƒå¤–ï¼ŒDocker è¿˜å­˜åœ¨ä¸€ä¸ªç‰¹æ®Šçš„é•œåƒï¼Œåä¸º <code>scratch</code>ã€‚è¿™ä¸ªé•œåƒæ˜¯è™šæ‹Ÿçš„æ¦‚å¿µï¼Œå¹¶ä¸å®é™…å­˜åœ¨ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªç©ºç™½çš„é•œåƒã€‚</p>
<pre><code class="language-dockerfile">FROM scratch
</code></pre>
<p>å¦‚æœä½ ä»¥ <code>scratch</code> ä¸ºåŸºç¡€é•œåƒçš„è¯ï¼Œæ„å‘³ç€ä½ ä¸ä»¥ä»»ä½•é•œåƒä¸ºåŸºç¡€ï¼Œæ¥ä¸‹æ¥æ‰€å†™çš„æŒ‡ä»¤å°†ä½œä¸ºé•œåƒç¬¬ä¸€å±‚å¼€å§‹å­˜åœ¨ã€‚</p>
<p>ä¸ä»¥ä»»ä½•ç³»ç»Ÿä¸ºåŸºç¡€ï¼Œç›´æ¥å°†å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶è¿›é•œåƒçš„åšæ³•å¹¶ä¸ç½•è§ï¼Œæ¯”å¦‚ <code>swarm</code>ã€<code>coreos/etcd</code>ã€‚å¯¹äº Linux ä¸‹é™æ€ç¼–è¯‘çš„ç¨‹åºæ¥è¯´ï¼Œå¹¶ä¸éœ€è¦æœ‰æ“ä½œç³»ç»Ÿæä¾›è¿è¡Œæ—¶æ”¯æŒï¼Œæ‰€éœ€çš„ä¸€åˆ‡åº“éƒ½å·²ç»åœ¨å¯æ‰§è¡Œæ–‡ä»¶é‡Œäº†ï¼Œå› æ­¤ç›´æ¥ <code>FROM scratch</code> ä¼šè®©é•œåƒä½“ç§¯æ›´åŠ å°å·§ã€‚ä½¿ç”¨ Go è¯­è¨€å¼€å‘çš„åº”ç”¨å¾ˆå¤šä¼šä½¿ç”¨è¿™ç§æ–¹å¼æ¥åˆ¶ä½œé•œåƒï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ‰äººè®¤ä¸º Go æ˜¯ç‰¹åˆ«é€‚åˆå®¹å™¨å¾®æœåŠ¡æ¶æ„è¯­è¨€çš„åŸå› ä¹‹ä¸€ã€‚</p>
<h2 id="run-æ‰§è¡Œå‘½ä»¤">RUN æ‰§è¡Œå‘½ä»¤</h2>
<p><code>RUN</code> æŒ‡ä»¤æ˜¯ç”¨æ¥æ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤çš„ã€‚ç”±äºå‘½ä»¤è¡Œçš„å¼ºå¤§èƒ½åŠ›ï¼Œ<code>RUN</code> æŒ‡ä»¤åœ¨å®šåˆ¶é•œåƒæ—¶æ˜¯æœ€å¸¸ç”¨çš„æŒ‡ä»¤ä¹‹ä¸€ã€‚å…¶æ ¼å¼æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li><strong>shell æ ¼å¼ï¼š</strong> <code>RUN &lt;å‘½ä»¤&gt;</code>ï¼Œå°±åƒç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥çš„å‘½ä»¤ä¸€æ ·ã€‚åˆšæ‰å†™çš„ Dockerfile ä¸­çš„ <code>RUN</code> æŒ‡ä»¤å°±æ˜¯è¿™ç§æ ¼å¼ã€‚</li>
</ul>
<pre><code>RUN echo '&lt;h1&gt;Hello, Docker!&lt;/h1&gt;' &gt; /usr/share/nginx/html/index.html
</code></pre>
<ul>
<li><strong>exec æ ¼å¼ï¼š</strong> <code>RUN [&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;, &quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;]</code>ï¼Œè¿™æ›´åƒæ˜¯å‡½æ•°è°ƒç”¨ä¸­çš„æ ¼å¼ã€‚</li>
</ul>
<p>æ—¢ç„¶ <code>RUN</code> å°±åƒ Shell è„šæœ¬ä¸€æ ·å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å°±å¯ä»¥åƒ Shell è„šæœ¬ä¸€æ ·æŠŠæ¯ä¸ªå‘½ä»¤å¯¹åº”ä¸€ä¸ª RUN å‘¢ï¼Ÿæ¯”å¦‚è¿™æ ·ï¼š</p>
<pre><code class="language-dockerfile">FROM debian:jessie

RUN apt-get update
RUN apt-get install -y gcc libc6-dev make
RUN wget -O redis.tar.gz &quot;http://download.redis.io/releases/redis-3.2.5.tar.gz&quot;
RUN mkdir -p /usr/src/redis
RUN tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1
RUN make -C /usr/src/redisRUN make -C /usr/src/redis install
</code></pre>
<p>ä¹‹å‰è¯´è¿‡ï¼ŒDockerfile ä¸­æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šå»ºç«‹ä¸€å±‚ï¼Œ<code>RUN</code> ä¹Ÿä¸ä¾‹å¤–ã€‚æ¯ä¸€ä¸ª <code>RUN</code> çš„è¡Œä¸ºï¼Œå°±å’Œåˆšæ‰æˆ‘ä»¬æ‰‹å·¥å»ºç«‹é•œåƒçš„è¿‡ç¨‹ä¸€æ ·ï¼šæ–°å»ºç«‹ä¸€å±‚ï¼Œåœ¨å…¶ä¸Šæ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œæ‰§è¡Œç»“æŸåï¼Œ<code>commit</code> è¿™ä¸€å±‚çš„ä¿®æ”¹ï¼Œæ„æˆæ–°çš„é•œåƒã€‚</p>
<p>è€Œä¸Šé¢çš„è¿™ç§å†™æ³•ï¼Œåˆ›å»ºäº† 7 å±‚é•œåƒã€‚è¿™æ˜¯å®Œå…¨æ²¡æœ‰æ„ä¹‰çš„ï¼Œè€Œä¸”å¾ˆå¤šè¿è¡Œæ—¶ä¸éœ€è¦çš„ä¸œè¥¿ï¼Œéƒ½è¢«è£…è¿›äº†é•œåƒé‡Œï¼Œæ¯”å¦‚ç¼–è¯‘ç¯å¢ƒã€æ›´æ–°çš„è½¯ä»¶åŒ…ç­‰ç­‰ã€‚ç»“æœå°±æ˜¯äº§ç”Ÿéå¸¸è‡ƒè‚¿ã€éå¸¸å¤šå±‚çš„é•œåƒï¼Œä¸ä»…ä»…å¢åŠ äº†æ„å»ºéƒ¨ç½²çš„æ—¶é—´ï¼Œä¹Ÿå¾ˆå®¹æ˜“å‡ºé”™ã€‚è¿™æ˜¯å¾ˆå¤šåˆå­¦ Docker çš„äººå¸¸çŠ¯çš„ä¸€ä¸ªé”™è¯¯ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> Union FS æ˜¯æœ‰æœ€å¤§å±‚æ•°é™åˆ¶çš„ï¼Œæ¯”å¦‚ AUFSï¼Œæ›¾ç»æ˜¯æœ€å¤§ä¸å¾—è¶…è¿‡ 42 å±‚ï¼Œç°åœ¨æ˜¯ä¸å¾—è¶…è¿‡ 127 å±‚ã€‚</p>
</blockquote>
<p>ä¸Šé¢çš„ <code>Dockerfile</code> æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯è¿™æ ·ï¼š</p>
<pre><code class="language-dockerfile">FROM debian:jessie
RUN buildDeps='gcc libc6-dev make' \    
	&amp;&amp; apt-get update \   
	&amp;&amp; apt-get install -y $buildDeps \    
	&amp;&amp; wget -O redis.tar.gz &quot;http://download.redis.io/releases/redis-3.2.5.tar.gz&quot; \     &amp;&amp; mkdir -p /usr/src/redis \   
    &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \    
    &amp;&amp; make -C /usr/src/redis \    
    &amp;&amp; make -C /usr/src/redis install \   
    &amp;&amp; rm -rf /var/lib/apt/lists/* \    
    &amp;&amp; rm redis.tar.gz \    
    &amp;&amp; rm -r /usr/src/redis \    
    &amp;&amp; apt-get purge -y --auto-remove $buildDeps
</code></pre>
<p>é¦–å…ˆï¼Œä¹‹å‰æ‰€æœ‰çš„å‘½ä»¤åªæœ‰ä¸€ä¸ªç›®çš„ï¼Œå°±æ˜¯ç¼–è¯‘ã€å®‰è£… Redis å¯æ‰§è¡Œæ–‡ä»¶ã€‚å› æ­¤æ²¡æœ‰å¿…è¦å»ºç«‹å¾ˆå¤šå±‚ï¼Œè¿™åªæ˜¯ä¸€å±‚çš„äº‹æƒ…ã€‚å› æ­¤ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨å¾ˆå¤šä¸ª <code>RUN</code> å¯¹ä¸€ä¸€å¯¹åº”ä¸åŒçš„å‘½ä»¤ï¼Œè€Œæ˜¯ä»…ä»…ä½¿ç”¨ä¸€ä¸ª <code>RUN</code> æŒ‡ä»¤ï¼Œå¹¶ä½¿ç”¨ <code>&amp;&amp;</code> å°†å„ä¸ªæ‰€éœ€å‘½ä»¤ä¸²è”èµ·æ¥ã€‚å°†ä¹‹å‰çš„ 7 å±‚ï¼Œç®€åŒ–ä¸ºäº† 1 å±‚ã€‚åœ¨æ’°å†™ Dockerfile çš„æ—¶å€™ï¼Œè¦ç»å¸¸æé†’è‡ªå·±ï¼Œ<strong>è¿™å¹¶ä¸æ˜¯åœ¨å†™ Shell è„šæœ¬ï¼Œè€Œæ˜¯åœ¨å®šä¹‰æ¯ä¸€å±‚è¯¥å¦‚ä½•æ„å»ºã€‚</strong></p>
<p>å¹¶ä¸”ï¼Œè¿™é‡Œä¸ºäº†æ ¼å¼åŒ–è¿˜è¿›è¡Œäº†æ¢è¡Œã€‚Dockerfile æ”¯æŒ Shell ç±»çš„è¡Œå°¾æ·»åŠ  <code>\</code> çš„å‘½ä»¤æ¢è¡Œæ–¹å¼ï¼Œä»¥åŠè¡Œé¦– <code>#</code> è¿›è¡Œæ³¨é‡Šçš„æ ¼å¼ã€‚è‰¯å¥½çš„æ ¼å¼ï¼Œæ¯”å¦‚æ¢è¡Œã€ç¼©è¿›ã€æ³¨é‡Šç­‰ï¼Œä¼šè®©ç»´æŠ¤ã€æ’éšœæ›´ä¸ºå®¹æ˜“ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¹ æƒ¯ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥çœ‹åˆ°è¿™ä¸€ç»„å‘½ä»¤çš„æœ€åæ·»åŠ äº†æ¸…ç†å·¥ä½œçš„å‘½ä»¤ï¼Œåˆ é™¤äº†ä¸ºäº†ç¼–è¯‘æ„å»ºæ‰€éœ€è¦çš„è½¯ä»¶ï¼Œæ¸…ç†äº†æ‰€æœ‰ä¸‹è½½ã€å±•å¼€çš„æ–‡ä»¶ï¼Œå¹¶ä¸”è¿˜æ¸…ç†äº† <code>apt</code> ç¼“å­˜æ–‡ä»¶ã€‚è¿™æ˜¯å¾ˆé‡è¦çš„ä¸€æ­¥ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œé•œåƒæ˜¯å¤šå±‚å­˜å‚¨ï¼Œæ¯ä¸€å±‚çš„ä¸œè¥¿å¹¶ä¸ä¼šåœ¨ä¸‹ä¸€å±‚è¢«åˆ é™¤ï¼Œä¼šä¸€ç›´è·Ÿéšç€é•œåƒã€‚å› æ­¤é•œåƒæ„å»ºæ—¶ï¼Œä¸€å®šè¦ç¡®ä¿æ¯ä¸€å±‚åªæ·»åŠ çœŸæ­£éœ€è¦æ·»åŠ çš„ä¸œè¥¿ï¼Œä»»ä½•æ— å…³çš„ä¸œè¥¿éƒ½åº”è¯¥æ¸…ç†æ‰ã€‚</p>
<p>å¾ˆå¤šäººåˆå­¦ Docker åˆ¶ä½œå‡ºäº†å¾ˆè‡ƒè‚¿çš„é•œåƒçš„åŸå› ä¹‹ä¸€ï¼Œå°±æ˜¯å¿˜è®°äº†æ¯ä¸€å±‚æ„å»ºçš„æœ€åä¸€å®šè¦æ¸…ç†æ‰æ— å…³æ–‡ä»¶ã€‚</p>
<h2 id="æ„å»ºé•œåƒ">æ„å»ºé•œåƒ</h2>
<p>å¥½äº†ï¼Œè®©æˆ‘ä»¬å†å›åˆ°ä¹‹å‰å®šåˆ¶çš„ Nginx é•œåƒçš„ Dockerfile æ¥ã€‚ç°åœ¨æˆ‘ä»¬æ˜ç™½äº†è¿™ä¸ª Dockerfile çš„å†…å®¹ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬æ¥æ„å»ºè¿™ä¸ªé•œåƒå§ã€‚åœ¨ <code>Dockerfile</code> æ–‡ä»¶æ‰€åœ¨ç›®å½•æ‰§è¡Œï¼š</p>
<pre><code class="language-bash">docker build -t nginx:v3 .
# è¾“å‡ºå¦‚ä¸‹
Sending build context to Docker daemon 2.048 kB
Step 1 : FROM nginx 
	---&gt; e43d811ce2f4
Step 2 : RUN echo '&lt;h1&gt;Hello, Docker!&lt;/h1&gt;' &gt; /usr/share/nginx/html/index.html 
	---&gt; Running in 9cdc27646c7b 
	---&gt; 44aa4490ce2c
Removing intermediate container 9cdc27646c7b
Successfully built 44aa4490ce2c
</code></pre>
<p>ä»å‘½ä»¤çš„è¾“å‡ºç»“æœä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°é•œåƒçš„æ„å»ºè¿‡ç¨‹ã€‚åœ¨ <code>Step 2</code> ä¸­ï¼Œå¦‚åŒæˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„é‚£æ ·ï¼Œ<code>RUN</code> æŒ‡ä»¤å¯åŠ¨äº†ä¸€ä¸ªå®¹å™¨ <code>9cdc27646c7b</code>ï¼Œæ‰§è¡Œäº†æ‰€è¦æ±‚çš„å‘½ä»¤ï¼Œå¹¶æœ€åæäº¤äº†è¿™ä¸€å±‚ <code>44aa4490ce2c</code>ï¼Œéšååˆ é™¤äº†æ‰€ç”¨åˆ°çš„è¿™ä¸ªå®¹å™¨ <code>9cdc27646c7b</code>ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† <code>docker build</code> å‘½ä»¤è¿›è¡Œé•œåƒæ„å»ºã€‚å…¶æ ¼å¼ä¸ºï¼š</p>
<pre><code>docker build [é€‰é¡¹] &lt;ä¸Šä¸‹æ–‡è·¯å¾„/URL/-&gt;
</code></pre>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬æŒ‡å®šäº†æœ€ç»ˆé•œåƒçš„åç§° <code>-t nginx:v3</code>ï¼Œæ„å»ºæˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥åƒä¹‹å‰è¿è¡Œ <code>nginx:v2</code> é‚£æ ·æ¥è¿è¡Œè¿™ä¸ªé•œåƒï¼Œå…¶ç»“æœä¼šå’Œ <code>nginx:v2</code> ä¸€æ ·ã€‚</p>
<h2 id="é•œåƒæ„å»ºä¸Šä¸‹æ–‡">é•œåƒæ„å»ºä¸Šä¸‹æ–‡</h2>
<p>å¦‚æœæ³¨æ„ï¼Œä¼šçœ‹åˆ° <code>docker build</code> å‘½ä»¤æœ€åæœ‰ä¸€ä¸ª <code>.</code>ã€‚<code>.</code> è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œè€Œ <code>Dockerfile</code> å°±åœ¨å½“å‰ç›®å½•ï¼Œå› æ­¤ä¸å°‘åˆå­¦è€…ä»¥ä¸ºè¿™ä¸ªè·¯å¾„æ˜¯åœ¨æŒ‡å®š <code>Dockerfile</code> æ‰€åœ¨è·¯å¾„ï¼Œè¿™ä¹ˆç†è§£å…¶å®æ˜¯ä¸å‡†ç¡®çš„ã€‚å¦‚æœå¯¹åº”ä¸Šé¢çš„å‘½ä»¤æ ¼å¼ï¼Œä½ å¯èƒ½ä¼šå‘ç°ï¼Œè¿™æ˜¯åœ¨æŒ‡å®š <strong>ä¸Šä¸‹æ–‡è·¯å¾„</strong>ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆæˆ‘ä»¬è¦ç†è§£ <code>docker build</code> çš„å·¥ä½œåŸç†ã€‚Docker åœ¨è¿è¡Œæ—¶åˆ†ä¸º Docker å¼•æ“ï¼ˆä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å®ˆæŠ¤è¿›ç¨‹ï¼‰å’Œå®¢æˆ·ç«¯å·¥å…·ã€‚Docker çš„å¼•æ“æä¾›äº†ä¸€ç»„ REST APIï¼Œè¢«ç§°ä¸º Docker Remote APIï¼Œè€Œå¦‚ <code>docker</code> å‘½ä»¤è¿™æ ·çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œåˆ™æ˜¯é€šè¿‡è¿™ç»„ API ä¸ Docker å¼•æ“äº¤äº’ï¼Œä»è€Œå®Œæˆå„ç§åŠŸèƒ½ã€‚å› æ­¤ï¼Œè™½ç„¶è¡¨é¢ä¸Šæˆ‘ä»¬å¥½åƒæ˜¯åœ¨æœ¬æœºæ‰§è¡Œå„ç§ <code>docker</code> åŠŸèƒ½ï¼Œä½†å®é™…ä¸Šï¼Œä¸€åˆ‡éƒ½æ˜¯ä½¿ç”¨çš„è¿œç¨‹è°ƒç”¨å½¢å¼åœ¨æœåŠ¡ç«¯ï¼ˆDocker å¼•æ“ï¼‰å®Œæˆã€‚ä¹Ÿå› ä¸ºè¿™ç§ C/S è®¾è®¡ï¼Œè®©æˆ‘ä»¬æ“ä½œè¿œç¨‹æœåŠ¡å™¨çš„ Docker å¼•æ“å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚</p>
<p>å½“æˆ‘ä»¬è¿›è¡Œé•œåƒæ„å»ºçš„æ—¶å€™ï¼Œå¹¶éæ‰€æœ‰å®šåˆ¶éƒ½ä¼šé€šè¿‡ <code>RUN</code> æŒ‡ä»¤å®Œæˆï¼Œç»å¸¸ä¼šéœ€è¦å°†ä¸€äº›æœ¬åœ°æ–‡ä»¶å¤åˆ¶è¿›é•œåƒï¼Œæ¯”å¦‚é€šè¿‡ <code>COPY</code> æŒ‡ä»¤ã€<code>ADD</code> æŒ‡ä»¤ç­‰ã€‚è€Œ <code>docker build</code> å‘½ä»¤æ„å»ºé•œåƒï¼Œå…¶å®å¹¶éåœ¨æœ¬åœ°æ„å»ºï¼Œè€Œæ˜¯åœ¨æœåŠ¡ç«¯ï¼Œä¹Ÿå°±æ˜¯ Docker å¼•æ“ä¸­æ„å»ºçš„ã€‚é‚£ä¹ˆåœ¨è¿™ç§å®¢æˆ·ç«¯/æœåŠ¡ç«¯çš„æ¶æ„ä¸­ï¼Œå¦‚ä½•æ‰èƒ½è®©æœåŠ¡ç«¯è·å¾—æœ¬åœ°æ–‡ä»¶å‘¢ï¼Ÿ</p>
<p>è¿™å°±å¼•å…¥äº†ä¸Šä¸‹æ–‡çš„æ¦‚å¿µã€‚å½“æ„å»ºçš„æ—¶å€™ï¼Œç”¨æˆ·ä¼šæŒ‡å®šæ„å»ºé•œåƒä¸Šä¸‹æ–‡çš„è·¯å¾„ï¼Œ<code>docker build</code> å‘½ä»¤å¾—çŸ¥è¿™ä¸ªè·¯å¾„åï¼Œä¼šå°†è·¯å¾„ä¸‹çš„æ‰€æœ‰å†…å®¹æ‰“åŒ…ï¼Œç„¶åä¸Šä¼ ç»™ Docker å¼•æ“ã€‚è¿™æ · Docker å¼•æ“æ”¶åˆ°è¿™ä¸ªä¸Šä¸‹æ–‡åŒ…åï¼Œå±•å¼€å°±ä¼šè·å¾—æ„å»ºé•œåƒæ‰€éœ€çš„ä¸€åˆ‡æ–‡ä»¶ã€‚</p>
<p>å¦‚æœåœ¨ <code>Dockerfile</code> ä¸­è¿™ä¹ˆå†™ï¼š</p>
<pre><code>COPY ./package.json /app/
</code></pre>
<p>è¿™å¹¶ä¸æ˜¯è¦å¤åˆ¶æ‰§è¡Œ <code>docker build</code> å‘½ä»¤æ‰€åœ¨çš„ç›®å½•ä¸‹çš„ <code>package.json</code>ï¼Œä¹Ÿä¸æ˜¯å¤åˆ¶ <code>Dockerfile</code> æ‰€åœ¨ç›®å½•ä¸‹çš„ <code>package.json</code>ï¼Œè€Œæ˜¯å¤åˆ¶ <strong>ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰</strong> ç›®å½•ä¸‹çš„ <code>package.json</code>ã€‚</p>
<p>å› æ­¤ï¼Œ<code>COPY</code> è¿™ç±»æŒ‡ä»¤ä¸­çš„æºæ–‡ä»¶çš„è·¯å¾„éƒ½æ˜¯<em>ç›¸å¯¹è·¯å¾„</em>ã€‚è¿™ä¹Ÿæ˜¯åˆå­¦è€…ç»å¸¸ä¼šé—®çš„ä¸ºä»€ä¹ˆ <code>COPY ../package.json /app</code> æˆ–è€… <code>COPY /opt/xxxx /app</code> æ— æ³•å·¥ä½œçš„åŸå› ï¼Œå› ä¸ºè¿™äº›è·¯å¾„å·²ç»è¶…å‡ºäº†ä¸Šä¸‹æ–‡çš„èŒƒå›´ï¼ŒDocker å¼•æ“æ— æ³•è·å¾—è¿™äº›ä½ç½®çš„æ–‡ä»¶ã€‚å¦‚æœçœŸçš„éœ€è¦é‚£äº›æ–‡ä»¶ï¼Œåº”è¯¥å°†å®ƒä»¬å¤åˆ¶åˆ°ä¸Šä¸‹æ–‡ç›®å½•ä¸­å»ã€‚</p>
<p>ç°åœ¨å°±å¯ä»¥ç†è§£åˆšæ‰çš„å‘½ä»¤ <code>docker build -t nginx:v3 .</code> ä¸­çš„è¿™ä¸ª <code>.</code>ï¼Œå®é™…ä¸Šæ˜¯åœ¨æŒ‡å®šä¸Šä¸‹æ–‡çš„ç›®å½•ï¼Œ<code>docker build</code> å‘½ä»¤ä¼šå°†è¯¥ç›®å½•ä¸‹çš„å†…å®¹æ‰“åŒ…äº¤ç»™ Docker å¼•æ“ä»¥å¸®åŠ©æ„å»ºé•œåƒã€‚</p>
<p>å¦‚æœè§‚å¯Ÿ <code>docker build</code> è¾“å‡ºï¼Œæˆ‘ä»¬å…¶å®å·²ç»çœ‹åˆ°äº†è¿™ä¸ªå‘é€ä¸Šä¸‹æ–‡çš„è¿‡ç¨‹ï¼š</p>
<pre><code class="language-bash">docker build -t nginx:v3 .
# è¾“å‡ºå¦‚ä¸‹
Sending build context to Docker daemon 2.048 kB
</code></pre>
<p>ç†è§£æ„å»ºä¸Šä¸‹æ–‡å¯¹äºé•œåƒæ„å»ºæ˜¯å¾ˆé‡è¦çš„ï¼Œé¿å…çŠ¯ä¸€äº›ä¸åº”è¯¥çš„é”™è¯¯ã€‚æ¯”å¦‚æœ‰äº›åˆå­¦è€…åœ¨å‘ç° <code>COPY /opt/xxxx /app</code> ä¸å·¥ä½œåï¼Œäºæ˜¯å¹²è„†å°† <code>Dockerfile</code> æ”¾åˆ°äº†ç¡¬ç›˜æ ¹ç›®å½•å»æ„å»ºï¼Œç»“æœå‘ç° <code>docker build</code> æ‰§è¡Œåï¼Œåœ¨å‘é€ä¸€ä¸ªå‡ å GB çš„ä¸œè¥¿ï¼Œæä¸ºç¼“æ…¢è€Œä¸”å¾ˆå®¹æ˜“æ„å»ºå¤±è´¥ã€‚é‚£æ˜¯å› ä¸ºè¿™ç§åšæ³•æ˜¯åœ¨è®© <code>docker build</code> æ‰“åŒ…æ•´ä¸ªç¡¬ç›˜ï¼Œè¿™æ˜¾ç„¶æ˜¯ä½¿ç”¨é”™è¯¯ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œåº”è¯¥ä¼šå°† <code>Dockerfile</code> ç½®äºä¸€ä¸ªç©ºç›®å½•ä¸‹ï¼Œæˆ–è€…é¡¹ç›®æ ¹ç›®å½•ä¸‹ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹æ²¡æœ‰æ‰€éœ€æ–‡ä»¶ï¼Œé‚£ä¹ˆåº”è¯¥æŠŠæ‰€éœ€æ–‡ä»¶å¤åˆ¶ä¸€ä»½è¿‡æ¥ã€‚å¦‚æœç›®å½•ä¸‹æœ‰äº›ä¸œè¥¿ç¡®å®ä¸å¸Œæœ›æ„å»ºæ—¶ä¼ ç»™ Docker å¼•æ“ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ <code>.gitignore</code> ä¸€æ ·çš„è¯­æ³•å†™ä¸€ä¸ª <code>.dockerignore</code>ï¼Œè¯¥æ–‡ä»¶æ˜¯ç”¨äºå‰”é™¤ä¸éœ€è¦ä½œä¸ºä¸Šä¸‹æ–‡ä¼ é€’ç»™ Docker å¼•æ“çš„ã€‚</p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šæœ‰äººè¯¯ä»¥ä¸º <code>.</code> æ˜¯æŒ‡å®š <code>Dockerfile</code> æ‰€åœ¨ç›®å½•å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸é¢å¤–æŒ‡å®š <code>Dockerfile</code> çš„è¯ï¼Œä¼šå°†ä¸Šä¸‹æ–‡ç›®å½•ä¸‹çš„åä¸º <code>Dockerfile</code> çš„æ–‡ä»¶ä½œä¸º Dockerfileã€‚</p>
<p>è¿™åªæ˜¯é»˜è®¤è¡Œä¸ºï¼Œå®é™…ä¸Š <code>Dockerfile</code> çš„æ–‡ä»¶åå¹¶ä¸è¦æ±‚å¿…é¡»ä¸º <code>Dockerfile</code>ï¼Œè€Œä¸”å¹¶ä¸è¦æ±‚å¿…é¡»ä½äºä¸Šä¸‹æ–‡ç›®å½•ä¸­ï¼Œæ¯”å¦‚å¯ä»¥ç”¨ <code>-f ../Dockerfile.php</code> å‚æ•°æŒ‡å®šæŸä¸ªæ–‡ä»¶ä½œä¸º <code>Dockerfile</code>ã€‚</p>
<p>å½“ç„¶ï¼Œä¸€èˆ¬å¤§å®¶ä¹ æƒ¯æ€§çš„ä¼šä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶å <code>Dockerfile</code>ï¼Œä»¥åŠä¼šå°†å…¶ç½®äºé•œåƒæ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ã€‚</p>
<h1 id="dockerfile-æŒ‡ä»¤">dockerfile æŒ‡ä»¤</h1>
<h2 id="æ¦‚è¿°-3">æ¦‚è¿°</h2>
<p>æˆ‘ä»¬å·²ç»ä»‹ç»äº† <code>FROM</code>ï¼Œ<code>RUN</code>ï¼Œè¿˜æåŠäº† <code>COPY</code>, <code>ADD</code>ï¼Œå…¶å® Dockerfile åŠŸèƒ½å¾ˆå¼ºå¤§ï¼Œå®ƒæä¾›äº†åå¤šä¸ªæŒ‡ä»¤ã€‚ä¸‹é¢æˆ‘ä»¬ç»§ç»­è®²è§£å…¶ä»–çš„æŒ‡ä»¤ã€‚</p>
<h2 id="copy">COPY</h2>
<p>æ ¼å¼ï¼š</p>
<ul>
<li><code>COPY &lt;æºè·¯å¾„&gt;... &lt;ç›®æ ‡è·¯å¾„&gt;</code></li>
<li><code>COPY [&quot;&lt;æºè·¯å¾„1&gt;&quot;,... &quot;&lt;ç›®æ ‡è·¯å¾„&gt;&quot;]</code></li>
</ul>
<p>å’Œ <code>RUN</code> æŒ‡ä»¤ä¸€æ ·ï¼Œä¹Ÿæœ‰ä¸¤ç§æ ¼å¼ï¼Œä¸€ç§ç±»ä¼¼äºå‘½ä»¤è¡Œï¼Œä¸€ç§ç±»ä¼¼äºå‡½æ•°è°ƒç”¨ã€‚</p>
<p><code>COPY</code> æŒ‡ä»¤å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ <code>&lt;æºè·¯å¾„&gt;</code> çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„ <code>&lt;ç›®æ ‡è·¯å¾„&gt;</code> ä½ç½®ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-dockerfile">COPY package.json /usr/src/app/
</code></pre>
<p><code>&lt;æºè·¯å¾„&gt;</code> å¯ä»¥æ˜¯å¤šä¸ªï¼Œç”šè‡³å¯ä»¥æ˜¯é€šé…ç¬¦ï¼Œå…¶é€šé…ç¬¦è§„åˆ™è¦æ»¡è¶³ Go çš„ <code>filepath.Match</code>è§„åˆ™ï¼Œå¦‚ï¼š</p>
<pre><code class="language-dockerfile">COPY hom* /mydir/
COPY hom?.txt /mydir/
</code></pre>
<p><code>&lt;ç›®æ ‡è·¯å¾„&gt;</code> å¯ä»¥æ˜¯å®¹å™¨å†…çš„ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äºå·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼ˆå·¥ä½œç›®å½•å¯ä»¥ç”¨ <code>WORKDIR</code> æŒ‡ä»¤æ¥æŒ‡å®šï¼‰ã€‚ç›®æ ‡è·¯å¾„ä¸éœ€è¦äº‹å…ˆåˆ›å»ºï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ä¼šåœ¨å¤åˆ¶æ–‡ä»¶å‰å…ˆè¡Œåˆ›å»ºç¼ºå¤±ç›®å½•ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œä½¿ç”¨ <code>COPY</code> æŒ‡ä»¤ï¼Œæºæ–‡ä»¶çš„å„ç§å…ƒæ•°æ®éƒ½ä¼šä¿ç•™ã€‚æ¯”å¦‚è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€æ–‡ä»¶å˜æ›´æ—¶é—´ç­‰ã€‚è¿™ä¸ªç‰¹æ€§å¯¹äºé•œåƒå®šåˆ¶å¾ˆæœ‰ç”¨ã€‚ç‰¹åˆ«æ˜¯æ„å»ºç›¸å…³æ–‡ä»¶éƒ½åœ¨ä½¿ç”¨ Git è¿›è¡Œç®¡ç†çš„æ—¶å€™ã€‚</p>
<h2 id="add">ADD</h2>
<p><code>ADD</code> æŒ‡ä»¤å’Œ <code>COPY</code> çš„æ ¼å¼å’Œæ€§è´¨åŸºæœ¬ä¸€è‡´ã€‚ä½†æ˜¯åœ¨ <code>COPY</code> åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›åŠŸèƒ½ã€‚</p>
<p>æ¯”å¦‚ <code>&lt;æºè·¯å¾„&gt;</code> å¯ä»¥æ˜¯ä¸€ä¸ª <code>URL</code>ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒDocker å¼•æ“ä¼šè¯•å›¾å»ä¸‹è½½è¿™ä¸ªé“¾æ¥çš„æ–‡ä»¶æ”¾åˆ° <code>&lt;ç›®æ ‡è·¯å¾„&gt;</code> å»ã€‚ä¸‹è½½åçš„æ–‡ä»¶æƒé™è‡ªåŠ¨è®¾ç½®ä¸º <code>600</code>ï¼Œå¦‚æœè¿™å¹¶ä¸æ˜¯æƒ³è¦çš„æƒé™ï¼Œé‚£ä¹ˆè¿˜éœ€è¦å¢åŠ é¢å¤–çš„ä¸€å±‚ <code>RUN</code> è¿›è¡Œæƒé™è°ƒæ•´ï¼Œå¦å¤–ï¼Œå¦‚æœä¸‹è½½çš„æ˜¯ä¸ªå‹ç¼©åŒ…ï¼Œéœ€è¦è§£å‹ç¼©ï¼Œä¹Ÿä¸€æ ·è¿˜éœ€è¦é¢å¤–çš„ä¸€å±‚ <code>RUN</code> æŒ‡ä»¤è¿›è¡Œè§£å‹ç¼©ã€‚æ‰€ä»¥ä¸å¦‚ç›´æ¥ä½¿ç”¨ <code>RUN</code> æŒ‡ä»¤ï¼Œç„¶åä½¿ç”¨ <code>wget</code> æˆ–è€… <code>curl</code> å·¥å…·ä¸‹è½½ï¼Œå¤„ç†æƒé™ã€è§£å‹ç¼©ã€ç„¶åæ¸…ç†æ— ç”¨æ–‡ä»¶æ›´åˆç†ã€‚å› æ­¤ï¼Œè¿™ä¸ªåŠŸèƒ½å…¶å®å¹¶ä¸å®ç”¨ï¼Œè€Œä¸”ä¸æ¨èä½¿ç”¨ã€‚</p>
<p>å¦‚æœ <code>&lt;æºè·¯å¾„&gt;</code> ä¸ºä¸€ä¸ª <code>tar</code> å‹ç¼©æ–‡ä»¶çš„è¯ï¼Œå‹ç¼©æ ¼å¼ä¸º <code>gzip</code>, <code>bzip2</code> ä»¥åŠ <code>xz</code> çš„æƒ…å†µä¸‹ï¼Œ<code>ADD</code> æŒ‡ä»¤å°†ä¼šè‡ªåŠ¨è§£å‹ç¼©è¿™ä¸ªå‹ç¼©æ–‡ä»¶åˆ° <code>&lt;ç›®æ ‡è·¯å¾„&gt;</code> å»ã€‚</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè‡ªåŠ¨è§£å‹ç¼©çš„åŠŸèƒ½éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚å®˜æ–¹é•œåƒ <code>ubuntu</code> ä¸­ï¼š</p>
<pre><code class="language-dockerfile">FROM scratch
ADD ubuntu-xenial-core-cloudimg-amd64-root.tar.gz /
</code></pre>
<p>ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çœŸçš„æ˜¯å¸Œæœ›å¤åˆ¶ä¸ªå‹ç¼©æ–‡ä»¶è¿›å»ï¼Œè€Œä¸è§£å‹ç¼©ï¼Œè¿™æ—¶å°±ä¸å¯ä»¥ä½¿ç”¨ <code>ADD</code> å‘½ä»¤äº†ã€‚</p>
<p>åœ¨ Docker å®˜æ–¹çš„ <code>Dockerfile æœ€ä½³å®è·µæ–‡æ¡£</code> ä¸­è¦æ±‚ï¼Œå°½å¯èƒ½çš„ä½¿ç”¨ <code>COPY</code>ï¼Œå› ä¸º <code>COPY</code> çš„è¯­ä¹‰å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯å¤åˆ¶æ–‡ä»¶è€Œå·²ï¼Œè€Œ <code>ADD</code> åˆ™åŒ…å«äº†æ›´å¤æ‚çš„åŠŸèƒ½ï¼Œå…¶è¡Œä¸ºä¹Ÿä¸ä¸€å®šå¾ˆæ¸…æ™°ã€‚æœ€é€‚åˆä½¿ç”¨ <code>ADD</code> çš„åœºåˆï¼Œå°±æ˜¯æ‰€æåŠçš„éœ€è¦è‡ªåŠ¨è§£å‹ç¼©çš„åœºåˆã€‚</p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>ADD</code> æŒ‡ä»¤ä¼šä»¤é•œåƒæ„å»ºç¼“å­˜å¤±æ•ˆï¼Œä»è€Œå¯èƒ½ä¼šä»¤é•œåƒæ„å»ºå˜å¾—æ¯”è¾ƒç¼“æ…¢ã€‚</p>
<p>å› æ­¤åœ¨ <code>COPY</code> å’Œ <code>ADD</code> æŒ‡ä»¤ä¸­é€‰æ‹©çš„æ—¶å€™ï¼Œå¯ä»¥éµå¾ªè¿™æ ·çš„åŸåˆ™ï¼Œæ‰€æœ‰çš„æ–‡ä»¶å¤åˆ¶å‡ä½¿ç”¨ <code>COPY</code> æŒ‡ä»¤ï¼Œä»…åœ¨éœ€è¦è‡ªåŠ¨è§£å‹ç¼©çš„åœºåˆä½¿ç”¨ <code>ADD</code>ã€‚</p>
<h2 id="cmd">CMD</h2>
<p><code>CMD</code> æŒ‡ä»¤çš„æ ¼å¼å’Œ <code>RUN</code> ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ä¸¤ç§æ ¼å¼ï¼š</p>
<ul>
<li><code>shell</code> æ ¼å¼ï¼š<code>CMD &lt;å‘½ä»¤&gt;</code></li>
<li><code>exec</code> æ ¼å¼ï¼š<code>CMD [&quot;å¯æ‰§è¡Œæ–‡ä»¶&quot;, &quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;...]</code></li>
<li>å‚æ•°åˆ—è¡¨æ ¼å¼ï¼š<code>CMD [&quot;å‚æ•°1&quot;, &quot;å‚æ•°2&quot;...]</code>ã€‚åœ¨æŒ‡å®šäº† <code>ENTRYPOINT</code> æŒ‡ä»¤åï¼Œç”¨ <code>CMD</code> æŒ‡å®šå…·ä½“çš„å‚æ•°ã€‚</li>
</ul>
<p>ä¹‹å‰ä»‹ç»å®¹å™¨çš„æ—¶å€™æ›¾ç»è¯´è¿‡ï¼ŒDocker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå®¹å™¨å°±æ˜¯è¿›ç¨‹ã€‚æ—¢ç„¶æ˜¯è¿›ç¨‹ï¼Œé‚£ä¹ˆåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šæ‰€è¿è¡Œçš„ç¨‹åºåŠå‚æ•°ã€‚<code>CMD</code> æŒ‡ä»¤å°±æ˜¯ç”¨äºæŒ‡å®šé»˜è®¤çš„å®¹å™¨ä¸»è¿›ç¨‹çš„å¯åŠ¨å‘½ä»¤çš„ã€‚</p>
<p>åœ¨è¿è¡Œæ—¶å¯ä»¥æŒ‡å®šæ–°çš„å‘½ä»¤æ¥æ›¿ä»£é•œåƒè®¾ç½®ä¸­çš„è¿™ä¸ªé»˜è®¤å‘½ä»¤ï¼Œæ¯”å¦‚ï¼Œ<code>ubuntu</code> é•œåƒé»˜è®¤çš„ <code>CMD</code> æ˜¯ <code>/bin/bash</code>ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ <code>docker run -it ubuntu</code> çš„è¯ï¼Œä¼šç›´æ¥è¿›å…¥ <code>bash</code>ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶æŒ‡å®šè¿è¡Œåˆ«çš„å‘½ä»¤ï¼Œå¦‚ <code>docker run -it ubuntu cat /etc/os-release</code>ã€‚è¿™å°±æ˜¯ç”¨ <code>cat /etc/os-release</code> å‘½ä»¤æ›¿æ¢äº†é»˜è®¤çš„ <code>/bin/bash</code> å‘½ä»¤äº†ï¼Œè¾“å‡ºäº†ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ã€‚</p>
<p>åœ¨æŒ‡ä»¤æ ¼å¼ä¸Šï¼Œä¸€èˆ¬æ¨èä½¿ç”¨ <code>exec</code> æ ¼å¼ï¼Œè¿™ç±»æ ¼å¼åœ¨è§£ææ—¶ä¼šè¢«è§£æä¸º JSON æ•°ç»„ï¼Œå› æ­¤ä¸€å®šè¦ä½¿ç”¨åŒå¼•å· <code>&quot;</code>ï¼Œè€Œä¸è¦ä½¿ç”¨å•å¼•å·ã€‚</p>
<p>å¦‚æœä½¿ç”¨ <code>shell</code> æ ¼å¼çš„è¯ï¼Œå®é™…çš„å‘½ä»¤ä¼šè¢«åŒ…è£…ä¸º <code>sh -c</code> çš„å‚æ•°çš„å½¢å¼è¿›è¡Œæ‰§è¡Œã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-dockerfile">CMD echo $HOME
</code></pre>
<p>åœ¨å®é™…æ‰§è¡Œä¸­ï¼Œä¼šå°†å…¶å˜æ›´ä¸ºï¼š</p>
<pre><code class="language-dockerfile">CMD [ &quot;sh&quot;, &quot;-c&quot;, &quot;echo $HOME&quot; ]
</code></pre>
<p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡çš„åŸå› ï¼Œå› ä¸ºè¿™äº›ç¯å¢ƒå˜é‡ä¼šè¢« shell è¿›è¡Œè§£æå¤„ç†ã€‚</p>
<p>æåˆ° <code>CMD</code> å°±ä¸å¾—ä¸æå®¹å™¨ä¸­åº”ç”¨åœ¨å‰å°æ‰§è¡Œå’Œåå°æ‰§è¡Œçš„é—®é¢˜ã€‚è¿™æ˜¯åˆå­¦è€…å¸¸å‡ºç°çš„ä¸€ä¸ªæ··æ·†ã€‚</p>
<p>Docker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå®¹å™¨ä¸­çš„åº”ç”¨éƒ½åº”è¯¥ä»¥å‰å°æ‰§è¡Œï¼Œè€Œä¸æ˜¯åƒè™šæ‹Ÿæœºã€ç‰©ç†æœºé‡Œé¢é‚£æ ·ï¼Œç”¨ upstart/systemd å»å¯åŠ¨åå°æœåŠ¡ï¼Œå®¹å™¨å†…æ²¡æœ‰åå°æœåŠ¡çš„æ¦‚å¿µã€‚</p>
<p>ä¸€äº›åˆå­¦è€…å°† <code>CMD</code> å†™ä¸ºï¼š</p>
<pre><code class="language-dockerfile">CMD service nginx start
</code></pre>
<p>ç„¶åå‘ç°å®¹å™¨æ‰§è¡Œåå°±ç«‹å³é€€å‡ºäº†ã€‚ç”šè‡³åœ¨å®¹å™¨å†…å»ä½¿ç”¨ <code>systemctl</code> å‘½ä»¤ç»“æœå´å‘ç°æ ¹æœ¬æ‰§è¡Œä¸äº†ã€‚è¿™å°±æ˜¯å› ä¸ºæ²¡æœ‰ææ˜ç™½å‰å°ã€åå°çš„æ¦‚å¿µï¼Œæ²¡æœ‰åŒºåˆ†å®¹å™¨å’Œè™šæ‹Ÿæœºçš„å·®å¼‚ï¼Œä¾æ—§åœ¨ä»¥ä¼ ç»Ÿè™šæ‹Ÿæœºçš„è§’åº¦å»ç†è§£å®¹å™¨ã€‚</p>
<p>å¯¹äºå®¹å™¨è€Œè¨€ï¼Œå…¶å¯åŠ¨ç¨‹åºå°±æ˜¯å®¹å™¨åº”ç”¨è¿›ç¨‹ï¼Œå®¹å™¨å°±æ˜¯ä¸ºäº†ä¸»è¿›ç¨‹è€Œå­˜åœ¨çš„ï¼Œä¸»è¿›ç¨‹é€€å‡ºï¼Œå®¹å™¨å°±å¤±å»äº†å­˜åœ¨çš„æ„ä¹‰ï¼Œä»è€Œé€€å‡ºï¼Œå…¶å®ƒè¾…åŠ©è¿›ç¨‹ä¸æ˜¯å®ƒéœ€è¦å…³å¿ƒçš„ä¸œè¥¿ã€‚</p>
<p>è€Œä½¿ç”¨ <code>service nginx start</code> å‘½ä»¤ï¼Œåˆ™æ˜¯å¸Œæœ› upstart æ¥ä»¥åå°å®ˆæŠ¤è¿›ç¨‹å½¢å¼å¯åŠ¨ <code>nginx</code> æœåŠ¡ã€‚è€Œåˆšæ‰è¯´äº† <code>CMD service nginx start</code> ä¼šè¢«ç†è§£ä¸º <code>CMD [ &quot;sh&quot;, &quot;-c&quot;, &quot;service nginx start&quot;]</code>ï¼Œå› æ­¤ä¸»è¿›ç¨‹å®é™…ä¸Šæ˜¯ <code>sh</code>ã€‚é‚£ä¹ˆå½“ <code>service nginx start</code> å‘½ä»¤ç»“æŸåï¼Œ<code>sh</code> ä¹Ÿå°±ç»“æŸäº†ï¼Œ<code>sh</code> ä½œä¸ºä¸»è¿›ç¨‹é€€å‡ºäº†ï¼Œè‡ªç„¶å°±ä¼šä»¤å®¹å™¨é€€å‡ºã€‚</p>
<p>æ­£ç¡®çš„åšæ³•æ˜¯ç›´æ¥æ‰§è¡Œ <code>nginx</code> å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”è¦æ±‚ä»¥å‰å°å½¢å¼è¿è¡Œã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-dockerfile">CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]
</code></pre>
<h2 id="entrypoint">ENTRYPOINT</h2>
<p><code>ENTRYPOINT</code> çš„æ ¼å¼å’Œ <code>RUN</code> æŒ‡ä»¤æ ¼å¼ä¸€æ ·ï¼Œåˆ†ä¸º <code>exec</code> æ ¼å¼å’Œ <code>shell</code> æ ¼å¼ã€‚</p>
<p><code>ENTRYPOINT</code> çš„ç›®çš„å’Œ <code>CMD</code> ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨æŒ‡å®šå®¹å™¨å¯åŠ¨ç¨‹åºåŠå‚æ•°ã€‚<code>ENTRYPOINT</code> åœ¨è¿è¡Œæ—¶ä¹Ÿå¯ä»¥æ›¿ä»£ï¼Œä¸è¿‡æ¯” <code>CMD</code> è¦ç•¥æ˜¾ç¹çï¼Œéœ€è¦é€šè¿‡ <code>docker run</code> çš„å‚æ•° <code>--entrypoint</code> æ¥æŒ‡å®šã€‚</p>
<p>å½“æŒ‡å®šäº† <code>ENTRYPOINT</code> åï¼Œ<code>CMD</code> çš„å«ä¹‰å°±å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸å†æ˜¯ç›´æ¥çš„è¿è¡Œå…¶å‘½ä»¤ï¼Œè€Œæ˜¯å°† <code>CMD</code> çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ ç»™ <code>ENTRYPOINT</code> æŒ‡ä»¤ï¼Œæ¢å¥è¯è¯´å®é™…æ‰§è¡Œæ—¶ï¼Œå°†å˜ä¸ºï¼š</p>
<pre><code class="language-dockerfile">&lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;
</code></pre>
<p>é‚£ä¹ˆæœ‰äº† <code>CMD</code> åï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ <code>ENTRYPOINT</code> å‘¢ï¼Ÿè¿™ç§ <code>&lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;</code> æœ‰ä»€ä¹ˆå¥½å¤„ä¹ˆï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªåœºæ™¯ã€‚</p>
<h3 id="åœºæ™¯ä¸€è®©é•œåƒå˜æˆåƒå‘½ä»¤ä¸€æ ·ä½¿ç”¨">åœºæ™¯ä¸€ï¼šè®©é•œåƒå˜æˆåƒå‘½ä»¤ä¸€æ ·ä½¿ç”¨</h3>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¾—çŸ¥è‡ªå·±å½“å‰å…¬ç½‘ IP çš„é•œåƒï¼Œé‚£ä¹ˆå¯ä»¥å…ˆç”¨ <code>CMD</code> æ¥å®ç°ï¼š</p>
<pre><code class="language-dockerfile">FROM ubuntu:16.04
RUN apt-get update \    
	&amp;&amp; apt-get install -y curl \    
	&amp;&amp; rm -rf /var/lib/apt/lists/*
CMD [ &quot;curl&quot;, &quot;-s&quot;, &quot;http://ip.cn&quot; ]
</code></pre>
<p>å‡å¦‚æˆ‘ä»¬ä½¿ç”¨ <code>docker build -t myip .</code> æ¥æ„å»ºé•œåƒçš„è¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æŸ¥è¯¢å½“å‰å…¬ç½‘ IPï¼Œåªéœ€è¦æ‰§è¡Œï¼š</p>
<pre><code class="language-dockerfile">docker run myip
 å½“å‰ IPï¼š61.148.226.66 æ¥è‡ªï¼šåŒ—äº¬å¸‚ è”é€š
</code></pre>
<p>å—¯ï¼Œè¿™ä¹ˆçœ‹èµ·æ¥å¥½åƒå¯ä»¥ç›´æ¥æŠŠé•œåƒå½“åšå‘½ä»¤ä½¿ç”¨äº†ï¼Œä¸è¿‡å‘½ä»¤æ€»æœ‰å‚æ•°ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›åŠ å‚æ•°å‘¢ï¼Ÿæ¯”å¦‚ä»ä¸Šé¢çš„ <code>CMD</code> ä¸­å¯ä»¥çœ‹åˆ°å®è´¨çš„å‘½ä»¤æ˜¯ <code>curl</code>ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¸Œæœ›æ˜¾ç¤º HTTP å¤´ä¿¡æ¯ï¼Œå°±éœ€è¦åŠ ä¸Š <code>-i</code> å‚æ•°ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥åŠ  <code>-i</code> å‚æ•°ç»™ <code>docker run myip</code> ä¹ˆï¼Ÿ</p>
<pre><code class="language-dockerfile">docker run myip -i
docker: Error response from daemon: invalid header field value &quot;oci runtime error: container_linux.go:247: starting container process caused \&quot;exec: \\\&quot;-i\\\&quot;: executable file not found in $PATH\&quot;\n&quot;.
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯æ‰§è¡Œæ–‡ä»¶æ‰¾ä¸åˆ°çš„æŠ¥é”™ï¼Œ<code>executable file not found</code>ã€‚ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œè·Ÿåœ¨é•œåƒååé¢çš„æ˜¯ <code>command</code>ï¼Œè¿è¡Œæ—¶ä¼šæ›¿æ¢ <code>CMD</code> çš„é»˜è®¤å€¼ã€‚å› æ­¤è¿™é‡Œçš„ <code>-i</code> æ›¿æ¢äº†åŸæ¥çš„ <code>CMD</code>ï¼Œè€Œä¸æ˜¯æ·»åŠ åœ¨åŸæ¥çš„ <code>curl -s http://ip.cn</code> åé¢ã€‚è€Œ <code>-i</code> æ ¹æœ¬ä¸æ˜¯å‘½ä»¤ï¼Œæ‰€ä»¥è‡ªç„¶æ‰¾ä¸åˆ°ã€‚</p>
<p>é‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¸Œæœ›åŠ å…¥ <code>-i</code> è¿™å‚æ•°ï¼Œæˆ‘ä»¬å°±å¿…é¡»é‡æ–°å®Œæ•´çš„è¾“å…¥è¿™ä¸ªå‘½ä»¤ï¼š</p>
<pre><code class="language-dockerfile">docker run myip curl -s http://ip.cn -i
</code></pre>
<p>è¿™æ˜¾ç„¶ä¸æ˜¯å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œä½¿ç”¨ <code>ENTRYPOINT</code> å°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç°åœ¨æˆ‘ä»¬é‡æ–°ç”¨ <code>ENTRYPOINT</code> æ¥å®ç°è¿™ä¸ªé•œåƒï¼š</p>
<pre><code class="language-dockerfile">FROM ubuntu:16.04
RUN apt-get update \    
	&amp;&amp; apt-get install -y curl \    
	&amp;&amp; rm -rf /var/lib/apt/lists/*
	ENTRYPOINT [ &quot;curl&quot;, &quot;-s&quot;, &quot;http://ip.cn&quot; ]
</code></pre>
<p>è¿™æ¬¡æˆ‘ä»¬å†æ¥å°è¯•ç›´æ¥ä½¿ç”¨ <code>docker run myip -i</code>ï¼š</p>
<pre><code class="language-dockerfile">docker run myip
å½“å‰ IPï¼š61.148.226.66 æ¥è‡ªï¼šåŒ—äº¬å¸‚ è”é€š

docker run myip -i
HTTP/1.1 200 OK
Server: nginx/1.8.0
Date: Tue, 22 Nov 2016 05:12:40 GMT
Content-Type: text/html; charset=UTF-8
Vary: Accept-Encoding
X-Powered-By: PHP/5.6.24-1~dotdeb+7.1
X-Cache: MISS from cache-2
X-Cache-Lookup: MISS from cache-2:80
X-Cache: MISS from proxy-2_6
Transfer-Encoding: chunked
Via: 1.1 cache-2:80, 1.1 proxy-2_6:8006
Connection: keep-aliveå½“å‰ IPï¼š61.148.226.66 æ¥è‡ªï¼šåŒ—äº¬å¸‚ è”é€š
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¬¡æˆåŠŸäº†ã€‚è¿™æ˜¯å› ä¸ºå½“å­˜åœ¨ <code>ENTRYPOINT</code> åï¼Œ<code>CMD</code> çš„å†…å®¹å°†ä¼šä½œä¸ºå‚æ•°ä¼ ç»™ <code>ENTRYPOINT</code>ï¼Œè€Œè¿™é‡Œ <code>-i</code> å°±æ˜¯æ–°çš„ <code>CMD</code>ï¼Œå› æ­¤ä¼šä½œä¸ºå‚æ•°ä¼ ç»™ <code>curl</code>ï¼Œä»è€Œè¾¾åˆ°äº†æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœã€‚</p>
<h3 id="åœºæ™¯äºŒåº”ç”¨è¿è¡Œå‰çš„å‡†å¤‡å·¥ä½œ">åœºæ™¯äºŒï¼šåº”ç”¨è¿è¡Œå‰çš„å‡†å¤‡å·¥ä½œ</h3>
<p>å¯åŠ¨å®¹å™¨å°±æ˜¯å¯åŠ¨ä¸»è¿›ç¨‹ï¼Œä½†æœ‰äº›æ—¶å€™ï¼Œå¯åŠ¨ä¸»è¿›ç¨‹å‰ï¼Œéœ€è¦ä¸€äº›å‡†å¤‡å·¥ä½œã€‚</p>
<p>æ¯”å¦‚ <code>mysql</code> ç±»çš„æ•°æ®åº“ï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ•°æ®åº“é…ç½®ã€åˆå§‹åŒ–çš„å·¥ä½œï¼Œè¿™äº›å·¥ä½œè¦åœ¨æœ€ç»ˆçš„ mysql æœåŠ¡å™¨è¿è¡Œä¹‹å‰è§£å†³ã€‚</p>
<p>æ­¤å¤–ï¼Œå¯èƒ½å¸Œæœ›é¿å…ä½¿ç”¨ <code>root</code> ç”¨æˆ·å»å¯åŠ¨æœåŠ¡ï¼Œä»è€Œæé«˜å®‰å…¨æ€§ï¼Œè€Œåœ¨å¯åŠ¨æœåŠ¡å‰è¿˜éœ€è¦ä»¥ <code>root</code> èº«ä»½æ‰§è¡Œä¸€äº›å¿…è¦çš„å‡†å¤‡å·¥ä½œï¼Œæœ€ååˆ‡æ¢åˆ°æœåŠ¡ç”¨æˆ·èº«ä»½å¯åŠ¨æœåŠ¡ã€‚æˆ–è€…é™¤äº†æœåŠ¡å¤–ï¼Œå…¶å®ƒå‘½ä»¤ä¾æ—§å¯ä»¥ä½¿ç”¨ <code>root</code> èº«ä»½æ‰§è¡Œï¼Œæ–¹ä¾¿è°ƒè¯•ç­‰ã€‚</p>
<p>è¿™äº›å‡†å¤‡å·¥ä½œæ˜¯å’Œå®¹å™¨ <code>CMD</code> æ— å…³çš„ï¼Œæ— è®º <code>CMD</code> ä¸ºä»€ä¹ˆï¼Œéƒ½éœ€è¦äº‹å…ˆè¿›è¡Œä¸€ä¸ªé¢„å¤„ç†çš„å·¥ä½œã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å†™ä¸€ä¸ªè„šæœ¬ï¼Œç„¶åæ”¾å…¥ <code>ENTRYPOINT</code> ä¸­å»æ‰§è¡Œï¼Œè€Œè¿™ä¸ªè„šæœ¬ä¼šå°†æ¥åˆ°çš„å‚æ•°ï¼ˆä¹Ÿå°±æ˜¯ <code>&lt;CMD&gt;</code>ï¼‰ä½œä¸ºå‘½ä»¤ï¼Œåœ¨è„šæœ¬æœ€åæ‰§è¡Œã€‚æ¯”å¦‚å®˜æ–¹é•œåƒ <code>redis</code> ä¸­å°±æ˜¯è¿™ä¹ˆåšçš„ï¼š</p>
<pre><code class="language-dockerfile">FROM alpine:3.4
RUN addgroup -S redis &amp;&amp; adduser -S -G redis redis
ENTRYPOINT [&quot;docker-entrypoint.sh&quot;]
EXPOSE 6379
CMD [ &quot;redis-server&quot; ]
</code></pre>
<p>å¯ä»¥çœ‹åˆ°å…¶ä¸­ä¸ºäº† redis æœåŠ¡åˆ›å»ºäº† redis ç”¨æˆ·ï¼Œå¹¶åœ¨æœ€åæŒ‡å®šäº† <code>ENTRYPOINT</code> ä¸º <code>docker-entrypoint.sh</code> è„šæœ¬ã€‚</p>
<pre><code class="language-dockerfile">#!/bin/sh

# allow the container to be started with `--user`
if [ &quot;$1&quot; = 'redis-server' -a &quot;$(id -u)&quot; = '0' ]; then    
	chown -R redis .    
	exec su-exec redis &quot;$0&quot; &quot;$@&quot;
fi

exec &quot;$@&quot;
</code></pre>
<p>è¯¥è„šæœ¬çš„å†…å®¹å°±æ˜¯æ ¹æ® <code>CMD</code> çš„å†…å®¹æ¥åˆ¤æ–­ï¼Œå¦‚æœæ˜¯ <code>redis-server</code> çš„è¯ï¼Œåˆ™åˆ‡æ¢åˆ° <code>redis</code> ç”¨æˆ·èº«ä»½å¯åŠ¨æœåŠ¡å™¨ï¼Œå¦åˆ™ä¾æ—§ä½¿ç”¨ <code>root</code> èº«ä»½æ‰§è¡Œã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-dockerfile">docker run -it redis id
uid=0(root) gid=0(root) groups=0(root)
</code></pre>
<h2 id="env">ENV</h2>
<p>æ ¼å¼æœ‰ä¸¤ç§ï¼š</p>
<ul>
<li><code>ENV &lt;key&gt; &lt;value&gt;</code></li>
<li><code>ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</code></li>
</ul>
<p>è¿™ä¸ªæŒ‡ä»¤å¾ˆç®€å•ï¼Œå°±æ˜¯è®¾ç½®ç¯å¢ƒå˜é‡è€Œå·²ï¼Œæ— è®ºæ˜¯åé¢çš„å…¶å®ƒæŒ‡ä»¤ï¼Œå¦‚ <code>RUN</code>ï¼Œè¿˜æ˜¯è¿è¡Œæ—¶çš„åº”ç”¨ï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™é‡Œå®šä¹‰çš„ç¯å¢ƒå˜é‡ã€‚</p>
<pre><code class="language-dockerfile">ENV VERSION=1.0 DEBUG=on \    
	NAME=&quot;Happy Feet&quot;
</code></pre>
<p>è¿™ä¸ªä¾‹å­ä¸­æ¼”ç¤ºäº†å¦‚ä½•æ¢è¡Œï¼Œä»¥åŠå¯¹å«æœ‰ç©ºæ ¼çš„å€¼ç”¨åŒå¼•å·æ‹¬èµ·æ¥çš„åŠæ³•ï¼Œè¿™å’Œ Shell ä¸‹çš„è¡Œä¸ºæ˜¯ä¸€è‡´çš„ã€‚</p>
<p>å®šä¹‰äº†ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆåœ¨åç»­çš„æŒ‡ä»¤ä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªç¯å¢ƒå˜é‡ã€‚æ¯”å¦‚åœ¨å®˜æ–¹ <code>node</code> é•œåƒ <code>Dockerfile</code> ä¸­ï¼Œå°±æœ‰ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š</p>
<pre><code class="language-dockerfile">ENV NODE_VERSION 7.2.0

RUN curl -SLO &quot;https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz&quot; \  
	&amp;&amp; curl -SLO &quot;https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc&quot; \  
	&amp;&amp; gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \  
	&amp;&amp; grep &quot; node-v$NODE_VERSION-linux-x64.tar.xz\$&quot; SHASUMS256.txt | sha256sum -c - \  
	&amp;&amp; tar -xJf &quot;node-v$NODE_VERSION-linux-x64.tar.xz&quot; -C /usr/local --strip-components=1 \  
	&amp;&amp; rm &quot;node-v$NODE_VERSION-linux-x64.tar.xz&quot; SHASUMS256.txt.asc SHASUMS256.txt \  
	&amp;&amp; ln -s /usr/local/bin/node /usr/local/bin/nodejs
</code></pre>
<p>åœ¨è¿™é‡Œå…ˆå®šä¹‰äº†ç¯å¢ƒå˜é‡ <code>NODE_VERSION</code>ï¼Œå…¶åçš„ <code>RUN</code> è¿™å±‚é‡Œï¼Œå¤šæ¬¡ä½¿ç”¨ <code>$NODE_VERSION</code> æ¥è¿›è¡Œæ“ä½œå®šåˆ¶ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå°†æ¥å‡çº§é•œåƒæ„å»ºç‰ˆæœ¬çš„æ—¶å€™ï¼Œåªéœ€è¦æ›´æ–° <code>7.2.0</code> å³å¯ï¼Œ<code>Dockerfile</code> æ„å»ºç»´æŠ¤å˜å¾—æ›´è½»æ¾äº†ã€‚</p>
<p>ä¸‹åˆ—æŒ‡ä»¤å¯ä»¥æ”¯æŒç¯å¢ƒå˜é‡å±•å¼€ï¼š <code>ADD</code>ã€<code>COPY</code>ã€<code>ENV</code>ã€<code>EXPOSE</code>ã€<code>LABEL</code>ã€<code>USER</code>ã€<code>WORKDIR</code>ã€<code>VOLUME</code>ã€<code>STOPSIGNAL</code>ã€<code>ONBUILD</code>ã€‚</p>
<p>å¯ä»¥ä»è¿™ä¸ªæŒ‡ä»¤åˆ—è¡¨é‡Œæ„Ÿè§‰åˆ°ï¼Œç¯å¢ƒå˜é‡å¯ä»¥ä½¿ç”¨çš„åœ°æ–¹å¾ˆå¤šï¼Œå¾ˆå¼ºå¤§ã€‚é€šè¿‡ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥è®©ä¸€ä»½ <code>Dockerfile</code> åˆ¶ä½œæ›´å¤šçš„é•œåƒï¼Œåªéœ€ä½¿ç”¨ä¸åŒçš„ç¯å¢ƒå˜é‡å³å¯ã€‚</p>
<h2 id="volume">VOLUME</h2>
<p>æ ¼å¼ä¸ºï¼š</p>
<ul>
<li><code>VOLUME [&quot;&lt;è·¯å¾„1&gt;&quot;, &quot;&lt;è·¯å¾„2&gt;&quot;...]</code></li>
<li><code>VOLUME &lt;è·¯å¾„&gt;</code></li>
</ul>
<p>ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œå®¹å™¨è¿è¡Œæ—¶åº”è¯¥å°½é‡ä¿æŒå®¹å™¨å­˜å‚¨å±‚ä¸å‘ç”Ÿå†™æ“ä½œï¼Œå¯¹äºæ•°æ®åº“ç±»éœ€è¦ä¿å­˜åŠ¨æ€æ•°æ®çš„åº”ç”¨ï¼Œå…¶æ•°æ®åº“æ–‡ä»¶åº”è¯¥ä¿å­˜äºå·(volume)ä¸­ï¼Œåé¢çš„ç« èŠ‚æˆ‘ä»¬ä¼šè¿›ä¸€æ­¥ä»‹ç» Docker å·çš„æ¦‚å¿µã€‚ä¸ºäº†é˜²æ­¢è¿è¡Œæ—¶ç”¨æˆ·å¿˜è®°å°†åŠ¨æ€æ–‡ä»¶æ‰€ä¿å­˜ç›®å½•æŒ‚è½½ä¸ºå·ï¼Œåœ¨ <code>Dockerfile</code> ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº‹å…ˆæŒ‡å®šæŸäº›ç›®å½•æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å¦‚æœç”¨æˆ·ä¸æŒ‡å®šæŒ‚è½½ï¼Œå…¶åº”ç”¨ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šå‘å®¹å™¨å­˜å‚¨å±‚å†™å…¥å¤§é‡æ•°æ®ã€‚</p>
<pre><code class="language-dockerfile">VOLUME /data
</code></pre>
<p>è¿™é‡Œçš„ <code>/data</code> ç›®å½•å°±ä¼šåœ¨è¿è¡Œæ—¶è‡ªåŠ¨æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œä»»ä½•å‘ <code>/data</code> ä¸­å†™å…¥çš„ä¿¡æ¯éƒ½ä¸ä¼šè®°å½•è¿›å®¹å™¨å­˜å‚¨å±‚ï¼Œä»è€Œä¿è¯äº†å®¹å™¨å­˜å‚¨å±‚çš„æ— çŠ¶æ€åŒ–ã€‚å½“ç„¶ï¼Œè¿è¡Œæ—¶å¯ä»¥è¦†ç›–è¿™ä¸ªæŒ‚è½½è®¾ç½®ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-dockerfile">docker run -d -v mydata:/data xxxx
</code></pre>
<p>åœ¨è¿™è¡Œå‘½ä»¤ä¸­ï¼Œå°±ä½¿ç”¨äº† <code>mydata</code> è¿™ä¸ªå‘½åå·æŒ‚è½½åˆ°äº† <code>/data</code> è¿™ä¸ªä½ç½®ï¼Œæ›¿ä»£äº† <code>Dockerfile</code> ä¸­å®šä¹‰çš„åŒ¿åå·çš„æŒ‚è½½é…ç½®ã€‚</p>
<h2 id="expose">EXPOSE</h2>
<p>æ ¼å¼ä¸º <code>EXPOSE &lt;ç«¯å£1&gt; [&lt;ç«¯å£2&gt;...]</code>ã€‚</p>
<p><code>EXPOSE</code> æŒ‡ä»¤æ˜¯å£°æ˜è¿è¡Œæ—¶å®¹å™¨æä¾›æœåŠ¡ç«¯å£ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå£°æ˜ï¼Œåœ¨è¿è¡Œæ—¶å¹¶ä¸ä¼šå› ä¸ºè¿™ä¸ªå£°æ˜åº”ç”¨å°±ä¼šå¼€å¯è¿™ä¸ªç«¯å£çš„æœåŠ¡ã€‚åœ¨ Dockerfile ä¸­å†™å…¥è¿™æ ·çš„å£°æ˜æœ‰ä¸¤ä¸ªå¥½å¤„ï¼Œä¸€ä¸ªæ˜¯å¸®åŠ©é•œåƒä½¿ç”¨è€…ç†è§£è¿™ä¸ªé•œåƒæœåŠ¡çš„å®ˆæŠ¤ç«¯å£ï¼Œä»¥æ–¹ä¾¿é…ç½®æ˜ å°„ï¼›å¦ä¸€ä¸ªç”¨å¤„åˆ™æ˜¯åœ¨è¿è¡Œæ—¶ä½¿ç”¨éšæœºç«¯å£æ˜ å°„æ—¶ï¼Œä¹Ÿå°±æ˜¯ <code>docker run -P</code> æ—¶ï¼Œä¼šè‡ªåŠ¨éšæœºæ˜ å°„ <code>EXPOSE</code> çš„ç«¯å£ã€‚</p>
<p>æ­¤å¤–ï¼Œåœ¨æ—©æœŸ Docker ç‰ˆæœ¬ä¸­è¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç”¨å¤„ã€‚ä»¥å‰æ‰€æœ‰å®¹å™¨éƒ½è¿è¡Œäºé»˜è®¤æ¡¥æ¥ç½‘ç»œä¸­ï¼Œå› æ­¤æ‰€æœ‰å®¹å™¨äº’ç›¸ä¹‹é—´éƒ½å¯ä»¥ç›´æ¥è®¿é—®ï¼Œè¿™æ ·å­˜åœ¨ä¸€å®šçš„å®‰å…¨æ€§é—®é¢˜ã€‚äºæ˜¯æœ‰äº†ä¸€ä¸ª Docker å¼•æ“å‚æ•° <code>--icc=false</code>ï¼Œå½“æŒ‡å®šè¯¥å‚æ•°åï¼Œå®¹å™¨é—´å°†é»˜è®¤æ— æ³•äº’è®¿ï¼Œé™¤éäº’ç›¸é—´ä½¿ç”¨äº† <code>--links</code> å‚æ•°çš„å®¹å™¨æ‰å¯ä»¥äº’é€šï¼Œå¹¶ä¸”åªæœ‰é•œåƒä¸­ <code>EXPOSE</code> æ‰€å£°æ˜çš„ç«¯å£æ‰å¯ä»¥è¢«è®¿é—®ã€‚è¿™ä¸ª <code>--icc=false</code> çš„ç”¨æ³•ï¼Œåœ¨å¼•å…¥äº† <code>docker network</code> åå·²ç»åŸºæœ¬ä¸ç”¨äº†ï¼Œé€šè¿‡è‡ªå®šä¹‰ç½‘ç»œå¯ä»¥å¾ˆè½»æ¾çš„å®ç°å®¹å™¨é—´çš„äº’è”ä¸éš”ç¦»ã€‚</p>
<p>è¦å°† <code>EXPOSE</code> å’Œåœ¨è¿è¡Œæ—¶ä½¿ç”¨ <code>-p &lt;å®¿ä¸»ç«¯å£&gt;:&lt;å®¹å™¨ç«¯å£&gt;</code> åŒºåˆ†å¼€æ¥ã€‚<code>-p</code>ï¼Œæ˜¯æ˜ å°„å®¿ä¸»ç«¯å£å’Œå®¹å™¨ç«¯å£ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯å°†å®¹å™¨çš„å¯¹åº”ç«¯å£æœåŠ¡å…¬å¼€ç»™å¤–ç•Œè®¿é—®ï¼Œè€Œ <code>EXPOSE</code> ä»…ä»…æ˜¯å£°æ˜å®¹å™¨æ‰“ç®—ä½¿ç”¨ä»€ä¹ˆç«¯å£è€Œå·²ï¼Œå¹¶ä¸ä¼šè‡ªåŠ¨åœ¨å®¿ä¸»è¿›è¡Œç«¯å£æ˜ å°„ã€‚</p>
<h2 id="workdir">WORKDIR</h2>
<p>æ ¼å¼ä¸º <code>WORKDIR &lt;å·¥ä½œç›®å½•è·¯å¾„&gt;</code>ã€‚</p>
<p>ä½¿ç”¨ <code>WORKDIR</code> æŒ‡ä»¤å¯ä»¥æ¥æŒ‡å®šå·¥ä½œç›®å½•ï¼ˆæˆ–è€…ç§°ä¸ºå½“å‰ç›®å½•ï¼‰ï¼Œä»¥åå„å±‚çš„å½“å‰ç›®å½•å°±è¢«æ”¹ä¸ºæŒ‡å®šçš„ç›®å½•ï¼Œå¦‚è¯¥ç›®å½•ä¸å­˜åœ¨ï¼Œ<code>WORKDIR</code> ä¼šå¸®ä½ å»ºç«‹ç›®å½•ã€‚</p>
<p>ä¹‹å‰æåˆ°ä¸€äº›åˆå­¦è€…å¸¸çŠ¯çš„é”™è¯¯æ˜¯æŠŠ <code>Dockerfile</code> ç­‰åŒäº Shell è„šæœ¬æ¥ä¹¦å†™ï¼Œè¿™ç§é”™è¯¯çš„ç†è§£è¿˜å¯èƒ½ä¼šå¯¼è‡´å‡ºç°ä¸‹é¢è¿™æ ·çš„é”™è¯¯ï¼š</p>
<pre><code class="language-dockerfile">RUN cd /app
RUN echo &quot;hello&quot; &gt; world.txt
</code></pre>
<p>å¦‚æœå°†è¿™ä¸ª <code>Dockerfile</code> è¿›è¡Œæ„å»ºé•œåƒè¿è¡Œåï¼Œä¼šå‘ç°æ‰¾ä¸åˆ° <code>/app/world.txt</code> æ–‡ä»¶ï¼Œæˆ–è€…å…¶å†…å®¹ä¸æ˜¯ <code>hello</code>ã€‚åŸå› å…¶å®å¾ˆç®€å•ï¼Œåœ¨ Shell ä¸­ï¼Œè¿ç»­ä¸¤è¡Œæ˜¯åŒä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œç¯å¢ƒï¼Œå› æ­¤å‰ä¸€ä¸ªå‘½ä»¤ä¿®æ”¹çš„å†…å­˜çŠ¶æ€ï¼Œä¼šç›´æ¥å½±å“åä¸€ä¸ªå‘½ä»¤ï¼›è€Œåœ¨ <code>Dockerfile</code> ä¸­ï¼Œè¿™ä¸¤è¡Œ <code>RUN</code> å‘½ä»¤çš„æ‰§è¡Œç¯å¢ƒæ ¹æœ¬ä¸åŒï¼Œæ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„å®¹å™¨ã€‚è¿™å°±æ˜¯å¯¹ <code>Dockerfile</code> æ„å»ºåˆ†å±‚å­˜å‚¨çš„æ¦‚å¿µä¸äº†è§£æ‰€å¯¼è‡´çš„é”™è¯¯ã€‚</p>
<p>ä¹‹å‰è¯´è¿‡æ¯ä¸€ä¸ª <code>RUN</code> éƒ½æ˜¯å¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€æ‰§è¡Œå‘½ä»¤ã€ç„¶åæäº¤å­˜å‚¨å±‚æ–‡ä»¶å˜æ›´ã€‚ç¬¬ä¸€å±‚ <code>RUN cd /app</code> çš„æ‰§è¡Œä»…ä»…æ˜¯å½“å‰è¿›ç¨‹çš„å·¥ä½œç›®å½•å˜æ›´ï¼Œä¸€ä¸ªå†…å­˜ä¸Šçš„å˜åŒ–è€Œå·²ï¼Œå…¶ç»“æœä¸ä¼šé€ æˆä»»ä½•æ–‡ä»¶å˜æ›´ã€‚è€Œåˆ°ç¬¬äºŒå±‚çš„æ—¶å€™ï¼Œå¯åŠ¨çš„æ˜¯ä¸€ä¸ªå…¨æ–°çš„å®¹å™¨ï¼Œè·Ÿç¬¬ä¸€å±‚çš„å®¹å™¨æ›´å®Œå…¨æ²¡å…³ç³»ï¼Œè‡ªç„¶ä¸å¯èƒ½ç»§æ‰¿å‰ä¸€å±‚æ„å»ºè¿‡ç¨‹ä¸­çš„å†…å­˜å˜åŒ–ã€‚</p>
<p>å› æ­¤å¦‚æœéœ€è¦æ”¹å˜ä»¥åå„å±‚çš„å·¥ä½œç›®å½•çš„ä½ç½®ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨ <code>WORKDIR</code> æŒ‡ä»¤ã€‚</p>
<h1 id="docker-compose-ç®€ä»‹">docker compose ç®€ä»‹</h1>
<h2 id="æ¦‚è¿°-4">æ¦‚è¿°</h2>
<p>Compose é¡¹ç›®æ˜¯ Docker å®˜æ–¹çš„å¼€æºé¡¹ç›®ï¼Œè´Ÿè´£å®ç°å¯¹ Docker å®¹å™¨é›†ç¾¤çš„å¿«é€Ÿç¼–æ’ã€‚ä»åŠŸèƒ½ä¸Šçœ‹ï¼Œè·Ÿ OpenStack ä¸­çš„ Heat ååˆ†ç±»ä¼¼ã€‚</p>
<p>å…¶ä»£ç ç›®å‰åœ¨ https://github.com/docker/composeä¸Šå¼€æºã€‚</p>
<p>Compose å®šä½æ˜¯ ã€Œå®šä¹‰å’Œè¿è¡Œå¤šä¸ª Docker å®¹å™¨çš„åº”ç”¨ï¼ˆDefining and running multi-container Docker applicationsï¼‰ã€ï¼Œå…¶å‰èº«æ˜¯å¼€æºé¡¹ç›® Figã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ä½¿ç”¨ä¸€ä¸ª Dockerfile æ¨¡æ¿æ–‡ä»¶ï¼Œå¯ä»¥è®©ç”¨æˆ·å¾ˆæ–¹ä¾¿çš„å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„åº”ç”¨å®¹å™¨ã€‚ç„¶è€Œï¼Œåœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œç»å¸¸ä¼šç¢°åˆ°éœ€è¦å¤šä¸ªå®¹å™¨ç›¸äº’é…åˆæ¥å®ŒæˆæŸé¡¹ä»»åŠ¡çš„æƒ…å†µã€‚ä¾‹å¦‚è¦å®ç°ä¸€ä¸ª Web é¡¹ç›®ï¼Œé™¤äº† Web æœåŠ¡å®¹å™¨æœ¬èº«ï¼Œå¾€å¾€è¿˜éœ€è¦å†åŠ ä¸Šåç«¯çš„æ•°æ®åº“æœåŠ¡å®¹å™¨ï¼Œç”šè‡³è¿˜åŒ…æ‹¬è´Ÿè½½å‡è¡¡å®¹å™¨ç­‰ã€‚</p>
<p>Compose æ°å¥½æ»¡è¶³äº†è¿™æ ·çš„éœ€æ±‚ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ <strong>docker-compose.yml</strong> æ¨¡æ¿æ–‡ä»¶ï¼ˆYAML æ ¼å¼ï¼‰æ¥å®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ä¸ºä¸€ä¸ªé¡¹ç›®ï¼ˆProjectï¼‰ã€‚Compose ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š</p>
<ul>
<li>æœåŠ¡ (Service)ï¼šä¸€ä¸ªåº”ç”¨çš„å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥åŒ…æ‹¬è‹¥å¹²è¿è¡Œç›¸åŒé•œåƒçš„å®¹å™¨å®ä¾‹ã€‚</li>
<li>é¡¹ç›® (Project)ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨ docker-compose.yml æ–‡ä»¶ä¸­å®šä¹‰ã€‚</li>
</ul>
<p>Compose çš„é»˜è®¤ç®¡ç†å¯¹è±¡æ˜¯é¡¹ç›®ï¼Œé€šè¿‡å­å‘½ä»¤å¯¹é¡¹ç›®ä¸­çš„ä¸€ç»„å®¹å™¨è¿›è¡Œä¾¿æ·åœ°ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚Compose é¡¹ç›®ç”± Python ç¼–å†™ï¼Œå®ç°ä¸Šè°ƒç”¨äº† Docker æœåŠ¡æä¾›çš„ API æ¥å¯¹å®¹å™¨è¿›è¡Œç®¡ç†ã€‚å› æ­¤ï¼Œåªè¦æ‰€æ“ä½œçš„å¹³å°æ”¯æŒ Docker APIï¼Œå°±å¯ä»¥åœ¨å…¶ä¸Šåˆ©ç”¨ Compose æ¥è¿›è¡Œç¼–æ’ç®¡ç†ã€‚</p>
<h2 id="å®‰è£…-docker-compose">å®‰è£… Docker Compose</h2>
<p>Compose æ”¯æŒ Linuxã€macOSã€Windows 10 ä¸‰å¤§å¹³å°ã€‚åœ¨ Linux ä¸Šçš„ä¹Ÿå®‰è£…ååˆ†ç®€å•ï¼Œä» å®˜æ–¹ GitHub Release å¤„ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶å³å¯ã€‚</p>
<pre><code class="language-bash">curl -L https://github.com/docker/compose/releases/download/1.24.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose
# ä¸Šé¢æ˜¯å®˜æ–¹æä¾›çš„ä¸‹è½½åœ°å€ å¯èƒ½ä¼šé“¾æ¥ä¸ç¨³å®šå¯¼è‡´ä¸‹è½½ä¸ä¸‹æ¥ å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªåœ°å€è¿›è¡Œå®‰è£…
curl -L https://get.daocloud.io/docker/compose/releases/download/1.24.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose dockercompose
chmod +x /usr/local/bin/docker-compose
</code></pre>
<h2 id="éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ">éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</h2>
<pre><code class="language-bash">docker-compose version
# è¾“å‡ºå¦‚ä¸‹
docker-compose version 1.24.0, build 0aa59064
docker-py version: 3.7.2
CPython version: 3.6.8
OpenSSL version: OpenSSL 1.1.0j  20 Nov 2018
</code></pre>
<h1 id="docker-compose-ä½¿ç”¨">docker compose ä½¿ç”¨</h1>
<h2 id="æœ¯è¯­">æœ¯è¯­</h2>
<p>é¦–å…ˆä»‹ç»å‡ ä¸ªæœ¯è¯­ã€‚</p>
<ul>
<li>æœåŠ¡ (Service)ï¼šä¸€ä¸ªåº”ç”¨å®¹å™¨ï¼Œå®é™…ä¸Šå¯ä»¥è¿è¡Œå¤šä¸ªç›¸åŒé•œåƒçš„å®ä¾‹ã€‚</li>
<li>é¡¹ç›® (Project)ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒã€‚</li>
</ul>
<p>å¯è§ï¼Œä¸€ä¸ªé¡¹ç›®å¯ä»¥ç”±å¤šä¸ªæœåŠ¡ï¼ˆå®¹å™¨ï¼‰å…³è”è€Œæˆï¼ŒCompose é¢å‘é¡¹ç›®è¿›è¡Œç®¡ç†ã€‚</p>
<h2 id="åœºæ™¯">åœºæ™¯</h2>
<p>æœ€å¸¸è§çš„é¡¹ç›®æ˜¯ Web ç½‘ç«™ï¼Œè¯¥é¡¹ç›®åº”è¯¥åŒ…å« Web åº”ç”¨å’Œç¼“å­˜ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨ Python æ¥å»ºç«‹ä¸€ä¸ªèƒ½å¤Ÿè®°å½•é¡µé¢è®¿é—®æ¬¡æ•°çš„ Web ç½‘ç«™ã€‚</p>
<h3 id="python-åº”ç”¨">Python åº”ç”¨</h3>
<p>æ–°å»ºæ–‡ä»¶å¤¹ï¼Œåœ¨è¯¥ç›®å½•ä¸­ç¼–å†™ <code>app.py</code> æ–‡ä»¶</p>
<pre><code class="language-python">from flask import Flask
from redis import Redis

app = Flask(__name__)
redis = Redis(host='redis', port=6379)

@app.route('/')d
ef hello():    
	count = redis.incr('hits')    
	return 'Hello World! è¯¥é¡µé¢å·²è¢«è®¿é—® {} æ¬¡ã€‚\n'.format(count)
	
if __name__ == &quot;__main__&quot;:    
	app.run(host=&quot;0.0.0.0&quot;, debug=True)
</code></pre>
<h3 id="dockerfile">Dockerfile</h3>
<p>ç¼–å†™ Dockerfile æ–‡ä»¶ï¼Œå†…å®¹ä¸º</p>
<pre><code class="language-dockerfile">FROM python:3.6-alpine
ADD . /code
WORKDIR /code
RUN pip install redis flask
CMD [&quot;python&quot;, &quot;app.py&quot;]
</code></pre>
<h3 id="docker-compose-æ¨¡æ¿">Docker Compose æ¨¡æ¿</h3>
<p>ç¼–å†™ <code>docker-compose.yml</code> æ–‡ä»¶ï¼Œè¿™ä¸ªæ˜¯ Compose ä½¿ç”¨çš„ä¸»æ¨¡æ¿æ–‡ä»¶ã€‚</p>
<pre><code class="language-yaml">version: '3'
services:  
   web:    
      build: .    
      ports:     
        - &quot;5000:5000&quot;  
   redis:    
      image: &quot;redis:alpine&quot;
</code></pre>
<h3 id="è¿è¡Œ-compose-é¡¹ç›®">è¿è¡Œ Compose é¡¹ç›®</h3>
<pre><code class="language-dockerfile">docker-compose up -d
</code></pre>
<p>æ­¤æ—¶è®¿é—®æœ¬åœ° <code>5000</code> ç«¯å£ï¼Œæ¯æ¬¡åˆ·æ–°é¡µé¢ï¼Œè®¡æ•°å°±ä¼šåŠ  1ã€‚</p>
<p>###ä½¿ç”¨docker compose å®‰è£…å¯åŠ¨tomcat</p>
<ul>
<li>
<p><code>cd /usr/local/</code>:åˆ°<code>usr/local</code>ç›®å½•ä¸‹</p>
</li>
<li>
<p><code>mkdir -p docker/tomcat</code>:åˆ›å»ºæµ‹è¯•ç›®å½•</p>
</li>
<li>
<p><code>vi docker-compose.yml</code>:åˆ›å»ºdocker compose ymlæ–‡ä»¶</p>
</li>
</ul>
<pre><code class="language-dockerfile"># ç²˜è´´å†…å®¹åˆ°ymlä¸­,éœ€è¦åŸæ ·ç²˜è´´
version: '3.1'
services:
    tomcat:
        restart: always
        image: tomcat
        container_name: tomcat
        ports:
          - 8080:8080
</code></pre>
<ul>
<li><code>docker-compose up</code>:åˆ›å»ºæˆåŠŸåæ‰§è¡Œdocker-compose up [-d]æ–‡ä»¶ <code>-d</code>å®ˆæŠ¤æ€è¿è¡Œ</li>
</ul>
<h2 id="æ‰©å±•é˜…è¯»-2">æ‰©å±•é˜…è¯»</h2>
<h3 id="yaml-é…ç½®æ–‡ä»¶è¯­è¨€">YAML é…ç½®æ–‡ä»¶è¯­è¨€</h3>
<p>YAML æ˜¯ä¸“é—¨ç”¨æ¥å†™é…ç½®æ–‡ä»¶çš„è¯­è¨€ï¼Œéå¸¸ç®€æ´å’Œå¼ºå¤§ï¼Œè¿œæ¯” JSON æ ¼å¼æ–¹ä¾¿ã€‚YAML è¯­è¨€çš„è®¾è®¡ç›®æ ‡ï¼Œå°±æ˜¯æ–¹ä¾¿äººç±»è¯»å†™ã€‚å®ƒå®è´¨ä¸Šæ˜¯ä¸€ç§é€šç”¨çš„æ•°æ®ä¸²è¡ŒåŒ–æ ¼å¼ã€‚å®ƒçš„åŸºæœ¬è¯­æ³•è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>å¤§å°å†™æ•æ„Ÿ</strong></li>
<li><strong>ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</strong></li>
<li><strong>ç¼©è¿›æ—¶ä¸å…è®¸ä½¿ç”¨ TAB é”®ï¼Œåªå…è®¸ä½¿ç”¨ç©ºæ ¼ã€‚</strong></li>
<li><strong>ç¼©è¿›çš„ç©ºæ ¼æ•°ç›®ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦ä¾§å¯¹é½å³å¯</strong></li>
</ul>
<p><code>#</code> è¡¨ç¤ºæ³¨é‡Šï¼Œä»è¿™ä¸ªå­—ç¬¦ä¸€ç›´åˆ°è¡Œå°¾ï¼Œéƒ½ä¼šè¢«è§£æå™¨å¿½ç•¥ã€‚YAML æ”¯æŒçš„æ•°æ®ç»“æ„æœ‰ä¸‰ç§ï¼š</p>
<ul>
<li><strong>å¯¹è±¡ï¼š</strong> é”®å€¼å¯¹çš„é›†åˆï¼Œåˆç§°ä¸ºæ˜ å°„ï¼ˆmappingï¼‰/ å“ˆå¸Œï¼ˆhashesï¼‰ / å­—å…¸ï¼ˆdictionaryï¼‰</li>
<li><strong>æ•°ç»„ï¼š</strong> ä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ï¼Œåˆç§°ä¸ºåºåˆ—ï¼ˆsequenceï¼‰ / åˆ—è¡¨ï¼ˆlistï¼‰</li>
<li><strong>çº¯é‡ï¼ˆscalarsï¼‰ï¼š</strong> å•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼</li>
</ul>
<h4 id="yaml-å¯¹è±¡">YAML å¯¹è±¡</h4>
<p>å¯¹è±¡çš„ä¸€ç»„é”®å€¼å¯¹ï¼Œä½¿ç”¨å†’å·ç»“æ„è¡¨ç¤º</p>
<pre><code class="language-yaml">animal: pets
</code></pre>
<h4 id="yaml-æ•°ç»„">YAML æ•°ç»„</h4>
<p>ä¸€ç»„è¿è¯çº¿å¼€å¤´çš„è¡Œï¼Œæ„æˆä¸€ä¸ªæ•°ç»„</p>
<pre><code class="language-yaml">- Cat
- Dog
- Goldfish
</code></pre>
<p>æ•°æ®ç»“æ„çš„å­æˆå‘˜æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™å¯ä»¥åœ¨è¯¥é¡¹ä¸‹é¢ç¼©è¿›ä¸€ä¸ªç©ºæ ¼</p>
<pre><code class="language-yaml">- Array 
  - Cat 
  - Dog 
  - Goldfish
</code></pre>
<h4 id="yaml-å¤åˆç»“æ„">YAML å¤åˆç»“æ„</h4>
<p>å¯¹è±¡å’Œæ•°ç»„å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œå½¢æˆå¤åˆç»“æ„</p>
<pre><code class="language-yaml">languages: 
   - Ruby 
   - Perl 
   - Python 
websites: 
   YAML: yaml.org  
   Ruby: ruby-lang.org  
   Python: python.org  
   Perl: use.perl.org 
</code></pre>
<h4 id="yaml-çº¯é‡">YAML çº¯é‡</h4>
<p>çº¯é‡æ˜¯æœ€åŸºæœ¬çš„ã€ä¸å¯å†åˆ†çš„å€¼ã€‚ä»¥ä¸‹æ•°æ®ç±»å‹éƒ½å±äº JavaScript çš„çº¯é‡</p>
<ul>
<li>å­—ç¬¦ä¸²</li>
<li>å¸ƒå°”å€¼</li>
<li>æ•´æ•°</li>
<li>æµ®ç‚¹æ•°</li>
<li>Null</li>
<li>æ—¶é—´</li>
<li>æ—¥æœŸ</li>
</ul>
<h3 id="ä¿®æ”¹-ip-å’Œ-dns">ä¿®æ”¹ IP å’Œ DNS</h3>
<p>è¯¾ç¨‹æ¼”ç¤ºä¼šé‡‡ç”¨å¤šè™šæ‹Ÿæœºæ¨¡æ‹Ÿåˆ†å¸ƒå¼åœºæ™¯ï¼Œä¸ºé˜²æ­¢ IP å†²çªï¼Œæ— æ³•è”ç½‘ç­‰é—®é¢˜ï¼Œéœ€è¦é¢„å…ˆè®¾ç½®å¥½ä¸»æœºåã€IPã€DNS é…ç½®(ä¿®æ”¹å®Œå¾—é‡å¯ç³»ç»Ÿ)</p>
<h4 id="ä¿®æ”¹ä¸»æœºå">ä¿®æ”¹ä¸»æœºå</h4>
<ul>
<li>ä¿®æ”¹ cloud.cfg é˜²æ­¢é‡å¯åä¸»æœºåè¿˜åŸ</li>
</ul>
<pre><code class="language-bash">vi /etc/cloud/cloud.cfg
# è¯¥é…ç½®é»˜è®¤ä¸º falseï¼Œä¿®æ”¹ä¸º true å³å¯
preserve_hostname: true
</code></pre>
<ul>
<li>ä¿®æ”¹ä¸»æœºå</li>
</ul>
<pre><code class="language-bash"># ä¿®æ”¹ä¸»æœºå
hostnamectl set-hostname deployment

# é…ç½® hosts
cat &gt;&gt; /etc/hosts &lt;&lt; EOF
192.168.141.130 deployment
EOF
</code></pre>
<h4 id="ä¿®æ”¹-ip">ä¿®æ”¹ IP</h4>
<p>ç¼–è¾‘ <code>vi /etc/netplan/50-cloud-init.yaml</code> é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹å†…å®¹å¦‚ä¸‹</p>
<pre><code class="language-yaml">network:    
   ethernets:        
       ens33:          
          addresses: [192.168.141.130/24]          
          gateway4: 192.168.141.2          
          nameservers:            
             addresses: [192.168.141.2]    
    version: 2
</code></pre>
<p>ä½¿ç”¨ <code>netplan apply</code> å‘½ä»¤è®©é…ç½®ç”Ÿæ•ˆ</p>
<h4 id="ä¿®æ”¹-dns">ä¿®æ”¹ DNS</h4>
<pre><code class="language-bash"># å–æ¶ˆ DNS è¡Œæ³¨é‡Šï¼Œå¹¶å¢åŠ  DNS é…ç½®å¦‚ï¼š114.114.114.114ï¼Œä¿®æ”¹åé‡å¯ä¸‹è®¡ç®—æœº
vi /etc/systemd/resolved.conf
</code></pre>
<h1 id="docker-compose-éƒ¨ç½²åº”ç”¨ç¨‹åº">docker compose éƒ¨ç½²åº”ç”¨ç¨‹åº</h1>
<h2 id="éƒ¨ç½²-tomcat">éƒ¨ç½² Tomcat</h2>
<pre><code class="language-yaml">version: '3.1'
services:  
  tomcat:    
     restart: always    
     image: tomcat
     container_name: tomcat    
     ports:      
        - 8080:8080    
     volumes:      
        - ./webapps:/usr/local/tomcat/webapps    
     environment:      
        TZ: Asia/Shanghai
</code></pre>
<h2 id="éƒ¨ç½²-mysql">éƒ¨ç½² MySQL</h2>
<pre><code class="language-yaml">version: '3.1'
services:  
   db:    
     # ç›®å‰ latest ç‰ˆæœ¬ä¸º MySQL8.x    
     image: mysql    
     restart: always    
     environment:      
        MYSQL_ROOT_PASSWORD: 123456    
     command:      
        --default-authentication-plugin=mysql_native_password      
        --character-set-server=utf8mb4      
        --collation-server=utf8mb4_general_ci      
        --explicit_defaults_for_timestamp=true      
        --lower_case_table_names=1    
     ports:      
        - 3306:3306    
     volumes:      
        - ./data:/var/lib/mysql  
      
   # MySQL çš„ Web å®¢æˆ·ç«¯  
   adminer:    
      image: adminer    
      restart: always    
      ports:      
        - 8081:8080
</code></pre>
<h1 id="docker-compose-éƒ¨ç½²-gitlab">docker compose éƒ¨ç½² GitLab</h1>
<h2 id="ä»€ä¹ˆæ˜¯-gitlab">ä»€ä¹ˆæ˜¯ GitLab</h2>
<p>GitLab æ˜¯åˆ©ç”¨ Ruby on Rails ä¸€ä¸ªå¼€æºçš„ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿï¼Œå®ç°ä¸€ä¸ªè‡ªæ‰˜ç®¡çš„ Git é¡¹ç›®ä»“åº“ï¼Œå¯é€šè¿‡ Web ç•Œé¢è¿›è¡Œè®¿é—®å…¬å¼€çš„æˆ–è€…ç§äººé¡¹ç›®ã€‚å®ƒæ‹¥æœ‰ä¸ Github ç±»ä¼¼çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿæµè§ˆæºä»£ç ï¼Œç®¡ç†ç¼ºé™·å’Œæ³¨é‡Šã€‚å¯ä»¥ç®¡ç†å›¢é˜Ÿå¯¹ä»“åº“çš„è®¿é—®ï¼Œå®ƒéå¸¸æ˜“äºæµè§ˆæäº¤è¿‡çš„ç‰ˆæœ¬å¹¶æä¾›ä¸€ä¸ªæ–‡ä»¶å†å²åº“ã€‚å›¢é˜Ÿæˆå‘˜å¯ä»¥åˆ©ç”¨å†…ç½®çš„ç®€å•èŠå¤©ç¨‹åº (Wall) è¿›è¡Œäº¤æµã€‚å®ƒè¿˜æä¾›ä¸€ä¸ªä»£ç ç‰‡æ®µæ”¶é›†åŠŸèƒ½å¯ä»¥è½»æ¾å®ç°ä»£ç å¤ç”¨ï¼Œä¾¿äºæ—¥åæœ‰éœ€è¦çš„æ—¶å€™è¿›è¡ŒæŸ¥æ‰¾ã€‚</p>
<h2 id="éƒ¨ç½²-gitlab">éƒ¨ç½² GitLab</h2>
<p>æˆ‘ä»¬ä½¿ç”¨ Docker æ¥å®‰è£…å’Œè¿è¡Œ GitLab ä¸­æ–‡ç‰ˆï¼Œ<code>docker-compose.yml</code> é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="language-yaml">version: '3'
services:
    web:
      image: 'twang2218/gitlab-ce-zh'
      restart: always
      hostname: '192.168.75.145'
      environment:
        TZ: 'Asia/Shanghai'
        GITLAB_OMNIBUS_CONFIG: |
          external_url 'http://192.168.75.145'
          gitlab_rails['gitlab_shell_ssh_port'] = 2222
          unicorn['port'] = 8888
          nginx['listen_port'] = 80
      ports:
        - '80:80'
        - '443:443'
        - '2222:22'
      volumes:
        - ./config:/etc/gitlab
        - ./data:/var/opt/gitlab
        - ./logs:/var/log/gitlab
</code></pre>
<h2 id="é…ç½®-gitlab">é…ç½® GitLab</h2>
<ul>
<li>
<p>è®¿é—®åœ°å€ï¼šhttp://ip:8080</p>
</li>
<li>
<p>è®¾ç½®ç®¡ç†å‘˜åˆå§‹å¯†ç ï¼Œè¿™é‡Œçš„å¯†ç æœ€å¥½æ˜¯ <strong>å­—æ¯ + æ•°å­—ç»„åˆï¼Œå¹¶ä¸”å¤§äºç­‰äº 8 ä½</strong></p>
</li>
<li>
<p>é…ç½®å®Œæˆåç™»å½•ï¼Œç®¡ç†å‘˜è´¦å·æ˜¯ <strong>root</strong></p>
</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> å¦‚æœæœåŠ¡å™¨é…ç½®è¾ƒä½ï¼Œå¯åŠ¨è¿è¡Œå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…</p>
</blockquote>
<h2 id="è®¾ç½®-gitlab">è®¾ç½® GitLab</h2>
<p>ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶å¯ä»¥åšä¸€äº›åˆå§‹åŒ–è®¾ç½®ï¼Œç‚¹å‡» <strong>ç®¡ç†åŒºåŸŸ</strong> -&gt; <strong>è®¾ç½®</strong></p>
<ul>
<li>
<p>å…³é—­å¤´åƒåŠŸèƒ½ï¼Œç”±äº Gravatar å¤´åƒä¸ºç½‘ç»œå¤´åƒï¼Œåœ¨ç½‘ç»œæƒ…å†µä¸ç†æƒ³æ—¶å¯èƒ½å¯¼è‡´è®¿é—®æ—¶å¡é¡¿</p>
</li>
<li>
<p>ç”±äºæ˜¯å†…éƒ¨ä»£ç æ‰˜ç®¡æœåŠ¡å™¨ï¼Œå¯ä»¥ç›´æ¥å…³é—­æ³¨å†ŒåŠŸèƒ½ï¼Œç”±ç®¡ç†å‘˜ç»Ÿä¸€åˆ›å»ºç”¨æˆ·å³å¯</p>
</li>
</ul>
<h2 id="è´¦æˆ·ç®¡ç†">è´¦æˆ·ç®¡ç†</h2>
<p>ä½¿ç”¨æ—¶è¯·ä¸è¦ç›´æ¥é€šè¿‡ root ç”¨æˆ·æ“ä½œï¼Œéœ€è¦å…ˆåˆ›å»ºç”¨æˆ·ï¼Œç„¶åé€šè¿‡åˆ›å»ºçš„ç”¨æˆ·æ“ä½œï¼Œå¦‚æœä½ æ˜¯ç®¡ç†å‘˜è¿˜éœ€è¦ä¸ºå…¶ä»–å¼€å‘äººå‘˜åˆ†é…è´¦æˆ·</p>
<ul>
<li>
<p>åˆ›å»ºè´¦æˆ·ï¼Œç‚¹å‡» <strong>ç®¡ç†åŒºåŸŸ</strong> -&gt; <strong>æ–°å»ºç”¨æˆ·</strong></p>
</li>
<li>
<p>è®¾ç½®è´¦æˆ·ä¿¡æ¯ï¼ŒåŒæ—¶ä½ å¯ä»¥å°†è‡ªå·±è®¾ç½®ä¸ºç®¡ç†å‘˜</p>
</li>
<li>
<p>ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼Œç”±äºæˆ‘ä»¬åˆ›å»ºæ—¶å¹¶æ²¡æœ‰é…ç½®é‚®ç®±ï¼Œæ‰€ä»¥è¿˜éœ€è¦é‡æ–°ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯å¹¶æ‰‹åŠ¨è®¾ç½®å¯†ç </p>
</li>
<li>
<p>é€€å‡ºå¹¶ä½¿ç”¨æ–°è´¦æˆ·ç™»å½•</p>
</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> åˆ›å»ºå®Œè´¦æˆ·ï¼Œç¬¬ä¸€æ¬¡ç™»å½•æ—¶è¿˜ä¼šæç¤ºä½ ä¿®æ”¹ç™»å½•å¯†ç </p>
</blockquote>
<h2 id="é¡¹ç›®ç®¡ç†">é¡¹ç›®ç®¡ç†</h2>
<ul>
<li>
<p>ç‚¹å‡» <strong>+</strong> å· -&gt; <strong>æ–°å»ºé¡¹ç›®</strong></p>
</li>
<li>
<p>è¾“å…¥é¡¹ç›®åç§°åŠæè¿°ä¿¡æ¯ï¼Œè®¾ç½®å¯è§ç­‰çº§ä¸ºç§æœ‰ï¼Œè¿™æ ·åˆ«äººå°±çœ‹ä¸è§ä½ çš„é¡¹ç›®</p>
</li>
<li>
<p>æˆ‘ä»¬é€‰æ‹©é€šè¿‡å¢åŠ ä¸€ä¸ª README çš„æ–¹å¼æ¥åˆå§‹åŒ–é¡¹ç›®</p>
</li>
<li>
<p>ç›´æ¥æäº¤ä¿®æ”¹å³å¯</p>
</li>
</ul>
<h2 id="ä½¿ç”¨-ssh-æ–¹å¼æ‹‰å–å’Œæ¨é€">ä½¿ç”¨ SSH æ–¹å¼æ‹‰å–å’Œæ¨é€</h2>
<h3 id="ç”Ÿæˆ-ssh-key">ç”Ÿæˆ SSH KEY</h3>
<ul>
<li>ä½¿ç”¨ ssh-keygen å·¥å…·ç”Ÿæˆï¼Œä½ç½®åœ¨ Git å®‰è£…ç›®å½•ä¸‹ï¼Œæˆ‘çš„æ˜¯ <code>C:\Program Files\Git\usr\bin</code>ï¼Œè¾“å…¥å‘½ä»¤ï¼š</li>
</ul>
<pre><code class="language-bash">ssh-keygen -t rsa -C &quot;your_email@example.com&quot;
</code></pre>
<ul>
<li>æ‰§è¡ŒæˆåŠŸåçš„æ•ˆæœï¼š</li>
</ul>
<pre><code class="language-bash">Microsoft Windows [ç‰ˆæœ¬ 10.0.14393]
(c) 2016 Microsoft Corporationã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚
C:\Program Files\Git\usr\bin&gt;ssh-keygen -t rsa -C &quot;topsale@vip.qq.com&quot;
Generating public/private rsa key pair.
Enter file in which to save the key (/c/Users/Lusifer/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /c/Users/Lusifer/.ssh/id_rsa.
Your public key has been saved in /c/Users/Lusifer/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:cVesJKa5VnQNihQOTotXUAIyphsqjb7Z9lqOji2704E topsale@vip.qq.com
The key's randomart image is:
+---[RSA 2048]----+
|  + ..=o=.  .+.  |
| o o + B .+.o.o  |
|o   . + +=o+..   |
|.=   .  oo...    |
|= o     So       |
|oE .    o        |
| .. .. .         |
| o*o+            |
| *B*oo           |
+----[SHA256]-----+
C:\Program Files\Git\usr\bin&gt;
</code></pre>
<h3 id="å¤åˆ¶-ssh-key-ä¿¡æ¯åˆ°-gitlab">å¤åˆ¶ SSH-KEY ä¿¡æ¯åˆ° GitLab</h3>
<ul>
<li>
<p>å¯†é’¥ä½ç½®åœ¨ï¼š<code>C:\Users\ä½ çš„ç”¨æˆ·å\.ssh</code> ç›®å½•ä¸‹ï¼Œæ‰¾åˆ° <code>id_rsa.pub</code> å¹¶ä½¿ç”¨ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå¦‚ï¼š</p>
</li>
<li>
<p>ç™»å½• GitLabï¼Œç‚¹å‡»â€œç”¨æˆ·å¤´åƒâ€--&gt;â€œè®¾ç½®â€--&gt;â€œSSH å¯†é’¥â€</p>
</li>
<li>
<p>æˆåŠŸå¢åŠ å¯†é’¥åçš„æ•ˆæœ</p>
</li>
</ul>
<h2 id="ä½¿ç”¨-tortoisegit">ä½¿ç”¨ TortoiseGit</h2>
<h3 id="å…‹éš†é¡¹ç›®">å…‹éš†é¡¹ç›®</h3>
<ul>
<li>
<p>æ–°å»ºä¸€ä¸ªå­˜æ”¾ä»£ç ä»“åº“çš„æœ¬åœ°æ–‡ä»¶å¤¹</p>
</li>
<li>
<p>åœ¨æ–‡ä»¶å¤¹ç©ºç™½å¤„æŒ‰å³é”®</p>
</li>
<li>
<p>é€‰æ‹© <strong>Git å…‹éš†...</strong></p>
</li>
<li>
<p>å¤åˆ¶é¡¹ç›®åœ°å€åˆ° URL</p>
</li>
<li>
<p>å¦‚æœå¼¹å‡ºè¿æ¥ä¿¡æ¯è¯·é€‰æ‹©æ˜¯</p>
</li>
<li>
<p>æˆåŠŸå…‹éš†é¡¹ç›®åˆ°æœ¬åœ°</p>
</li>
</ul>
<h3 id="æ¨é€é¡¹ç›®">æ¨é€é¡¹ç›®</h3>
<ul>
<li>åˆ›å»ºæˆ–ä¿®æ”¹æ–‡ä»¶ï¼ˆè¿™é‡Œçš„æ–‡ä»¶ä¸ºæ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬ï¼šä»£ç ã€å›¾ç‰‡ç­‰ï¼‰</li>
<li>æˆ‘ä»¬ä»¥åˆ›å»º <code>.gitignore</code> è¿‡æ»¤é…ç½®æ–‡ä»¶ä¸ºä¾‹ï¼Œè¯¥æ–‡ä»¶çš„ä¸»è¦ä½œç”¨ä¸ºè¿‡æ»¤ä¸éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼šIDE ç”Ÿæˆçš„å·¥ç¨‹æ–‡ä»¶ã€ç¼–è¯‘åçš„ class æ–‡ä»¶ç­‰</li>
<li>åœ¨å·¥ç¨‹ç›®å½•ä¸‹ï¼Œæ–°å»º <code>.gitignore</code> æ–‡ä»¶ï¼Œå¹¶å¡«å…¥å¦‚ä¸‹é…ç½®</li>
</ul>
<pre><code class="language-bash">target/
!.mvn/wrapper/maven-wrapper.jar
## STS ##
.apt_generated
.classpath
.factorypath
.project
.settings
.springBeans
## IntelliJ IDEA ##
.idea
*.iws
*.iml
*.ipr
## JRebel ##
rebel.xml
## MAC ##
.DS_Store
## Other ##
logs/
temp/
</code></pre>
<ul>
<li>
<p>å³é”®å‘¼å‡ºèœå•ï¼Œé€‰æ‹© <strong>æäº¤ Master...</strong></p>
</li>
<li>
<p>ç‚¹å‡» <strong>å…¨éƒ¨</strong> å¹¶å¡«å…¥ <strong>æ—¥å¿—ä¿¡æ¯</strong></p>
</li>
<li>
<p>ç‚¹å‡» <strong>æäº¤å¹¶æ¨é€</strong></p>
</li>
<li>
<p>æˆåŠŸåçš„æ•ˆæœå›¾</p>
</li>
</ul>
<h2 id="æŸ¥çœ‹-gitlab-ç¡®è®¤æäº¤æˆåŠŸ">æŸ¥çœ‹ GitLab ç¡®è®¤æäº¤æˆåŠŸ</h2>
<h1 id="docker-compose-éƒ¨ç½²-nexus">docker compose éƒ¨ç½² Nexus</h1>
<h2 id="ä»€ä¹ˆæ˜¯-nexus">ä»€ä¹ˆæ˜¯ Nexus</h2>
<p>Nexus æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Maven ä»“åº“ç®¡ç†å™¨ï¼Œæå¤§åœ°ç®€åŒ–äº†å†…éƒ¨ä»“åº“çš„ç»´æŠ¤å’Œå¤–éƒ¨ä»“åº“çš„è®¿é—®ã€‚2016 å¹´ 4 æœˆ 6 æ—¥ Nexus 3.0 ç‰ˆæœ¬å‘å¸ƒï¼Œç›¸è¾ƒ 2.x ç‰ˆæœ¬æœ‰äº†å¾ˆå¤§çš„æ”¹å˜</p>
<ul>
<li>å¯¹ä½å±‚ä»£ç è¿›è¡Œäº†å¤§è§„æ¨¡é‡æ„ï¼Œæå‡æ€§èƒ½ï¼Œå¢åŠ å¯æ‰©å±•æ€§ä»¥åŠæ”¹å–„ç”¨æˆ·ä½“éªŒã€‚</li>
<li>å‡çº§ç•Œé¢ï¼Œæå¤§çš„ç®€åŒ–äº†ç”¨æˆ·ç•Œé¢çš„æ“ä½œå’Œç®¡ç†ã€‚</li>
<li>æä¾›æ–°çš„å®‰è£…åŒ…ï¼Œè®©éƒ¨ç½²æ›´åŠ ç®€å•ã€‚</li>
<li>å¢åŠ å¯¹ Docker, NeGet, npm, Bower çš„æ”¯æŒã€‚</li>
<li>æä¾›æ–°çš„ç®¡ç†æ¥å£ï¼Œä»¥åŠå¢å¼ºå¯¹è‡ªåŠ¨ä»»åŠ¡çš„ç®¡ç†ã€‚</li>
</ul>
<h2 id="éƒ¨ç½²-nexus">éƒ¨ç½² Nexus</h2>
<p>æˆ‘ä»¬ä½¿ç”¨ Docker æ¥å®‰è£…å’Œè¿è¡Œ Nexusï¼Œ<code>docker-compose.yml</code> é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="language-yaml">version: '3.1'
services:
  nexus:
    restart: always
    image: sonatype/nexus3
    container_name: nexus
    ports:
      - 80:8081
    volumes:
      - data:/nexus-data
volumes:
  data:
</code></pre>
<h2 id="éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ-2">éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</h2>
<ul>
<li><strong>åœ°å€ï¼š</strong> http://ip:port/</li>
<li><strong>ç”¨æˆ·åï¼š</strong> admin</li>
<li><strong>å¯†ç ï¼š</strong> admin123</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> æ–°ç‰ˆæœ¬å¯†ç åœ¨ <code>cat /var/lib/docker/volumes/nexus_data/_data/admin.password</code></p>
</blockquote>
<h2 id="maven-ä»“åº“ä»‹ç»">Maven ä»“åº“ä»‹ç»</h2>
<h3 id="ä»£ç†ä»“åº“proxy-repository">ä»£ç†ä»“åº“(Proxy Repository)</h3>
<ul>
<li>ç¬¬ä¸‰æ–¹ä»“åº“
<ul>
<li><strong>maven-central</strong></li>
<li><strong>nuget.org-proxy</strong></li>
</ul>
</li>
<li>ç‰ˆæœ¬ç­–ç•¥(Version Policy)
<ul>
<li><strong>Releaseï¼š</strong> æ­£å¼ç‰ˆæœ¬</li>
<li><strong>Snapshotï¼š</strong> å¿«ç…§ç‰ˆæœ¬</li>
<li><strong>Mixedï¼š</strong> æ··åˆæ¨¡å¼</li>
</ul>
</li>
<li>å¸ƒå±€ç­–ç•¥(Layout Policy)
<ul>
<li><strong>Strictï¼š</strong> ä¸¥æ ¼</li>
<li><strong>Permissiveï¼š</strong> å®½æ¾</li>
</ul>
</li>
</ul>
<h3 id="å®¿ä¸»ä»“åº“hosted-repository">å®¿ä¸»ä»“åº“(Hosted Repository)</h3>
<ul>
<li>å­˜å‚¨æœ¬åœ°ä¸Šä¼ çš„ç»„ä»¶å’Œèµ„æºçš„
<ul>
<li><strong>maven-releases</strong></li>
<li><strong>maven-snapshots</strong></li>
<li><strong>nuget-hosted</strong></li>
</ul>
</li>
<li>éƒ¨ç½²ç­–ç•¥(Deployment Policy)
<ul>
<li><strong>Allow Redeployï¼š</strong> å…è®¸é‡æ–°éƒ¨ç½²</li>
<li><strong>Disable Redeployï¼š</strong> ç¦æ­¢é‡æ–°éƒ¨ç½²</li>
<li><strong>Read-Onlyï¼š</strong> åªè¯»</li>
</ul>
</li>
</ul>
<h3 id="ä»“åº“ç»„repository-group">ä»“åº“ç»„(Repository Group)</h3>
<p>é€šå¸¸åŒ…å«äº†å¤šä¸ªä»£ç†ä»“åº“å’Œå®¿ä¸»ä»“åº“ï¼Œåœ¨é¡¹ç›®ä¸­åªè¦å¼•å…¥ä»“åº“ç»„å°±å¯ä»¥ä¸‹è½½åˆ°ä»£ç†ä»“åº“å’Œå®¿ä¸»ä»“åº“ä¸­çš„åŒ…</p>
<ul>
<li><strong>maven-public</strong></li>
<li><strong>nuget-group</strong></li>
</ul>
<h2 id="åœ¨é¡¹ç›®ä¸­ä½¿ç”¨-nexus">åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Nexus</h2>
<h3 id="é…ç½®è®¤è¯ä¿¡æ¯">é…ç½®è®¤è¯ä¿¡æ¯</h3>
<p>åœ¨ Maven <code>settings.xml</code> ä¸­æ·»åŠ  Nexus è®¤è¯ä¿¡æ¯ (<strong>servers</strong> èŠ‚ç‚¹ä¸‹)</p>
<pre><code class="language-xml">&lt;server&gt;
  &lt;id&gt;nexus-releases&lt;/id&gt;
  &lt;username&gt;admin&lt;/username&gt;
  &lt;password&gt;admin123&lt;/password&gt;
&lt;/server&gt;
&lt;server&gt;
  &lt;id&gt;nexus-snapshots&lt;/id&gt;
  &lt;username&gt;admin&lt;/username&gt;
  &lt;password&gt;admin123&lt;/password&gt;
&lt;/server&gt;
</code></pre>
<h3 id="snapshots-ä¸-releases-çš„åŒºåˆ«">Snapshots ä¸ Releases çš„åŒºåˆ«</h3>
<ul>
<li><strong>nexus-releasesï¼š</strong> ç”¨äºå‘å¸ƒ Release ç‰ˆæœ¬</li>
<li><strong>nexus-snapshotsï¼š</strong> ç”¨äºå‘å¸ƒ Snapshot ç‰ˆæœ¬ï¼ˆå¿«ç…§ç‰ˆï¼‰</li>
</ul>
<p>Release ç‰ˆæœ¬ä¸ Snapshot å®šä¹‰</p>
<pre><code class="language-bash">Release: 1.0.0/1.0.0-RELEASE
Snapshot: 1.0.0-SNAPSHOT
</code></pre>
<ul>
<li>åœ¨é¡¹ç›® <code>pom.xml</code> ä¸­è®¾ç½®çš„ç‰ˆæœ¬å·æ·»åŠ  <code>SNAPSHOT</code> æ ‡è¯†çš„éƒ½ä¼šå‘å¸ƒä¸º <code>SNAPSHOT</code> ç‰ˆæœ¬ï¼Œæ²¡æœ‰ <code>SNAPSHOT</code> æ ‡è¯†çš„éƒ½ä¼šå‘å¸ƒä¸º <code>RELEASE</code> ç‰ˆæœ¬ã€‚</li>
<li><code>SNAPSHOT</code> ç‰ˆæœ¬ä¼šè‡ªåŠ¨åŠ ä¸€ä¸ªæ—¶é—´ä½œä¸ºæ ‡è¯†ï¼Œå¦‚ï¼š<code>1.0.0-SNAPSHOT</code> å‘å¸ƒåä¸ºå˜æˆ <code>1.0.0-SNAPSHOT-20180522.123456-1.jar</code></li>
</ul>
<h3 id="é…ç½®è‡ªåŠ¨åŒ–éƒ¨ç½²">é…ç½®è‡ªåŠ¨åŒ–éƒ¨ç½²</h3>
<p>åœ¨ <code>pom.xml</code> ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç </p>
<pre><code class="language-xml">&lt;distributionManagement&gt;  
  &lt;repository&gt;  
    &lt;id&gt;nexus-releases&lt;/id&gt;  
    &lt;name&gt;Nexus Release Repository&lt;/name&gt;  
    &lt;url&gt;http://127.0.0.1:8081/repository/maven-releases/&lt;/url&gt;  
  &lt;/repository&gt;  
  &lt;snapshotRepository&gt;  
    &lt;id&gt;nexus-snapshots&lt;/id&gt;  
    &lt;name&gt;Nexus Snapshot Repository&lt;/name&gt;  
    &lt;url&gt;http://127.0.0.1:8081/repository/maven-snapshots/&lt;/url&gt;  
  &lt;/snapshotRepository&gt;  
&lt;/distributionManagement&gt; 
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<ul>
<li>ID åç§°å¿…é¡»è¦ä¸ <code>settings.xml</code> ä¸­ Servers é…ç½®çš„ ID åç§°ä¿æŒä¸€è‡´</li>
<li>é¡¹ç›®ç‰ˆæœ¬å·ä¸­æœ‰ <code>SNAPSHOT</code> æ ‡è¯†çš„ï¼Œä¼šå‘å¸ƒåˆ° Nexus Snapshots Repositoryï¼Œ å¦åˆ™å‘å¸ƒåˆ° Nexus Release Repositoryï¼Œå¹¶æ ¹æ® ID å»åŒ¹é…æˆæƒè´¦å·</li>
</ul>
<h3 id="éƒ¨ç½²åˆ°ä»“åº“">éƒ¨ç½²åˆ°ä»“åº“</h3>
<pre><code>mvn deploy
</code></pre>
<h3 id="é…ç½®ä»£ç†ä»“åº“">é…ç½®ä»£ç†ä»“åº“</h3>
<pre><code class="language-xml">&lt;repositories&gt;
    &lt;repository&gt;
        &lt;id&gt;nexus&lt;/id&gt;
        &lt;name&gt;Nexus Repository&lt;/name&gt;
        &lt;url&gt;http://127.0.0.1:8081/repository/maven-public/&lt;/url&gt;
        &lt;snapshots&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
        &lt;/snapshots&gt;
        &lt;releases&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
        &lt;/releases&gt;
    &lt;/repository&gt;
&lt;/repositories&gt;
&lt;pluginRepositories&gt;
    &lt;pluginRepository&gt;
        &lt;id&gt;nexus&lt;/id&gt;
        &lt;name&gt;Nexus Plugin Repository&lt;/name&gt;
        &lt;url&gt;http://127.0.0.1:8081/repository/maven-public/&lt;/url&gt;
        &lt;snapshots&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
        &lt;/snapshots&gt;
        &lt;releases&gt;
            &lt;enabled&gt;true&lt;/enabled&gt;
        &lt;/releases&gt;
    &lt;/pluginRepository&gt;
&lt;/pluginRepositories&gt;
</code></pre>
<h2 id="æ‰©å±•é˜…è¯»-3">æ‰©å±•é˜…è¯»</h2>
<h3 id="æ‰‹åŠ¨ä¸Šä¼ ç¬¬ä¸‰æ–¹ä¾èµ–">æ‰‹åŠ¨ä¸Šä¼ ç¬¬ä¸‰æ–¹ä¾èµ–</h3>
<p>Nexus 3.1.x å¼€å§‹æ”¯æŒé¡µé¢ä¸Šä¼ ç¬¬ä¸‰æ–¹ä¾èµ–åŠŸèƒ½ï¼Œä»¥ä¸‹ä¸ºæ‰‹åŠ¨ä¸Šä¼ å‘½ä»¤</p>
<pre><code class="language-yaml"># å¦‚ç¬¬ä¸‰æ–¹JARåŒ…ï¼šaliyun-sdk-oss-2.2.3.jar
mvn deploy:deploy-file 
  -DgroupId=com.aliyun.oss 
  -DartifactId=aliyun-sdk-oss 
  -Dversion=2.2.3 
  -Dpackaging=jar 
  -Dfile=D:\aliyun-sdk-oss-2.2.3.jar 
  -Durl=http://127.0.0.1:8081/repository/maven-3rd/ 
  -DrepositoryId=nexus-releases
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹</strong></p>
<ul>
<li>å»ºè®®åœ¨ä¸Šä¼ ç¬¬ä¸‰æ–¹ JAR åŒ…æ—¶ï¼Œåˆ›å»ºå•ç‹¬çš„ç¬¬ä¸‰æ–¹ JAR åŒ…ç®¡ç†ä»“åº“ï¼Œä¾¿äºç®¡ç†æœ‰ç»´æŠ¤ã€‚ï¼ˆmaven-3rdï¼‰</li>
<li><code>-DrepositoryId=nexus-releases</code> å¯¹åº”çš„æ˜¯ <code>settings.xml</code> ä¸­ <strong>Servers</strong> é…ç½®çš„ ID åç§°ã€‚ï¼ˆæˆæƒï¼‰</li>
</ul>
<h1 id="docker-compose-éƒ¨ç½²-harbor">docker compose éƒ¨ç½² Harbor</h1>
<h2 id="ä»€ä¹ˆæ˜¯-harbor">ä»€ä¹ˆæ˜¯ Harbor</h2>
<p>Harbor æ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨å’Œåˆ†å‘ Docker é•œåƒçš„ä¼ä¸šçº§ Registry æœåŠ¡å™¨ï¼Œé€šè¿‡æ·»åŠ ä¸€äº›ä¼ä¸šå¿…éœ€çš„åŠŸèƒ½ç‰¹æ€§ï¼Œä¾‹å¦‚å®‰å…¨ã€æ ‡è¯†å’Œç®¡ç†ç­‰ï¼Œæ‰©å±•äº†å¼€æº Docker Distributionã€‚ä½œä¸ºä¸€ä¸ªä¼ä¸šçº§ç§æœ‰ Registry æœåŠ¡å™¨ï¼ŒHarbor æä¾›äº†æ›´å¥½çš„æ€§èƒ½å’Œå®‰å…¨ã€‚æå‡ç”¨æˆ·ä½¿ç”¨ Registry æ„å»ºå’Œè¿è¡Œç¯å¢ƒä¼ è¾“é•œåƒçš„æ•ˆç‡ã€‚Harbor æ”¯æŒå®‰è£…åœ¨å¤šä¸ª Registry èŠ‚ç‚¹çš„é•œåƒèµ„æºå¤åˆ¶ï¼Œé•œåƒå…¨éƒ¨ä¿å­˜åœ¨ç§æœ‰ Registry ä¸­ï¼Œ ç¡®ä¿æ•°æ®å’ŒçŸ¥è¯†äº§æƒåœ¨å…¬å¸å†…éƒ¨ç½‘ç»œä¸­ç®¡æ§ã€‚å¦å¤–ï¼ŒHarbor ä¹Ÿæä¾›äº†é«˜çº§çš„å®‰å…¨ç‰¹æ€§ï¼Œè¯¸å¦‚ç”¨æˆ·ç®¡ç†ï¼Œè®¿é—®æ§åˆ¶å’Œæ´»åŠ¨å®¡è®¡ç­‰ã€‚</p>
<h2 id="harbor-ç‰¹æ€§">Harbor ç‰¹æ€§</h2>
<ul>
<li><strong>åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ ï¼š</strong> ç”¨æˆ·ä¸ Docker é•œåƒä»“åº“é€šè¿‡ â€œé¡¹ç›®â€ è¿›è¡Œç»„ç»‡ç®¡ç†ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥å¯¹å¤šä¸ªé•œåƒä»“åº“åœ¨åŒä¸€å‘½åç©ºé—´ï¼ˆprojectï¼‰é‡Œæœ‰ä¸åŒçš„æƒé™ã€‚</li>
<li><strong>é•œåƒå¤åˆ¶ ï¼š</strong> é•œåƒå¯ä»¥åœ¨å¤šä¸ª Registry å®ä¾‹ä¸­å¤åˆ¶ï¼ˆåŒæ­¥ï¼‰ã€‚å°¤å…¶é€‚åˆäºè´Ÿè½½å‡è¡¡ï¼Œé«˜å¯ç”¨ï¼Œæ··åˆäº‘å’Œå¤šäº‘çš„åœºæ™¯ã€‚</li>
<li><strong>å›¾å½¢åŒ–ç”¨æˆ·ç•Œé¢ ï¼š</strong> ç”¨æˆ·å¯ä»¥é€šè¿‡æµè§ˆå™¨æ¥æµè§ˆï¼Œæ£€ç´¢å½“å‰ Docker é•œåƒä»“åº“ï¼Œç®¡ç†é¡¹ç›®å’Œå‘½åç©ºé—´ã€‚</li>
<li><strong>AD/LDAP æ”¯æŒ ï¼š</strong> Harbor å¯ä»¥é›†æˆä¼ä¸šå†…éƒ¨å·²æœ‰çš„ AD/LDAPï¼Œç”¨äºé‰´æƒè®¤è¯ç®¡ç†ã€‚</li>
<li><strong>å®¡è®¡ç®¡ç† ï¼š</strong> æ‰€æœ‰é’ˆå¯¹é•œåƒä»“åº“çš„æ“ä½œéƒ½å¯ä»¥è¢«è®°å½•è¿½æº¯ï¼Œç”¨äºå®¡è®¡ç®¡ç†ã€‚</li>
<li><strong>å›½é™…åŒ– ï¼š</strong> å·²æ‹¥æœ‰è‹±æ–‡ã€ä¸­æ–‡ã€å¾·æ–‡ã€æ—¥æ–‡å’Œä¿„æ–‡çš„æœ¬åœ°åŒ–ç‰ˆæœ¬ã€‚æ›´å¤šçš„è¯­è¨€å°†ä¼šæ·»åŠ è¿›æ¥ã€‚</li>
<li><strong>RESTful API ï¼š</strong> RESTful API æä¾›ç»™ç®¡ç†å‘˜å¯¹äº Harbor æ›´å¤šçš„æ“æ§ï¼Œä½¿å¾—ä¸å…¶å®ƒç®¡ç†è½¯ä»¶é›†æˆå˜å¾—æ›´å®¹æ˜“ã€‚</li>
<li><strong>éƒ¨ç½²ç®€å• ï¼š</strong> æä¾›åœ¨çº¿å’Œç¦»çº¿ä¸¤ç§å®‰è£…å·¥å…·ï¼Œ ä¹Ÿå¯ä»¥å®‰è£…åˆ° vSphere å¹³å° (OVA æ–¹å¼) è™šæ‹Ÿè®¾å¤‡ã€‚</li>
</ul>
<h2 id="harbor-ç»„ä»¶">Harbor ç»„ä»¶</h2>
<ul>
<li>
<p><strong>Proxyï¼š</strong> Harbor çš„ registry, UI, token ç­‰æœåŠ¡ï¼Œé€šè¿‡ä¸€ä¸ªå‰ç½®çš„åå‘ä»£ç†ç»Ÿä¸€æ¥æ”¶æµè§ˆå™¨ã€Docker å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘ç»™åç«¯ä¸åŒçš„æœåŠ¡ã€‚</p>
</li>
<li>
<p><strong>Registryï¼š</strong> è´Ÿè´£å‚¨å­˜ Docker é•œåƒï¼Œå¹¶å¤„ç† docker push/pull å‘½ä»¤ã€‚ç”±äºæˆ‘ä»¬è¦å¯¹ç”¨æˆ·è¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œå³ä¸åŒç”¨æˆ·å¯¹ Docker image æœ‰ä¸åŒçš„è¯»å†™æƒé™ï¼ŒRegistry ä¼šæŒ‡å‘ä¸€ä¸ª token æœåŠ¡ï¼Œå¼ºåˆ¶ç”¨æˆ·çš„æ¯æ¬¡ docker pull/push è¯·æ±‚éƒ½è¦æºå¸¦ä¸€ä¸ªåˆæ³•çš„ token, Registry ä¼šé€šè¿‡å…¬é’¥å¯¹ token è¿›è¡Œè§£å¯†éªŒè¯ã€‚</p>
</li>
<li>
<p>Core servicesï¼š</p>
<p>è¿™æ˜¯ Harbor çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸»è¦æä¾›ä»¥ä¸‹æœåŠ¡ï¼š</p>
<ul>
<li><strong>UIï¼š</strong> æä¾›å›¾å½¢åŒ–ç•Œé¢ï¼Œå¸®åŠ©ç”¨æˆ·ç®¡ç† registry ä¸Šçš„é•œåƒï¼ˆimageï¼‰, å¹¶å¯¹ç”¨æˆ·è¿›è¡Œæˆæƒã€‚</li>
</ul>
</li>
<li>
<p><strong>WebHookï¼š</strong> ä¸ºäº†åŠæ—¶è·å– registry ä¸Š image çŠ¶æ€å˜åŒ–çš„æƒ…å†µï¼Œ åœ¨ Registry ä¸Šé…ç½® webhookï¼ŒæŠŠçŠ¶æ€å˜åŒ–ä¼ é€’ç»™ UI æ¨¡å—ã€‚</p>
<ul>
<li><strong>Tokenï¼š</strong> è´Ÿè´£æ ¹æ®ç”¨æˆ·æƒé™ç»™æ¯ä¸ª docker push/pull å‘½ä»¤ç­¾å‘ token. Docker å®¢æˆ·ç«¯å‘ - Registry æœåŠ¡å‘èµ·çš„è¯·æ±‚ï¼Œå¦‚æœä¸åŒ…å« tokenï¼Œä¼šè¢«é‡å®šå‘åˆ°è¿™é‡Œï¼Œè·å¾— token åå†é‡æ–°å‘ Registry è¿›è¡Œè¯·æ±‚ã€‚</li>
</ul>
</li>
<li>
<p><strong>Databaseï¼š</strong> ä¸º core services æä¾›æ•°æ®åº“æœåŠ¡ï¼Œè´Ÿè´£å‚¨å­˜ç”¨æˆ·æƒé™ã€å®¡è®¡æ—¥å¿—ã€Docker image åˆ†ç»„ä¿¡æ¯ç­‰æ•°æ®ã€‚</p>
</li>
<li>
<p><strong>Job Servicesï¼š</strong> æä¾›é•œåƒè¿œç¨‹å¤åˆ¶åŠŸèƒ½ï¼Œå¯ä»¥æŠŠæœ¬åœ°é•œåƒåŒæ­¥åˆ°å…¶ä»– Harbor å®ä¾‹ä¸­ã€‚</p>
</li>
<li>
<p><strong>Log Collectorï¼š</strong> ä¸ºäº†å¸®åŠ©ç›‘æ§ Harbor è¿è¡Œï¼Œè´Ÿè´£æ”¶é›†å…¶ä»–ç»„ä»¶çš„ logï¼Œä¾›æ—¥åè¿›è¡Œåˆ†æã€‚</p>
</li>
</ul>
<h2 id="å®‰è£…-harbor">å®‰è£… Harbor</h2>
<p>å®˜æ–¹ GitHub ä¸Šä¸‹è½½æœ€æ–°ç¦»çº¿å®‰è£…ç‰ˆï¼ˆæˆ‘å·²ç»ä¸‹è½½å¹¶æ”¾ç½®åœ¨ç¾¤åˆ†äº«çš„ <strong>Linux</strong> ç›®å½•ä¸‹ï¼‰å¹¶ä¸Šä¼ è‡³æœåŠ¡å™¨</p>
<h3 id="è§£å‹å®‰è£…åŒ…">è§£å‹å®‰è£…åŒ…</h3>
<pre><code class="language-bash">tar -zxvf harbor-offline-installer-v1.8.0.tgz
# è¾“å‡ºå¦‚ä¸‹
harbor/harbor.v1.8.0.tar.gz
harbor/prepare
harbor/LICENSE
harbor/install.sh
harbor/harbor.yml
</code></pre>
<h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶">ä¿®æ”¹é…ç½®æ–‡ä»¶</h3>
<pre><code class="language-bash">vi harbor.yml
# ä¿®æ”¹ä¸ºåŸŸåæˆ–ä½ æœåŠ¡å™¨ IP
hostname: 192.168.141.150
</code></pre>
<h3 id="æ‰§è¡Œå®‰è£…è„šæœ¬">æ‰§è¡Œå®‰è£…è„šæœ¬</h3>
<pre><code class="language-bash">./install.sh
# è¾“å‡ºå¦‚ä¸‹
[Step 0]: checking installation environment ...
Note: docker version: 18.09.6
Note: docker-compose version: 1.24.0
[Step 1]: loading Harbor images ...
23d9f72a5270: Loading layer [==================================================&gt;]  33.25MB/33.25MB
1d4a1da12c02: Loading layer [==================================================&gt;]  50.51MB/50.51MB
8eb1a006f3b0: Loading layer [==================================================&gt;]  3.584kB/3.584kB
41b6f75847f4: Loading layer [==================================================&gt;]  3.072kB/3.072kB
ec9bd6e4d4e8: Loading layer [==================================================&gt;]   2.56kB/2.56kB
6d852bb664c2: Loading layer [==================================================&gt;]  3.072kB/3.072kB
0e4ed2b5a5b8: Loading layer [==================================================&gt;]  3.584kB/3.584kB
8dfb2b644f30: Loading layer [==================================================&gt;]  12.29kB/12.29kB
Loaded image: goharbor/harbor-log:v1.8.0
d8c53538042b: Loading layer [==================================================&gt;]  63.34MB/63.34MB
1b5fb7ee22e0: Loading layer [==================================================&gt;]  47.96MB/47.96MB
a8bdca5e9d71: Loading layer [==================================================&gt;]  6.656kB/6.656kB
f7cec940b52c: Loading layer [==================================================&gt;]  2.048kB/2.048kB
301a4a2af7db: Loading layer [==================================================&gt;]   7.68kB/7.68kB
e588e1e3a775: Loading layer [==================================================&gt;]   2.56kB/2.56kB
539f28a5d0ea: Loading layer [==================================================&gt;]   2.56kB/2.56kB
8b4a72241226: Loading layer [==================================================&gt;]   2.56kB/2.56kB
Loaded image: goharbor/harbor-db:v1.8.0
c88db349fb2f: Loading layer [==================================================&gt;]  8.972MB/8.972MB
1f2d4d72bba2: Loading layer [==================================================&gt;]  35.77MB/35.77MB
dddbcf598df5: Loading layer [==================================================&gt;]  2.048kB/2.048kB
0ced476c2d9c: Loading layer [==================================================&gt;]  3.072kB/3.072kB
af24eb0bf40b: Loading layer [==================================================&gt;]  35.77MB/35.77MB
Loaded image: goharbor/chartmuseum-photon:v0.8.1-v1.8.0
b185d348bd7d: Loading layer [==================================================&gt;]   2.56kB/2.56kB
f032ded7f92e: Loading layer [==================================================&gt;]  1.536kB/1.536kB
c6c822edbc47: Loading layer [==================================================&gt;]   66.9MB/66.9MB
73ef3c4363bf: Loading layer [==================================================&gt;]  39.75MB/39.75MB
0c490e002448: Loading layer [==================================================&gt;]  144.4kB/144.4kB
31afe2abafb4: Loading layer [==================================================&gt;]  3.004MB/3.004MB
Loaded image: goharbor/prepare:v1.8.0
257ebcc1c9c4: Loading layer [==================================================&gt;]  8.967MB/8.967MB
7579d3c94fca: Loading layer [==================================================&gt;]  38.68MB/38.68MB
323611f7dd17: Loading layer [==================================================&gt;]  38.68MB/38.68MB
Loaded image: goharbor/harbor-jobservice:v1.8.0
587a5757a7f6: Loading layer [==================================================&gt;]  3.548MB/3.548MB
Loaded image: goharbor/nginx-photon:v1.8.0
a61ab2060e6e: Loading layer [==================================================&gt;]  8.967MB/8.967MB
25359ae00f57: Loading layer [==================================================&gt;]  5.143MB/5.143MB
610a1668f8bf: Loading layer [==================================================&gt;]  15.13MB/15.13MB
db2252abd9e0: Loading layer [==================================================&gt;]  26.47MB/26.47MB
4f406312560b: Loading layer [==================================================&gt;]  22.02kB/22.02kB
1cee0947e5a7: Loading layer [==================================================&gt;]  3.072kB/3.072kB
48db2b9b0752: Loading layer [==================================================&gt;]  46.74MB/46.74MB
Loaded image: goharbor/notary-server-photon:v0.6.1-v1.8.0
aaf447150765: Loading layer [==================================================&gt;]    113MB/113MB
6835441e1a1d: Loading layer [==================================================&gt;]  10.94MB/10.94MB
9f4739e3a532: Loading layer [==================================================&gt;]  2.048kB/2.048kB
928f489135f0: Loading layer [==================================================&gt;]  48.13kB/48.13kB
1495a1a09ada: Loading layer [==================================================&gt;]  3.072kB/3.072kB
1a5f5b141717: Loading layer [==================================================&gt;]  10.99MB/10.99MB
Loaded image: goharbor/clair-photon:v2.0.8-v1.8.0
66006ea937c6: Loading layer [==================================================&gt;]  337.8MB/337.8MB
d272ba122880: Loading layer [==================================================&gt;]  106.5kB/106.5kB
Loaded image: goharbor/harbor-migrator:v1.8.0
05bc5efb1724: Loading layer [==================================================&gt;]  8.967MB/8.967MB
af3a6f89469a: Loading layer [==================================================&gt;]  46.85MB/46.85MB
452d238b3e48: Loading layer [==================================================&gt;]  5.632kB/5.632kB
36e1cb2d6ffa: Loading layer [==================================================&gt;]  27.14kB/27.14kB
5385ffb8451e: Loading layer [==================================================&gt;]  46.85MB/46.85MB
Loaded image: goharbor/harbor-core:v1.8.0
268091c30a67: Loading layer [==================================================&gt;]  71.66MB/71.66MB
4433bcd802e7: Loading layer [==================================================&gt;]  3.072kB/3.072kB
420b26399278: Loading layer [==================================================&gt;]   59.9kB/59.9kB
8864c4b9ac3d: Loading layer [==================================================&gt;]  61.95kB/61.95kB
Loaded image: goharbor/redis-photon:v1.8.0
63645c97bf5d: Loading layer [==================================================&gt;]  8.968MB/8.968MB
ccb295818ad9: Loading layer [==================================================&gt;]  3.072kB/3.072kB
1ec2d1eefa8f: Loading layer [==================================================&gt;]   2.56kB/2.56kB
b88acf0f9f5f: Loading layer [==================================================&gt;]   20.1MB/20.1MB
0e7375de12e6: Loading layer [==================================================&gt;]   20.1MB/20.1MB
Loaded image: goharbor/registry-photon:v2.7.1-patch-2819-v1.8.0
444b0c8bfeee: Loading layer [==================================================&gt;]  3.548MB/3.548MB
ed0415346760: Loading layer [==================================================&gt;]  6.568MB/6.568MB
572bd51089e0: Loading layer [==================================================&gt;]  160.8kB/160.8kB
1410c2919a92: Loading layer [==================================================&gt;]    215kB/215kB
8ecdca210598: Loading layer [==================================================&gt;]  3.584kB/3.584kB
Loaded image: goharbor/harbor-portal:v1.8.0
7fb66591fb58: Loading layer [==================================================&gt;]  8.968MB/8.968MB
42ec4a6394bf: Loading layer [==================================================&gt;]  3.072kB/3.072kB
be6c2180cb57: Loading layer [==================================================&gt;]   20.1MB/20.1MB
d956d9e974c5: Loading layer [==================================================&gt;]  3.072kB/3.072kB
e2e0b4f17ad8: Loading layer [==================================================&gt;]  7.465MB/7.465MB
7e29d670afe9: Loading layer [==================================================&gt;]  27.56MB/27.56MB
Loaded image: goharbor/harbor-registryctl:v1.8.0
453732ea69d4: Loading layer [==================================================&gt;]  13.72MB/13.72MB
c985f3824f33: Loading layer [==================================================&gt;]  26.47MB/26.47MB
76eaa2763221: Loading layer [==================================================&gt;]  22.02kB/22.02kB
0ef55a752948: Loading layer [==================================================&gt;]  3.072kB/3.072kB
c5749b90723d: Loading layer [==================================================&gt;]  45.33MB/45.33MB
Loaded image: goharbor/notary-signer-photon:v0.6.1-v1.8.0
[Step 2]: preparing environment ...
prepare base dir is set to /usr/local/docker/harbor/harbor
Generated configuration file: /config/log/logrotate.conf
Generated configuration file: /config/nginx/nginx.conf
Generated configuration file: /config/core/env
Generated configuration file: /config/core/app.conf
Generated configuration file: /config/registry/config.yml
Generated configuration file: /config/registryctl/env
Generated configuration file: /config/db/env
Generated configuration file: /config/jobservice/env
Generated configuration file: /config/jobservice/config.yml
Generated and saved secret to file: /secret/keys/secretkey
Generated certificate, key file: /secret/core/private_key.pem, cert file: /secret/registry/root.crt
Generated configuration file: /compose_location/docker-compose.yml
Clean up the input dir
[Step 3]: starting Harbor ...
Creating network &quot;harbor_harbor&quot; with the default driver
Creating harbor-log ... done
Creating harbor-db   ... done
Creating registryctl ... done
Creating redis       ... done
Creating registry    ... done
Creating harbor-core ... done
Creating harbor-jobservice ... done
Creating harbor-portal     ... done
Creating nginx             ... done
âœ” ----Harbor has been installed and started successfully.----
Now you should be able to visit the admin portal at http://192.168.141.150. 
For more details, please visit https://github.com/goharbor/harbor .
</code></pre>
<h3 id="éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ-3">éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</h3>
<p>é€šè¿‡æµè§ˆå™¨è®¿é—® http://192.168.141.150ï¼Œçœ‹åˆ°ç™»å½•é¡µé¢</p>
<p>è¾“å…¥è´¦å· <code>admin</code>ï¼Œå¯†ç  <code>Harbor12345</code>ï¼Œç™»å½•æˆåŠŸå</p>
<h2 id="harbor-å¯åŠ¨å’Œåœæ­¢">Harbor å¯åŠ¨å’Œåœæ­¢</h2>
<p>Harbor çš„æ—¥å¸¸è¿ç»´ç®¡ç†æ˜¯é€šè¿‡ docker-compose æ¥å®Œæˆçš„ï¼ŒHarbor æœ¬èº«æœ‰å¤šä¸ªæœåŠ¡è¿›ç¨‹ï¼Œéƒ½æ”¾åœ¨ docker å®¹å™¨ä¹‹ä¸­è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>docker ps</code> å‘½ä»¤æŸ¥çœ‹ã€‚</p>
<pre><code class="language-bash">docker ps | grep goharbor
# è¾“å‡ºå¦‚ä¸‹
07b401504357        goharbor/nginx-photon:v1.8.0                        &quot;nginx -g 'daemon ofâ€¦&quot;   23 minutes ago      Up 23 minutes (healthy)   0.0.0.0:80-&gt;80/tcp          nginx
050f39a147bc        goharbor/harbor-portal:v1.8.0                       &quot;nginx -g 'daemon ofâ€¦&quot;   23 minutes ago      Up 23 minutes (healthy)   80/tcp                      harbor-portal
305077bc0a3e        goharbor/harbor-jobservice:v1.8.0                   &quot;/harbor/start.sh&quot;       23 minutes ago      Up 23 minutes                                         harbor-jobservice
4eb33b09b268        goharbor/harbor-core:v1.8.0                         &quot;/harbor/start.sh&quot;       23 minutes ago      Up 23 minutes (healthy)                               harbor-core
e9efb7a6abf9        goharbor/registry-photon:v2.7.1-patch-2819-v1.8.0   &quot;/entrypoint.sh /etcâ€¦&quot;   24 minutes ago      Up 23 minutes (healthy)   5000/tcp                    registry
f9bc75d47752        goharbor/harbor-registryctl:v1.8.0                  &quot;/harbor/start.sh&quot;       24 minutes ago      Up 23 minutes (healthy)                               registryctl
76d33d1755f6        goharbor/redis-photon:v1.8.0                        &quot;docker-entrypoint.sâ€¦&quot;   24 minutes ago      Up 23 minutes             6379/tcp                    redis
3870b3b93f46        goharbor/harbor-db:v1.8.0                           &quot;/entrypoint.sh postâ€¦&quot;   24 minutes ago      Up 23 minutes (healthy)   5432/tcp                    harbor-db
6e848e4d8bc2        goharbor/harbor-log:v1.8.0                          &quot;/bin/sh -c /usr/locâ€¦&quot;   24 minutes ago      Up 24 minutes (healthy)   127.0.0.1:1514-&gt;10514/tcp   harbor-log
</code></pre>
<pre><code class="language-dockerfile"># å¯åŠ¨
docker-compose start

 # åœæ­¢
 `docker-comose stop

 # é‡å¯
 docker-compose restart
</code></pre>
<p><strong>è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>nginxï¼š</strong> nginx è´Ÿè´£æµé‡è½¬å‘å’Œå®‰å…¨éªŒè¯ï¼Œå¯¹å¤–æä¾›çš„æµé‡éƒ½æ˜¯ä» nginx ä¸­è½¬ï¼Œæ‰€ä»¥å¼€æ”¾ https çš„ 443 ç«¯å£ï¼Œå®ƒå°†æµé‡åˆ†å‘åˆ°åç«¯çš„ ui å’Œæ­£åœ¨ docker é•œåƒå­˜å‚¨çš„ docker registryã€‚</li>
<li><strong>harbor-jobserviceï¼š</strong> harbor-jobservice æ˜¯ harbor çš„ job ç®¡ç†æ¨¡å—ï¼Œjob åœ¨ harbor é‡Œé¢ä¸»è¦æ˜¯ä¸ºäº†é•œåƒä»“åº“ä¹‹å‰åŒæ­¥ä½¿ç”¨çš„ï¼›</li>
<li><strong>harbor-uiï¼š</strong> harbor-ui æ˜¯ web ç®¡ç†é¡µé¢ï¼Œä¸»è¦æ˜¯å‰ç«¯çš„é¡µé¢å’Œåç«¯ CURD çš„æ¥å£ï¼›</li>
<li><strong>registryï¼š</strong> registry å°±æ˜¯ docker åŸç”Ÿçš„ä»“åº“ï¼Œè´Ÿè´£ä¿å­˜é•œåƒã€‚</li>
<li><strong>harbor-adminserverï¼š</strong> harbor-adminserver æ˜¯ harbor ç³»ç»Ÿç®¡ç†æ¥å£ï¼Œå¯ä»¥ä¿®æ”¹ç³»ç»Ÿé…ç½®ä»¥åŠè·å–ç³»ç»Ÿä¿¡æ¯ã€‚</li>
<li><strong>harbor-dbï¼š</strong> harbor-db æ˜¯ harbor çš„æ•°æ®åº“ï¼Œè¿™é‡Œä¿å­˜äº†ç³»ç»Ÿçš„ job ä»¥åŠé¡¹ç›®ã€äººå‘˜æƒé™ç®¡ç†ã€‚ç”±äºæœ¬ harbor çš„è®¤è¯ä¹Ÿæ˜¯é€šè¿‡æ•°æ®ï¼Œåœ¨ç”Ÿäº§ç¯èŠ‚å¤§å¤šå¯¹æ¥åˆ°ä¼ä¸šçš„ ldap ä¸­ï¼›</li>
<li><strong>harbor-logï¼š</strong> harbor-log æ˜¯ harbor çš„æ—¥å¿—æœåŠ¡ï¼Œç»Ÿä¸€ç®¡ç† harbor çš„æ—¥å¿—ã€‚é€šè¿‡ inspect å¯ä»¥çœ‹å‡ºå®¹å™¨ç»Ÿä¸€å°†æ—¥å¿—è¾“å‡ºçš„ syslogã€‚</li>
</ul>
<p>è¿™å‡ ä¸ªå®¹å™¨é€šè¿‡ Docker link çš„å½¢å¼è¿æ¥åœ¨ä¸€èµ·ï¼Œè¿™æ ·ï¼Œåœ¨å®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡å®¹å™¨åå­—äº’ç›¸è®¿é—®ã€‚å¯¹ç»ˆç«¯ç”¨æˆ·è€Œè¨€ï¼Œåªéœ€è¦æš´éœ² proxy ï¼ˆå³ Nginxï¼‰çš„æœåŠ¡ç«¯å£ã€‚</p>
<h2 id="é…ç½®å®¢æˆ·ç«¯">é…ç½®å®¢æˆ·ç«¯</h2>
<p>åœ¨ <code>/etc/docker/daemon.json</code> ä¸­å¢åŠ å¦‚ä¸‹å†…å®¹ï¼ˆå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨è¯·æ–°å»ºè¯¥æ–‡ä»¶ï¼‰</p>
<pre><code class="language-bash">{
  &quot;registry-mirrors&quot;: [
    &quot;https://registry.docker-cn.com&quot;
  ],
  &quot;insecure-registries&quot;: [
    &quot;192.168.141.150&quot;
  ]
}
</code></pre>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong> è¯¥æ–‡ä»¶å¿…é¡»ç¬¦åˆ JSON è§„èŒƒï¼Œå¦åˆ™ Docker å°†ä¸èƒ½å¯åŠ¨ã€‚</p>
</blockquote>
<p>é‡å¯æœåŠ¡</p>
<pre><code class="language-bash">systemctl daemon-reload
systemctl restart docker
</code></pre>
<h2 id="æ£€æŸ¥å®¢æˆ·ç«¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ">æ£€æŸ¥å®¢æˆ·ç«¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ</h2>
<p>ä½¿ç”¨ <code>docker info</code> å‘½ä»¤æ‰‹åŠ¨æ£€æŸ¥ï¼Œå¦‚æœä»é…ç½®ä¸­çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼Œè¯´æ˜é…ç½®æˆåŠŸ</p>
<pre><code class="language-bash">Insecure Registries:
 192.168.141.150
 127.0.0.0/8
</code></pre>
<h2 id="harbor-ä¸Šä¼ é•œåƒ">Harbor ä¸Šä¼ é•œåƒ</h2>
<h3 id="æ–°å»ºé¡¹ç›®">æ–°å»ºé¡¹ç›®</h3>
<p>æˆ‘ä»¬ä»¥æ¨é€ Nginx ä¸ºä¾‹ï¼Œé¦–å…ˆéœ€è¦åœ¨ Harbor ä¸Šåˆ›å»ºä¸€ä¸ª <strong>å…¬å¼€/ç§æœ‰</strong> çš„é¡¹ç›®</p>
<h3 id="æ¨é€é•œåƒ">æ¨é€é•œåƒ</h3>
<pre><code class="language-bash"># åœ¨é¡¹ç›®ä¸­æ ‡è®°é•œåƒ
docker tag nginx 192.168.141.150/myshop/nginx:latest
# ç™»å½• Harbor
docker login 192.168.141.150 -u admin -p Harbor12345
# æ¨é€é•œåƒåˆ°é¡¹ç›®
docker push 192.168.141.150/myshop/nginx:latest
</code></pre>
<h3 id="æŸ¥çœ‹é•œåƒ">æŸ¥çœ‹é•œåƒ</h3>
<h2 id="harbor-ä¸‹è½½é•œåƒ">Harbor ä¸‹è½½é•œåƒ</h2>
<p>åœ¨å…¶å®ƒæœºå™¨ä¸‹è½½é•œåƒåªéœ€è¦é…ç½®å¥½å®¢æˆ·ç«¯å³å¯</p>
<pre><code>docker pull 192.168.141.150/myshop/nginx:latest
</code></pre>
<h1 id="docker-compose-ç½‘ç»œè®¾ç½®">docker compose ç½‘ç»œè®¾ç½®</h1>
<h2 id="æ¦‚è¿°-5">æ¦‚è¿°</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒCompose ä¼šä¸ºæˆ‘ä»¬çš„åº”ç”¨åˆ›å»ºä¸€ä¸ªç½‘ç»œï¼ŒæœåŠ¡çš„æ¯ä¸ªå®¹å™¨éƒ½ä¼šåŠ å…¥è¯¥ç½‘ç»œä¸­ã€‚è¿™æ ·ï¼Œå®¹å™¨å°±å¯è¢«è¯¥ç½‘ç»œä¸­çš„å…¶ä»–å®¹å™¨è®¿é—®ï¼Œä¸ä»…å¦‚æ­¤ï¼Œ<strong>è¯¥å®¹å™¨è¿˜èƒ½ä»¥æœåŠ¡åç§°ä½œä¸º Hostname è¢«å…¶ä»–å®¹å™¨è®¿é—®</strong>ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºçš„ç½‘ç»œåç§°åŸºäº Compose çš„å·¥ç¨‹åç§°ï¼Œè€Œé¡¹ç›®åç§°åŸºäº <code>docker-compose.yml</code> æ‰€åœ¨ç›®å½•çš„åç§°ã€‚å¦‚éœ€ä¿®æ”¹å·¥ç¨‹åç§°ï¼Œå¯ä½¿ç”¨ <code>--project-name</code> æ ‡è¯†æˆ– <code>COMPOSE_PORJECT_NAME</code> ç¯å¢ƒå˜é‡ã€‚</p>
<p>å‡å¦‚ä¸€ä¸ªåº”ç”¨ç¨‹åºåœ¨åä¸º myapp çš„ç›®å½•ä¸­ï¼Œå¹¶ä¸” <code>docker-compose.yml</code> å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-yaml">version: '2'
services:
  web:
    build: .
    ports:
      - &quot;8000:8000&quot;
  db:
    image: postgres
</code></pre>
<p>å½“æˆ‘ä»¬è¿è¡Œ <code>docker-compose up</code> æ—¶ï¼Œå°†ä¼šæ‰§è¡Œä»¥ä¸‹å‡ æ­¥ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªåä¸º <strong>myapp_default</strong> çš„ç½‘ç»œ</li>
<li>ä½¿ç”¨ web æœåŠ¡çš„é…ç½®åˆ›å»ºå®¹å™¨ï¼Œå®ƒä»¥ <strong>web</strong> è¿™ä¸ªåç§°åŠ å…¥ç½‘ç»œ myapp_default</li>
<li>ä½¿ç”¨ db æœåŠ¡çš„é…ç½®åˆ›å»ºå®¹å™¨ï¼Œå®ƒä»¥ <strong>db</strong> è¿™ä¸ªåç§°åŠ å…¥ç½‘ç»œ myapp_default</li>
</ul>
<p>å®¹å™¨é—´å¯ä½¿ç”¨æœåŠ¡åç§°ï¼ˆweb æˆ– dbï¼‰ä½œä¸º Hostname ç›¸äº’è®¿é—®ã€‚ä¾‹å¦‚ï¼Œweb è¿™ä¸ªæœåŠ¡å¯ä½¿ç”¨ <code>postgres://db:5432</code> è®¿é—® db å®¹å™¨ã€‚</p>
<p>å½“æœåŠ¡çš„é…ç½®å‘ç”Ÿæ›´æ”¹æ—¶ï¼Œå¯ä½¿ç”¨ <code>docker-compose up</code> å‘½ä»¤æ›´æ–°é…ç½®ã€‚æ­¤æ—¶ï¼ŒCompose ä¼šåˆ é™¤æ—§å®¹å™¨å¹¶åˆ›å»ºæ–°å®¹å™¨ã€‚æ–°å®¹å™¨ä¼šä»¥ä¸åŒçš„ IP åœ°å€åŠ å…¥ç½‘ç»œï¼Œåç§°ä¿æŒä¸å˜ã€‚ä»»ä½•æŒ‡å‘æ—§å®¹å™¨çš„è¿æ¥éƒ½ä¼šè¢«å…³é—­ï¼Œå®¹å™¨ä¼šé‡æ–°æ‰¾åˆ°æ–°å®¹å™¨å¹¶è¿æ¥ä¸Šå»ã€‚</p>
<h2 id="ä½¿ç”¨-links">ä½¿ç”¨ links</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒæœåŠ¡ä¹‹é—´å¯ä½¿ç”¨æœåŠ¡åç§°ç›¸äº’è®¿é—®ã€‚links å…è®¸æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåˆ«åï¼Œä»è€Œä½¿ç”¨è¯¥åˆ«åè®¿é—®å…¶ä»–æœåŠ¡ã€‚</p>
<pre><code class="language-yaml">version: '2'
services:
  web:
    build: .
    links:
      - &quot;db:database&quot;
  db:
    image: postgres
</code></pre>
<h2 id="è‡ªå®šä¹‰ç½‘ç»œ">è‡ªå®šä¹‰ç½‘ç»œ</h2>
<p>ä¸€äº›åœºæ™¯ä¸‹ï¼Œé»˜è®¤çš„ç½‘ç»œé…ç½®æ»¡è¶³ä¸äº†æˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä½¿ç”¨ networks å‘½ä»¤è‡ªå®šä¹‰ç½‘ç»œã€‚networks å‘½ä»¤å…è®¸æˆ‘ä»¬åˆ›å»ºæ›´åŠ å¤æ‚çš„ç½‘ç»œæ‹“æ‰‘å¹¶æŒ‡å®šè‡ªå®šä¹‰ç½‘ç»œé©±åŠ¨å’Œé€‰é¡¹ã€‚ä¸ä»…å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜å¯ä½¿ç”¨ networks å°†æœåŠ¡è¿æ¥åˆ°ä¸æ˜¯ç”± Compose ç®¡ç†çš„ã€å¤–éƒ¨åˆ›å»ºçš„ç½‘ç»œã€‚</p>
<pre><code class="language-yaml">version: '2'
services:
  proxy:
    build: ./proxy
    networks:
      - front
  app:
    build: ./app
    networks:
      - front
      - back
  db:
    image: postgres
    networks:
      - back
networks:
  front:
    # Use a custom driver
    driver: custom-driver-1
  back:
    # Use a custom driver which takes special options
    driver: custom-driver-2
    driver_opts:
      foo: &quot;1&quot;
      bar: &quot;2&quot;
</code></pre>
<p>å…¶ä¸­ï¼Œproxy æœåŠ¡ä¸ db æœåŠ¡éš”ç¦»ï¼Œä¸¤è€…åˆ†åˆ«ä½¿ç”¨è‡ªå·±çš„ç½‘ç»œï¼›app æœåŠ¡å¯ä¸ä¸¤è€…é€šä¿¡ã€‚ä½¿ç”¨ networks å‘½ä»¤ï¼Œå³å¯æ–¹ä¾¿å®ç°æœåŠ¡é—´çš„ç½‘ç»œéš”ç¦»ä¸è¿æ¥ã€‚</p>
<h2 id="é…ç½®é»˜è®¤ç½‘ç»œ">é…ç½®é»˜è®¤ç½‘ç»œ</h2>
<pre><code class="language-yaml">version: '2'
services:
  web:
    build: .
    ports:
      - &quot;8000:8000&quot;
  db:
    image: postgres
networks:
  default:
    # Use a custom driver
    driver: custom-driver-1
</code></pre>
<p>è¿™æ ·ï¼Œå°±å¯ä¸ºè¯¥åº”ç”¨æŒ‡å®šè‡ªå®šä¹‰çš„ç½‘ç»œé©±åŠ¨</p>
<h2 id="å·²å­˜åœ¨çš„ç½‘ç»œ">å·²å­˜åœ¨çš„ç½‘ç»œ</h2>
<p>æˆ‘ä»¬å¯ä»¥é¢„å…ˆåˆ›å»ºä¸€ä¸ªåä¸º myapp çš„ç½‘ç»œï¼Œè®© Compose åŠ å…¥è¿™ä¸ªæ–°åˆ›å»ºçš„ç½‘ç»œï¼Œä½¿æ‰€æœ‰ Compose å¯ä»¥é€šä¿¡ï¼Œæ­¤æ—¶ä½¿ç”¨ external é€‰é¡¹ã€‚</p>
<pre><code class="language-bash"># åˆ›å»ºç½‘ç»œ
docker network create &lt;Network Name&gt;
# æŸ¥çœ‹å·²å­˜åœ¨çš„ç½‘ç»œ
docker network list
</code></pre>
<pre><code class="language-yaml">networks:
  default:
    external:
      name: myapp
</code></pre>

                        </div>
                        
                            <div class="post-toc">
                                <ul class="markdownIt-TOC">
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-docker">ä¸ºä»€ä¹ˆéœ€è¦ docker</a>
<ul>
<li><a href="#%E6%A6%82%E8%BF%B0">æ¦‚è¿°</a></li>
<li><a href="#%E6%9B%B4%E9%AB%98%E6%95%88%E7%9A%84%E5%88%A9%E7%94%A8%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90">æ›´é«˜æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æº</a></li>
<li><a href="#%E6%9B%B4%E5%BF%AB%E9%80%9F%E7%9A%84%E5%90%AF%E5%8A%A8%E6%97%B6%E9%97%B4">æ›´å¿«é€Ÿçš„å¯åŠ¨æ—¶é—´</a></li>
<li><a href="#%E4%B8%80%E8%87%B4%E7%9A%84%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83">ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ</a></li>
<li><a href="#%E6%8C%81%E7%BB%AD%E4%BA%A4%E4%BB%98%E5%92%8C%E9%83%A8%E7%BD%B2">æŒç»­äº¤ä»˜å’Œéƒ¨ç½²</a></li>
<li><a href="#%E6%9B%B4%E8%BD%BB%E6%9D%BE%E7%9A%84%E8%BF%81%E7%A7%BB">æ›´è½»æ¾çš„è¿ç§»</a></li>
<li><a href="#%E6%9B%B4%E8%BD%BB%E6%9D%BE%E7%9A%84%E7%BB%B4%E6%8A%A4%E5%92%8C%E6%89%A9%E5%B1%95">æ›´è½»æ¾çš„ç»´æŠ¤å’Œæ‰©å±•</a></li>
<li><a href="#%E5%AF%B9%E6%AF%94%E4%BC%A0%E7%BB%9F%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%80%BB%E7%BB%93">å¯¹æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ€»ç»“</a></li>
</ul>
</li>
<li><a href="#%E5%AE%89%E8%A3%85docker">å®‰è£…docker</a>
<ul>
<li><a href="#ubuntu">Ubuntu</a>
<ul>
<li><a href="#%E5%85%B6%E5%AE%83%E5%AE%89%E8%A3%85%E6%96%B9%E6%B3%95">å…¶å®ƒå®‰è£…æ–¹æ³•</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E9%85%8D%E7%BD%AEdocker%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F%E5%99%A8">é…ç½®dockeré•œåƒåŠ é€Ÿå™¨</a>
<ul>
<li><a href="#%E9%98%BF%E9%87%8C%E4%BA%91%E5%8A%A0%E9%80%9F%E5%99%A8%E6%8E%A8%E8%8D%90">é˜¿é‡Œäº‘åŠ é€Ÿå™¨(æ¨è)</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E5%8A%A0%E9%80%9F%E5%99%A8">é…ç½®åŠ é€Ÿå™¨</a></li>
<li><a href="#%E9%AA%8C%E8%AF%81%E9%85%8D%E7%BD%AE%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F">éªŒè¯é…ç½®æ˜¯å¦æˆåŠŸ</a></li>
</ul>
</li>
<li><a href="#docker-%E6%A6%82%E8%BF%B0">docker æ¦‚è¿°</a>
<ul>
<li><a href="#docker-%E5%BC%95%E6%93%8E">Docker å¼•æ“</a></li>
<li><a href="#docker-%E6%9E%B6%E6%9E%84">Docker æ¶æ„</a></li>
</ul>
</li>
<li><a href="#%E6%93%8D%E4%BD%9C%E9%95%9C%E5%83%8F">æ“ä½œé•œåƒ</a>
<ul>
<li><a href="#%E8%8E%B7%E5%8F%96%E9%95%9C%E5%83%8F">è·å–é•œåƒ</a></li>
<li><a href="#%E5%88%97%E5%87%BA%E9%95%9C%E5%83%8F">åˆ—å‡ºé•œåƒ</a></li>
<li><a href="#%E9%95%9C%E5%83%8F%E4%BD%93%E7%A7%AF">é•œåƒä½“ç§¯</a></li>
<li><a href="#%E8%99%9A%E6%82%AC%E9%95%9C%E5%83%8F">è™šæ‚¬é•œåƒ</a></li>
<li><a href="#%E4%B8%AD%E9%97%B4%E5%B1%82%E9%95%9C%E5%83%8F">ä¸­é—´å±‚é•œåƒ</a></li>
<li><a href="#%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F">åˆ é™¤é•œåƒ</a>
<ul>
<li><a href="#%E7%94%A8-id-%E9%95%9C%E5%83%8F%E5%90%8D-%E6%91%98%E8%A6%81%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F">ç”¨ IDã€é•œåƒåã€æ‘˜è¦åˆ é™¤é•œåƒ</a></li>
<li><a href="#%E7%94%A8-docker-image-ls-%E5%91%BD%E4%BB%A4%E6%9D%A5%E9%85%8D%E5%90%88">ç”¨ docker image ls å‘½ä»¤æ¥é…åˆ</a></li>
</ul>
</li>
<li><a href="#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB">æ‰©å±•é˜…è¯»</a>
<ul>
<li><a href="#%E5%88%97%E5%87%BA%E9%83%A8%E5%88%86%E9%95%9C%E5%83%8F">åˆ—å‡ºéƒ¨åˆ†é•œåƒ</a></li>
<li><a href="#%E4%BB%A5%E7%89%B9%E5%AE%9A%E6%A0%BC%E5%BC%8F%E6%98%BE%E7%A4%BA">ä»¥ç‰¹å®šæ ¼å¼æ˜¾ç¤º</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E6%93%8D%E4%BD%9C%E5%AE%B9%E5%99%A8">æ“ä½œå®¹å™¨</a>
<ul>
<li><a href="#%E5%90%AF%E5%8A%A8%E5%AE%B9%E5%99%A8">å¯åŠ¨å®¹å™¨</a></li>
<li><a href="#%E7%BB%88%E6%AD%A2%E5%AE%B9%E5%99%A8">ç»ˆæ­¢å®¹å™¨</a></li>
<li><a href="#%E5%90%AF%E5%8A%A8%E5%B7%B2%E7%BB%88%E6%AD%A2%E5%AE%B9%E5%99%A8">å¯åŠ¨å·²ç»ˆæ­¢å®¹å™¨</a></li>
<li><a href="#%E5%AE%88%E6%8A%A4%E6%80%81%E8%BF%90%E8%A1%8C">å®ˆæŠ¤æ€è¿è¡Œ</a></li>
<li><a href="#%E5%AE%B9%E5%99%A8%E6%97%A5%E5%BF%97">å®¹å™¨æ—¥å¿—</a></li>
<li><a href="#%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8">è¿›å…¥å®¹å™¨</a></li>
<li><a href="#%E5%88%A0%E9%99%A4%E5%AE%B9%E5%99%A8">åˆ é™¤å®¹å™¨</a></li>
<li><a href="#%E6%B8%85%E7%90%86%E6%89%80%E6%9C%89%E5%A4%84%E4%BA%8E%E7%BB%88%E6%AD%A2%E7%8A%B6%E6%80%81%E7%9A%84%E5%AE%B9%E5%99%A8">æ¸…ç†æ‰€æœ‰å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨</a></li>
</ul>
</li>
<li><a href="#dockerfile%E5%AE%9A%E5%88%B6%E9%95%9C%E5%83%8F">dockerfileå®šåˆ¶é•œåƒ</a>
<ul>
<li><a href="#%E6%A6%82%E8%BF%B0-2">æ¦‚è¿°</a></li>
<li><a href="#from-%E6%8C%87%E5%AE%9A%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F">FROM æŒ‡å®šåŸºç¡€é•œåƒ</a></li>
<li><a href="#run-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4">RUN æ‰§è¡Œå‘½ä»¤</a></li>
<li><a href="#%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F">æ„å»ºé•œåƒ</a></li>
<li><a href="#%E9%95%9C%E5%83%8F%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87">é•œåƒæ„å»ºä¸Šä¸‹æ–‡</a></li>
</ul>
</li>
<li><a href="#dockerfile-%E6%8C%87%E4%BB%A4">dockerfile æŒ‡ä»¤</a>
<ul>
<li><a href="#%E6%A6%82%E8%BF%B0-3">æ¦‚è¿°</a></li>
<li><a href="#copy">COPY</a></li>
<li><a href="#add">ADD</a></li>
<li><a href="#cmd">CMD</a></li>
<li><a href="#entrypoint">ENTRYPOINT</a>
<ul>
<li><a href="#%E5%9C%BA%E6%99%AF%E4%B8%80%E8%AE%A9%E9%95%9C%E5%83%8F%E5%8F%98%E6%88%90%E5%83%8F%E5%91%BD%E4%BB%A4%E4%B8%80%E6%A0%B7%E4%BD%BF%E7%94%A8">åœºæ™¯ä¸€ï¼šè®©é•œåƒå˜æˆåƒå‘½ä»¤ä¸€æ ·ä½¿ç”¨</a></li>
<li><a href="#%E5%9C%BA%E6%99%AF%E4%BA%8C%E5%BA%94%E7%94%A8%E8%BF%90%E8%A1%8C%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">åœºæ™¯äºŒï¼šåº”ç”¨è¿è¡Œå‰çš„å‡†å¤‡å·¥ä½œ</a></li>
</ul>
</li>
<li><a href="#env">ENV</a></li>
<li><a href="#volume">VOLUME</a></li>
<li><a href="#expose">EXPOSE</a></li>
<li><a href="#workdir">WORKDIR</a></li>
</ul>
</li>
<li><a href="#docker-compose-%E7%AE%80%E4%BB%8B">docker compose ç®€ä»‹</a>
<ul>
<li><a href="#%E6%A6%82%E8%BF%B0-4">æ¦‚è¿°</a></li>
<li><a href="#%E5%AE%89%E8%A3%85-docker-compose">å®‰è£… Docker Compose</a></li>
<li><a href="#%E9%AA%8C%E8%AF%81%E5%AE%89%E8%A3%85%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F">éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</a></li>
</ul>
</li>
<li><a href="#docker-compose-%E4%BD%BF%E7%94%A8">docker compose ä½¿ç”¨</a>
<ul>
<li><a href="#%E6%9C%AF%E8%AF%AD">æœ¯è¯­</a></li>
<li><a href="#%E5%9C%BA%E6%99%AF">åœºæ™¯</a>
<ul>
<li><a href="#python-%E5%BA%94%E7%94%A8">Python åº”ç”¨</a></li>
<li><a href="#dockerfile">Dockerfile</a></li>
<li><a href="#docker-compose-%E6%A8%A1%E6%9D%BF">Docker Compose æ¨¡æ¿</a></li>
<li><a href="#%E8%BF%90%E8%A1%8C-compose-%E9%A1%B9%E7%9B%AE">è¿è¡Œ Compose é¡¹ç›®</a></li>
</ul>
</li>
<li><a href="#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB-2">æ‰©å±•é˜…è¯»</a>
<ul>
<li><a href="#yaml-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%AD%E8%A8%80">YAML é…ç½®æ–‡ä»¶è¯­è¨€</a>
<ul>
<li><a href="#yaml-%E5%AF%B9%E8%B1%A1">YAML å¯¹è±¡</a></li>
<li><a href="#yaml-%E6%95%B0%E7%BB%84">YAML æ•°ç»„</a></li>
<li><a href="#yaml-%E5%A4%8D%E5%90%88%E7%BB%93%E6%9E%84">YAML å¤åˆç»“æ„</a></li>
<li><a href="#yaml-%E7%BA%AF%E9%87%8F">YAML çº¯é‡</a></li>
</ul>
</li>
<li><a href="#%E4%BF%AE%E6%94%B9-ip-%E5%92%8C-dns">ä¿®æ”¹ IP å’Œ DNS</a>
<ul>
<li><a href="#%E4%BF%AE%E6%94%B9%E4%B8%BB%E6%9C%BA%E5%90%8D">ä¿®æ”¹ä¸»æœºå</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9-ip">ä¿®æ”¹ IP</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9-dns">ä¿®æ”¹ DNS</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#docker-compose-%E9%83%A8%E7%BD%B2%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F">docker compose éƒ¨ç½²åº”ç”¨ç¨‹åº</a>
<ul>
<li><a href="#%E9%83%A8%E7%BD%B2-tomcat">éƒ¨ç½² Tomcat</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2-mysql">éƒ¨ç½² MySQL</a></li>
</ul>
</li>
<li><a href="#docker-compose-%E9%83%A8%E7%BD%B2-gitlab">docker compose éƒ¨ç½² GitLab</a>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-gitlab">ä»€ä¹ˆæ˜¯ GitLab</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2-gitlab">éƒ¨ç½² GitLab</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE-gitlab">é…ç½® GitLab</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AE-gitlab">è®¾ç½® GitLab</a></li>
<li><a href="#%E8%B4%A6%E6%88%B7%E7%AE%A1%E7%90%86">è´¦æˆ·ç®¡ç†</a></li>
<li><a href="#%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86">é¡¹ç›®ç®¡ç†</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-ssh-%E6%96%B9%E5%BC%8F%E6%8B%89%E5%8F%96%E5%92%8C%E6%8E%A8%E9%80%81">ä½¿ç”¨ SSH æ–¹å¼æ‹‰å–å’Œæ¨é€</a>
<ul>
<li><a href="#%E7%94%9F%E6%88%90-ssh-key">ç”Ÿæˆ SSH KEY</a></li>
<li><a href="#%E5%A4%8D%E5%88%B6-ssh-key-%E4%BF%A1%E6%81%AF%E5%88%B0-gitlab">å¤åˆ¶ SSH-KEY ä¿¡æ¯åˆ° GitLab</a></li>
</ul>
</li>
<li><a href="#%E4%BD%BF%E7%94%A8-tortoisegit">ä½¿ç”¨ TortoiseGit</a>
<ul>
<li><a href="#%E5%85%8B%E9%9A%86%E9%A1%B9%E7%9B%AE">å…‹éš†é¡¹ç›®</a></li>
<li><a href="#%E6%8E%A8%E9%80%81%E9%A1%B9%E7%9B%AE">æ¨é€é¡¹ç›®</a></li>
</ul>
</li>
<li><a href="#%E6%9F%A5%E7%9C%8B-gitlab-%E7%A1%AE%E8%AE%A4%E6%8F%90%E4%BA%A4%E6%88%90%E5%8A%9F">æŸ¥çœ‹ GitLab ç¡®è®¤æäº¤æˆåŠŸ</a></li>
</ul>
</li>
<li><a href="#docker-compose-%E9%83%A8%E7%BD%B2-nexus">docker compose éƒ¨ç½² Nexus</a>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-nexus">ä»€ä¹ˆæ˜¯ Nexus</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2-nexus">éƒ¨ç½² Nexus</a></li>
<li><a href="#%E9%AA%8C%E8%AF%81%E5%AE%89%E8%A3%85%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F-2">éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</a></li>
<li><a href="#maven-%E4%BB%93%E5%BA%93%E4%BB%8B%E7%BB%8D">Maven ä»“åº“ä»‹ç»</a>
<ul>
<li><a href="#%E4%BB%A3%E7%90%86%E4%BB%93%E5%BA%93proxy-repository">ä»£ç†ä»“åº“(Proxy Repository)</a></li>
<li><a href="#%E5%AE%BF%E4%B8%BB%E4%BB%93%E5%BA%93hosted-repository">å®¿ä¸»ä»“åº“(Hosted Repository)</a></li>
<li><a href="#%E4%BB%93%E5%BA%93%E7%BB%84repository-group">ä»“åº“ç»„(Repository Group)</a></li>
</ul>
</li>
<li><a href="#%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8-nexus">åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Nexus</a>
<ul>
<li><a href="#%E9%85%8D%E7%BD%AE%E8%AE%A4%E8%AF%81%E4%BF%A1%E6%81%AF">é…ç½®è®¤è¯ä¿¡æ¯</a></li>
<li><a href="#snapshots-%E4%B8%8E-releases-%E7%9A%84%E5%8C%BA%E5%88%AB">Snapshots ä¸ Releases çš„åŒºåˆ«</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2">é…ç½®è‡ªåŠ¨åŒ–éƒ¨ç½²</a></li>
<li><a href="#%E9%83%A8%E7%BD%B2%E5%88%B0%E4%BB%93%E5%BA%93">éƒ¨ç½²åˆ°ä»“åº“</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%90%86%E4%BB%93%E5%BA%93">é…ç½®ä»£ç†ä»“åº“</a></li>
</ul>
</li>
<li><a href="#%E6%89%A9%E5%B1%95%E9%98%85%E8%AF%BB-3">æ‰©å±•é˜…è¯»</a>
<ul>
<li><a href="#%E6%89%8B%E5%8A%A8%E4%B8%8A%E4%BC%A0%E7%AC%AC%E4%B8%89%E6%96%B9%E4%BE%9D%E8%B5%96">æ‰‹åŠ¨ä¸Šä¼ ç¬¬ä¸‰æ–¹ä¾èµ–</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#docker-compose-%E9%83%A8%E7%BD%B2-harbor">docker compose éƒ¨ç½² Harbor</a>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF-harbor">ä»€ä¹ˆæ˜¯ Harbor</a></li>
<li><a href="#harbor-%E7%89%B9%E6%80%A7">Harbor ç‰¹æ€§</a></li>
<li><a href="#harbor-%E7%BB%84%E4%BB%B6">Harbor ç»„ä»¶</a></li>
<li><a href="#%E5%AE%89%E8%A3%85-harbor">å®‰è£… Harbor</a>
<ul>
<li><a href="#%E8%A7%A3%E5%8E%8B%E5%AE%89%E8%A3%85%E5%8C%85">è§£å‹å®‰è£…åŒ…</a></li>
<li><a href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">ä¿®æ”¹é…ç½®æ–‡ä»¶</a></li>
<li><a href="#%E6%89%A7%E8%A1%8C%E5%AE%89%E8%A3%85%E8%84%9A%E6%9C%AC">æ‰§è¡Œå®‰è£…è„šæœ¬</a></li>
<li><a href="#%E9%AA%8C%E8%AF%81%E5%AE%89%E8%A3%85%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F-3">éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</a></li>
</ul>
</li>
<li><a href="#harbor-%E5%90%AF%E5%8A%A8%E5%92%8C%E5%81%9C%E6%AD%A2">Harbor å¯åŠ¨å’Œåœæ­¢</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E5%AE%A2%E6%88%B7%E7%AB%AF">é…ç½®å®¢æˆ·ç«¯</a></li>
<li><a href="#%E6%A3%80%E6%9F%A5%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%85%8D%E7%BD%AE%E6%98%AF%E5%90%A6%E7%94%9F%E6%95%88">æ£€æŸ¥å®¢æˆ·ç«¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ</a></li>
<li><a href="#harbor-%E4%B8%8A%E4%BC%A0%E9%95%9C%E5%83%8F">Harbor ä¸Šä¼ é•œåƒ</a>
<ul>
<li><a href="#%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE">æ–°å»ºé¡¹ç›®</a></li>
<li><a href="#%E6%8E%A8%E9%80%81%E9%95%9C%E5%83%8F">æ¨é€é•œåƒ</a></li>
<li><a href="#%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F">æŸ¥çœ‹é•œåƒ</a></li>
</ul>
</li>
<li><a href="#harbor-%E4%B8%8B%E8%BD%BD%E9%95%9C%E5%83%8F">Harbor ä¸‹è½½é•œåƒ</a></li>
</ul>
</li>
<li><a href="#docker-compose-%E7%BD%91%E7%BB%9C%E8%AE%BE%E7%BD%AE">docker compose ç½‘ç»œè®¾ç½®</a>
<ul>
<li><a href="#%E6%A6%82%E8%BF%B0-5">æ¦‚è¿°</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-links">ä½¿ç”¨ links</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C">è‡ªå®šä¹‰ç½‘ç»œ</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E9%BB%98%E8%AE%A4%E7%BD%91%E7%BB%9C">é…ç½®é»˜è®¤ç½‘ç»œ</a></li>
<li><a href="#%E5%B7%B2%E5%AD%98%E5%9C%A8%E7%9A%84%E7%BD%91%E7%BB%9C">å·²å­˜åœ¨çš„ç½‘ç»œ</a></li>
</ul>
</li>
</ul>

                            </div>
                            
                                
                                    
                                        <!--en-->
                                        <section class="post-copyright en">
                                            <p class="copyright-item">
                                                <span>Author:</span>
                                                <span>æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚</span>
                                            </p>

                                            <p class="copyright-item">
                                                <span>Permalink:</span>
                                                <span><a href="http://blog.ludangxin.club/post/docker/">http://blog.ludangxin.club/post/docker/</a></span>
                                            </p>

                                            <p class="copyright-item">
                                                <span>License:</span>
                                                <span>MIT License</span>
                                            </p>
                                        </section>
                                        
                                                
                                                    
                                                        <!-- Share-->
                                                        <span style="margin-right:15px">
                                                    <i class="post-share"></i>
                                                    <span>Share:</span>
                                                        <a title="QR Code" target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://blog.ludangxin.club/post/docker/"><i class="fa fa-qrcode"></i></a>
                                                        <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.ludangxin.club/post/docker/&sharesource=qzone&title=Docker&pics=http://blog.ludangxin.club/images/avatar.png?v=1598170590593&summary="><i class="fa fa-qq"></i></a>
                                                        <a title="Weibo" target="_blank" href="https://service.weibo.com/share/share.php?url=http://blog.ludangxin.club/post/docker/&sharesource=weibo&title=Docker + " - " + &pic="http://blog.ludangxin.club/images/avatar.png?v=1598170590593 "><i class="fa fa-weibo "></i></a>
                                                        
                                                                </span>
                                                                <!--en-->
                                                                <section class="post-tags en ">
                                                                    <div>
                                                                        <span>Tag(s):</span>
                                                                        <span class="tag ">
                        
                        
                        <a href="http://blog.ludangxin.club/tag/OMiYgbyBS/">#
                                                å®¹å™¨æŠ€æœ¯
                                                    </a>
                                                    
                                                        
                                                            </span>
                                                                    </div>
                                                                    <div>
                                                                        <a href="javascript:window.history.back();">back</a>
                                                                        <span>&dot;</span>
                                                                        <a href="#">home</a>
                                                                    </div>
                                                                </section>
                                                                
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                        <a class="prev" rel="prev" href="http://blog.ludangxin.club/post/springboot-ji-cheng-redis/">
                                                                                            SpringBoot  é›†æˆredis
                                                                                        </a>
                                                                                        
                                                                                            
                                                                                                <a class="next" rel="next" href="http://blog.ludangxin.club/post/linux/">
                                                                                                    Linux
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                
                                            
                                                <script type="application/javascript" src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
<div id="vlaine-comment"></div>
<script type="application/javascript">
    new Valine({
        el: '#vlaine-comment',
        appId: '6v8KE1xPEnnI3VycbaTHPQvD-gzGzoHsz',
        appKey: 'tCAPkuAx3JWn7YrPKlEpyaMH',
        pageSize: 10,
        avatar: 'mp',
        placeholder: 'æ¥éƒ½æ¥äº†ï¼Œä¸å¦¨è¯„è®ºä¸€ä¸‹',
        visitor: true,
        highlight: false,
        recordIP: true,
    })
</script>
                                                    
            </div>
    </div>
    </div>
    </div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                    <div class="Like">
                        <div class="tip" data-tooltip="Do you like it?">
                            <a href="https://github.com/ITJoker233/Gridea-theme-Chic" target="_blank" title=""><svg class="icon"
                        aria-hidden="true">
                        <use xlink:href="#like"></use>
                    </svg><b class="like_text" id="star"></b></a>
                        </div>
                    </div>
                    
                        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
                            
                                <b id="hitokoto"></b><br>
                                
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚ &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://coding.net" target="_blank">
                                                Coding.net
                                            </a>
            </div>
            <div id="update" style="display:none;">
                on
            </div>
            
                <div id="version" style="display:none;">
                    1.7.4
                </div>
                
                    <script>
                        var port = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + port + '</div>')
                    </script>
        </footer>
        
            <script src='https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js'></script>
            
                <script>
                    
                    
                    loadlive2d();
                    
                    
                    hitokoto();
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    CheckVersion();
                    
                    var newDate = new Date();
                    newDate.setTime(1598170590593);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
        </div>
</body>
<script>
    scroll();
</script>

</html>