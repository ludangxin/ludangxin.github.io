<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    断剑重铸之日，骑士归来之时。
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<meta name="author" content="鲁档信">
<meta name="description" content="Hello World !">
<meta name="keywords" content="鲁档信,ludangxin">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="http://blog.ludangxin.club/styles/main.css" />
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
        
            <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                <!--点击特效-->
                <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/love.min.js"></script>
                
                        <!--CDN样式-->
                        <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
                        <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
                        
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="http://blog.ludangxin.club">
                    断剑重铸之日，骑士归来之时。
                </a>
            </div>
            <div id="tp-weather-widget"></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/">
                        🏠首页
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        📚归档
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        🏷️标签
                    </a>
                    
                    <a class="menu-item" href="/posts">
                        ✍️博客
                    </a>
                    
                    <a class="menu-item" href="/post/about/">
                        👦关于
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1597935637693" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="http://blog.ludangxin.club">
                            断剑重铸之日，骑士归来之时。
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1597935637693" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/">
                            🏠首页
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            📚归档
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            🏷️标签
                        </a>
                        
                        <a class="menu-item" href="/posts">
                            ✍️博客
                        </a>
                        
                        <a class="menu-item" href="/post/about/">
                            👦关于
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>



    <script>
        (function(a, h, g, f, e, d, c, b) {
            b = function() {
                d = h.createElement(g);
                c = h.getElementsByTagName(g)[0];
                d.src = e;
                d.charset = "utf-8";
                d.async = 1;
                c.parentNode.insertBefore(d, c)
            };
            a["SeniverseWeatherWidgetObject"] = f;
            a[f] || (a[f] = function() {
                (a[f].q = a[f].q || []).push(arguments)
            });
            a[f].l = +new Date();
            if (a.attachEvent) {
                a.attachEvent("onload", b)
            } else {
                a.addEventListener("load", b, false)
            }
        }(window, document, "script", "SeniverseWeatherWidget", "//cdn.sencdn.com/widget2/static/js/bundle.js?t=" + parseInt((new Date().getTime() / 100000000).toString(), 10)));
        window.SeniverseWeatherWidget('show', {
            flavor: "slim",
            location: "WWEFQFPJZ7T8",
            geolocation: true,
            language: "auto",
            unit: "c",
            theme: "auto",
            token: "61bcc333-3305-4728-9465-6785274bb0a3",
            hover: "enabled",
            container: "tp-weather-widget"
        })
    </script>
    
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                Nginx
                            </h1>
                            
                                <!--en-->
                                <div class="post-meta en">
                                    Author:
                                    <a itemprop="author" rel="author" href="/">
                                        断剑重铸之日，骑士归来之时。
                                    </a>
                                    <span class="post-time">
                                Date: <a href="#">2020-05-17</a>
                            </span>
                                    <span class="post-readtime">Reading Time:<a
                                    href="#">21.5
                                    mins</a></span>
                                    <span class="post-words">words:<a href="#">5643</a></span>
                                    
                                        <span class="post-category">
                                Category:
                                
                                <a href="http://blog.ludangxin.club/tag/gRwzGMaSm/">nginx</a>
                                
                            </span>
                                        
                                            Views:
                                            <span data-hk-page="current"> - </span>
                                            
                                </div>
                                
                        </header>
                        
                            <img class="post-feature-image" src="http://blog.ludangxin.club/post-images/nginx.jpg" alt="">
                          
                        <div class="post-content">
                            <h1 id="nginx简介">nginx简介</h1>
<h2 id="nginx概述">nginx概述</h2>
<p>Nginx (&quot;engine x&quot;) 是一个高性能的 HTTP 和反向代理服务器,特点是占有内存少，并发能<br>
力强，事实上 nginx 的并发能力确实在同类型的网页服务器中表现较好，中国大陆使用 nginx<br>
网站用户有：百度、京东、新浪、网易、腾讯、淘宝等</p>
<h2 id="nginx作为web服务器">nginx作为web服务器</h2>
<p>Nginx 可以作为静态页面的 web 服务器，同时还支持 CGI 协议的动态语言，比如 perl、php<br>
等。但是不支持 java。Java 程序只能通过与 tomcat 配合完成。Nginx 专为性能优化而开发，<br>
性能是其最重要的考量,实现上非常注重效率 ，能经受高负载的考验,有报告表明能支持高<br>
达 50,000 个并发连接数。<br>
https://lnmp.org/nginx.html</p>
<h2 id="正向代理">正向代理</h2>
<p>Nginx 不仅可以做反向代理，实现负载均衡。还能用作正向代理来进行上网等功能。<br>
正向代理：如果把局域网外的 Internet 想象成一个巨大的资源库，则局域网中的客户端要访<br>
问 Internet，则需要通过代理服务器来访问，这种代理服务就称为正向代理。<br>
<img src="https://i.loli.net/2020/04/16/LXnVcihqUCKS5FG.png" alt="image.png" loading="lazy"></p>
<h2 id="反向代理">反向代理</h2>
<p>反向代理，其实客户端对代理是无感知的，因为客户端不需要任何配置就可以访问，我们只<br>
需要将请求发送到反向代理服务器，由反向代理服务器去选择目标服务器获取数据后，在返<br>
回给客户端，此时反向代理服务器和目标服务器对外就是一个服务器，暴露的是代理服务器<br>
地址，隐藏了真实服务器 IP 地址。<br>
<img src="https://i.loli.net/2020/04/16/ecldAyw4K9MaufG.png" alt="image.png" loading="lazy"></p>
<h2 id="负载均衡">负载均衡</h2>
<p>客户端发送多个请求到服务器，服务器处理请求，有一些可能要与数据库进行交互，服务器处理完毕后，再将结果返回给客户端。<br>
这种架构模式对于早期的系统相对单一，并发请求相对较少的情况下是比较适合的，成本也低。但是随着信息数量的不断增长，访问量和数据量的飞速增长，以及系统业务的复杂度增加，这种架构会造成服务器相应客户端的请求日益缓慢，并发量特别大的时候，还容易造成服务器直接崩溃。很明显这是由于服务器性能的瓶颈造成的问题，那么如何解决这种情况呢？<br>
我们首先想到的可能是升级服务器的配置，比如提高 CPU 执行频率，加大内存等提高机器的物理性能来解决此问题，但是我们知道摩尔定律的日益失效，硬件的性能提升已经不能满足日益提升的需求了。最明显的一个例子，天猫双十一当天，某个热销商品的瞬时访问量是极其庞大的，那么类似上面的系统架构，将机器都增加到现有的顶级物理配置，都是不能够满足需求的。那么怎么呢？<br>
上面的分析我们去掉了增加服务器物理配置来解决问题的办法，也就是说纵向解决问题的办法行不通了，那么横向增加服务器的数量呢？这时候集群的概念产生了，单个服务器解决不了，我们增加服务器的数量，然后将请求分发到各个服务器上，将原先请求集中到单个服务器上的情况改为将请求分发到多个服务器上，将负载分发到不同的服务器，也就是我们所说的<strong>负载均衡</strong><br>
<img src="https://i.loli.net/2020/04/16/C6BqOvr3slDyTme.png" alt="image.png" loading="lazy"></p>
<h2 id="动静分离">动静分离</h2>
<p>为了加快网站的解析速度，可以把动态页面和静态页面由不同的服务器来解析，加快解析速度。降低原来单个服务器的压力。<br>
<img src="https://i.loli.net/2020/04/16/PbKDoymtFkT2fwn.png" alt="image.png" loading="lazy"></p>
<h1 id="nginx-安装">nginx 安装</h1>
<h2 id="素材介绍">素材介绍</h2>
<h3 id="pcre">PCRE</h3>
<p>PCRE库支持正则表达式。如果我们在配置文件nginx.conf中使用了正则表达式，那么在编译Nginx时就必须把PCRE库编译进Nginx，因为Nginx的HTTP模块需要靠它来解析正则表达式。另外，pcre-devel是使用PCRE做二次开发时所需要的开发库，包括头文件等，这也是编译Nginx所必须使用的.</p>
<h3 id="zlib">zlib</h3>
<p>zlib库用于对HTTP包的内容做gzip格式的压缩，如果我们在nginx.conf中配置了gzip on，并指定对于某些类型（content-type）的HTTP响应使用gzip来进行压缩以减少网络传输量，则在编译时就必须把zlib编译进Nginx。zlib-devel是二次开发所需要的库.</p>
<h3 id="openssl">openSSL</h3>
<p>如果服务器不只是要支持HTTP，还需要在更安全的SSL协议上传输HTTP，那么需要拥有OpenSSL。另外，如果我们想使用MD5、SHA1等散列函数，那么也需要安装它。</p>
<h3 id="nginx安装包">nginx安装包</h3>
<h2 id="开始安装">开始安装</h2>
<h3 id="安装pcre">安装pcre</h3>
<ul>
<li><code>cd /usr/local/</code> : 到安装目录下</li>
<li><code>wget https://sourceforge.net/projects/pcre/files/pcre/8.44/pcre-8.44.tar.gz</code>:下载pcre</li>
<li><code>tar -zxvf pcre-8.44.tar.gz</code>: 解压</li>
<li><code>cd pcre-8.44</code>:切换到文件夹下</li>
<li><code>./configure</code>:执行配置文件</li>
<li><code>make &amp;&amp; make install</code>:编译安装pcre</li>
</ul>
<p><strong>特别注意</strong>:make 命令执行不了的同学 <code>./configure</code>后 最后一行会出现</p>
<p>configure: error: You need a C++ compiler for C++ support.</p>
<p>安装一下这个即可：<code>yum install -y gcc gcc-c++</code></p>
<p>（安装完毕后在执行 ./configure 在执行make 就OK了 我就是这样）</p>
<h3 id="安装openssl和zlib">安装openssl和zlib</h3>
<p><code>yum -y install make zlib zlib-devel gcc-c++ libtool openssl openssl-devel</code>:一键安装</p>
<h3 id="安装nginx">安装nginx</h3>
<ul>
<li><code>cd /usr/local/</code> : 到安装目录下并且把tar文件放到该目录中</li>
<li><code>tar -zxvf nginx-1.16.1.tar.gz</code> : 解压文件</li>
<li><code>cd nginx-1.16.1</code>: 切换到文件目录下</li>
<li><code>./configure</code>: 执行安装配置文件</li>
<li><code>make &amp;&amp; make install</code>: 编译安装</li>
<li><code>cd /usr/local/nginx/sbin/</code>: 进去nginx可执行文件目录中</li>
<li><code>./nginx</code>:启动nginx服务</li>
<li>访问系统80端口查看服务是否启动</li>
</ul>
<p><strong>特别注意</strong>:</p>
<p>在 windows 系统中访问linux 中 <strong>nginx</strong>，默认不能访问的，因为<strong>防火墙</strong>问题</p>
<ul>
<li>
<p>查看开放的端口号</p>
<ul>
<li>firewall-cmd --list-all</li>
</ul>
</li>
<li>
<p>设置开放的端口号</p>
<ul>
<li>firewall-cmd --add-service=http –permanent</li>
<li>firewall-cmd --add-port=80/tcp --permanent</li>
</ul>
</li>
<li>
<p>重启防火墙</p>
<ul>
<li>firewall-cmd –reload</li>
</ul>
</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://i.loli.net/2020/04/18/vo1gCVjNGi2mYzE.png" alt="image.png" loading="lazy"></figure>
<h1 id="nginx-常用命令和配置文件">nginx 常用命令和配置文件</h1>
<h2 id="常用命令">常用命令</h2>
<ul>
<li>
<p><code>cd /usr/local/nginx/sbin</code>: 进入nginx目录中</p>
</li>
<li>
<p><code>./nginx -v</code>:查看nginx版本号</p>
</li>
<li>
<p><code>./nginx</code>: 启动nginx</p>
</li>
<li>
<p><code>./nginx -s stop</code>: 停止nginx</p>
</li>
<li>
<p><code>./nginx -s reload</code>:重新加载nginx(不是重启)</p>
</li>
</ul>
<h2 id="配置文件">配置文件</h2>
<ul>
<li>
<p><code>cd /usr/local/nginx/conf/nginx.conf</code> : 配置文件的目录</p>
</li>
<li>
<p>配置文件中的内容</p>
<ul>
<li>
<p>全局块</p>
</li>
<li>
<pre><code></code></pre>
</li>
</ul>
<p>worker_processes;</p>
<pre><code>
* 从配置文件开始到 events 块之间的内容，主要会设置一些影响 nginx 服务器整体运行的配置指令，主要包括配置运行 Nginx 服务器的用户（组）、允许生成的 worker process 数，进程 PID 存放路径、日志存放路径和类型以及配置文件的引入等。比如上面第一行配置的 `worker_processes  1;`
 这是 Nginx 服务器并发处理服务的关键配置，worker_processes 值越大，可以支持的并发处理量也越多，但是会受到硬件、软件等设备的制约.

* events块
* ``````json
  events {
      worker_connections  1024;
  }
  ``````
* events 块涉及的指令主要影响 Nginx 服务器与用户的网络连接，常用的设置包括是否开启对多 work process 下的网络连接进行序列化，是否允许同时接收多个网络连接，选取哪种事件驱动模型来处理连接请求，每个 word  process 可以同时支持的最大连接数等。
上述例子就表示每个 work process 支持的最大连接数为 1024.
 这部分的配置对 Nginx 的性能影响较大，在实际中应该灵活配置。

* http块

* ``````json
  http {
      include       mime.types;
      default_type  application/octet-stream;
  
      #log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
      #                  '$status $body_bytes_sent &quot;$http_referer&quot; '
      #                  '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';
  
      #access_log  logs/access.log  main;
  
      sendfile        on;
      #tcp_nopush     on;
  
      #keepalive_timeout  0;
      keepalive_timeout  65;
  
      #gzip  on;
  
      server {
          listen       80;
          server_name  localhost;
  ``````

* 这算是 Nginx 服务器配置中最频繁的部分，代理、缓存和日志定义等绝大多数功能和第三方模块的配置都在这里。需要注意的是：http 块也可以包括 **http 全局块**、**server 块**

* http全局块

   * http 全局块配置的指令包括文件引入、MIME-TYPE 定义、日志自定义、连接超时时间、单链接请求数上限等。

* server块
  * 这块和虚拟主机有密切关系，虚拟主机从用户角度看，和一台独立的硬件主机是完全一样的，该技术的产生是为了节省互联网服务器硬件成本。每个 http 块可以包括多个server 块，而每个 server 块就相当于一个虚拟主机。而每个 server 块也分为全局server 块，以及可以同时包含多个 locaton 块。
  * 全局server块
    * 最常见的配置是本虚拟机主机的监听配置和本虚拟主机的名称或 IP 配置。
  * location块
    * 一个 server 块可以配置多个 location 块。
</code></pre>
</li>
</ul>
<p>这块的主要作用是基于 Nginx 服务器接收到的请求字符串（例如 server_name/uri-string），对虚拟 主机名称（也可以是 IP 别名）之外的字符串（例如 前面的 /uri-string）进行匹配，对特定的请求进行处理。地址定向、数据缓存和应答控制等功能，还有许多第三方模块的配置也在这里进行。</p>
<h2 id="location-指令说明">location 指令说明</h2>
<p>该指令用于匹配URL</p>
<p>语法如下</p>
<pre><code class="language-json">location [ = | ~ | ~* | ^~] uri {

}
</code></pre>
<ul>
<li>
<p>= : 用于不含正则表达式的 uri 前，要求请求字符串与 uri 严格匹配，如果匹配成功，就停止继续向下搜索并立即处理该请求</p>
</li>
<li>
<p>~ : 用于表示 uri 包含正则表达式，并且区分大小写</p>
</li>
<li>
<p>~* : 用于表示 uri 包含正则表达式，并且不区分大小写</p>
</li>
<li>
<p>^~ : 用于不含正则表达式的 uri 前，要求 Nginx 服务器找到标识 uri 和请求字符串匹配度最高的 location 后，立即使用此 location 处理请求，而不再使用 location 块中的正则 uri 和请求字符串做匹配</p>
</li>
</ul>
<p>*<em>注意 : ** 如果 uri 包含正则表达式，则必须要有 ~ 或者 ~</em> 标识</p>
<h1 id="nginx配置实例-反向代理">nginx配置实例-反向代理</h1>
<h2 id="反向代理实例一">反向代理实例一</h2>
<p>实现效果:使用nginx反向代理,访问www.123.com直接跳转到127.0.0.1:8080</p>
<h3 id="实现过程">实现过程:</h3>
<ol>
<li>启动一个tomcat,浏览器地址栏输入127.0.0.1:8080,启动访问正常后</li>
<li>修改本地host<code>C:\Windows\System32\drivers\etc\hosts</code>文件,将<code>www.123.com</code>映射到127.0.0.1</li>
</ol>
<pre><code class="language-tex">配置完成之后，我们便可以通过 www.123.com:8080 访问到第一步出现的 Tomcat 初始界面。那么如何只需要输入 www.123.com 便可以跳转到 Tomcat 初始界面呢？便用到 nginx的反向代理。
</code></pre>
<ol start="3">
<li>在 nginx.conf 配置文件中增加如下配置</li>
</ol>
<pre><code class="language-json">server {
	listen  80;
	server_name www.123.com;
	
	location / {
		proxy_pass http://127.0.0.1:8080;
		index index.html index.htm index.jsp;
	}
}
</code></pre>
<ol start="4">
<li>如上配置，我们监听 80 端口，访问域名为 www.123.com，不加端口号时默认为 80 端口，故 访问该域名时会跳转到 127.0.0.1:8080 路径上。在浏览器端输入 www.123.com 会看到tomcat index.jsp 页面：</li>
</ol>
<h2 id="反向代理实例二">反向代理实例二</h2>
<p>实现效果：使用 nginx 反向代理，根据访问的路径跳转到不同端口的服务中nginx 监听端口为 9001，</p>
<p>访问 http://127.0.0.1:9001/edu/ 直接跳转到 127.0.0.1:8081</p>
<p>访问 http://127.0.0.1:9001/vod/ 直接跳转到 127.0.0.1:8082</p>
<h3 id="实现过程-2">实现过程</h3>
<ol>
<li>
<p>准备两个 tomcat，一个 8001 端口，一个 8002 端口，并准备好测试的页面</p>
</li>
<li>
<p>修改 nginx 的配置文件 ,在 http 块中添加 server{}</p>
</li>
</ol>
<pre><code class="language-json">server {
	listen 9001;
    server_name localhost;
    
    location ~ /edu/ {
    	proxy_pass http://localhost:8001;
	}
    location ~ /vod/ {
    	proxy_pass http://localhost:8002;
	}
}
</code></pre>
<ol start="3">
<li>访问测试</li>
</ol>
<h1 id="nginx-配置实例-负载均衡">nginx 配置实例-负载均衡</h1>
<p>实现效果:</p>
<p>浏览器地址栏输入地址 <code>http://192.168.17.129/edu/a.html</code>，负载均衡效果,平均8080和 8081 端口中</p>
<h2 id="实现过程-3">实现过程</h2>
<ol>
<li>
<p>准备两个同时启动的tomcat,一台8080,一台8081</p>
</li>
<li>
<p>在两台 tomcat里面 webapps目录中，创建名称 edu 文件夹，在 edu 文件夹中创建页面 a.html，用于测试</p>
</li>
<li>
<p>在nginx的配置文件中进行负载均衡的配置</p>
</li>
</ol>
<pre><code class="language-json">upstream myserver {
	server 192.168.17.129:8080;
	server 192.168.17.129:8081;
}
</code></pre>
<pre><code class="language-json">server {
	listen 80;
	server_name 192.168.17.129;
	
	location /{
		proxy_pass http://myserver;
		root html;
		index index.html index.htm;
	}
}
</code></pre>
<ol start="4">
<li>地址栏中访问测试<code>http://192.168.17.129/edu/a.html</code></li>
</ol>
<h2 id="nginx负载均衡-分配策略">nginx负载均衡 分配策略</h2>
<ol>
<li>轮询（默认）</li>
</ol>
<pre><code>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉，能自动剔除。
</code></pre>
<ol start="2">
<li>weight</li>
</ol>
<pre><code class="language-json">weight 代表权,重默认为 1,权重越高被分配的客户端越多
指定轮询几率，weight 和访问比率成正比，用于后端服务器性能不均的情况。例如:

upstream server_pool{ 
	server 192.168.5.21 weight=5; 
	server 192.168.5.22 weight=10; 
}

</code></pre>
<ol start="3">
<li>ip_hash</li>
</ol>
<pre><code class="language-json">每个请求按访问 ip 的 hash 结果分配，这样每个访客固定访问一个后端服务器，可以解决 session 的问题。 例如：

upstream server_pool{ 
	ip_hash; 
	server 192.168.5.21:80; 
	server 192.168.5.22:80; 
}
</code></pre>
<ol start="4">
<li>fair (第三方)</li>
</ol>
<pre><code class="language-json">按后端服务器的响应时间来分配请求，响应时间短的优先分配。

upstream server_pool{ 
	server 192.168.5.21:80; 
	server 192.168.5.22:80; 
	fair; 
}
</code></pre>
<h1 id="nginx-配置实例-动静分离">nginx 配置实例-动静分离</h1>
<p>Nginx 动静分离简单来说就是把动态跟静态请求分开，不能理解成只是单纯的把动态页面和静态页面物理分离。严格意义上说应该是动态请求跟静态请求分开，可以理解成使用 Nginx处理静态页面，Tomcat 处理动态页面。动静分离从目前实现角度来讲大致分为两种，</p>
<p>​	一种是纯粹把静态文件独立成单独的域名，放在独立的服务器上，也是目前主流推崇的方案；</p>
<p>​	另外一种方法就是动态跟静态文件混合在一起发布，通过 nginx 来分开。通过 location 指定不同的后缀名实现不同的请求转发。通过 expires 参数设置，可以使浏览器缓存过期时间，减少与服务器之前的请求和流量。具体 Expires 定义：是给一个资源设定一个过期时间，也就是说无需去服务端验证，直接通过浏览器自身确认是否过期即可，所以不会产生额外的流量。此种方法非常适合不经常变动的资源。（如果经常更新的文件，不建议使用Expires 来缓存），我这里设置 3d，表示在这 3 天之内访问这个 URL，发送一个请求，比对服务器该文件最后更新时间没有变化，则不会从服务器抓取，返回状态码304，如果有修改，则直接从服务器重新下载，返回状态码 200。</p>
<h2 id="实现过程-4">实现过程</h2>
<ol>
<li>现在系统中准备静态资源,用于访问</li>
</ol>
<pre><code>在linux 跟目录中创建image和www文件夹,并给文件夹下放入静态资源
</code></pre>
<ol start="2">
<li>具体配置</li>
</ol>
<pre><code class="language-json">server {
    listen 80;
    server_name 192.168.17.129;
    
    location /www/ {
    	root /data/;
    	index index.html index.htm;
	}
	location /image/ {
        root /data/;
        autoindex on;
    }
}
</code></pre>
<ol start="3">
<li>浏览器中输入地址<code>http://192.168.17.129/image/01.jpg</code>,<code>http://192.168.17.129/www/a.html</code></li>
</ol>
<p><strong>特别注意</strong>: 因为配置文件中配置了 autoindex on;所以在浏览器中访问<code>http://192.168.17.129/image/</code>结果如下:</p>
<figure data-type="image" tabindex="2"><img src="https://i.loli.net/2020/04/19/ig8TzoqZWMU4Fhu.png" alt="image.png" loading="lazy"></figure>
<h1 id="nginx-处理跨域请求">nginx 处理跨域请求</h1>
<p>当出现403跨域错误的时候 <code>No 'Access-Control-Allow-Origin' header is present on the requested resource</code>，需要给Nginx服务器配置响应的header参数：</p>
<h2 id="解决方案">解决方案</h2>
<pre><code class="language-json">location / {  
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS';
    add_header Access-Control-Allow-Headers 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization';

    if ($request_method = 'OPTIONS') {
        return 204;
    }
} 
</code></pre>
<h2 id="解释">解释</h2>
<h4 id="1-access-control-allow-origin">1. <strong>Access-Control-Allow-Origin</strong></h4>
<pre><code>服务器默认是不被允许跨域的。给Nginx服务器配置`Access-Control-Allow-Origin *`后，表示服务器可以接受所有的请求源（Origin）,即接受所有跨域的请求。
</code></pre>
<h4 id="2-access-control-allow-headers-是为了防止出现以下错误">2. <strong>Access-Control-Allow-Headers</strong> 是为了防止出现以下错误：</h4>
<pre><code>Request header field Content-Type is not allowed by Access-Control-Allow-Headers in preflight response.
</code></pre>
<p>这个错误表示当前请求Content-Type的值不被支持。其实是我们发起了&quot;application/json&quot;的类型请求导致的。这里涉及到一个概念：<code>预检请求（preflight request）</code>,请看下面&quot;预检请求&quot;的介绍。</p>
<h4 id="3-access-control-allow-methods-是为了防止出现以下错误">3. <strong>Access-Control-Allow-Methods</strong> 是为了防止出现以下错误：</h4>
<pre><code>Content-Type is not allowed by Access-Control-Allow-Headers in preflight response.
</code></pre>
<h4 id="4给options-添加-204的返回是为了处理在发送post请求时nginx依然拒绝访问的错误">4.给<code>OPTIONS</code> 添加 <code>204</code>的返回，是为了处理在发送POST请求时Nginx依然拒绝访问的错误</h4>
<p>发送&quot;预检请求&quot;时，需要用到方法 <code>OPTIONS</code> ,所以服务器需要允许该方法。</p>
<h2 id="预检请求preflight-request">预检请求（preflight request）</h2>
<p>其实上面的配置涉及到了一个W3C标准：<code>CROS</code>,全称是跨域资源共享 (Cross-origin resource sharing)，它的提出就是为了解决跨域请求的。</p>
<blockquote>
<p>跨域资源共享(CORS)标准新增了一组 HTTP 首部字段，允许服务器声明哪些源站有权限访问哪些资源。另外，规范要求，<code>对那些可能对服务器数据产生副作用的HTTP 请求方法（特别是 GET 以外的 HTTP 请求，或者搭配某些 MIME 类型的 POST 请求）</code>，浏览器必须首先使用 OPTIONS 方法发起一个预检请求（preflight request），从而获知服务端是否允许该跨域请求。服务器确认允许之后，才发起实际的 HTTP 请求。在预检请求的返回中，服务器端也可以通知客户端，是否需要携带身份凭证（包括 Cookies 和 HTTP 认证相关数据）。</p>
</blockquote>
<p>那么, 允许跨域, 不就是服务端(例如Nginx或者后端代码)设置<code>Access-Control-Allow-Origin: *</code>就可以了吗?</p>
<p>普通的请求确实是这样子的, 除此之外, 还一种叫请求叫Preflighted Request（带预检的跨域请求）</p>
<p>Preflighted Request在发送真正的请求前, 会先发送一个方法为OPTIONS的预请求(Preflighted Request), 用于试探服务端是否能接受真正的请求.</p>
<p>如果options获得的回应是拒绝性质的，比如404\403\500等http状态，就会停止post、get等请求的发出。</p>
<p>那么, 什么情况下请求会变成Preflighted Request呢? 翻看了MDN的文档发现如下：(文档地址：https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#The_HTTP_request_headers)</p>
<ol>
<li>请求方法不是GET/HEAD/POST</li>
<li>POST请求的<code>Content-Type</code>并非<code>application/x-www-form-urlencoded</code>, <code>multipart/form-data</code>, 或<code>text/plain</code></li>
<li>请求设置了自定义的<code>header</code>字段</li>
</ol>
<p>举个例子, 如果POST请求要传输的数据为 XML文档, <code>Content-Type</code>为<code>application/xml</code>或<code>text/xml</code>, 则发送这个请求前会发送一个预请求，或者自定义的header字段也是一样的道理。</p>
<p>有了上面的知识点, 再去看项目中ajax调用</p>
<figure data-type="image" tabindex="3"><img src="https://i.loli.net/2020/04/20/hyRJi2OaCktSAEB.png" alt="image.png" loading="lazy"></figure>
<p>可以看出, 跨域请求中设置了自定义的<code>header</code>字段, 所以该请求是<code>preflighted request</code>, 则请求前一定会发送一个OPTIONS作为预请求.</p>
<p>所以说, 在项目中ajax对后台API的调用, OPTIONS请求是没办法去掉的, 除非后台接口不再需要在请求<code>header</code>中设置<code>openId</code>但是由于该项目中用户信息是采用的JWT的方式，所以只好作罢。</p>
<p>但是由于该项目在后台中自定义了请求频率限制的拦截器，例如限制同一个客户端一秒内对某一个接口只能访问1次。如果超过限制，则第二次会返回状态码500，不予处理。如果每次请求前都带着一次OPTIONS请求，则该拦截器无法正常实现功能，反正会导致大批接口调用失败的情况。</p>
<p>鉴于上述分析，既然前端发起请求时OPTIONS请求没有办法去除，那么是否可以考虑从后台拦截器进行改造。</p>
<p>改造后的代码如下：</p>
<figure data-type="image" tabindex="4"><img src="https://i.loli.net/2020/04/20/9623BrEtSPhFRfL.png" alt="image.png" loading="lazy"></figure>
<p>如果拦截到的请求不是项目中常规的GET或者POST请求，则该拦截器直接放行。至此，问题完美解决。</p>
<h1 id="nginx-原理">nginx 原理</h1>
<figure data-type="image" tabindex="5"><img src="https://i.loli.net/2020/04/19/oBvuNLaUpHGICMX.png" alt="image.png" loading="lazy"></figure>
<figure data-type="image" tabindex="6"><img src="https://i.loli.net/2020/04/19/6oJX1jz9IWbD37Z.png" alt="1587305293_1_.jpg" loading="lazy"></figure>
<h2 id="master-workers-的机制的好处">master-workers 的机制的好处</h2>
<p>首先，对于每个 worker 进程来说，独立的进程，不需要加锁，所以省掉了锁带来的开销，</p>
<p>同时在编程以及问题查找时，也会方便很多。其次，采用独立的进程，可以让互相之间不会</p>
<p>影响，一个进程退出后，其它进程还在工作，服务不会中断，master 进程则很快启动新的</p>
<p>worker 进程。当然，worker 进程的异常退出，肯定是程序有 bug 了，异常退出，会导致当</p>
<p>前 worker 上的所有请求失败，不过不会影响到所有请求，所以降低了风险。</p>
<h2 id="需要设置多少个worker">需要设置多少个worker</h2>
<p>Nginx 同 redis 类似都采用了 io 多路复用机制，每个 worker 都是一个独立的进程，但每个进程里只有一个主线程，通过异步非阻塞的方式来处理请求， 即使是千上万个请求也不在话下。每个 worker 的线程可以把一个 cpu 的性能发挥到极致。所以 worker 数和服务器的cpu数相等是最为适宜的。设少了会浪费 cpu，设多了会造成 cpu 频繁切换上下文带来的损耗。</p>
<p><strong>设置 worker 数量</strong></p>
<p>worker_processes 4</p>
<p>#work 绑定 cpu(4 work 绑定 4cpu)。</p>
<p>worker_cpu_affinity 0001 0010 0100 1000</p>
<p>#work 绑定 cpu (4 work 绑定 8cpu 中的 4 个) 。</p>
<p>worker_cpu_affinity 0000001 00000010 00000100 00001000</p>
<p><strong>连接数</strong> <strong>worker_connection</strong></p>
<p>这个值是表示每个 worker 进程所能建立连接的最大值，所以，一个 nginx 能建立的最大连接数，应该是</p>
<p><code>worker_connections * worker_processes</code></p>
<p>当然，这里说的是最大连接数，对于HTTP 请 求 本 地 资 源 来 说 ， 能 够 支 持 的 最 大 并 发 数 量 是</p>
<p><code>worker_connections * worker_processes</code></p>
<p>如果是支持 http1.1 的浏览器每次访问要占两个连接，所以普通的静态访问最大并发数是： <code>worker_connections * worker_processes /2</code></p>
<p>而如果是 HTTP 作 为反向代理来说，最大并发数量应该是</p>
<p><code>worker_connections * worker_processes/4</code></p>
<p>因为作为反向代理服务器，每个并发会建立与客户端的连接和与后端服务的连接，会占用两个连接。</p>
<figure data-type="image" tabindex="7"><img src="https://i.loli.net/2020/04/19/LcyKewbUuTN2kF4.png" alt="image.png" loading="lazy"></figure>

                        </div>
                        
                            <div class="post-toc">
                                <ul class="markdownIt-TOC">
<li><a href="#nginx%E7%AE%80%E4%BB%8B">nginx简介</a>
<ul>
<li><a href="#nginx%E6%A6%82%E8%BF%B0">nginx概述</a></li>
<li><a href="#nginx%E4%BD%9C%E4%B8%BAweb%E6%9C%8D%E5%8A%A1%E5%99%A8">nginx作为web服务器</a></li>
<li><a href="#%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86">正向代理</a></li>
<li><a href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">反向代理</a></li>
<li><a href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">负载均衡</a></li>
<li><a href="#%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB">动静分离</a></li>
</ul>
</li>
<li><a href="#nginx-%E5%AE%89%E8%A3%85">nginx 安装</a>
<ul>
<li><a href="#%E7%B4%A0%E6%9D%90%E4%BB%8B%E7%BB%8D">素材介绍</a>
<ul>
<li><a href="#pcre">PCRE</a></li>
<li><a href="#zlib">zlib</a></li>
<li><a href="#openssl">openSSL</a></li>
<li><a href="#nginx%E5%AE%89%E8%A3%85%E5%8C%85">nginx安装包</a></li>
</ul>
</li>
<li><a href="#%E5%BC%80%E5%A7%8B%E5%AE%89%E8%A3%85">开始安装</a>
<ul>
<li><a href="#%E5%AE%89%E8%A3%85pcre">安装pcre</a></li>
<li><a href="#%E5%AE%89%E8%A3%85openssl%E5%92%8Czlib">安装openssl和zlib</a></li>
<li><a href="#%E5%AE%89%E8%A3%85nginx">安装nginx</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#nginx-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%92%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">nginx 常用命令和配置文件</a>
<ul>
<li><a href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">常用命令</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">配置文件</a></li>
<li><a href="#location-%E6%8C%87%E4%BB%A4%E8%AF%B4%E6%98%8E">location 指令说明</a></li>
</ul>
</li>
<li><a href="#nginx%E9%85%8D%E7%BD%AE%E5%AE%9E%E4%BE%8B-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86">nginx配置实例-反向代理</a>
<ul>
<li><a href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AE%9E%E4%BE%8B%E4%B8%80">反向代理实例一</a>
<ul>
<li><a href="#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B">实现过程:</a></li>
</ul>
</li>
<li><a href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E5%AE%9E%E4%BE%8B%E4%BA%8C">反向代理实例二</a>
<ul>
<li><a href="#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B-2">实现过程</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#nginx-%E9%85%8D%E7%BD%AE%E5%AE%9E%E4%BE%8B-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">nginx 配置实例-负载均衡</a>
<ul>
<li><a href="#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B-3">实现过程</a></li>
<li><a href="#nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1-%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5">nginx负载均衡 分配策略</a></li>
</ul>
</li>
<li><a href="#nginx-%E9%85%8D%E7%BD%AE%E5%AE%9E%E4%BE%8B-%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB">nginx 配置实例-动静分离</a>
<ul>
<li><a href="#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B-4">实现过程</a></li>
</ul>
</li>
<li><a href="#nginx-%E5%A4%84%E7%90%86%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82">nginx 处理跨域请求</a>
<ul>
<li><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">解决方案</a></li>
<li><a href="#%E8%A7%A3%E9%87%8A">解释</a><br>
*
<ul>
<li><a href="#1-access-control-allow-origin">1. <strong>Access-Control-Allow-Origin</strong></a></li>
<li><a href="#2-access-control-allow-headers-%E6%98%AF%E4%B8%BA%E4%BA%86%E9%98%B2%E6%AD%A2%E5%87%BA%E7%8E%B0%E4%BB%A5%E4%B8%8B%E9%94%99%E8%AF%AF">2. <strong>Access-Control-Allow-Headers</strong> 是为了防止出现以下错误：</a></li>
<li><a href="#3-access-control-allow-methods-%E6%98%AF%E4%B8%BA%E4%BA%86%E9%98%B2%E6%AD%A2%E5%87%BA%E7%8E%B0%E4%BB%A5%E4%B8%8B%E9%94%99%E8%AF%AF">3. <strong>Access-Control-Allow-Methods</strong> 是为了防止出现以下错误：</a></li>
<li><a href="#4%E7%BB%99options-%E6%B7%BB%E5%8A%A0-204%E7%9A%84%E8%BF%94%E5%9B%9E%E6%98%AF%E4%B8%BA%E4%BA%86%E5%A4%84%E7%90%86%E5%9C%A8%E5%8F%91%E9%80%81post%E8%AF%B7%E6%B1%82%E6%97%B6nginx%E4%BE%9D%E7%84%B6%E6%8B%92%E7%BB%9D%E8%AE%BF%E9%97%AE%E7%9A%84%E9%94%99%E8%AF%AF">4.给<code>OPTIONS</code> 添加 <code>204</code>的返回，是为了处理在发送POST请求时Nginx依然拒绝访问的错误</a></li>
</ul>
</li>
<li><a href="#%E9%A2%84%E6%A3%80%E8%AF%B7%E6%B1%82preflight-request">预检请求（preflight request）</a></li>
</ul>
</li>
<li><a href="#nginx-%E5%8E%9F%E7%90%86">nginx 原理</a>
<ul>
<li><a href="#master-workers-%E7%9A%84%E6%9C%BA%E5%88%B6%E7%9A%84%E5%A5%BD%E5%A4%84">master-workers 的机制的好处</a></li>
<li><a href="#%E9%9C%80%E8%A6%81%E8%AE%BE%E7%BD%AE%E5%A4%9A%E5%B0%91%E4%B8%AAworker">需要设置多少个worker</a></li>
</ul>
</li>
</ul>

                            </div>
                            
                                
                                    
                                        <!--en-->
                                        <section class="post-copyright en">
                                            <p class="copyright-item">
                                                <span>Author:</span>
                                                <span>断剑重铸之日，骑士归来之时。</span>
                                            </p>

                                            <p class="copyright-item">
                                                <span>Permalink:</span>
                                                <span><a href="http://blog.ludangxin.club/post/nginx/">http://blog.ludangxin.club/post/nginx/</a></span>
                                            </p>

                                            <p class="copyright-item">
                                                <span>License:</span>
                                                <span>MIT License</span>
                                            </p>
                                        </section>
                                        
                                                
                                                    
                                                        <!-- Share-->
                                                        <span style="margin-right:15px">
                                                    <i class="post-share"></i>
                                                    <span>Share:</span>
                                                        <a title="QR Code" target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://blog.ludangxin.club/post/nginx/"><i class="fa fa-qrcode"></i></a>
                                                        <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.ludangxin.club/post/nginx/&sharesource=qzone&title=Nginx&pics=http://blog.ludangxin.club/images/avatar.png?v=1597935637693&summary="><i class="fa fa-qq"></i></a>
                                                        <a title="Weibo" target="_blank" href="https://service.weibo.com/share/share.php?url=http://blog.ludangxin.club/post/nginx/&sharesource=weibo&title=Nginx + " - " + &pic="http://blog.ludangxin.club/images/avatar.png?v=1597935637693 "><i class="fa fa-weibo "></i></a>
                                                        
                                                                </span>
                                                                <!--en-->
                                                                <section class="post-tags en ">
                                                                    <div>
                                                                        <span>Tag(s):</span>
                                                                        <span class="tag ">
                        
                        
                        <a href="http://blog.ludangxin.club/tag/gRwzGMaSm/">#
                                                nginx
                                                    </a>
                                                    
                                                        
                                                            </span>
                                                                    </div>
                                                                    <div>
                                                                        <a href="javascript:window.history.back();">back</a>
                                                                        <span>&dot;</span>
                                                                        <a href="#">home</a>
                                                                    </div>
                                                                </section>
                                                                
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                        <a class="prev" rel="prev" href="http://blog.ludangxin.club/post/springboot-ji-cheng-biao-dan-yan-zheng-he-yi-chang-tong-yi-chu-li/">
                                                                                            SpringBoot 集成 表单验证 和 异常统一处理
                                                                                        </a>
                                                                                        
                                                                                            
                                                                                                <a class="next" rel="next" href="http://blog.ludangxin.club/post/springboot-ji-cheng-redis/">
                                                                                                    SpringBoot  集成redis
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                
                                            
                                                <script type="application/javascript" src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
<div id="vlaine-comment"></div>
<script type="application/javascript">
    new Valine({
        el: '#vlaine-comment',
        appId: '6v8KE1xPEnnI3VycbaTHPQvD-gzGzoHsz',
        appKey: 'tCAPkuAx3JWn7YrPKlEpyaMH',
        pageSize: 10,
        avatar: 'mp',
        placeholder: '来都来了，不妨评论一下',
        visitor: true,
        highlight: false,
        recordIP: true,
    })
</script>
                                                    
            </div>
    </div>
    </div>
    </div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                    <div class="Like">
                        <div class="tip" data-tooltip="Do you like it?">
                            <a href="https://github.com/ITJoker233/Gridea-theme-Chic" target="_blank" title=""><svg class="icon"
                        aria-hidden="true">
                        <use xlink:href="#like"></use>
                    </svg><b class="like_text" id="star"></b></a>
                        </div>
                    </div>
                    
                        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
                            
                                <b id="hitokoto"></b><br>
                                
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        断剑重铸之日，骑士归来之时。 &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://coding.net" target="_blank">
                                                Coding.net
                                            </a>
            </div>
            <div id="update" style="display:none;">
                on
            </div>
            
                <div id="version" style="display:none;">
                    1.7.4
                </div>
                
                    <script>
                        var port = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + port + '</div>')
                    </script>
        </footer>
        
            <script src='https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js'></script>
            
                <script>
                    
                    
                    loadlive2d();
                    
                    
                    hitokoto();
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    CheckVersion();
                    
                    var newDate = new Date();
                    newDate.setTime(1597935637693);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
        </div>
</body>
<script>
    scroll();
</script>

</html>