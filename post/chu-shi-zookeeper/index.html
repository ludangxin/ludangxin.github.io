<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<meta name="author" content="é²æ¡£ä¿¡">
<meta name="description" content="Hello World !">
<meta name="keywords" content="é²æ¡£ä¿¡,ludangxin">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="http://blog.ludangxin.club/styles/main.css" />
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
        
            <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                <!--ç‚¹å‡»ç‰¹æ•ˆ-->
                <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/love.min.js"></script>
                
                        <!--CDNæ ·å¼-->
                        <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
                        <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
                        
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="http://blog.ludangxin.club">
                    æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚
                </a>
            </div>
            <div id="tp-weather-widget"></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/">
                        ğŸ é¦–é¡µ
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        ğŸ“šå½’æ¡£
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        ğŸ·ï¸æ ‡ç­¾
                    </a>
                    
                    <a class="menu-item" href="/posts">
                        âœï¸åšå®¢
                    </a>
                    
                    <a class="menu-item" href="/post/about/">
                        ğŸ‘¦å…³äº
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1598170590593" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="http://blog.ludangxin.club">
                            æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1598170590593" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/">
                            ğŸ é¦–é¡µ
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            ğŸ“šå½’æ¡£
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            ğŸ·ï¸æ ‡ç­¾
                        </a>
                        
                        <a class="menu-item" href="/posts">
                            âœï¸åšå®¢
                        </a>
                        
                        <a class="menu-item" href="/post/about/">
                            ğŸ‘¦å…³äº
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>



    <script>
        (function(a, h, g, f, e, d, c, b) {
            b = function() {
                d = h.createElement(g);
                c = h.getElementsByTagName(g)[0];
                d.src = e;
                d.charset = "utf-8";
                d.async = 1;
                c.parentNode.insertBefore(d, c)
            };
            a["SeniverseWeatherWidgetObject"] = f;
            a[f] || (a[f] = function() {
                (a[f].q = a[f].q || []).push(arguments)
            });
            a[f].l = +new Date();
            if (a.attachEvent) {
                a.attachEvent("onload", b)
            } else {
                a.addEventListener("load", b, false)
            }
        }(window, document, "script", "SeniverseWeatherWidget", "//cdn.sencdn.com/widget2/static/js/bundle.js?t=" + parseInt((new Date().getTime() / 100000000).toString(), 10)));
        window.SeniverseWeatherWidget('show', {
            flavor: "slim",
            location: "WWEFQFPJZ7T8",
            geolocation: true,
            language: "auto",
            unit: "c",
            theme: "auto",
            token: "61bcc333-3305-4728-9465-6785274bb0a3",
            hover: "enabled",
            container: "tp-weather-widget"
        })
    </script>
    
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                åˆè¯† Zookeeper
                            </h1>
                            
                                <!--en-->
                                <div class="post-meta en">
                                    Author:
                                    <a itemprop="author" rel="author" href="/">
                                        æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚
                                    </a>
                                    <span class="post-time">
                                Date: <a href="#">2020-05-24</a>
                            </span>
                                    <span class="post-readtime">Reading Time:<a
                                    href="#">16.7
                                    mins</a></span>
                                    <span class="post-words">words:<a href="#">4105</a></span>
                                    
                                        <span class="post-category">
                                Category:
                                
                                <a href="http://blog.ludangxin.club/tag/4KBrXdUxz/">åˆ†å¸ƒå¼</a>
                                
                            </span>
                                        
                                            Views:
                                            <span data-hk-page="current"> - </span>
                                            
                                </div>
                                
                        </header>
                        
                            <img class="post-feature-image" src="http://blog.ludangxin.club/post-images/chu-shi-zookeeper.jpg" alt="">
                          
                        <div class="post-content">
                            <h1 id="zookeeperæ˜¯ä»€ä¹ˆ">zookeeperæ˜¯ä»€ä¹ˆ</h1>
<p>zookeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼<strong>åè°ƒ</strong>æœåŠ¡, æä¾›åˆ†å¸ƒå¼<strong>æ•°æ®ä¸€è‡´æ€§</strong>è§£å†³æ–¹æ¡ˆ,åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥å®ç°<strong>æ•°æ®ç»Ÿä¸€é…ç½®ç®¡ç†ã€ç»Ÿä¸€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼é”ã€é›†ç¾¤ç®¡ç†</strong>ç­‰åŠŸèƒ½.</p>
<p>ZooKeeperä¸»è¦<strong>æœåŠ¡äºåˆ†å¸ƒå¼ç³»ç»Ÿ</strong>ï¼Œä½¿ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿå°±æ— æ³•é¿å…å¯¹èŠ‚ç‚¹ç®¡ç†çš„é—®é¢˜(éœ€è¦å®æ—¶æ„ŸçŸ¥èŠ‚ç‚¹çš„çŠ¶æ€ã€å¯¹èŠ‚ç‚¹è¿›è¡Œç»Ÿä¸€ç®¡ç†ç­‰ç­‰)ï¼Œè€Œç”±äºè¿™äº›é—®é¢˜å¤„ç†èµ·æ¥å¯èƒ½ç›¸å¯¹éº»çƒ¦å’Œæé«˜äº†ç³»ç»Ÿçš„å¤æ‚æ€§ï¼ŒZooKeeperä½œä¸ºä¸€ä¸ªèƒ½å¤Ÿ<strong>é€šç”¨</strong>è§£å†³è¿™äº›é—®é¢˜çš„ä¸­é—´ä»¶å°±åº”è¿è€Œç”Ÿäº†ã€‚</p>
<h1 id="zookeeperä¸ºä»€ä¹ˆèƒ½å¹²è¿™ä¹ˆå¤š">zookeeperä¸ºä»€ä¹ˆèƒ½å¹²è¿™ä¹ˆå¤š</h1>
<p>ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¯ä»¥ç”¨ZooKeeperæ¥åšï¼šç»Ÿä¸€é…ç½®ç®¡ç†ã€ç»Ÿä¸€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼é”ã€é›†ç¾¤ç®¡ç†ã€‚</p>
<ul>
<li>è¿™é‡Œæˆ‘ä»¬<strong>å…ˆ</strong>ä¸ç®¡<code>ç»Ÿä¸€é…ç½®ç®¡ç†ã€ç»Ÿä¸€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼é”ã€é›†ç¾¤ç®¡ç†</code>æ¯ä¸ªå…·ä½“çš„å«ä¹‰(åé¢ä¼šè®²)</li>
</ul>
<p>é‚£ä¸ºä»€ä¹ˆZooKeeperå¯ä»¥å¹²é‚£ä¹ˆå¤šäº‹ï¼Ÿæ¥çœ‹çœ‹ZooKeeperç©¶ç«Ÿæ˜¯ä½•æ–¹ç¥ç‰©ï¼Œåœ¨Wikiä¸­å…¶å®ä¹Ÿæœ‰æåˆ°ï¼š</p>
<blockquote>
<p>ZooKeeper nodes store their data in a hierarchical name space, much like a file system or a <a href="https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Tree_(data_structure)">tree</a> data structure</p>
<p>è¯‘æ–‡: ZooKeeperèŠ‚ç‚¹å°†å…¶æ•°æ®å­˜å‚¨åœ¨åˆ†å±‚åç§°ç©ºé—´ä¸­ï¼Œè¿™ä¸æ–‡ä»¶ç³»ç»Ÿæˆ–æ ‘æ•°æ®ç»“æ„éå¸¸ç›¸ä¼¼</p>
</blockquote>
<p><strong>Zookeeper ä¸€ä¸ªæœ€å¸¸ç”¨çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯ç”¨äºæ‹…ä»»æœåŠ¡ç”Ÿäº§è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…çš„æ³¨å†Œä¸­å¿ƒ</strong> ã€‚æœåŠ¡ç”Ÿäº§è€…å°†è‡ªå·±æä¾›çš„æœåŠ¡æ³¨å†Œåˆ°Zookeeperä¸­å¿ƒï¼ŒæœåŠ¡çš„æ¶ˆè´¹è€…åœ¨è¿›è¡ŒæœåŠ¡è°ƒç”¨çš„æ—¶å€™å…ˆåˆ°Zookeeperä¸­æŸ¥æ‰¾æœåŠ¡ï¼Œè·å–åˆ°æœåŠ¡ç”Ÿäº§è€…çš„è¯¦ç»†ä¿¡æ¯ä¹‹åï¼Œå†å»è°ƒç”¨æœåŠ¡ç”Ÿäº§è€…çš„å†…å®¹ä¸æ•°æ®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨ Dubboæ¶æ„ä¸­ Zookeeper å°±æ‹…ä»»äº†æ³¨å†Œä¸­å¿ƒè¿™ä¸€è§’è‰²ã€‚<br>
<img src="http://blog.ludangxin.club/post-images/1590297452731.jpg" alt="" loading="lazy"></p>
<h2 id="æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</h2>
<p>ZooKeeperçš„æ•°æ®ç»“æ„ï¼Œè·ŸUnixæ–‡ä»¶ç³»ç»Ÿéå¸¸ç±»ä¼¼ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€é¢—<strong>æ ‘</strong>ï¼Œæ¯ä¸ªèŠ‚ç‚¹å«åš<strong>ZNode</strong>ã€‚æ¯ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥é€šè¿‡<strong>è·¯å¾„</strong>æ¥æ ‡è¯†ï¼Œç»“æ„å›¾å¦‚ä¸‹ï¼š<br>
<img src="http://blog.ludangxin.club/post-images/1590297465572.jpg" alt="" loading="lazy"><br>
é‚£ZooKeeperè¿™é¢—&quot;æ ‘&quot;æœ‰ä»€ä¹ˆç‰¹ç‚¹å‘¢ï¼Ÿï¼ŸZooKeeperçš„èŠ‚ç‚¹æˆ‘ä»¬ç§°ä¹‹ä¸º<strong>Znode</strong>ï¼ŒZnodeåˆ†ä¸º<strong>ä¸¤ç§</strong>ç±»å‹ï¼š</p>
<ul>
<li><strong>çŸ­æš‚/ä¸´æ—¶(Ephemeral)</strong>ï¼šå½“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ–­å¼€è¿æ¥åï¼Œæ‰€åˆ›å»ºçš„Znode(èŠ‚ç‚¹)<strong>ä¼šè‡ªåŠ¨åˆ é™¤</strong></li>
<li><strong>æŒä¹…(Persistent)</strong>ï¼šå½“å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ–­å¼€è¿æ¥åï¼Œæ‰€åˆ›å»ºçš„Znode(èŠ‚ç‚¹)<strong>ä¸ä¼šåˆ é™¤</strong></li>
</ul>
<blockquote>
<p>ZooKeeperå’ŒRedisä¸€æ ·ï¼Œä¹Ÿæ˜¯C/Sç»“æ„(åˆ†æˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯)<br>
<img src="http://blog.ludangxin.club/post-images/1590297481498.jpg" alt="" loading="lazy"></p>
</blockquote>
<h2 id="ç›‘å¬å™¨">ç›‘å¬å™¨</h2>
<p>åœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»ç®€å•çŸ¥é“äº†ZooKeeperçš„æ•°æ®ç»“æ„äº†ï¼ŒZooKeeperè¿˜é…åˆäº†<strong>ç›‘å¬å™¨</strong>æ‰èƒ½å¤Ÿåšé‚£ä¹ˆå¤šäº‹çš„ã€‚<br>
<strong>å¸¸è§</strong>çš„ç›‘å¬åœºæ™¯æœ‰ä»¥ä¸‹ä¸¤é¡¹ï¼š</p>
<ul>
<li>ç›‘å¬ZnodeèŠ‚ç‚¹çš„<strong>æ•°æ®å˜åŒ–</strong></li>
<li>ç›‘å¬å­èŠ‚ç‚¹çš„<strong>å¢å‡å˜åŒ–</strong><br>
<img src="http://blog.ludangxin.club/post-images/1590297499784.jpg" alt="" loading="lazy"><br>
<img src="http://blog.ludangxin.club/post-images/1590297527050.jpg" alt="" loading="lazy"><br>
æ²¡é”™ï¼Œé€šè¿‡<strong>ç›‘å¬+ZnodeèŠ‚ç‚¹(æŒä¹…/çŸ­æš‚[ä¸´æ—¶])</strong>ï¼ŒZooKeeperå°±å¯ä»¥ç©å‡ºè¿™ä¹ˆå¤šèŠ±æ ·äº†ã€‚</li>
</ul>
<h1 id="zookeeperå…·ä½“èƒ½å¹²ä»€ä¹ˆ">zookeeperå…·ä½“èƒ½å¹²ä»€ä¹ˆ</h1>
<h2 id="ç»Ÿä¸€é…ç½®ç®¡ç†">ç»Ÿä¸€é…ç½®ç®¡ç†</h2>
<p>æ¯”å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸‰ä¸ªç³»ç»ŸAã€Bã€Cï¼Œä»–ä»¬æœ‰ä¸‰ä»½é…ç½®ï¼Œåˆ†åˆ«æ˜¯<code>ASystem.ymlã€BSystem.ymlã€CSystem.yml</code>ï¼Œç„¶åï¼Œè¿™ä¸‰ä»½é…ç½®åˆéå¸¸ç±»ä¼¼ï¼Œå¾ˆå¤šçš„é…ç½®é¡¹å‡ ä¹éƒ½ä¸€æ ·ã€‚</p>
<ul>
<li>æ­¤æ—¶ï¼Œå¦‚æœæˆ‘ä»¬è¦æ”¹å˜å…¶ä¸­ä¸€ä»½é…ç½®é¡¹çš„ä¿¡æ¯ï¼Œå¾ˆå¯èƒ½å…¶ä»–ä¸¤ä»½éƒ½è¦æ”¹ã€‚å¹¶ä¸”ï¼Œæ”¹å˜äº†é…ç½®é¡¹çš„ä¿¡æ¯<strong>å¾ˆå¯èƒ½å°±è¦é‡å¯ç³»ç»Ÿ</strong><br>
äºæ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›æŠŠ<code>ASystem.ymlã€BSystem.ymlã€CSystem.yml</code>ç›¸åŒçš„é…ç½®é¡¹æŠ½å–å‡ºæ¥æˆä¸€ä»½<strong>å…¬ç”¨</strong>çš„é…ç½®<code>common.yml</code>ï¼Œå¹¶ä¸”å³ä¾¿<code>common.yml</code>æ”¹äº†ï¼Œä¹Ÿä¸éœ€è¦ç³»ç»ŸAã€Bã€Cé‡å¯ã€‚<br>
<img src="http://blog.ludangxin.club/post-images/1590297542591.jpg" alt="" loading="lazy"><br>
åšæ³•ï¼šæˆ‘ä»¬å¯ä»¥å°†<code>common.yml</code>è¿™ä»½é…ç½®æ”¾åœ¨ZooKeeperçš„ZnodeèŠ‚ç‚¹ä¸­ï¼Œç³»ç»ŸAã€Bã€Cç›‘å¬ç€è¿™ä¸ªZnodeèŠ‚ç‚¹æœ‰æ— å˜æ›´ï¼Œå¦‚æœå˜æ›´äº†ï¼Œ<strong>åŠæ—¶</strong>å“åº”ã€‚<br>
<img src="http://blog.ludangxin.club/post-images/1590297551378.jpg" alt="" loading="lazy"></li>
</ul>
<h2 id="ç»Ÿä¸€å‘½åæœåŠ¡">ç»Ÿä¸€å‘½åæœåŠ¡</h2>
<p>ç»Ÿä¸€å‘½åæœåŠ¡çš„ç†è§£å…¶å®è·Ÿ<strong>åŸŸå</strong>ä¸€æ ·ï¼Œæ˜¯æˆ‘ä»¬ä¸ºè¿™æŸä¸€éƒ¨åˆ†çš„èµ„æºç»™å®ƒ<strong>å–ä¸€ä¸ªåå­—</strong>ï¼Œåˆ«äººé€šè¿‡è¿™ä¸ªåå­—å°±å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„èµ„æºã€‚<br>
æ¯”å¦‚è¯´ï¼Œç°åœ¨æˆ‘æœ‰ä¸€ä¸ªåŸŸå<code>www.java3y.com</code>ï¼Œä½†æˆ‘è¿™ä¸ªåŸŸåä¸‹æœ‰å¤šå°æœºå™¨ï¼š</p>
<ul>
<li>192.168.1.1</li>
<li>192.168.1.2</li>
<li>192.168.1.3</li>
<li>192.168.1.4<br>
åˆ«äººè®¿é—®<code>www.java3y.com</code>å³å¯è®¿é—®åˆ°æˆ‘çš„æœºå™¨ï¼Œè€Œä¸æ˜¯é€šè¿‡IPå»è®¿é—®ã€‚<br>
<img src="http://blog.ludangxin.club/post-images/1590297563202.jpg" alt="" loading="lazy"></li>
</ul>
<h2 id="åˆ†å¸ƒå¼é”">åˆ†å¸ƒå¼é”</h2>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ZooKeeperæ¥å®ç°åˆ†å¸ƒå¼é”ï¼Œé‚£æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿï¼Ÿä¸‹é¢æ¥çœ‹çœ‹ï¼š<br>
ç³»ç»ŸAã€Bã€Céƒ½å»è®¿é—®<code>/locks</code>èŠ‚ç‚¹<br>
<img src="http://blog.ludangxin.club/post-images/1590297574406.jpg" alt="" loading="lazy"><br>
è®¿é—®çš„æ—¶å€™ä¼šåˆ›å»º<strong>å¸¦é¡ºåºå·çš„ä¸´æ—¶/çŸ­æš‚</strong>(<code>EPHEMERAL_SEQUENTIAL</code>)èŠ‚ç‚¹ï¼Œæ¯”å¦‚ï¼Œç³»ç»ŸAåˆ›å»ºäº†<code>id_000000</code>èŠ‚ç‚¹ï¼Œç³»ç»ŸBåˆ›å»ºäº†<code>id_000002</code>èŠ‚ç‚¹ï¼Œç³»ç»ŸCåˆ›å»ºäº†<code>id_000001</code>èŠ‚ç‚¹ã€‚<br>
<img src="http://blog.ludangxin.club/post-images/1590297582628.jpg" alt="" loading="lazy"><br>
æ¥ç€ï¼Œæ‹¿åˆ°<code>/locks</code>èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹(id_000000,id_000001,id_000002)ï¼Œ<strong>åˆ¤æ–­è‡ªå·±åˆ›å»ºçš„æ˜¯ä¸æ˜¯æœ€å°çš„é‚£ä¸ªèŠ‚ç‚¹</strong></p>
<ul>
<li>å¦‚æœæ˜¯ï¼Œåˆ™æ‹¿åˆ°é”ã€‚</li>
<li>
<ul>
<li>é‡Šæ”¾é”ï¼šæ‰§è¡Œå®Œæ“ä½œåï¼ŒæŠŠåˆ›å»ºçš„èŠ‚ç‚¹ç»™åˆ æ‰</li>
</ul>
</li>
<li>å¦‚æœä¸æ˜¯ï¼Œåˆ™ç›‘å¬æ¯”è‡ªå·±è¦å°1çš„èŠ‚ç‚¹å˜åŒ–<br>
ä¸¾ä¸ªä¾‹å­ï¼š</li>
<li>ç³»ç»ŸAæ‹¿åˆ°<code>/locks</code>èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œç»è¿‡æ¯”è¾ƒï¼Œå‘ç°è‡ªå·±(<code>id_000000</code>)ï¼Œæ˜¯æ‰€æœ‰å­èŠ‚ç‚¹æœ€å°çš„ã€‚æ‰€ä»¥å¾—åˆ°é”</li>
<li>ç³»ç»ŸBæ‹¿åˆ°<code>/locks</code>èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œç»è¿‡æ¯”è¾ƒï¼Œå‘ç°è‡ªå·±(<code>id_000002</code>)ï¼Œä¸æ˜¯æ‰€æœ‰å­èŠ‚ç‚¹æœ€å°çš„ã€‚æ‰€ä»¥ç›‘å¬æ¯”è‡ªå·±å°1çš„èŠ‚ç‚¹<code>id_000001</code>çš„çŠ¶æ€</li>
<li>ç³»ç»ŸCæ‹¿åˆ°<code>/locks</code>èŠ‚ç‚¹ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œç»è¿‡æ¯”è¾ƒï¼Œå‘ç°è‡ªå·±(<code>id_000001</code>)ï¼Œä¸æ˜¯æ‰€æœ‰å­èŠ‚ç‚¹æœ€å°çš„ã€‚æ‰€ä»¥ç›‘å¬æ¯”è‡ªå·±å°1çš„èŠ‚ç‚¹<code>id_000000</code>çš„çŠ¶æ€</li>
<li>â€¦...</li>
<li>ç­‰åˆ°ç³»ç»ŸAæ‰§è¡Œå®Œæ“ä½œä»¥åï¼Œå°†è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹åˆ é™¤(<code>id_000000</code>)ã€‚é€šè¿‡ç›‘å¬ï¼Œç³»ç»ŸCå‘ç°<code>id_000000</code>èŠ‚ç‚¹å·²ç»åˆ é™¤äº†ï¼Œå‘ç°è‡ªå·±å·²ç»æ˜¯æœ€å°çš„èŠ‚ç‚¹äº†ï¼Œäºæ˜¯é¡ºåˆ©æ‹¿åˆ°é”</li>
<li>â€¦.ç³»ç»ŸBå¦‚ä¸Š</li>
</ul>
<h2 id="é›†ç¾¤çŠ¶æ€">é›†ç¾¤çŠ¶æ€</h2>
<p>ç»è¿‡ä¸Šé¢å‡ ä¸ªä¾‹å­ï¼Œæˆ‘ç›¸ä¿¡å¤§å®¶ä¹Ÿå¾ˆå®¹æ˜“æƒ³åˆ°ZooKeeperæ˜¯æ€ä¹ˆ&quot;<strong>æ„ŸçŸ¥</strong>&quot;èŠ‚ç‚¹çš„åŠ¨æ€æ–°å¢æˆ–è€…åˆ é™¤çš„äº†ã€‚<br>
è¿˜æ˜¯ä»¥æˆ‘ä»¬ä¸‰ä¸ªç³»ç»ŸAã€Bã€Cä¸ºä¾‹ï¼Œåœ¨ZooKeeperä¸­åˆ›å»º<strong>ä¸´æ—¶èŠ‚ç‚¹</strong>å³å¯ï¼š<br>
<img src="http://blog.ludangxin.club/post-images/1590297610379.jpg" alt="" loading="lazy"><br>
åªè¦ç³»ç»ŸAæŒ‚äº†ï¼Œé‚£<code>/groupMember/A</code>è¿™ä¸ªèŠ‚ç‚¹å°±ä¼šåˆ é™¤ï¼Œé€šè¿‡<strong>ç›‘å¬</strong><code>groupMember</code>ä¸‹çš„å­èŠ‚ç‚¹ï¼Œç³»ç»ŸBå’ŒCå°±èƒ½å¤Ÿæ„ŸçŸ¥åˆ°ç³»ç»ŸAå·²ç»æŒ‚äº†ã€‚(æ–°å¢ä¹Ÿæ˜¯åŒç†)<br>
é™¤äº†èƒ½å¤Ÿæ„ŸçŸ¥èŠ‚ç‚¹çš„ä¸Šä¸‹çº¿å˜åŒ–ï¼ŒZooKeeperè¿˜å¯ä»¥å®ç°<strong>åŠ¨æ€é€‰ä¸¾Master</strong>çš„åŠŸèƒ½ã€‚(å¦‚æœé›†ç¾¤æ˜¯ä¸»ä»æ¶æ„æ¨¡å¼ä¸‹)<br>
åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œå¦‚æœæƒ³è¦å®ç°åŠ¨æ€é€‰ä¸¾Masterçš„åŠŸèƒ½ï¼ŒZnodeèŠ‚ç‚¹çš„ç±»å‹æ˜¯å¸¦<strong>é¡ºåºå·çš„ä¸´æ—¶èŠ‚ç‚¹</strong>(<code>EPHEMERAL_SEQUENTIAL</code>)å°±å¥½äº†ã€‚</p>
<ul>
<li>Zookeeperä¼šæ¯æ¬¡é€‰ä¸¾æœ€å°ç¼–å·çš„ä½œä¸ºMasterï¼Œå¦‚æœMasteræŒ‚äº†ï¼Œè‡ªç„¶å¯¹åº”çš„ZnodeèŠ‚ç‚¹å°±ä¼šåˆ é™¤ã€‚ç„¶åè®©<strong>æ–°çš„æœ€å°ç¼–å·ä½œä¸ºMaster</strong>ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°åŠ¨æ€é€‰ä¸¾çš„åŠŸèƒ½äº†ã€‚<br>
è½¬è‡ª: <a href="https://www.zhihu.com/question/65852003/answer/656091418">Java3y-zookeeper</a></li>
</ul>
<h1 id="zab-åè®®paxosç®—æ³•">ZAB åè®®&amp;Paxosç®—æ³•</h1>
<p><a href="https://www.zhihu.com/question/19787937/answer/107750652">paxos ç®—æ³•</a><br>
Paxos ç®—æ³•åº”è¯¥å¯ä»¥è¯´æ˜¯ ZooKeeper çš„çµé­‚äº†ã€‚ä½†æ˜¯ï¼ŒZooKeeper å¹¶æ²¡æœ‰å®Œå…¨é‡‡ç”¨ Paxosç®—æ³• ï¼Œè€Œæ˜¯ä½¿ç”¨ ZAB åè®®ä½œä¸ºå…¶ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„æ ¸å¿ƒç®—æ³•ã€‚å¦å¤–ï¼Œåœ¨ZooKeeperçš„å®˜æ–¹æ–‡æ¡£ä¸­ä¹ŸæŒ‡å‡ºï¼ŒZABåè®®å¹¶ä¸åƒ Paxos ç®—æ³•é‚£æ ·ï¼Œæ˜¯ä¸€ç§é€šç”¨çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹åˆ«ä¸ºZookeeperè®¾è®¡çš„å´©æºƒå¯æ¢å¤çš„åŸå­æ¶ˆæ¯å¹¿æ’­ç®—æ³•ã€‚</p>
<h2 id="zab-åè®®ä»‹ç»">ZAB åè®®ä»‹ç»</h2>
<p><strong>ZABï¼ˆZooKeeper Atomic Broadcast åŸå­å¹¿æ’­ï¼‰ åè®®æ˜¯ä¸ºåˆ†å¸ƒå¼åè°ƒæœåŠ¡ ZooKeeper ä¸“é—¨è®¾è®¡çš„ä¸€ç§æ”¯æŒå´©æºƒæ¢å¤çš„åŸå­å¹¿æ’­åè®®ã€‚ åœ¨ ZooKeeper ä¸­ï¼Œä¸»è¦ä¾èµ– ZAB åè®®æ¥å®ç°åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§ï¼ŒåŸºäºè¯¥åè®®ï¼ŒZooKeeper å®ç°äº†ä¸€ç§ä¸»å¤‡æ¨¡å¼çš„ç³»ç»Ÿæ¶æ„æ¥ä¿æŒé›†ç¾¤ä¸­å„ä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚</strong><br>
<strong>ZAB åè®®ä¸¤ç§åŸºæœ¬çš„æ¨¡å¼ï¼šå´©æºƒæ¢å¤å’Œæ¶ˆæ¯å¹¿æ’­</strong><br>
ZABåè®®åŒ…æ‹¬ä¸¤ç§åŸºæœ¬çš„æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ <strong>å´©æºƒæ¢å¤å’Œæ¶ˆæ¯å¹¿æ’­</strong>ã€‚å½“æ•´ä¸ªæœåŠ¡æ¡†æ¶åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œæˆ–æ˜¯å½“ Leader æœåŠ¡å™¨å‡ºç°ç½‘ç»œä¸­æ–­ã€å´©æºƒé€€å‡ºä¸é‡å¯ç­‰å¼‚å¸¸æƒ…å†µæ—¶ï¼ŒZAB åè®®å°±ä¼šè¿›äººæ¢å¤æ¨¡å¼å¹¶é€‰ä¸¾äº§ç”Ÿæ–°çš„LeaderæœåŠ¡å™¨ã€‚å½“é€‰ä¸¾äº§ç”Ÿäº†æ–°çš„ Leader æœåŠ¡å™¨ï¼ŒåŒæ—¶é›†ç¾¤ä¸­å·²ç»æœ‰è¿‡åŠçš„æœºå™¨ä¸è¯¥LeaderæœåŠ¡å™¨å®Œæˆäº†çŠ¶æ€åŒæ­¥ä¹‹åï¼ŒZABåè®®å°±ä¼šé€€å‡ºæ¢å¤æ¨¡å¼ã€‚å…¶ä¸­ï¼Œ<strong>æ‰€è°“çš„çŠ¶æ€åŒæ­¥æ˜¯æŒ‡æ•°æ®åŒæ­¥ï¼Œç”¨æ¥ä¿è¯é›†ç¾¤ä¸­å­˜åœ¨è¿‡åŠçš„æœºå™¨èƒ½å¤Ÿå’ŒLeaderæœåŠ¡å™¨çš„æ•°æ®çŠ¶æ€ä¿æŒä¸€è‡´</strong>ã€‚<br>
<strong>å½“é›†ç¾¤ä¸­å·²ç»æœ‰è¿‡åŠçš„FolloweræœåŠ¡å™¨å®Œæˆäº†å’ŒLeaderæœåŠ¡å™¨çš„çŠ¶æ€åŒæ­¥ï¼Œé‚£ä¹ˆæ•´ä¸ªæœåŠ¡æ¡†æ¶å°±å¯ä»¥è¿›äººæ¶ˆæ¯å¹¿æ’­æ¨¡å¼äº†ã€‚</strong> å½“ä¸€å°åŒæ ·éµå®ˆZABåè®®çš„æœåŠ¡å™¨å¯åŠ¨ååŠ äººåˆ°é›†ç¾¤ä¸­æ—¶ï¼Œå¦‚æœæ­¤æ—¶é›†ç¾¤ä¸­å·²ç»å­˜åœ¨ä¸€ä¸ªLeaderæœåŠ¡å™¨åœ¨è´Ÿè´£è¿›è¡Œæ¶ˆæ¯å¹¿æ’­ï¼Œé‚£ä¹ˆæ–°åŠ äººçš„æœåŠ¡å™¨å°±ä¼šè‡ªè§‰åœ°è¿›äººæ•°æ®æ¢å¤æ¨¡å¼ï¼šæ‰¾åˆ°Leaderæ‰€åœ¨çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸å…¶è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œç„¶åä¸€èµ·å‚ä¸åˆ°æ¶ˆæ¯å¹¿æ’­æµç¨‹ä¸­å»ã€‚æ­£å¦‚ä¸Šæ–‡ä»‹ç»ä¸­æ‰€è¯´çš„ï¼ŒZooKeeperè®¾è®¡æˆåªå…è®¸å”¯ä¸€çš„ä¸€ä¸ªLeaderæœåŠ¡å™¨æ¥è¿›è¡Œäº‹åŠ¡è¯·æ±‚çš„å¤„ç†ã€‚LeaderæœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„äº‹åŠ¡è¯·æ±‚åï¼Œä¼šç”Ÿæˆå¯¹åº”çš„äº‹åŠ¡ææ¡ˆå¹¶å‘èµ·ä¸€è½®å¹¿æ’­åè®®ï¼›è€Œå¦‚æœé›†ç¾¤ä¸­çš„å…¶ä»–æœºå™¨æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„äº‹åŠ¡è¯·æ±‚ï¼Œé‚£ä¹ˆè¿™äº›éLeaderæœåŠ¡å™¨ä¼šé¦–å…ˆå°†è¿™ä¸ªäº‹åŠ¡è¯·æ±‚è½¬å‘ç»™LeaderæœåŠ¡å™¨ã€‚</p>
<h1 id="zookeeperç¯å¢ƒæ­å»º">zookeeperç¯å¢ƒæ­å»º</h1>
<h2 id="å•æœºç¯å¢ƒ">å•æœºç¯å¢ƒ</h2>
<ol>
<li>ä¸Šä¼ zookeeperåˆ°linuxæœåŠ¡å™¨</li>
<li>è§£å‹ç¼©å‹ç¼©åŒ…</li>
</ol>
<pre><code class="language-bash">tar -zxvf zookeeper-3.5.8.tar
</code></pre>
<ol start="3">
<li>è¿›å…¥zookeeper-3.5.8ç›®å½•,åˆ›å»ºdataæ–‡ä»¶å¤¹ä¸”åˆ›å»ºcfgæ–‡ä»¶</li>
</ol>
<pre><code class="language-bash">mkdir data
cd conf
# zookeeperé»˜è®¤è¯»å–zoo.cfgçš„é…ç½®æ–‡ä»¶ä¿¡æ¯
cp zoo_sample.cfg zoo.cfg
</code></pre>
<ol start="4">
<li>ä¿®æ”¹zoo.cfg dataç›®å½•</li>
</ol>
<pre><code class="language-bash">dataDir=/usr/local/zookeeper-3.5.8/data
# zkæœåŠ¡å™¨é»˜è®¤8080ç«¯å£,ä¸ºé˜²æ­¢ç«¯å£å ç”¨,å¢åŠ serverPorté…ç½®
admin.serverPort=6666
</code></pre>
<ol start="5">
<li>åˆ°binç›®å½•å¯åŠ¨zookeeper</li>
</ol>
<pre><code class="language-bash">./zkServer.sh start
</code></pre>
<ol start="6">
<li>æŸ¥çœ‹zookeeperçŠ¶æ€</li>
</ol>
<pre><code class="language-bash">./zkServer.sh status
</code></pre>
<h2 id="é›†ç¾¤ç¯å¢ƒ">é›†ç¾¤ç¯å¢ƒ</h2>
<ol>
<li>å°†zookeeperåˆ†åˆ«å®‰è£…åˆ°ä¸‰å°æœåŠ¡å™¨ä¸Šå¹¶é…ç½®å¥½åŸºæœ¬ä¿¡æ¯(é‡å¤å•æœºç¯å¢ƒæ­å»ºè¿‡ç¨‹)</li>
<li>åœ¨æ¯ä¸ªzookeeperçš„dataç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªmyidæ–‡ä»¶,å†…å®¹åˆ†åˆ«æ˜¯1,2,3 è¿™ä¸ªæ–‡ä»¶å°±æ˜¯è®°å½•æ¯ä¸ªæœåŠ¡å™¨çš„id</li>
</ol>
<pre><code class="language-bash"># 192.168.1.110 æœåŠ¡å™¨
echo 1 &gt; myid 
# 192.168.1.111 æœåŠ¡å™¨
echo 2 &gt; myid 
# 192.168.1.112 æœåŠ¡å™¨
echo 3 &gt; myid 
</code></pre>
<ol start="3">
<li>åœ¨æ¯ä¸€ä¸ªzookeeperçš„zoo.cfgé…ç½®å®¢æˆ·ç«¯è®¿é—®ç«¯å£å’Œé›†ç¾¤æœåŠ¡å™¨ipåˆ—è¡¨</li>
</ol>
<pre><code class="language-bash"># server.æœåŠ¡å™¨id=æœåŠ¡å™¨ipåœ°å€:æœåŠ¡å™¨ä¹‹é—´é€šä¿¡ç«¯å£:æœåŠ¡å™¨ä¹‹é—´æŠ•ç¥¨é€‰ä¸¾ç«¯å£
server.1=192.168.1.110:2181:3881
server.2=192.168.1.111:2181:3881
server.3=192.168.1.112:2181:3881
</code></pre>
<ol start="4">
<li>å¯åŠ¨é›†ç¾¤<br>
ä¾æ¬¡å¯åŠ¨ä¸‰ä¸ªzkå®ä¾‹,å…¶ä¸­æœ‰ä¸€ä¸ªleaderå’Œä¸¤ä¸ªfollower</li>
<li>é€šè¿‡<code>./zkServer.sh status</code>å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰zkæ˜¯ leader è¿˜æ˜¯ follower</li>
<li>å¯ä»¥é€šè¿‡<code>./zkServer.sh stop</code>å‘½ä»¤åœæ­¢zkæœåŠ¡æ¥æµ‹è¯•zkçš„é€‰ä¸¾æ¨¡å¼</li>
</ol>
<h1 id="zookeeperåŸºæœ¬ä½¿ç”¨">zookeeperåŸºæœ¬ä½¿ç”¨</h1>
<h2 id="æ•°æ®ç»“æ„-2">æ•°æ®ç»“æ„</h2>
<p>zookeeperæ•°æ®æ¨¡å‹çš„ç»“æ„ä¸Unixæ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼,æ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘,æ¯ä¸ªèŠ‚ç‚¹ç§°ä½œä¸€ä¸ªZNode,æ¯ä¸ªZNodeéƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†. å¦‚å›¾ç¤º<br>
<img src="http://blog.ludangxin.club/post-images/1590297680104.jpg" alt="" loading="lazy"><br>
ZNodeèŠ‚ç‚¹ç±»å‹</p>
<ul>
<li>æŒä¹…åŒ–ç›®å½•èŠ‚ç‚¹(PERSISTENT)<br>
å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥å,è¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨</li>
<li>æŒä¹…åŒ–é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹(PERSISTENT_SEQUENTIAL)<br>
å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥å,è¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨,zookeeperä¼šç»™è¯¥èŠ‚ç‚¹æŒ‰ç…§é¡ºåºç¼–å·</li>
<li>ä¸´æ—¶ç›®å½•èŠ‚ç‚¹(EPHEMERAL)<br>
å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥å,è¯¥èŠ‚ç‚¹è¢«åˆ é™¤</li>
<li>ä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹(EPHEMERAL_SEQUENTIAL)<br>
å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥å,è¯¥èŠ‚ç‚¹è¢«åˆ é™¤,zookeeperä¼šç»™è¯¥èŠ‚ç‚¹æŒ‰ç…§é¡ºåºç¼–å·</li>
</ul>
<h2 id="å‘½ä»¤è¡Œä½¿ç”¨">å‘½ä»¤è¡Œä½¿ç”¨</h2>
<ol>
<li>åœ¨zookeeper binç›®å½•ä¸­è¾“å…¥ <code>./zkCli.sh</code> è¿›å…¥å®¢æˆ·ç«¯</li>
<li>è¾“å…¥helpæŸ¥çœ‹ç›¸å…³å‘½ä»¤æ“ä½œ,ç»“æœå¦‚ä¸‹<br>
<img src="http://blog.ludangxin.club/post-images/1590297708595.jpg" alt="" loading="lazy"><br>
å¸¸ç”¨å‘½ä»¤è®²è§£:</li>
</ol>
<h2 id="èŠ‚ç‚¹ç›®å½•æ“ä½œ">èŠ‚ç‚¹ç›®å½•æ“ä½œ</h2>
<ol>
<li>ä½¿ç”¨lså‘½ä»¤æ¥æŸ¥çœ‹å½“å‰znodeä¸­é”åŒ…å«çš„å†…å®¹</li>
</ol>
<pre><code class="language-bash"># ls [-s] [-w] [-R] path
[zk: localhost:2181(CONNECTED) 3] ls /
[ludangxin, zookeeper]
</code></pre>
<ol start="2">
<li>ä½¿ç”¨ls2æŸ¥çœ‹å½“å‰èŠ‚ç‚¹æ•°æ®å¹¶èƒ½çœ‹åˆ°æ›´æ–°æ¬¡æ•°ç­‰æ•°æ®</li>
</ol>
<pre><code class="language-bash"># ls2 path [watch] å®˜æ–¹ä¸æ¨èç›´æ¥ä½¿ç”¨ls2æŸ¥çœ‹, ä½¿ç”¨ ls -s path æ•ˆæœä¸€æ ·
[zk: localhost:2181(CONNECTED) 4] ls2 /
'ls2' has been deprecated. Please use 'ls [-s] path' instead.
[ludangxin, zookeeper]
cZxid = 0x0
ctime = Thu Jan 01 00:00:00 UTC 1970
mZxid = 0x0
mtime = Thu Jan 01 00:00:00 UTC 1970
pZxid = 0x2
cversion = 0
dataVersion = 0
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 0
numChildren = 2
</code></pre>
<ol start="3">
<li>ä½¿ç”¨createåˆ›å»ºèŠ‚ç‚¹  -s å«æœ‰åºåˆ—  -e ä¸´æ—¶</li>
</ol>
<pre><code class="language-bash"># create [-s] [-e] [-c] [-t ttl] path [data] [acl]
# zkå®¢æˆ·ç«¯ä¸èƒ½é€’å½’åˆ›å»ºç›®å½•,åªèƒ½ä¸€çº§ä¸€çº§åˆ›å»º
[zk: localhost:2181(CONNECTED) 6] create /ludangxin/app1
Created /ludangxin/app1
</code></pre>
<ol start="4">
<li>ä½¿ç”¨setè®¾ç½®èŠ‚ç‚¹å€¼</li>
</ol>
<pre><code class="language-bash"># set [-s] [-v version] path data
[zk: localhost:2181(CONNECTED) 8] set /ludangxin/app1 helloworld
</code></pre>
<ol start="5">
<li>ä½¿ç”¨getè·å¾—èŠ‚ç‚¹çš„å€¼</li>
</ol>
<pre><code class="language-bash"># get [-s] [-w] path 
[zk: localhost:2181(CONNECTED) 9] get /ludangxin/app1
helloworld
</code></pre>
<ol start="6">
<li>ä½¿ç”¨statæŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</li>
</ol>
<pre><code class="language-bash"># stat [-w] path
[zk: localhost:2181(CONNECTED) 1] stat /ludangxin/app1
cZxid = 0x3
ctime = Sat May 23 13:03:07 UTC 2020
mZxid = 0x4
mtime = Sat May 23 13:05:56 UTC 2020
pZxid = 0x3
cversion = 0
dataVersion = 1
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 10
numChildren = 0
</code></pre>
<ol start="7">
<li>ä½¿ç”¨deleteåˆ é™¤èŠ‚ç‚¹</li>
</ol>
<pre><code class="language-bash"># delete [-v version] path
# deleteä¸èƒ½é€’å½’åˆ é™¤ç›®å½•,åªèƒ½ä¸€çº§ä¸€çº§åˆ é™¤
[zk: localhost:2181(CONNECTED) 3] delete /ludangxin/app1
</code></pre>
<ol start="8">
<li>ä½¿ç”¨rmræˆ–deleteallé€’å½’åˆ é™¤èŠ‚ç‚¹</li>
</ol>
<pre><code class="language-bash"># rmr path å®˜æ–¹ä¸æ¨èä½¿ç”¨rmr æ¨èä½¿ç”¨deleteall
[zk: localhost:2181(CONNECTED) 4] create /ludangxin/app1
Created /ludangxin/app1
[zk: localhost:2181(CONNECTED) 5] create /ludangxin/app1/test1
Created /ludangxin/app1/test1
[zk: localhost:2181(CONNECTED) 7] rmr /ludangxin
The command 'rmr' has been deprecated. Please use 'deleteall' instead.
[zk: localhost:2181(CONNECTED) 8] ls /ludangxin
Node does not exist: /ludangxin
[zk: localhost:2181(CONNECTED) 9] ls /
[zookeeper]
</code></pre>
<h2 id="ç›‘å¬æ“ä½œ">ç›‘å¬æ“ä½œ</h2>
<p><strong>ç›‘å¬åªèƒ½ç›‘å¬ä¸€æ¬¡,è§¦å‘åå°±é”€æ¯äº†</strong></p>
<ol>
<li>ä½¿ç”¨lsåˆ›å»ºç›‘å¬</li>
</ol>
<pre><code class="language-bash"># ls -w path å½“ç›‘å¬çš„èŠ‚ç‚¹åŒ…æ‹¬ä»–çš„å­èŠ‚ç‚¹å‘ç›®å½•å‘ç”Ÿå˜åŒ–çš„æ—¶å€™æ‰è§¦å‘ç›‘å¬
# ä¾‹:å½“å‰ç›‘å¬ /a/b å¦‚æœåˆ é™¤bèŠ‚ç‚¹,æˆ–è€…åˆ›å»º /a/b/c çš„æ—¶å€™ä¼šè§¦å‘ç›‘å¬ä¸”åªèƒ½è§¦å‘ä¸€æ¬¡
[zk: localhost:2181(CONNECTED) 15] ls -w  /ludangxin/app1
[]
[zk: localhost:2181(CONNECTED) 16] set /ludangxin/app1 helloworld
[zk: localhost:2181(CONNECTED) 17] create /ludangxin/app1/testwatch
Created /ludangxin/app1/testwatch
WATCHER::
WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/ludangxin/app1
</code></pre>
<ol start="2">
<li>ä½¿ç”¨getåˆ›å»ºç›‘å¬(åªèƒ½å½“å‰èŠ‚ç‚¹ç›‘å¬èŠ‚ç‚¹å€¼çš„å˜åŒ–)</li>
</ol>
<pre><code class="language-bash"># get -w path
get -w /ludangxin/app1
</code></pre>
<ol start="3">
<li>ä½¿ç”¨statåˆ›å»ºç›‘å¬(å½“ å½“å‰èŠ‚ç‚¹çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜çš„æ—¶å€™è§¦å‘)</li>
</ol>
<pre><code class="language-bash"># stat -w path
stat -w /ludangxin/app1
</code></pre>
<h1 id="zookeeper-apiä½¿ç”¨">zookeeper apiä½¿ç”¨</h1>
<h2 id="å¼•å…¥ä¾èµ–">å¼•å…¥ä¾èµ–</h2>
<p><strong>æ³¨</strong>: å¼•å…¥ä¾èµ–çš„ç‰ˆæœ¬æœ€å¥½å’Œå®‰è£…çš„zkæœåŠ¡çš„ç‰ˆæœ¬ä¸€è‡´</p>
<pre><code class="language-xml">&lt;!-- zookeeper --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.zookeeper&lt;/groupId&gt;
    &lt;artifactId&gt;zookeeper&lt;/artifactId&gt;
    &lt;version&gt;3.5.8&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- lombok --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
    &lt;artifactId&gt;lombok&lt;/artifactId&gt;
    &lt;optional&gt;true&lt;/optional&gt;
&lt;/dependency&gt;
</code></pre>
<h2 id="åˆ›å»ºæµ‹è¯•ç±»">åˆ›å»ºæµ‹è¯•ç±»</h2>
<pre><code class="language-java">import lombok.extern.slf4j.Slf4j;
import org.apache.zookeeper.*;
import org.apache.zookeeper.data.Stat;
import org.junit.jupiter.api.Test;
import java.io.IOException;
import java.util.List;

@Slf4j
public class ZkApiTest {

    public static final String URL = &quot;192.168.128.130:2181&quot;;

    public static final int SESSION_TIME_OUT = 20000;

    @Test
    public void test() throws IOException, KeeperException, InterruptedException {
        //1. åˆ›å»ºzookeeperè¿æ¥
        ZooKeeper zooKeeper = new ZooKeeper(URL,SESSION_TIME_OUT, watch -&gt;
                log.info(&quot;è§¦å‘äº†&quot;+ watch.getType() +&quot;äº‹ä»¶&quot;)
        );
        //2. åˆ›å»ºçˆ¶èŠ‚ç‚¹
        //Ids.OPEN_ACL_UNSAFE æ— æƒé™ CreateMode.PERSISTENT æŒä¹…åŒ–èŠ‚ç‚¹
        String testParentPath = zooKeeper.create(&quot;/testPath1&quot;, &quot;testParentValue&quot;.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);
        log.info(&quot;testParentPath===&quot;+testParentPath);
        //3. åˆ›å»ºå­èŠ‚ç‚¹
        String testChildPath = zooKeeper.create(testParentPath+&quot;/child1&quot;, &quot;testChildValue&quot;.getBytes(), ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);
        log.info(&quot;testChildPath===&quot;+testChildPath);
        //4. è·å–èŠ‚ç‚¹ä¸­çš„å€¼(çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹)
        byte[] parentData = zooKeeper.getData(testParentPath, false, null);
        byte[] childData = zooKeeper.getData(testChildPath, false, null);
        List&lt;String&gt; childrenNodes = zooKeeper.getChildren(testParentPath, false);
        log.info(&quot;parentData===&quot;+new String(parentData));
        log.info(&quot;childData===&quot;+new String(childData));
        for (String childrenNode : childrenNodes) {
            log.info(&quot;childrenNode===&quot;+childrenNode);
        }
        //5. ä¿®æ”¹èŠ‚ç‚¹çš„å€¼
        //version èŠ‚ç‚¹ç‰ˆæœ¬ -1 åŒ¹é…ä»»ä½•ç‰ˆæœ¬
        zooKeeper.setData(testParentPath, &quot;testValueUpdate&quot;.getBytes(), -1);
        byte[] parentNewData = zooKeeper.getData(testParentPath, false, null);
        log.info(&quot;parentNewData===&quot;+new String(parentNewData));
        //6. åˆ¤æ–­æŸä¸ªèŠ‚ç‚¹æ˜¯å¦å­˜åœ¨
        Stat exists = zooKeeper.exists(testChildPath, false);
        log.info(exists.toString());
        //7. åˆ é™¤èŠ‚ç‚¹
        zooKeeper.delete(testChildPath,-1);
    }
}
</code></pre>
<h2 id="è¾“å‡ºç»“æœ">è¾“å‡ºç»“æœ</h2>
<pre><code class="language-java">23:37:36.574 [main-EventThread] INFO com.ldx.springboot.ZkApiTest - è§¦å‘äº†Noneäº‹ä»¶
23:37:36.581 [main] INFO com.ldx.springboot.ZkApiTest - testParentPath===/testPath1
23:37:36.585 [main] INFO com.ldx.springboot.ZkApiTest - testChildPath===/testPath1/child1
23:37:36.595 [main] INFO com.ldx.springboot.ZkApiTest - parentData===testParentValue
23:37:36.595 [main] INFO com.ldx.springboot.ZkApiTest - childData===testChildValue
23:37:36.595 [main] INFO com.ldx.springboot.ZkApiTest - childrenNode===child1
23:37:36.603 [main] INFO com.ldx.springboot.ZkApiTest - parentNewData===testValueUpdate
23:37:36.606 [main] INFO com.ldx.springboot.ZkApiTest - 111,111,1590248257090,1590248257090,0,0,0,0,14,0,111
</code></pre>

                        </div>
                        
                            <div class="post-toc">
                                <ul class="markdownIt-TOC">
<li><a href="#zookeeper%E6%98%AF%E4%BB%80%E4%B9%88">zookeeperæ˜¯ä»€ä¹ˆ</a></li>
<li><a href="#zookeeper%E4%B8%BA%E4%BB%80%E4%B9%88%E8%83%BD%E5%B9%B2%E8%BF%99%E4%B9%88%E5%A4%9A">zookeeperä¸ºä»€ä¹ˆèƒ½å¹²è¿™ä¹ˆå¤š</a>
<ul>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84">æ•°æ®ç»“æ„</a></li>
<li><a href="#%E7%9B%91%E5%90%AC%E5%99%A8">ç›‘å¬å™¨</a></li>
</ul>
</li>
<li><a href="#zookeeper%E5%85%B7%E4%BD%93%E8%83%BD%E5%B9%B2%E4%BB%80%E4%B9%88">zookeeperå…·ä½“èƒ½å¹²ä»€ä¹ˆ</a>
<ul>
<li><a href="#%E7%BB%9F%E4%B8%80%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86">ç»Ÿä¸€é…ç½®ç®¡ç†</a></li>
<li><a href="#%E7%BB%9F%E4%B8%80%E5%91%BD%E5%90%8D%E6%9C%8D%E5%8A%A1">ç»Ÿä¸€å‘½åæœåŠ¡</a></li>
<li><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">åˆ†å¸ƒå¼é”</a></li>
<li><a href="#%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81">é›†ç¾¤çŠ¶æ€</a></li>
</ul>
</li>
<li><a href="#zab-%E5%8D%8F%E8%AE%AEpaxos%E7%AE%97%E6%B3%95">ZAB åè®®&amp;Paxosç®—æ³•</a>
<ul>
<li><a href="#zab-%E5%8D%8F%E8%AE%AE%E4%BB%8B%E7%BB%8D">ZAB åè®®ä»‹ç»</a></li>
</ul>
</li>
<li><a href="#zookeeper%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">zookeeperç¯å¢ƒæ­å»º</a>
<ul>
<li><a href="#%E5%8D%95%E6%9C%BA%E7%8E%AF%E5%A2%83">å•æœºç¯å¢ƒ</a></li>
<li><a href="#%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83">é›†ç¾¤ç¯å¢ƒ</a></li>
</ul>
</li>
<li><a href="#zookeeper%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">zookeeperåŸºæœ¬ä½¿ç”¨</a>
<ul>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-2">æ•°æ®ç»“æ„</a></li>
<li><a href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BD%BF%E7%94%A8">å‘½ä»¤è¡Œä½¿ç”¨</a></li>
<li><a href="#%E8%8A%82%E7%82%B9%E7%9B%AE%E5%BD%95%E6%93%8D%E4%BD%9C">èŠ‚ç‚¹ç›®å½•æ“ä½œ</a></li>
<li><a href="#%E7%9B%91%E5%90%AC%E6%93%8D%E4%BD%9C">ç›‘å¬æ“ä½œ</a></li>
</ul>
</li>
<li><a href="#zookeeper-api%E4%BD%BF%E7%94%A8">zookeeper apiä½¿ç”¨</a>
<ul>
<li><a href="#%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96">å¼•å…¥ä¾èµ–</a></li>
<li><a href="#%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E7%B1%BB">åˆ›å»ºæµ‹è¯•ç±»</a></li>
<li><a href="#%E8%BE%93%E5%87%BA%E7%BB%93%E6%9E%9C">è¾“å‡ºç»“æœ</a></li>
</ul>
</li>
</ul>

                            </div>
                            
                                
                                    
                                        <!--en-->
                                        <section class="post-copyright en">
                                            <p class="copyright-item">
                                                <span>Author:</span>
                                                <span>æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚</span>
                                            </p>

                                            <p class="copyright-item">
                                                <span>Permalink:</span>
                                                <span><a href="http://blog.ludangxin.club/post/chu-shi-zookeeper/">http://blog.ludangxin.club/post/chu-shi-zookeeper/</a></span>
                                            </p>

                                            <p class="copyright-item">
                                                <span>License:</span>
                                                <span>MIT License</span>
                                            </p>
                                        </section>
                                        
                                                
                                                    
                                                        <!-- Share-->
                                                        <span style="margin-right:15px">
                                                    <i class="post-share"></i>
                                                    <span>Share:</span>
                                                        <a title="QR Code" target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://blog.ludangxin.club/post/chu-shi-zookeeper/"><i class="fa fa-qrcode"></i></a>
                                                        <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.ludangxin.club/post/chu-shi-zookeeper/&sharesource=qzone&title=åˆè¯† Zookeeper&pics=http://blog.ludangxin.club/images/avatar.png?v=1598170590593&summary="><i class="fa fa-qq"></i></a>
                                                        <a title="Weibo" target="_blank" href="https://service.weibo.com/share/share.php?url=http://blog.ludangxin.club/post/chu-shi-zookeeper/&sharesource=weibo&title=åˆè¯† Zookeeper + " - " + &pic="http://blog.ludangxin.club/images/avatar.png?v=1598170590593 "><i class="fa fa-weibo "></i></a>
                                                        
                                                                </span>
                                                                <!--en-->
                                                                <section class="post-tags en ">
                                                                    <div>
                                                                        <span>Tag(s):</span>
                                                                        <span class="tag ">
                        
                        
                        <a href="http://blog.ludangxin.club/tag/4KBrXdUxz/">#
                                                åˆ†å¸ƒå¼
                                                    </a>
                                                    
                                                        
                                                            </span>
                                                                    </div>
                                                                    <div>
                                                                        <a href="javascript:window.history.back();">back</a>
                                                                        <span>&dot;</span>
                                                                        <a href="#">home</a>
                                                                    </div>
                                                                </section>
                                                                
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                        <a class="prev" rel="prev" href="http://blog.ludangxin.club/post/chu-shi-dubbo/">
                                                                                            åˆè¯† Dubbo
                                                                                        </a>
                                                                                        
                                                                                            
                                                                                                <a class="next" rel="next" href="http://blog.ludangxin.club/post/fen-bu-shi-ji-qun-wei-fu-wu/">
                                                                                                    æµ…è°ˆ åˆ†å¸ƒå¼ é›†ç¾¤ å¾®æœåŠ¡
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                
                                            
                                                <script type="application/javascript" src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
<div id="vlaine-comment"></div>
<script type="application/javascript">
    new Valine({
        el: '#vlaine-comment',
        appId: '6v8KE1xPEnnI3VycbaTHPQvD-gzGzoHsz',
        appKey: 'tCAPkuAx3JWn7YrPKlEpyaMH',
        pageSize: 10,
        avatar: 'mp',
        placeholder: 'æ¥éƒ½æ¥äº†ï¼Œä¸å¦¨è¯„è®ºä¸€ä¸‹',
        visitor: true,
        highlight: false,
        recordIP: true,
    })
</script>
                                                    
            </div>
    </div>
    </div>
    </div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                    <div class="Like">
                        <div class="tip" data-tooltip="Do you like it?">
                            <a href="https://github.com/ITJoker233/Gridea-theme-Chic" target="_blank" title=""><svg class="icon"
                        aria-hidden="true">
                        <use xlink:href="#like"></use>
                    </svg><b class="like_text" id="star"></b></a>
                        </div>
                    </div>
                    
                        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
                            
                                <b id="hitokoto"></b><br>
                                
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        æ–­å‰‘é‡é“¸ä¹‹æ—¥ï¼Œéª‘å£«å½’æ¥ä¹‹æ—¶ã€‚ &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://coding.net" target="_blank">
                                                Coding.net
                                            </a>
            </div>
            <div id="update" style="display:none;">
                on
            </div>
            
                <div id="version" style="display:none;">
                    1.7.4
                </div>
                
                    <script>
                        var port = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + port + '</div>')
                    </script>
        </footer>
        
            <script src='https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js'></script>
            
                <script>
                    
                    
                    loadlive2d();
                    
                    
                    hitokoto();
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    CheckVersion();
                    
                    var newDate = new Date();
                    newDate.setTime(1598170590593);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
        </div>
</body>
<script>
    scroll();
</script>

</html>