<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
<title>
    断剑重铸之日，骑士归来之时。
</title>
<!--[if lt IE 9]><script src="//cdn.bootcss.com/html5shiv/r29/html5.js"></script><![endif]-->
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<meta name="author" content="鲁档信">
<meta name="description" content="Hello World !">
<meta name="keywords" content="鲁档信,ludangxin">
<script async src="//instant.page/3.0.0" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>
<link rel="stylesheet" href="http://blog.ludangxin.club/styles/main.css" />
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/1.7.1/jquery.min.js"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/css/style.min.css" />
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/tocbot.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/script.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/itjoker233/Gridea-theme-Chic/assets/media/script/icon.min.js"></script>
        
            <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/Card/prism.min.js"></script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/css/Card/prism.min.css" />
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css">
            <script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js"></script>
            
                <!--点击特效-->
                <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/love.min.js"></script>
                
                        <!--CDN样式-->
                        <script src="https://cdn.jsdelivr.net/gh/ITJoker233/ITJoker233.github.io@latest/CDN/js/hit-kounter-lc-0.3.0.js"></script>
                        <script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
                        
                            <script>
                                (function() {
                                    var bp = document.createElement('script');
                                    var curProtocol = window.location.protocol.split(':')[0];
                                    if (curProtocol === 'https') {
                                        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
                                    } else {
                                        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                                    }
                                    var s = document.getElementsByTagName("script")[0];
                                    s.parentNode.insertBefore(bp, s);
                                })();
                            </script>
                            
</head>

<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <a href="http://blog.ludangxin.club">
                    断剑重铸之日，骑士归来之时。
                </a>
            </div>
            <div id="tp-weather-widget"></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/">
                        🏠首页
                    </a>
                    
                    <a class="menu-item" href="/archives">
                        📚归档
                    </a>
                    
                    <a class="menu-item" href="/tags">
                        🏷️标签
                    </a>
                    
                    <a class="menu-item" href="/posts">
                        ✍️博客
                    </a>
                    
                    <a class="menu-item" href="/post/about/">
                        👦关于
                    </a>
                    
                        <input id="switch_default" type="checkbox" class="switch_default">
                        <label for="switch_default" class="toggleBtn"></label>
            </div>
            <form id="gridea-search-form" data-update="1597935637693" action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
            </form>
        </div>
    </nav>

    
        <nav class="navbar-mobile" id="nav-mobile">
            <div class="container">
                <div class="navbar-header">
                    <div>
                        <a href="http://blog.ludangxin.club">
                            断剑重铸之日，骑士归来之时。
                        </a>
                        <!--en-->
                        <a id="mobile-toggle-theme-en" class="a en">&nbsp;Dark</a>
                        <!--zh-->
                        <a id="mobile-toggle-theme-zh" class="a zh">&nbsp;&#x6697;&#x9ED1;</a>
                    </div>
                    <form id="gridea-search-form" data-update="1597935637693" action="/search/index.html">
                        <input class="search-input" autocomplete="off" spellcheck="false" name="q" autofocus="true" placeholder="Search...">
                    </form>
                    <!--en-->
                    <div class="menu-toggle" id="menu-toggle-en" onclick="mobileBtn()">&#9776; Menu</div>
                    <!--zh-->
                    <div class="menu-toggle" id="menu-toggle-zh" onclick="mobileBtn()">&#9776; &#x83DC;&#x5355;</div>

                </div>
                <div class="menu" id="mobile-menu">
                    
                        <a class="menu-item" href="/">
                            🏠首页
                        </a>
                        
                        <a class="menu-item" href="/archives">
                            📚归档
                        </a>
                        
                        <a class="menu-item" href="/tags">
                            🏷️标签
                        </a>
                        
                        <a class="menu-item" href="/posts">
                            ✍️博客
                        </a>
                        
                        <a class="menu-item" href="/post/about/">
                            👦关于
                        </a>
                        
                </div>
            </div>
        </nav>
</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementById("menu-toggle-en");
        var toggleMenu_zh = document.getElementById("menu-toggle-zh");

        var mobileMenu = document.getElementById("mobile-menu");
        if (toggleMenu.display != "none") {
            if (toggleMenu.classList.contains("active")) {
                toggleMenu.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu.classList.add("active")
                mobileMenu.classList.add("active")
            }
        } else if (toggleMenu_zh.display != "none") {
            if (toggleMenu_zh.classList.contains("active")) {
                toggleMenu_zh.classList.remove("active")
                mobileMenu.classList.remove("active")
            } else {
                toggleMenu_zh.classList.add("active")
                mobileMenu.classList.add("active")
            }
        }

    }
</script>



    <script>
        (function(a, h, g, f, e, d, c, b) {
            b = function() {
                d = h.createElement(g);
                c = h.getElementsByTagName(g)[0];
                d.src = e;
                d.charset = "utf-8";
                d.async = 1;
                c.parentNode.insertBefore(d, c)
            };
            a["SeniverseWeatherWidgetObject"] = f;
            a[f] || (a[f] = function() {
                (a[f].q = a[f].q || []).push(arguments)
            });
            a[f].l = +new Date();
            if (a.attachEvent) {
                a.attachEvent("onload", b)
            } else {
                a.addEventListener("load", b, false)
            }
        }(window, document, "script", "SeniverseWeatherWidget", "//cdn.sencdn.com/widget2/static/js/bundle.js?t=" + parseInt((new Date().getTime() / 100000000).toString(), 10)));
        window.SeniverseWeatherWidget('show', {
            flavor: "slim",
            location: "WWEFQFPJZ7T8",
            geolocation: true,
            language: "auto",
            unit: "c",
            theme: "auto",
            token: "61bcc333-3305-4728-9465-6785274bb0a3",
            hover: "enabled",
            container: "tp-weather-widget"
        })
    </script>
    
            <div class="main">
                <div class="container">
                    <article class="post-wrap">
                        <header class="post-header">
                            <h1 class="post-title">
                                SpringBoot 集成 Mybatis-Plus
                            </h1>
                            
                                <!--en-->
                                <div class="post-meta en">
                                    Author:
                                    <a itemprop="author" rel="author" href="/">
                                        断剑重铸之日，骑士归来之时。
                                    </a>
                                    <span class="post-time">
                                Date: <a href="#">2020-08-20</a>
                            </span>
                                    <span class="post-readtime">Reading Time:<a
                                    href="#">31.6
                                    mins</a></span>
                                    <span class="post-words">words:<a href="#">6680</a></span>
                                    
                                            Views:
                                            <span data-hk-page="current"> - </span>
                                            
                                </div>
                                
                        </header>
                        
                            <img class="post-feature-image" src="http://blog.ludangxin.club/post-images/mybatis-plus.jpg" alt="">
                          
                        <div class="post-content">
                            <h2 id="1-mybatis-plus简介">1 Mybatis-Plus简介</h2>
<h3 id="11-简介">1.1 简介</h3>
<p>MyBatis-Plus（简称 MP）是一个 MyBatis 的增强工具，在 MyBatis 的基础上只做增强不做改变，为简化开发、提高效率而生。该框架由baomidou（苞米豆）组织开发并且开源的。官网：<a href="https://mp.baomidou.com/">https://mp.baomidou.com/</a>，码云地址：<a href="https://gitee.com/organizations/baomidou">https://gitee.com/organizations/baomidou</a><br>
<img src="http://blog.ludangxin.club/post-images/1597928865765.png" alt="" loading="lazy"><br>
<strong>愿景</strong><br>
我们的愿景是成为 MyBatis 最好的搭档，就像魂斗罗 中的 1P、2P，基友搭配，效率翻倍。<br>
<img src="http://blog.ludangxin.club/post-images/1597928952406.png" alt="" loading="lazy"></p>
<h3 id="12-特性">1.2 特性</h3>
<ul>
<li><strong>无侵入</strong>：只做增强不做改变，引入它不会对现有工程产生影响，如丝般顺滑</li>
<li><strong>损耗小</strong>：启动即会自动注入基本 CURD，性能基本无损耗，直接面向对象操作</li>
<li><strong>强大的 CRUD 操作</strong>：内置通用 Mapper、通用 Service，仅仅通过少量配置即可实现单表大部分 CRUD 操作，更有强大的条件构造器，满足各类使用需求</li>
<li><strong>支持 Lambda 形式调用</strong>：通过 Lambda 表达式，方便的编写各类查询条件，无需再担心字段写错</li>
<li><strong>支持多种数据库</strong>：支持 MySQL、MariaDB、Oracle、DB2、H2、HSQL、SQLite、Postgre、SQLServer2005、SQLServer 等多种数据库</li>
<li><strong>支持主键自动生成</strong>：支持多达 4 种主键策略（内含分布式唯一 ID 生成器 - Sequence），可自由配置，完美解决主键问题</li>
<li><strong>支持 XML 热加载</strong>：Mapper 对应的 XML 支持热加载，对于简单的 CRUD 操作，甚至可以无 XML 启动</li>
<li><strong>支持 ActiveRecord 模式</strong>：支持 ActiveRecord 形式调用，实体类只需继承 Model 类即可进行强大的 CRUD 操作</li>
<li><strong>支持自定义全局通用操作</strong>：支持全局通用方法注入（ Write once, use anywhere ）</li>
<li><strong>支持关键词自动转义</strong>：支持数据库关键词（order、key......）自动转义，还可自定义关键词</li>
<li><strong>内置代码生成器</strong>：采用代码或者 Maven 插件可快速生成 Mapper 、 Model 、 Service 、 Controller 层代码，支持模板引擎，更有超多自定义配置等您来使用</li>
<li><strong>内置分页插件</strong>：基于 MyBatis 物理分页，开发者无需关心具体操作，配置好插件之后，写分页等同于普通 List 查询</li>
<li><strong>内置性能分析插件</strong>：可输出 Sql 语句以及其执行时间，建议开发测试时启用该功能，能快速揪出慢查询</li>
<li><strong>内置全局拦截插件</strong>：提供全表 delete 、update 操作智能分析阻断，也可自定义拦截规则，预防误操作</li>
<li><strong>内置 Sql 注入剥离器</strong>：支持 Sql 注入剥离，有效预防 Sql 注入攻击</li>
</ul>
<h2 id="2-快速入门">2 快速入门</h2>
<h3 id="21-创建数据库及表">2.1 创建数据库及表</h3>
<figure data-type="image" tabindex="1"><img src="http://blog.ludangxin.club/post-images/1597928994208.png" alt="" loading="lazy"></figure>
<pre><code class="language-sql">-- 创建测试表
CREATE TABLE `sys_user` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `user_name` varchar(20) NOT NULL COMMENT '用户名',
  `name` varchar(30) DEFAULT NULL COMMENT '姓名',
  `age` int(11) DEFAULT NULL COMMENT '年龄',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

-- 插入测试数据
INSERT INTO `sys_user` (`id`, `user_name`, `name`, `age`) VALUES ('1', 'zhangsan', '张三', '18');
INSERT INTO `sys_user` (`id`, `user_name`, `name`, `age`) VALUES ('2', 'lisi', '李四', '20');
INSERT INTO `sys_user` (`id`, `user_name`, `name`, `age`) VALUES ('3', 'wangwu', '王五', '28');
INSERT INTO `sys_user` (`id`, `user_name`, `name`, `age`) VALUES ('4', 'zhaoliu', '赵六', '21');
INSERT INTO `sys_user` (`id`, `user_name`, `name`, `age`) VALUES ('5', 'sunqi', '孙七', '24');
~~~![](http://blog.ludangxin.club/post-images/1597929873595.jpg)
### 2.2 工程搭建
#### 完整的项目结构图示
![](http://blog.ludangxin.club/post-images/1597929500996.jpg)
#### 2.2.1 添加所需依赖
~~~xml
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!--简化代码的工具包--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;!--mybatis-plus的springboot支持--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;3.3.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--mysql驱动--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;version&gt;5.1.47&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<h4 id="222-配置-applicationyml">2.2.2 配置 application.yml</h4>
<pre><code class="language-yaml">spring:
  datasource:
    # Oracle: oracle.jdbc.OracleDriver
    #  5.7之前版本使用 com.mysql.jdbc.Driver 
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/mp?useUnicode=true&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8
    username: root
    password: root
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      minimum-idle: 5
      maximum-pool-size: 5
      auto-commit: true
      idle-timeout: 30000
      pool-name: DatebookHikariCP
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1  # Oracle: SELECT 1 FROM DUAL

mybatis-plus:
  # 设置Mapper接口所对应的XML文件位置，如果你在Mapper接口中有自定义方法，需要进行该配置
  mapper-locations: classpath*:mybatis/*.xml
  # 设置别名包扫描路径，通过该属性可以给包中的类注册别名
  type-aliases-package: com.ludangxin.mp.pojo
  configuration:
    # 控制台sql打印
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

</code></pre>
<h4 id="223-编写pojo">2.2.3 编写pojo</h4>
<pre><code class="language-java">import com.baomidou.mybatisplus.annotation.TableName;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
@TableName(&quot;sys_user&quot;)
public class User {
    @TableId(&quot;ID&quot;)
    private Long id;
    //驼峰命名,则无需注解
    @TableField(&quot;USER_NAME&quot;) 
    private String userName; 
    @TableField(&quot;NAME&quot;)
    private String name;
    @TableField(&quot;AGE&quot;)
    private Integer age;
}
</code></pre>
<h4 id="225-编写mapper接口和配置文件">2.2.5 编写mapper接口和配置文件</h4>
<pre><code class="language-java">import com.ludangxin.mp.pojo.User;
import com.baomidou.mybatisplus.core.mapper.BaseMapper;

public interface UserMapper extends BaseMapper&lt;User&gt; {
}
</code></pre>
<p>在resources目录下新建一个文件夹mybatis，专门存放mapper配置文件</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;com.ludangxin.mp.mapper.UserMapper&quot;&gt;
    
&lt;/mapper&gt;
</code></pre>
<h4 id="226-修改启动类">2.2.6 修改启动类</h4>
<pre><code class="language-java">import org.mybatis.spring.annotation.MapperScan;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.WebApplicationType;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.builder.SpringApplicationBuilder;

//设置mapper接口的扫描包
@MapperScan(&quot;com.ludangxin.mp.mapper&quot;) 
@SpringBootApplication
public class MyApplication {
    public static void main(String[] args) {
        SpringApplication.run(MyApplication.class, args);
    }
}
</code></pre>
<h4 id="227-编写测试用例">2.2.7 编写测试用例</h4>
<pre><code class="language-java">import com.ludangxin.mp.mapper.UserMapper;
import com.ludangxin.mp.pojo.User;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import java.util.List;

@RunWith(SpringRunner.class)
@SpringBootTest
public class TestMybatisSpringBoot {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void testSelect() {
        //根据id查询数据
        User user = userMapper.selectById(2L);
        System.out.println(user);
    }

}
</code></pre>
<p>测试结果：</p>
<pre><code class="language-shell">JDBC Connection [HikariProxyConnection@358849801 wrapping com.mysql.cj.jdbc.ConnectionImpl@4fba8eec] will not be managed by Spring
==&gt;  Preparing: SELECT ID,USER_NAME,NAME,AGE FROM sys_user WHERE ID=? 
==&gt; Parameters: 2(Long)
&lt;==    Columns: ID, USER_NAME, NAME, AGE
&lt;==        Row: 2, lisi, 李四, 20
&lt;==      Total: 1
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@39da5e49]
User(id=2, userName=lisi, name=李四, age=20)
</code></pre>
<h2 id="3-通用crud">3 通用CRUD</h2>
<pre><code>在入门案例中，我们的Mapper接口继承了BaseMapper，然后就可以进行到各种各样的单表操作，接下来我们将详细讲解这些操作。
</code></pre>
<figure data-type="image" tabindex="2"><img src="http://blog.ludangxin.club/post-images/1597929052973.png" alt="" loading="lazy"></figure>
<h3 id="31-插入操作">3.1 插入操作</h3>
<h4 id="311-insert方法">3.1.1 insert方法</h4>
<pre><code class="language-java">/**
 * 插入一条记录
 * @param entity 实体对象
*/
int insert(T entity);
</code></pre>
<h4 id="312-测试用例">3.1.2 测试用例</h4>
<pre><code class="language-java">import com.ludangxin.mp.mapper.UserMapper;
import com.ludangxin.mp.pojo.User;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringRunner;

import java.util.List;

@RunWith(SpringRunner.class)
@SpringBootTest
public class TestUserMapper {

    @Autowired
    private UserMapper userMapper;

    @Test
    public void testInsert(){
        User user = new User();
        user.setAge(301);
        user.setUserName(&quot;caocao&quot;);
        user.setName(&quot;曹操&quot;);

        //返回的result是受影响的行数，并不是自增后的id
        int result = userMapper.insert(user); 
        System.out.println(&quot;result = &quot; + result); 

        //自增后的id会回填到对象中
        System.out.println(user.getId()); 
    }
}
</code></pre>
<p>测试结果：</p>
<pre><code class="language-shell">JDBC Connection [HikariProxyConnection@1240320816 wrapping com.mysql.cj.jdbc.ConnectionImpl@59303963] will not be managed by Spring
==&gt;  Preparing: INSERT INTO sys_user ( ID, USER_NAME, NAME, AGE ) VALUES ( ?, ?, ?, ? ) 
==&gt; Parameters: 1295736901034086401(Long), caocao(String), 曹操(String), 301(Integer)
&lt;==    Updates: 1
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@108e9837]
result = 1
1295736901034086401
</code></pre>
<h4 id="313-主键生成策略">3.1.3 主键生成策略</h4>
<pre><code>在刚才的例子中，数据已经保存到了数据库，但是id的值不是我们期望的自增长，而是MP生成了id的值并写入到了数据库。我们也可以通过IdType类自己设置id的生成策略。
</code></pre>
<pre><code class="language-java">package com.baomidou.mybatisplus.annotation;
import lombok.Getter;

/**
 * 生成ID类型枚举类
 */
@Getter
public enum IdType {
    /**
     * 数据库ID自增
     */
    AUTO(0),
    /**
     * 该类型为未设置主键类型，这是默认值
     */
    NONE(1),
    /**
     * 用户输入ID
     * &lt;p&gt;该类型可以通过自己注册自动填充插件进行填充&lt;/p&gt;
     */
    INPUT(2),

    /* 以下3种类型、只有当插入对象ID为空，才自动填充。 */
    /**
     * 全局唯一ID (idWorker)
     */
    ID_WORKER(3),
    /**
     * 全局唯一ID (UUID)
     */
    UUID(4),
    /**
     * 字符串全局唯一ID (idWorker的字符串表示)
     */
    ID_WORKER_STR(5);

    private final int key;

    IdType(int key) {
        this.key = key;
    }
}

</code></pre>
<p>修改User对象，设置id为自增长：</p>
<pre><code class="language-java">import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
@AllArgsConstructor
@TableName(&quot;sys_user&quot;)
public class User {

    @TableId(type = IdType.AUTO) //指定id为自增长
    private Long id;
    ... ...
}
</code></pre>
<h3 id="32-更新操作">3.2 更新操作</h3>
<h4 id="321-updatebyid方法">3.2.1 updateById方法</h4>
<pre><code class="language-java">/**
 * 根据ID修改
 * @param entity 实体对象
 */
int updateById(@Param(Constants.ENTITY) T entity);
</code></pre>
<p>####　3.2.2 测试用例</p>
<pre><code class="language-java">    @Test
    public void testUpdateById() {
        User user = new User();
        user.setId(5L); //主键
        user.setAge(21); //更新的字段

        //根据id更新，更新不为null的字段
        this.userMapper.updateById(user);
    }

}
</code></pre>
<p>测试结果：</p>
<pre><code class="language-shell">JDBC Connection [HikariProxyConnection@864078397 wrapping com.mysql.cj.jdbc.ConnectionImpl@23310248] will not be managed by Spring
==&gt;  Preparing: UPDATE sys_user SET AGE=? WHERE id=? 
==&gt; Parameters: 21(Integer), 5(Long)
&lt;==    Updates: 1
</code></pre>
<h3 id="33-删除操作">3.3 删除操作</h3>
<h4 id="331-deletebyid">3.3.1 deleteById</h4>
<pre><code class="language-java">/**
 * 根据 ID 删除
 * @param id 主键ID
 */
int deleteById(Serializable id);
</code></pre>
<h4 id="332-测试用例">3.3.2 测试用例</h4>
<pre><code class="language-java">	@Test
    public void testDeleteById() {
        //执行删除操作
        int result = this.userMapper.deleteById(6L);
        System.out.println(&quot;result = &quot; + result);
    }
}
</code></pre>
<p>测试结果：</p>
<pre><code class="language-shell">JDBC Connection [HikariProxyConnection@103068963 wrapping com.mysql.cj.jdbc.ConnectionImpl@50b46e24] will not be managed by Spring
==&gt;  Preparing: DELETE FROM sys_user WHERE id=? 
==&gt; Parameters: 5(Long)
&lt;==    Updates: 1
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@5934ca1e]
result = 1
</code></pre>
<h4 id="333-批量删除">3.3.3 批量删除</h4>
<pre><code class="language-java">	@Test 
    public void testDeleteByIds() { 
        //根据id集合批量删除 
        int result = this.userMapper.deleteBatchIds(Arrays.asList(1L,10L,20L));
        System.out.println(&quot;result = &quot; + result); 
    }
</code></pre>
<h3 id="34-查询操作">3.4 查询操作</h3>
<p>MP提供了多种查询操作，包括根据id查询、批量查询、查询单条数据、查询列表、分页查询等操作。</p>
<h4 id="341-selectbyid">3.4.1 selectById</h4>
<pre><code class="language-java">/**
 * 根据ID查询
 * @param id 主键ID
 */
T selectById(Serializable id);
</code></pre>
<h4 id="342-测试用例">3.4.2 测试用例</h4>
<pre><code class="language-java">    @Test
    public void testSelectById() {
        //根据id查询数据
        User user = this.userMapper.selectById(2L);
        System.out.println(&quot;result = &quot; + user);
    }
}
</code></pre>
<p>测试结果：</p>
<pre><code class="language-shell">JDBC Connection [HikariProxyConnection@1317052417 wrapping com.mysql.cj.jdbc.ConnectionImpl@624b523] will not be managed by Spring
==&gt;  Preparing: SELECT id,USER_NAME,NAME,AGE FROM sys_user WHERE id=? 
==&gt; Parameters: 2(Long)
&lt;==    Columns: id, USER_NAME, NAME, AGE
&lt;==        Row: 2, lisi, 李四, 20
&lt;==      Total: 1
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@1cbc5693]
result = User(id=2, userName=lisi, name=李四, age=20)
</code></pre>
<h2 id="4-条件构造器">4 条件构造器</h2>
<pre><code>在增删改查中，最复杂的就是带有各种条件的操作。在MP中，专门针对sql条件进行了封装，提供了各种Wrapper接口及其实现类。XxxWrapper类提供了各种方法来封装sql条件。
</code></pre>
<figure data-type="image" tabindex="3"><img src="http://blog.ludangxin.club/post-images/1597929075718.png" alt="" loading="lazy"></figure>
<p>MP提供了各种方法用来支持带有条件的查询方法、修改方法和删除方法：</p>
<pre><code class="language-java">/**
根据 entity 条件，查询一条记录
@param queryWrapper 实体对象封装操作类（可以为null）
*/
T selectOne(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);

/**
根据 Wrapper 条件，查询总记录数
@param queryWrapper 实体对象封装操作类（可以为null）
*/
Integer selectCount(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);

/**
根据 entity 条件，查询全部记录
@param queryWrapper 实体对象封装操作类（可以为null）
*/
List&lt;T&gt; selectList(@Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);
</code></pre>
<p>下面我们以查询方法为例学习条件构造器的具体用法。</p>
<h3 id="41-比较操作">4.1 比较操作</h3>
<ul>
<li>eq
<ul>
<li>等于 =</li>
</ul>
</li>
<li>ne
<ul>
<li>不等于 &lt;&gt;</li>
</ul>
</li>
<li>gt
<ul>
<li>大于 &gt;</li>
</ul>
</li>
<li>ge
<ul>
<li>大于等于 &gt;=</li>
</ul>
</li>
<li>lt
<ul>
<li>小于 &lt;</li>
</ul>
</li>
<li>le
<ul>
<li>小于等于 &lt;=</li>
</ul>
</li>
<li>between
<ul>
<li>BETWEEN 值1 AND 值2</li>
</ul>
</li>
<li>notBetween
<ul>
<li>NOT BETWEEN 值1 AND 值2</li>
</ul>
</li>
<li>in
<ul>
<li>字段 IN (value.get(0), value.get(1), ...)</li>
</ul>
</li>
<li>notIn
<ul>
<li>字段 NOT IN (v0, v1, ...)</li>
</ul>
</li>
</ul>
<p>测试用例：</p>
<pre><code class="language-java">    @Test
    public void testEq() {
        QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;&gt;();

        //SELECT id,user_name,name,age FROM sys_user WHERE 
        // AND age &gt;= ? AND name IN (?,?,?)
        wrapper.ge(&quot;age&quot;, 20)
               .in(&quot;name&quot;, &quot;李四&quot;, &quot;王五&quot;, &quot;赵六&quot;);

        List&lt;User&gt; users = this.userMapper.selectList(wrapper);
        for (User user : users) {
            System.out.println(user);
        }
    }
}
</code></pre>
<p>测试结果:</p>
<pre><code class="language-shell">JDBC Connection [HikariProxyConnection@525275084 wrapping com.mysql.cj.jdbc.ConnectionImpl@46c10083] will not be managed by Spring
==&gt;  Preparing: SELECT id,USER_NAME,NAME,AGE FROM sys_user WHERE age &gt;= ? AND name IN (?,?,?) 
==&gt; Parameters: 20(Integer), 李四(String), 王五(String), 赵六(String)
&lt;==    Columns: id, USER_NAME, NAME, AGE
&lt;==        Row: 2, lisi, 李四, 20
&lt;==        Row: 3, wangwu, 王五, 28
&lt;==        Row: 4, zhaoliu, 赵六, 21
&lt;==      Total: 3
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@61149fa5]
User(id=2, userName=lisi, name=李四, age=20)
User(id=3, userName=wangwu, name=王五, age=28)
User(id=4, userName=zhaoliu, name=赵六, age=21)
</code></pre>
<h3 id="42-模糊查询">4.2 模糊查询</h3>
<ul>
<li>like
<ul>
<li>LIKE '%值%'</li>
<li>例: <code>like(&quot;name&quot;, &quot;王&quot;)</code>---&gt;<code>name like '%王%'</code></li>
</ul>
</li>
<li>notLike
<ul>
<li>NOT LIKE '%值%'</li>
<li>例: <code>notLike(&quot;name&quot;, &quot;王&quot;)</code>---&gt;<code>name not like '%王%'</code></li>
</ul>
</li>
<li>likeLeft
<ul>
<li>LIKE '%值'</li>
<li>例: <code>likeLeft(&quot;name&quot;, &quot;王&quot;)</code>---&gt;<code>name like '%王'</code></li>
</ul>
</li>
<li>likeRight
<ul>
<li>LIKE '值%'</li>
<li>例: <code>likeRight(&quot;name&quot;, &quot;王&quot;)</code>---&gt;<code>name like '王%'</code></li>
</ul>
</li>
</ul>
<p>测试用例：</p>
<pre><code class="language-java">    @Test
    public void testLike() {
        QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;&gt;();

        //SELECT id,user_name,name,age FROM sys_user WHERE name LIKE ?
        //Parameters: %曹%(String)
        wrapper.like(&quot;name&quot;, &quot;曹&quot;);

        List&lt;User&gt; users = this.userMapper.selectList(wrapper);
        for (User user : users) {
            System.out.println(user);
        }
    }
}
</code></pre>
<h3 id="43-排序">4.3 排序</h3>
<ul>
<li>orderBy
<ul>
<li>排序：ORDER BY 字段, ...</li>
<li>例: <code>orderBy(true, true, &quot;id&quot;, &quot;name&quot;)</code>---&gt;<code>order by id ASC,name ASC</code></li>
</ul>
</li>
<li>orderByAsc
<ul>
<li>排序：ORDER BY 字段, ... ASC</li>
<li>例: <code>orderByAsc(&quot;id&quot;, &quot;name&quot;)</code>---&gt;<code>order by id ASC,name ASC</code></li>
</ul>
</li>
<li>orderByDesc
<ul>
<li>排序：ORDER BY 字段, ... DESC</li>
<li>例: <code>orderByDesc(&quot;id&quot;, &quot;name&quot;)</code>---&gt;<code>order by id DESC,name DESC</code></li>
</ul>
</li>
</ul>
<p>测试用例：</p>
<pre><code class="language-java">    @Test
    public void testOrderByAgeDesc() {
        QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;&gt;();

        //SELECT id,user_name,name,age FROM sys_user ORDER BY age DESC
        wrapper.orderByDesc(&quot;age&quot;);

        List&lt;User&gt; users = this.userMapper.selectList(wrapper);
        for (User user : users) {
            System.out.println(user);
        }
    }
}
</code></pre>
<h3 id="44-逻辑查询">4.4 逻辑查询</h3>
<ul>
<li>or
<ul>
<li>拼接 OR</li>
<li>主动调用<code>or</code>表示紧接着下一个<strong>方法</strong>不是用<code>and</code>连接!(不调用<code>or</code>则默认为使用<code>and</code>连接)</li>
</ul>
</li>
<li>and
<ul>
<li>AND 嵌套</li>
<li>例: <code>and(i -&gt; i.eq(&quot;name&quot;, &quot;李白&quot;).ne(&quot;status&quot;, &quot;活着&quot;))</code>---&gt;<code>and (name = '李白' and status &lt;&gt; '活着')</code></li>
</ul>
</li>
</ul>
<p>测试用例：</p>
<pre><code class="language-java">	@Test
    public void testOr() {
        QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;&gt;();

        //SELECT id,user_name,name,age FROM sys_user WHERE 
        //name = ? OR age = ?
        wrapper.eq(&quot;name&quot;,&quot;李四&quot;).or().eq(&quot;age&quot;, 24);

        List&lt;User&gt; users = this.userMapper.selectList(wrapper);
        for (User user : users) {
            System.out.println(user);
        }
    }
}
</code></pre>
<pre><code class="language-java">	@Test
    public void testAnd() {
        QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;&gt;();

        //SELECT id,USER_NAME,NAME,AGE FROM sys_user WHERE age = ? AND ( name = ? OR user_Name = ? ) 
        wrapper.eq(&quot;age&quot;, 20)
        .and(obj -&gt; obj.eq(&quot;name&quot;,&quot;李四&quot;).or().eq(&quot;user_name&quot;, &quot;王五&quot;));

        List&lt;User&gt; users = this.userMapper.selectList(wrapper);
        for (User user : users) {
            System.out.println(user);
        }
    }
</code></pre>
<h3 id="45-分页查询">4.5 分页查询</h3>
<p>selectPage方法：</p>
<pre><code class="language-java">/**
 * 根据 entity 条件，查询全部记录（并翻页）
 * @param page         分页查询条件（可以为 RowBounds.DEFAULT）
 * @param queryWrapper 实体对象封装操作类（可以为 null）
 */
IPage&lt;T&gt; selectPage(IPage&lt;T&gt; page, @Param(Constants.WRAPPER) Wrapper&lt;T&gt; queryWrapper);
</code></pre>
<p>配置分页插件：</p>
<pre><code class="language-java">import com.baomidou.mybatisplus.extension.plugins.PaginationInterceptor;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class MybatisPlusConfig {

    /**
     * 分页插件
     */
    @Bean
    public PaginationInterceptor paginationInterceptor() {
        PaginationInterceptor paginationInterceptor = new PaginationInterceptor();
        // 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求  默认false
        // paginationInterceptor.setOverflow(false);
        // 设置最大单页限制数量，默认 500 条，-1 不受限制
        // paginationInterceptor.setLimit(500);
        // 开启 count 的 join 优化,只针对部分 left join
        paginationInterceptor.setCountSqlParser(new JsqlParserCountOptimize(true));
        return paginationInterceptor;
    }
}
</code></pre>
<p>测试用例：</p>
<pre><code class="language-java">    @Test
    public void testSelectPage() {
        QueryWrapper&lt;User&gt; wrapper = new QueryWrapper&lt;User&gt;();
        wrapper.gt(&quot;age&quot;, 20); //年龄大于20岁

        Page&lt;User&gt; page = new Page&lt;&gt;(1,1);

        //根据条件查询数据
        IPage&lt;User&gt; iPage = this.userMapper.selectPage(page, wrapper);
        System.out.println(&quot;数据总条数：&quot; + iPage.getTotal());
        System.out.println(&quot;总页数：&quot; + iPage.getPages());

        List&lt;User&gt; users = iPage.getRecords();
        for (User user : users) {
            System.out.println(&quot;user = &quot; + user);
        }
    }
}
</code></pre>
<p>测试结果:</p>
<pre><code class="language-sh">JDBC Connection [HikariProxyConnection@1663774813 wrapping com.mysql.cj.jdbc.ConnectionImpl@44598ef7] will not be managed by Spring
JsqlParserCountOptimize sql=SELECT  id,USER_NAME,NAME,AGE  FROM sys_user WHERE age &gt; ?
==&gt;  Preparing: SELECT COUNT(1) FROM sys_user WHERE age &gt; ? 
==&gt; Parameters: 20(Integer)
&lt;==    Columns: COUNT(1)
&lt;==        Row: 3
==&gt;  Preparing: SELECT id,USER_NAME,NAME,AGE FROM sys_user WHERE age &gt; ? LIMIT ?,? 
==&gt; Parameters: 20(Integer), 0(Long), 1(Long)
&lt;==    Columns: id, USER_NAME, NAME, AGE
&lt;==        Row: 3, wangwu, 王五, 28
&lt;==      Total: 1
Closing non transactional SqlSession [org.apache.ibatis.session.defaults.DefaultSqlSession@11d4d979]
数据总条数：3
总页数：3
user = User(id=3, userName=wangwu, name=王五, age=28)
</code></pre>
<h3 id="46-修改和删除">4.6 修改和删除</h3>
<pre><code>前面都是以查询为例讲解条件构造器，那么在进行修改和删除操作时也可以带条件，和查询基本一样，这里不再讲解，后面用到时再说。
</code></pre>
<pre><code class="language-java">/**
根据wrapper封装的条件进行更新操作
*/
int delete(@Param(&quot;ew&quot;) Wrapper&lt;T&gt; wrapper);

/**
根据wrapper封装的条件进行删除操作
*/
int update(@Param(&quot;et&quot;) T entity, @Param(&quot;ew&quot;) Wrapper&lt;T&gt; updateWrapper);
</code></pre>
<h3 id="47-lambda">4.7  lambda</h3>
<p>​	获取 <code>LambdaWrapper</code><br>
​	在<code>QueryWrapper</code>中是获取<code>LambdaQueryWrapper</code><br>
​	在<code>UpdateWrapper</code>中是获取<code>LambdaUpdateWrapper</code></p>
<p>​	<strong>强烈使用lambda表达式构建wrapper，无需再担心字段写错</strong></p>
<h4 id="471-测试用例">4.7.1 测试用例</h4>
<pre><code class="language-java">	@Test
    public void testLambdaSelect(){
        LambdaQueryWrapper lambdaQueryWrapper = new LambdaQueryWrapper&lt;User&gt;().eq(User::getUserName,&quot;zhangsan&quot;);
        //QueryWrapper&lt;User&gt; queryWrapper = new QueryWrapper&lt;&gt;();
        //queryWrapper.lambda().eq(User::getName, &quot;zhangsan&quot;);
        int result = this.userMapper.selectCount(lambdaQueryWrapper);
        System.out.println(&quot;result = &quot; + result);
    }
</code></pre>
<h2 id="5-mybatis-plus的service封装">5 Mybatis-Plus的Service封装</h2>
<pre><code>Mybatis-Plus为了开发更加快捷，对业务层也进行了封装，直接提供了相关的接口和实现类。我们在进行业务层开发时，可以继承它提供的接口和实现类，使得编码更加高效。
</code></pre>
<ol>
<li>
<p>com.baomidou.mybatisplus.extension.service.IService接口</p>
<p>该接口是一个泛型接口，里面提供了很多方法，包括基本的增删改查。<br>
<img src="http://blog.ludangxin.club/post-images/1597929094373.png" alt="" loading="lazy"></p>
</li>
<li>
<p>com.baomidou.mybatisplus.extension.service.impl.ServiceImpl类</p>
<p>该类实现了上面接口中的所有方法。</p>
</li>
<li>
<p>测试用例</p>
<p>1）自定义业务层接口，继承IService：</p>
<pre><code class="language-java">public interface UserService extends IService&lt;User&gt; {

}
</code></pre>
<p>2）自定义业务层实现类，继承ServiceImpl：</p>
<pre><code class="language-java">@Service
public class UserServiceImpl extends ServiceImpl&lt;UserMapper,User&gt; implements UserService {

}
</code></pre>
<p>3）测试类：</p>
<pre><code class="language-java">@RunWith(SpringRunner.class)
@SpringBootTest
public class TestUserService {
    @Autowired
    private UserService userService;

    @Test
    public void testInsert() {
        User user = new User();
        user.setAge(301);
        user.setUserName(&quot;caocao1&quot;);
        user.setName(&quot;曹操1&quot;);

        userService.save(user);

        //获取自增长后的id值, 自增长后的id值会回填到user对象中
        System.out.println(&quot;id =&gt; &quot; + user.getId());
    }

    @Test
    public void testSelectById() {
        User user = userService.getById(2);
        System.out.println(user);
    }

    @Test
    public void testUpdateById() {
        User user = new User();
        user.setId(1L); //条件，根据id更新
        user.setAge(19); //更新的字段

        userService.updateById(user);
    }

    @Test
    public void testDeleteById(){
        // 根据id删除数据
        userService.removeById(2L);
    }

}
</code></pre>
</li>
</ol>
<h2 id="6-oracle-主键-sequence">6 oracle 主键 Sequence</h2>
<p>在mysql中，主键往往是自增长的，这样使用起来是比较方便的，如果使用的是Oracle数据库，那么就不能使用自增长了，就得使用Sequence 序列生成id值了。</p>
<h3 id="61修改applicationproperties">6.1修改application.properties</h3>
<pre><code class="language-yaml">mybatis-plus:
  # 设置Mapper接口所对应的XML文件位置，如果你在Mapper接口中有自定义方法，需要进行该配置
  mapper-locations: classpath*:mybatis/*.xml
  # 设置别名包扫描路径，通过该属性可以给包中的类注册别名
  type-aliases-package: com.ludangxin.mp.pojo
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  # id 生成策略
  global-config:
    db-config:
      id-type: input
</code></pre>
<h3 id="62-mybatisplusconfig-增加序列生成器配置">6.2 MybatisPlusConfig 增加序列生成器配置</h3>
<pre><code class="language-java">/*** 序列生成器 */ 
@Bean 
public OracleKeyGenerator oracleKeyGenerator(){ 
    return new OracleKeyGenerator();
}
</code></pre>
<h2 id="7-逻辑删除">7 逻辑删除</h2>
<p>开发系统时，有时候在实现功能时，删除操作需要实现逻辑删除，所谓逻辑删除就是将数据标记为删除，而并非真正的物理删除（非DELETE操作），查询时需要携带状态条件，确保被标记的数据不被查询到。这样做的目的就是避免数据被真正的删除。</p>
<h3 id="71-增加字段">7.1 增加字段</h3>
<pre><code class="language-sql">ALTER TABLE sys_user ADD COLUMN deleted int(1) NULL DEFAULT 0 COMMENT '1代表删除，0代表未删除';
</code></pre>
<h3 id="72-修改pojo">7.2 修改pojo</h3>
<pre><code class="language-java">@TableLogic 
private Integer deleted;
</code></pre>
<h3 id="73-修改applicationyml">7.3 修改application.yml</h3>
<pre><code class="language-yaml">mybatis-plus:
  # 设置Mapper接口所对应的XML文件位置，如果你在Mapper接口中有自定义方法，需要进行该配置
  mapper-locations: classpath*:mybatis/*.xml
  # 设置别名包扫描路径，通过该属性可以给包中的类注册别名
  type-aliases-package: com.ludangxin.mp.pojo
  configuration:
    # 控制台sql打印
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      # 逻辑删除值为1
      logic-delete-value: 1
      # 逻辑未删除值为 0
      logic-not-delete-value: 0
</code></pre>
<h3 id="74-测试用例">7.4 测试用例</h3>
<pre><code class="language-java">@Test
    public void testDeleteById2() {
        this.userMapper.deleteById(3L);
    }
</code></pre>
<h3 id="75-测试结果">7.5 测试结果</h3>
<pre><code class="language-shell">JDBC Connection [HikariProxyConnection@2098830440 wrapping com.mysql.cj.jdbc.ConnectionImpl@63411512] will not be managed by Spring
==&gt;  Preparing: UPDATE sys_user SET deleted=1 WHERE id=? AND deleted=0 
==&gt; Parameters: 3(Long)
&lt;==    Updates: 1
</code></pre>
<h2 id="8-乐观锁">8   乐观锁</h2>
<h3 id="主要适用场景">主要适用场景</h3>
<p>意图：</p>
<p>当要更新一条记录的时候，希望这条记录没有被别人更新</p>
<p>乐观锁实现方式：</p>
<ul>
<li>取出记录时，获取当前version</li>
<li>更新时，带上这个version</li>
<li>执行更新时， set version = newVersion where version = oldVersion</li>
<li>如果version不对，就更新失败</li>
</ul>
<p><strong>乐观锁配置需要2步 记得两步</strong></p>
<h3 id="81-增加字段">8.1 增加字段</h3>
<pre><code class="language-sql">ALTER TABLE `sys_user` ADD COLUMN `version` int(10) NULL COMMENT '乐观锁' ;
</code></pre>
<h3 id="82-修改pojo">8.2  修改pojo</h3>
<pre><code class="language-java">@Version 
private Integer version;
</code></pre>
<h3 id="83-增加乐观锁配置">8.3 增加乐观锁配置</h3>
<pre><code class="language-java">/**
 * 乐观锁配置
 * @return
*/
@Bean
public OptimisticLockerInterceptor optimisticLockerInterceptor() {
    return new OptimisticLockerInterceptor();
}
</code></pre>
<h3 id="84-测试用例">8.4 测试用例</h3>
<pre><code class="language-java">@Test
    public void testUpdate(){
        User user = new User();
        user.setAge(30);
        user.setId(2L);
        //获取到version为1
        user.setVersion(1);        
        int result = this.userMapper.updateById(user);
        System.out.println(&quot;result = &quot; + result); 
    }
</code></pre>
<h3 id="85-测试结果">8.5 测试结果</h3>
<pre><code class="language-shell">JDBC Connection [HikariProxyConnection@2032547119 wrapping com.mysql.cj.jdbc.ConnectionImpl@5bc63e20] will not be managed by Spring
==&gt;  Preparing: UPDATE sys_user SET AGE=?, version=? WHERE id=? AND version=? AND deleted=0 
==&gt; Parameters: 30(Integer), 2(Integer), 2(Long), 1(Integer)
&lt;==    Updates: 0
</code></pre>
<p><strong>注:</strong> 操作记录数为0说明已经有人update了</p>
<h2 id="9-自动填充功能">9 自动填充功能</h2>
<p>示例工程：</p>
<p>👉 <a href="https://gitee.com/baomidou/mybatis-plus-samples/tree/master/mybatis-plus-sample-auto-fill-metainfo">mybatis-plus-sample-auto-fill-metainfo</a></p>
<h3 id="91-添加字段">9.1 添加字段</h3>
<pre><code class="language-sql">ALTER TABLE `sys_user` ADD COLUMN `create_by` VARCHAR(50) NULL COMMENT '创建人' ;
ALTER TABLE `sys_user` ADD COLUMN `update_by` VARCHAR(50) NULL COMMENT '修改人' ;
</code></pre>
<h3 id="92-修改pojo">9.2 修改pojo</h3>
<pre><code class="language-java">@TableField(fill = FieldFill.INSERT)
private String createBy;
@TableField(fill = FieldFill.UPDATE)
private String updateBy;
</code></pre>
<h4 id="921-fieldfill提供了多种模式选择">9.2.1 FieldFill提供了多种模式选择</h4>
<pre><code class="language-java">public enum FieldFill {
    /**
     * 默认不处理
     */
    DEFAULT,
    /**
     * 插入填充字段
     */
    INSERT,
    /**
     * 更新填充字段
     */
    UPDATE,
    /**
     * 插入和更新填充字段
     */
    INSERT_UPDATE
}
</code></pre>
<ul>
<li>自定义实现类 MyMetaObjectHandler</li>
</ul>
<pre><code class="language-java">import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;
import lombok.extern.slf4j.Slf4j;
import org.apache.ibatis.reflection.MetaObject;
import org.springframework.stereotype.Component;

@Slf4j
@Component
public class MyMetaObjectHandler implements MetaObjectHandler {

    @Override
    public void insertFill(MetaObject metaObject) {
//            Object createTime = getFieldValByName(&quot;createTime&quot;, metaObject);
//            //字段为空，可以进行填充
//            if (null == createTime) {
//                setFieldValByName(&quot;createTime&quot;, LocalDateTime.now(), metaObject);
//            }
            log.info(&quot;start insert fill ....&quot;);
            this.strictInsertFill(metaObject, &quot;createBy&quot;, String.class, this.getUserId());
        }

        @Override
        public void updateFill (MetaObject metaObject){
            log.info(&quot;start update fill ....&quot;);
            this.strictUpdateFill(metaObject, &quot;updateBy&quot;, String.class, this.getUserId());
        }

        private String getUserId() {
            return &quot;001&quot;;
        }
}
</code></pre>
<p>注意事项：</p>
<ul>
<li>填充原理是直接给<code>entity</code>的属性设置值!!!</li>
<li>注解则是指定该属性在对应情况下必有值,如果无值则入库会是<code>null</code></li>
<li><code>MetaObjectHandler</code>提供的默认方法的策略均为:如果属性有值则不覆盖,如果填充值为<code>null</code>则不填充</li>
<li>字段必须声明<code>TableField</code>注解,属性<code>fill</code>选择对应策略,该声明告知<code>Mybatis-Plus</code>需要预留注入<code>SQL</code>字段</li>
<li>填充处理器<code>MyMetaObjectHandler</code>在 Spring Boot 中需要声明<code>@Component</code>或<code>@Bean</code>注入</li>
<li>要想根据注解<code>FieldFill.xxx</code>和<code>字段名</code>以及<code>字段类型</code>来区分必须使用父类的<code>strictInsertFill</code>或者<code>strictUpdateFill</code>方法</li>
<li>不需要根据任何来区分可以使用父类的<code>fillStrategy</code>方法</li>
</ul>
<h3 id="93-执行新增操作日志">9.3 执行新增操作日志</h3>
<pre><code class="language-shell">JDBC Connection [HikariProxyConnection@897358809 wrapping com.mysql.cj.jdbc.ConnectionImpl@7aea704c] will not be managed by Spring
==&gt;  Preparing: INSERT INTO sys_user ( USER_NAME, NAME, AGE, create_by ) VALUES ( ?, ?, ?, ? ) 
==&gt; Parameters: caocao(String), 曹操(String), 301(Integer), 001(String)
&lt;==    Updates: 1
</code></pre>
<h2 id="10-多数据源配置">10 多数据源配置</h2>
<h3 id="简介">简介</h3>
<p>dynamic-datasource-spring-boot-starter 是一个基于springboot的快速集成多数据源的启动器。</p>
<p>其支持 <strong>Jdk 1.7+, SpringBoot 1.4.x 1.5.x 2.x.x</strong>。</p>
<p><strong>示例项目</strong> 可参考项目下的samples目录。</p>
<h3 id="特性">特性</h3>
<ol>
<li>支持 <strong>数据源分组</strong> ，适用于多种场景 纯粹多库 读写分离 一主多从 混合模式。</li>
<li>支持数据库敏感配置信息 <strong>加密</strong> ENC()。</li>
<li>支持每个数据库独立初始化表结构schema和数据库database。</li>
<li>支持 <strong>自定义注解</strong> ，需继承DS(3.2.0+)。</li>
<li>提供对Druid，Mybatis-Plus，P6sy，Jndi的快速集成。</li>
<li>简化Druid和HikariCp配置，提供 <strong>全局参数配置</strong> 。配置一次，全局通用。</li>
<li>提供 <strong>自定义数据源来源</strong> 方案。</li>
<li>提供项目启动后 <strong>动态增加移除数据源</strong> 方案。</li>
<li>提供Mybatis环境下的 <strong>纯读写分离</strong> 方案。</li>
<li>提供使用 <strong>spel动态参数</strong> 解析数据源方案。内置spel，session，header，支持自定义。</li>
<li>支持 <strong>多层数据源嵌套切换</strong> 。（ServiceA &gt;&gt;&gt; ServiceB &gt;&gt;&gt; ServiceC）。</li>
<li>提供对shiro，sharding-jdbc,quartz等第三方库集成的方案,注意事项和示例。</li>
<li>提供 <strong>基于seata的分布式事务方案。</strong> 附：不支持原生spring事务。</li>
</ol>
<h3 id="约定">约定</h3>
<ol>
<li>本框架只做 <strong>切换数据源</strong> 这件核心的事情，并<strong>不限制你的具体操作</strong>，切换了数据源可以做任何CRUD。</li>
<li>配置文件所有以下划线 <code>_</code> 分割的数据源 <strong>首部</strong> 即为组的名称，相同组名称的数据源会放在一个组下。</li>
<li>切换数据源可以是组名，也可以是具体数据源名称。组名则切换时采用负载均衡算法切换。</li>
<li>默认的数据源名称为 <strong>master</strong> ，你可以通过 <code>spring.datasource.dynamic.primary</code> 修改。</li>
<li>方法上的注解优先于类上注解。</li>
<li>强烈建议只在service的类和方法上添加注解，不建议在mapper上添加注解。</li>
</ol>
<h3 id="使用方法">使用方法</h3>
<ol>
<li>引入dynamic-datasource-spring-boot-starter。</li>
</ol>
<pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
  &lt;artifactId&gt;dynamic-datasource-spring-boot-starter&lt;/artifactId&gt;
  &lt;version&gt;${version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<ol>
<li>配置数据源。</li>
</ol>
<pre><code class="language-yaml">spring:
  datasource:
    dynamic:
      primary: master #设置默认的数据源或者数据源组,默认值即为master
      strict: false #设置严格模式,默认false不启动. 启动后在未匹配到指定数据源时候会抛出异常,不启动则使用默认数据源.
      datasource:
        master:
          url: jdbc:mysql://xx.xx.xx.xx:3306/dynamic
          username: root
          password: 123456
          driver-class-name: com.mysql.jdbc.Driver # 3.2.0开始支持SPI可省略此配置
        slave_1:
          url: jdbc:mysql://xx.xx.xx.xx:3307/dynamic
          username: root
          password: 123456
          driver-class-name: com.mysql.jdbc.Driver
        slave_2:
          url: ENC(xxxxx) # 内置加密,使用请查看详细文档
          username: ENC(xxxxx)
          password: ENC(xxxxx)
          driver-class-name: com.mysql.jdbc.Driver
          schema: db/schema.sql # 配置则生效,自动初始化表结构
          data: db/data.sql # 配置则生效,自动初始化数据
          continue-on-error: true # 默认true,初始化失败是否继续
          separator: &quot;;&quot; # sql默认分号分隔符
          
       #......省略
       #以上会配置一个默认库master，一个组slave下有两个子库slave_1,slave_2
# 多主多从                      纯粹多库（记得设置primary）                   混合配置
spring:                               spring:                               spring:
  datasource:                           datasource:                           datasource:
    dynamic:                              dynamic:                              dynamic:
      datasource:                           datasource:                           datasource:
        master_1:                             mysql:                                master:
        master_2:                             oracle:                               slave_1:
        slave_1:                              sqlserver:                            slave_2:
        slave_2:                              postgresql:                           oracle_1:
        slave_3:                              h2:                                   oracle_2:
</code></pre>
<ol>
<li>使用 <strong>@DS</strong> 切换数据源。</li>
</ol>
<p><strong>@DS</strong> 可以注解在方法上和类上，<strong>同时存在方法注解优先于类上注解</strong>。</p>
<p>强烈建议只注解在service实现上。</p>
<table>
<thead>
<tr>
<th style="text-align:center">注解</th>
<th style="text-align:center">结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">没有@DS</td>
<td style="text-align:center">默认数据源</td>
</tr>
<tr>
<td style="text-align:center">@DS(&quot;dsName&quot;)</td>
<td style="text-align:center">dsName可以为组名也可以为具体某个库的名称</td>
</tr>
</tbody>
</table>
<pre><code class="language-java">@Service
@DS(&quot;slave&quot;)
public class UserServiceImpl implements UserService {

  @Autowired
  private JdbcTemplate jdbcTemplate;

  public List selectAll() {
    return  jdbcTemplate.queryForList(&quot;select * from user&quot;);
  }
  
  @Override
  @DS(&quot;slave_1&quot;)
  public List selectByCondition() {
    return  jdbcTemplate.queryForList(&quot;select * from user where age &gt;10&quot;);
  }
}
</code></pre>
<hr>
<p><a href="https://baomidou.com/guide/dynamic-datasource.html#%E8%B5%B6%E7%B4%A7%E9%9B%86%E6%88%90%E4%BD%93%E9%AA%8C%E4%B8%80%E4%B8%8B%E5%90%A7%EF%BC%81-%E5%A6%82%E6%9E%9C%E9%9C%80%E8%A6%81%E6%9B%B4%E5%A4%9A%E5%8A%9F%E8%83%BD%E8%AF%B7%E7%82%B9%E5%87%BB%E4%B8%8B%E9%9D%A2%E9%93%BE%E6%8E%A5%E6%9F%A5%E7%9C%8B%E8%AF%A6%E7%BB%86%E6%96%87%E6%A1%A3%EF%BC%81">#</a>赶紧集成体验一下吧！ 如果需要更多功能请点击下面链接查看详细文档！</p>
<hr>
<p><a href="https://github.com/baomidou/dynamic-datasource-spring-boot-starter/wiki/FAQ">常见问题请点我</a> <a href="https://github.com/baomidou/dynamic-datasource-spring-boot-starter/wiki">分布式事务，加密,Druid集成，MybatisPlus集成，动态增减数据源，自定义切换规则,纯读写分离插件等等更多更细致的文档在这里</a></p>

                        </div>
                        
                            <div class="post-toc">
                                <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#1-mybatis-plus%E7%AE%80%E4%BB%8B">1 Mybatis-Plus简介</a>
<ul>
<li><a href="#11-%E7%AE%80%E4%BB%8B">1.1 简介</a></li>
<li><a href="#12-%E7%89%B9%E6%80%A7">1.2 特性</a></li>
</ul>
</li>
<li><a href="#2-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8">2 快速入门</a>
<ul>
<li><a href="#21-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%8A%E8%A1%A8">2.1 创建数据库及表</a>
<ul>
<li><a href="#222-%E9%85%8D%E7%BD%AE-applicationyml">2.2.2 配置 application.yml</a></li>
<li><a href="#223-%E7%BC%96%E5%86%99pojo">2.2.3 编写pojo</a></li>
<li><a href="#225-%E7%BC%96%E5%86%99mapper%E6%8E%A5%E5%8F%A3%E5%92%8C%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">2.2.5 编写mapper接口和配置文件</a></li>
<li><a href="#226-%E4%BF%AE%E6%94%B9%E5%90%AF%E5%8A%A8%E7%B1%BB">2.2.6 修改启动类</a></li>
<li><a href="#227-%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B">2.2.7 编写测试用例</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#3-%E9%80%9A%E7%94%A8crud">3 通用CRUD</a>
<ul>
<li><a href="#31-%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9C">3.1 插入操作</a>
<ul>
<li><a href="#311-insert%E6%96%B9%E6%B3%95">3.1.1 insert方法</a></li>
<li><a href="#312-%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B">3.1.2 测试用例</a></li>
<li><a href="#313-%E4%B8%BB%E9%94%AE%E7%94%9F%E6%88%90%E7%AD%96%E7%95%A5">3.1.3 主键生成策略</a></li>
</ul>
</li>
<li><a href="#32-%E6%9B%B4%E6%96%B0%E6%93%8D%E4%BD%9C">3.2 更新操作</a>
<ul>
<li><a href="#321-updatebyid%E6%96%B9%E6%B3%95">3.2.1 updateById方法</a></li>
</ul>
</li>
<li><a href="#33-%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C">3.3 删除操作</a>
<ul>
<li><a href="#331-deletebyid">3.3.1 deleteById</a></li>
<li><a href="#332-%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B">3.3.2 测试用例</a></li>
<li><a href="#333-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4">3.3.3 批量删除</a></li>
</ul>
</li>
<li><a href="#34-%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C">3.4 查询操作</a>
<ul>
<li><a href="#341-selectbyid">3.4.1 selectById</a></li>
<li><a href="#342-%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B">3.4.2 测试用例</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#4-%E6%9D%A1%E4%BB%B6%E6%9E%84%E9%80%A0%E5%99%A8">4 条件构造器</a>
<ul>
<li><a href="#41-%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C">4.1 比较操作</a></li>
<li><a href="#42-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2">4.2 模糊查询</a></li>
<li><a href="#43-%E6%8E%92%E5%BA%8F">4.3 排序</a></li>
<li><a href="#44-%E9%80%BB%E8%BE%91%E6%9F%A5%E8%AF%A2">4.4 逻辑查询</a></li>
<li><a href="#45-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2">4.5 分页查询</a></li>
<li><a href="#46-%E4%BF%AE%E6%94%B9%E5%92%8C%E5%88%A0%E9%99%A4">4.6 修改和删除</a></li>
<li><a href="#47-lambda">4.7  lambda</a>
<ul>
<li><a href="#471-%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B">4.7.1 测试用例</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#5-mybatis-plus%E7%9A%84service%E5%B0%81%E8%A3%85">5 Mybatis-Plus的Service封装</a></li>
<li><a href="#6-oracle-%E4%B8%BB%E9%94%AE-sequence">6 oracle 主键 Sequence</a>
<ul>
<li><a href="#61%E4%BF%AE%E6%94%B9applicationproperties">6.1修改application.properties</a></li>
<li><a href="#62-mybatisplusconfig-%E5%A2%9E%E5%8A%A0%E5%BA%8F%E5%88%97%E7%94%9F%E6%88%90%E5%99%A8%E9%85%8D%E7%BD%AE">6.2 MybatisPlusConfig 增加序列生成器配置</a></li>
</ul>
</li>
<li><a href="#7-%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4">7 逻辑删除</a>
<ul>
<li><a href="#71-%E5%A2%9E%E5%8A%A0%E5%AD%97%E6%AE%B5">7.1 增加字段</a></li>
<li><a href="#72-%E4%BF%AE%E6%94%B9pojo">7.2 修改pojo</a></li>
<li><a href="#73-%E4%BF%AE%E6%94%B9applicationyml">7.3 修改application.yml</a></li>
<li><a href="#74-%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B">7.4 测试用例</a></li>
<li><a href="#75-%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C">7.5 测试结果</a></li>
</ul>
</li>
<li><a href="#8-%E4%B9%90%E8%A7%82%E9%94%81">8   乐观锁</a>
<ul>
<li><a href="#%E4%B8%BB%E8%A6%81%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">主要适用场景</a></li>
<li><a href="#81-%E5%A2%9E%E5%8A%A0%E5%AD%97%E6%AE%B5">8.1 增加字段</a></li>
<li><a href="#82-%E4%BF%AE%E6%94%B9pojo">8.2  修改pojo</a></li>
<li><a href="#83-%E5%A2%9E%E5%8A%A0%E4%B9%90%E8%A7%82%E9%94%81%E9%85%8D%E7%BD%AE">8.3 增加乐观锁配置</a></li>
<li><a href="#84-%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B">8.4 测试用例</a></li>
<li><a href="#85-%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C">8.5 测试结果</a></li>
</ul>
</li>
<li><a href="#9-%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85%E5%8A%9F%E8%83%BD">9 自动填充功能</a>
<ul>
<li><a href="#91-%E6%B7%BB%E5%8A%A0%E5%AD%97%E6%AE%B5">9.1 添加字段</a></li>
<li><a href="#92-%E4%BF%AE%E6%94%B9pojo">9.2 修改pojo</a>
<ul>
<li><a href="#921-fieldfill%E6%8F%90%E4%BE%9B%E4%BA%86%E5%A4%9A%E7%A7%8D%E6%A8%A1%E5%BC%8F%E9%80%89%E6%8B%A9">9.2.1 FieldFill提供了多种模式选择</a></li>
</ul>
</li>
<li><a href="#93-%E6%89%A7%E8%A1%8C%E6%96%B0%E5%A2%9E%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97">9.3 执行新增操作日志</a></li>
</ul>
</li>
<li><a href="#10-%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE">10 多数据源配置</a>
<ul>
<li><a href="#%E7%AE%80%E4%BB%8B">简介</a></li>
<li><a href="#%E7%89%B9%E6%80%A7">特性</a></li>
<li><a href="#%E7%BA%A6%E5%AE%9A">约定</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">使用方法</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                            </div>
                            
                                
                                    
                                        <!--en-->
                                        <section class="post-copyright en">
                                            <p class="copyright-item">
                                                <span>Author:</span>
                                                <span>断剑重铸之日，骑士归来之时。</span>
                                            </p>

                                            <p class="copyright-item">
                                                <span>Permalink:</span>
                                                <span><a href="http://blog.ludangxin.club/post/mybatis-plus/">http://blog.ludangxin.club/post/mybatis-plus/</a></span>
                                            </p>

                                            <p class="copyright-item">
                                                <span>License:</span>
                                                <span>MIT License</span>
                                            </p>
                                        </section>
                                        
                                                
                                                    
                                                        <!-- Share-->
                                                        <span style="margin-right:15px">
                                                    <i class="post-share"></i>
                                                    <span>Share:</span>
                                                        <a title="QR Code" target="_blank" href="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://blog.ludangxin.club/post/mybatis-plus/"><i class="fa fa-qrcode"></i></a>
                                                        <a title="QQ" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://blog.ludangxin.club/post/mybatis-plus/&sharesource=qzone&title=SpringBoot 集成 Mybatis-Plus&pics=http://blog.ludangxin.club/images/avatar.png?v=1597935637693&summary="><i class="fa fa-qq"></i></a>
                                                        <a title="Weibo" target="_blank" href="https://service.weibo.com/share/share.php?url=http://blog.ludangxin.club/post/mybatis-plus/&sharesource=weibo&title=SpringBoot 集成 Mybatis-Plus + " - " + &pic="http://blog.ludangxin.club/images/avatar.png?v=1597935637693 "><i class="fa fa-weibo "></i></a>
                                                        
                                                                </span>
                                                                <!--en-->
                                                                <section class="post-tags en ">
                                                                    <div>
                                                                        <span>Tag(s):</span>
                                                                        <span class="tag ">
                        
                                                            </span>
                                                                    </div>
                                                                    <div>
                                                                        <a href="javascript:window.history.back();">back</a>
                                                                        <span>&dot;</span>
                                                                        <a href="#">home</a>
                                                                    </div>
                                                                </section>
                                                                
                                                                                <!---->
                                                                                <section class="post-nav">
                                                                                    
                                                                                            
                                                                                                <a class="next" rel="next" href="http://blog.ludangxin.club/post/springboot-ji-cheng-ren-wu-diao-du/">
                                                                                                    SpringBoot  集成 任务调度
                                                                                                </a>
                                                                                                
                                                                                </section>
                    </article>
                </div>
                
                                            
                                                <script type="application/javascript" src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
<div id="vlaine-comment"></div>
<script type="application/javascript">
    new Valine({
        el: '#vlaine-comment',
        appId: '6v8KE1xPEnnI3VycbaTHPQvD-gzGzoHsz',
        appKey: 'tCAPkuAx3JWn7YrPKlEpyaMH',
        pageSize: 10,
        avatar: 'mp',
        placeholder: '来都来了，不妨评论一下',
        visitor: true,
        highlight: false,
        recordIP: true,
    })
</script>
                                                    
            </div>
    </div>
    </div>
    </div>
    
        <footer id="footer" class="footer">
            <div class="copyright">
                
                    <div class="Like">
                        <div class="tip" data-tooltip="Do you like it?">
                            <a href="https://github.com/ITJoker233/Gridea-theme-Chic" target="_blank" title=""><svg class="icon"
                        aria-hidden="true">
                        <use xlink:href="#like"></use>
                    </svg><b class="like_text" id="star"></b></a>
                        </div>
                    </div>
                    
                        Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a>
                            
                                <b id="hitokoto"></b><br>
                                
                                        <svg viewBox="0 0 1024 1024" style="margin-left: 5px;margin-right: 5px;" version="1.0" width="8" height="8" class="my-face">
            <path
                d="M863.597631 513.574282l-271.33965-140.213484L729.783667 81.926656c3.583731-7.87141 7.167462-15.742819 7.167462-25.214109C736.887134 25.226908 708.345275 0.012799 672.635953 0.012799a63.611229 63.611229 0 0 0-39.293053 12.607055c-1.791866 1.59988-3.519736 3.19976-5.311602 3.19976L147.87531 418.925381a55.547834 55.547834 0 0 0-19.646527 47.356448c1.791866 17.278704 14.27093 33.021523 32.125591 42.492813l271.33965 141.749369L292.504463 945.221908c-12.479064 25.214109-1.791866 53.563983 23.166262 69.306802 10.751194 6.335525 23.230258 9.47129 35.709322 9.47129 16.062795 0 32.125591-4.735645 44.604655-15.742819l480.091993-403.297753a55.547834 55.547834 0 0 0 19.646526-47.228458 61.243407 61.243407 0 0 0-32.12559-44.156688z"
                fill="#93b5cf"></path>
        </svg>
                                        断剑重铸之日，骑士归来之时。 &copy;Copyright
                                            <script>
                                                var date = new Date();
                                                document.write("" + date.getFullYear());
                                            </script>
                                            | Powered by
                                            <a href="https://coding.net" target="_blank">
                                                Coding.net
                                            </a>
            </div>
            <div id="update" style="display:none;">
                on
            </div>
            
                <div id="version" style="display:none;">
                    1.7.4
                </div>
                
                    <script>
                        var port = '';
                        
                        document.write('<div id="home_path" style="display:none;">' + document.location.protocol + '//' + window.document.location.hostname + port + '</div>')
                    </script>
        </footer>
        
            <script src='https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js'></script>
            
                <script>
                    
                    
                    loadlive2d();
                    
                    
                    hitokoto();
                    
                    getStar();
                    hljs.initHighlighting();
                    console.clear();
                    
                    CheckVersion();
                    
                    var newDate = new Date();
                    newDate.setTime(1597935637693);
                    console.log(" Blog Update Time: " + newDate.toLocaleDateString());
                    console.log("\n %c \u26a1Theme:Chic Author's Blog:https://blog.itjoker.cn  Write By ITJoker  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;");
                </script>
        </div>
</body>
<script>
    scroll();
</script>

</html>